
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ffs_fibs_inf_bridge</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-06-13"><meta name="DC.source" content="ffs_fibs_inf_bridge.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FFS_FIBS_INF_BRIDGE Amount of Informal Borrowing Needed as Bridge Loans</a></li><li><a href="#3">Default and Parse Parameters</a></li><li><a href="#4">Bridge Loan Required</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> [max_c_nextperiod_nobridge, fl_for_borr, fl_for_save, fl_inf_borr] = ffs_fibs_inf_bridge(varargin)
</pre><h2 id="2">FFS_FIBS_INF_BRIDGE Amount of Informal Borrowing Needed as Bridge Loans</h2><p>Bridge loan needed to pay for debt that is still unpaid due to insufficient cash on hand. Only informal lender or some other lender willing to extend this loan offers it</p><div><ol><li>borrow all 5 informally</li><li>borrow 3 formally and 2 informally</li><li>borrow 6 formally and save 1</li><li>additionally, if 5 is actually on the grid, you would borrow 5 only formally if that offers the lower interest rate.</li></ol></div><p>This function here finds which one of of these options is optimal conditional on aprime choice. Households choose among the different aprime choices given these within aprime choice optimal formal/informal allocations.</p><p><b>aprime</b> is the borrowing choices that do not include bridge loan. The additional borrowing on top of bridge loans.</p><p>@param bl_b_is_principle boolean solving with aggregate savings as savings + debt principles + interests, or just principles no interests. if true, principels only, no interests.</p><p>@param fl_r_inf float informal interest rate</p><p>@param fl_r_fsv float (formal) savings interest rate</p><p>@param fl_r_fbr float borrowing interest rate</p><p>@param ar_aprime array N by 1 level of aggregate borrowing excluding bridge loan. Note that bridge loan is needed if coh is negative and households can not pay back principle and interests.</p><p>@param coh_today array N by 1 the level of cash-on-hand today, when the borrowing and savings decisions are made. If this is positive, then households freely borrow, do not need bridge loans. If this is negative households need to first borrow to meet bridge loan needs.</p><p>@return max_c_nextperiod array maximum next period consumption given aprime and optimal formal informal choices</p><p>@return fl_for_borr array formal borrowing choices that maximized next period consumption for each element of aprime vector</p><p>@return fl_for_save array (formal) savings choices that maximized next period consumption for each element of aprime vector</p><p>@return fl_inf_borr array informal borrowing choices that maximized next period consumption for each element of aprime vector</p><p>@example</p><pre class="language-matlab">[max_c, fl_for_borr, fl_for_save, fl_inf_borr, fl_coh_add] = <span class="keyword">...</span>
     ffs_akz_set_functions(bl_b_is_principle, fl_r_bridge, ar_aprime, ar_coh_today);
</pre><h2 id="3">Default and Parse Parameters</h2><pre class="codeinput">bl_input_override = 0;
<span class="keyword">if</span> (length(varargin) == 6)
    bl_input_override = varargin{6};
<span class="keyword">end</span>

<span class="keyword">if</span> (bl_input_override)
    <span class="comment">% override when called from outside</span>
    [bl_b_is_principle, fl_r_bridge, ar_aprime, ar_coh_today, bl_display_infbridge, ~] = varargin{:};
<span class="keyword">else</span>
    close <span class="string">all</span>

    <span class="comment">% Default</span>
    it_param_set = 4;
    [param_map, ~] = ffs_abz_fibs_set_default_param(it_param_set);

    <span class="comment">% Gather Inputs from param_map</span>
    params_group = values(param_map, {<span class="string">'bl_b_is_principle'</span>, <span class="string">'fl_r_inf'</span>});
    [bl_b_is_principle, fl_r_inf] = params_group{:};

    <span class="comment">% For benchmark, assume that the informal lender</span>
    fl_r_bridge = fl_r_inf;

    <span class="comment">% Testing COH and Aprime Vectors</span>
    ar_aprime =    [-5,-5, -4.5,-4.5, -0.1,-0.1]';
    ar_coh_today = [ 1, -1,   1,-1,      1,0 ]';

    <span class="comment">% Set Display Control</span>
    bl_display_infbridge = true;
<span class="keyword">end</span>
</pre><h2 id="4">Bridge Loan Required</h2><p>when coh &lt;= cmin/0. Income does not fully repay debts. Suppose formal lenders have strict rules about not allowing for roll-over. Then when this happens, households would go to default state if default is allowed. If default is not allowed, households would never borrow such that coh ends up lower than 0. But now informal lender comes in and is willing to offer bridge loan. This bridge loan might be a fraction of total debt taken out last period, and it will become share of the debt carried on today. Or households after using bridge loan to cover debt, actually end up saving in net.</p><pre class="codeinput">b_bridge = zeros(size(ar_coh_today));

<span class="keyword">if</span> (bl_b_is_principle)

    <span class="comment">% c_bridge is cost of borrowing in next period consumption</span>
    b_bridge(ar_coh_today&lt;0) = ar_coh_today(ar_coh_today&lt;0);
    c_bridge = b_bridge.*(1+fl_r_bridge);

<span class="keyword">else</span>

    <span class="comment">% c_bridge is the gain from borrowing in current period consumption</span>
    b_bridge(ar_coh_today&lt;0) = ar_coh_today(ar_coh_today&lt;0).*(1+fl_r_bridge);
    c_bridge = (-1)*b_bridge./(1+fl_r_bridge);

<span class="keyword">end</span>

<span class="comment">% remaining aprime after allocating to pay debt not covered by coh</span>
ar_aprime_nobridge = ar_aprime - b_bridge;

<span class="keyword">if</span> (bl_display_infbridge)
    tab_aprime_bridge = table(ar_coh_today, b_bridge, c_bridge, ar_aprime, ar_aprime_nobridge);
    disp(<span class="string">'coh_today: includes all income - debt'</span>);
    disp(tab_aprime_bridge);
<span class="keyword">end</span>

<span class="comment">% Display</span>
<span class="keyword">if</span> (bl_display_infbridge)
    tab_bridge = table(ar_coh_today, ar_aprime, ar_aprime_nobridge, c_bridge, b_bridge);
    disp(tab_bridge);
<span class="keyword">end</span>
</pre><pre class="codeoutput">coh_today: includes all income - debt
    ar_coh_today    b_bridge    c_bridge    ar_aprime    ar_aprime_nobridge
    ____________    ________    ________    _________    __________________

          1              0         0            -5                -5       
         -1          -1.06         1            -5             -3.94       
          1              0         0          -4.5              -4.5       
         -1          -1.06         1          -4.5             -3.44       
          1              0         0          -0.1              -0.1       
          0              0         0          -0.1              -0.1       

    ar_coh_today    ar_aprime    ar_aprime_nobridge    c_bridge    b_bridge
    ____________    _________    __________________    ________    ________

          1             -5                -5              0             0  
         -1             -5             -3.94              1         -1.06  
          1           -4.5              -4.5              0             0  
         -1           -4.5             -3.44              1         -1.06  
          1           -0.1              -0.1              0             0  
          0           -0.1              -0.1              0             0  

</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%%
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

function [max_c_nextperiod_nobridge, fl_for_borr, fl_for_save, fl_inf_borr] = ffs_fibs_inf_bridge(varargin)
%% FFS_FIBS_INF_BRIDGE Amount of Informal Borrowing Needed as Bridge Loans
% Bridge loan needed to pay for debt that is still unpaid due to
% insufficient cash on hand. Only informal lender or some other lender
% willing to extend this loan offers it
%
% # borrow all 5 informally
% # borrow 3 formally and 2 informally
% # borrow 6 formally and save 1
% # additionally, if 5 is actually on the grid, you would borrow 5 only
% formally if that offers the lower interest rate. 
% 
% This function here finds which one of of these options is optimal
% conditional on aprime choice. Households choose among the different
% aprime choices given these within aprime choice optimal formal/informal
% allocations. 
%
% *aprime* is the borrowing choices that do not include bridge
% loan. The additional borrowing on top of bridge loans.
%
% @param bl_b_is_principle boolean solving with aggregate savings as
% savings + debt principles + interests, or just principles no interests.
% if true, principels only, no interests. 
%
% @param fl_r_inf float informal interest rate
%
% @param fl_r_fsv float (formal) savings interest rate
%
% @param fl_r_fbr float borrowing interest rate
%
% @param ar_aprime array N by 1 level of aggregate borrowing excluding
% bridge loan. Note that bridge loan is needed if coh is negative and
% households can not pay back principle and interests.
%
% @param coh_today array N by 1 the level of cash-on-hand today, when the
% borrowing and savings decisions are made. If this is positive, then
% households freely borrow, do not need bridge loans. If this is negative
% households need to first borrow to meet bridge loan needs. 
%
% @return max_c_nextperiod array maximum next period consumption given aprime and
% optimal formal informal choices
%
% @return fl_for_borr array formal borrowing choices that maximized next
% period consumption for each element of aprime vector
%
% @return fl_for_save array (formal) savings choices that maximized next
% period consumption for each element of aprime vector
%
% @return fl_inf_borr array informal borrowing choices that maximized next
% period consumption for each element of aprime vector
%
% @example
%
%   [max_c, fl_for_borr, fl_for_save, fl_inf_borr, fl_coh_add] = ...
%        ffs_akz_set_functions(bl_b_is_principle, fl_r_bridge, ar_aprime, ar_coh_today);
%

%% Default and Parse Parameters

bl_input_override = 0;
if (length(varargin) == 6)
    bl_input_override = varargin{6};
end

if (bl_input_override)
    % override when called from outside
    [bl_b_is_principle, fl_r_bridge, ar_aprime, ar_coh_today, bl_display_infbridge, ~] = varargin{:};
else
    close all
    
    % Default
    it_param_set = 4;
    [param_map, ~] = ffs_abz_fibs_set_default_param(it_param_set);        
    
    % Gather Inputs from param_map
    params_group = values(param_map, {'bl_b_is_principle', 'fl_r_inf'});
    [bl_b_is_principle, fl_r_inf] = params_group{:};
    
    % For benchmark, assume that the informal lender 
    fl_r_bridge = fl_r_inf;
    
    % Testing COH and Aprime Vectors
    ar_aprime =    [-5,-5, -4.5,-4.5, -0.1,-0.1]';
    ar_coh_today = [ 1, -1,   1,-1,      1,0 ]';
    
    % Set Display Control
    bl_display_infbridge = true;            
end

%% Bridge Loan Required
% when coh <= cmin/0. Income does not fully repay debts. Suppose formal
% lenders have strict rules about not allowing for roll-over. Then when
% this happens, households would go to default state if default is allowed.
% If default is not allowed, households would never borrow such that coh
% ends up lower than 0. But now informal lender comes in and is willing to
% offer bridge loan. This bridge loan might be a fraction of total debt
% taken out last period, and it will become share of the debt carried on
% today. Or households after using bridge loan to cover debt, actually end
% up saving in net. 

b_bridge = zeros(size(ar_coh_today));

if (bl_b_is_principle)
    
    % c_bridge is cost of borrowing in next period consumption
    b_bridge(ar_coh_today<0) = ar_coh_today(ar_coh_today<0);
    c_bridge = b_bridge.*(1+fl_r_bridge);
    
else
    
    % c_bridge is the gain from borrowing in current period consumption
    b_bridge(ar_coh_today<0) = ar_coh_today(ar_coh_today<0).*(1+fl_r_bridge);
    c_bridge = (-1)*b_bridge./(1+fl_r_bridge);
    
end

% remaining aprime after allocating to pay debt not covered by coh
ar_aprime_nobridge = ar_aprime - b_bridge;

if (bl_display_infbridge)
    tab_aprime_bridge = table(ar_coh_today, b_bridge, c_bridge, ar_aprime, ar_aprime_nobridge);
    disp('coh_today: includes all income - debt');
    disp(tab_aprime_bridge);    
end

% Display
if (bl_display_infbridge)
    tab_bridge = table(ar_coh_today, ar_aprime, ar_aprime_nobridge, c_bridge, b_bridge);
    disp(tab_bridge);    
end

end

##### SOURCE END #####
--></body></html>