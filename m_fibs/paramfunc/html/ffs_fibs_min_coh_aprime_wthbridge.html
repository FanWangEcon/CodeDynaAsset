
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ffs_fibs_min_coh_aprime_wthbridge</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-06-12"><meta name="DC.source" content="ffs_fibs_min_coh_aprime_wthbridge.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FFS_FIB_MIN_COH_aprime optimal borrow for+inf given borrowing</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">Bridge Loan Required</a></li><li><a href="#6">Compute Consumption Informal Borrowing only</a></li><li><a href="#7">Compute Consumption Values Formal + Informal Borrowing Jointly</a></li><li><a href="#8">Compute Consumption Values Formal Borrowing + Formal Savings</a></li><li><a href="#9">Maximize Consumption For non-Bridge Loan Component</a></li><li><a href="#10">Consumption Cost of Aprime Choice Bridge Loan includes</a></li><li><a href="#11">Process Results</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> [max_c_nextperiod_nobridge, fl_for_borr, fl_for_save, fl_inf_borr] = ffs_fibs_min_coh_aprime_wthbridge(varargin)
</pre><h2 id="2">FFS_FIB_MIN_COH_aprime optimal borrow for+inf given borrowing</h2><p>Suppose I want to borrow 5 dollar today. That will increase current consumption by 5 dollars, but its cost to next period cash-on-hand is a function of how I get the 5 dollar of borrowing, whether I borrow from formal sources, informal or joint sources. Suppose the formal borrowing grid has three points, you can borrow 0, 3 or 6, these are the options:</p><div><ol><li>borrow all 5 informally</li><li>borrow 3 formally and 2 informally</li><li>borrow 6 formally and save 1</li><li>additionally, if 5 is actually on the grid, you would borrow 5 only formally if that offers the lower interest rate.</li></ol></div><p>This function here finds which one of of these options is optimal conditional on aprime choice. Households choose among the different aprime choices given these within aprime choice optimal formal/informal allocations.</p><p><b>aprime</b> is the borrowing choices that do not include bridge loan. The additional borrowing on top of bridge loans.</p><p>@param fl_r_inf float informal interest rate</p><p>@param fl_r_fsv float (formal) savings interest rate</p><p>@param fl_r_fbr float borrowing interest rate</p><p>@param aprime array level of aggregate borrowing excluding bridge loan. Note that bridge loan is needed if coh is negative and households can not pay back principle and interests.</p><p>@param coh_today array the level of cash-on-hand today, when the borrowing and savings decisions are made. If this is positive, then households freely borrow, do not need bridge loans. If this is negative households need to first borrow to meet bridge loan needs.</p><p>@return max_c_nextperiod array maximum next period consumption given aprime and optimal formal informal choices</p><p>@return fl_for_borr array formal borrowing choices that maximized next period consumption for each element of aprime vector</p><p>@return fl_for_save array (formal) savings choices that maximized next period consumption for each element of aprime vector</p><p>@return fl_inf_borr array informal borrowing choices that maximized next period consumption for each element of aprime vector</p><p>@example</p><pre class="language-matlab">[max_c, fl_for_borr, fl_for_save, fl_inf_borr, fl_coh_add] = <span class="keyword">...</span>
     ffs_akz_set_functions(fl_r_inf, fl_r_fsv, fl_r_fbr, fl_for_br_block, aprime);
</pre><h2 id="3">Default</h2><pre class="codeinput">[fl_r_inf, fl_r_fsv, fl_r_fbr] = deal(0.15, 0.01, 0.06);
[fl_for_br_block] = -1;
[aprime] =    [-5,-5, -4.5,-4.5, -0.1,-0.1];
[coh_today] = [ 1, -1,   1,-1,      1,0 ];
bl_display_fibs_min_coh_aprime = true;
default_params = {fl_r_inf fl_r_fsv fl_r_fbr fl_for_br_block aprime coh_today bl_display_fibs_min_coh_aprime};
</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput"><span class="comment">% numvarargs is the number of varagin inputted</span>
[default_params{1:length(varargin)}] = varargin{:};
[fl_r_inf, fl_r_fsv, fl_r_fbr, fl_for_br_block, aprime, coh_today, <span class="keyword">...</span>
    bl_display_fibs_min_coh_aprime] = default_params{:};
</pre><h2 id="5">Bridge Loan Required</h2><pre class="codeinput">b_inf_bridge = zeros(size(coh_today));
b_inf_bridge(coh_today&lt;0) = coh_today(coh_today&lt;0);
c_bridge = b_inf_bridge.*(1+fl_r_inf);
aprime_nobridge = aprime - b_inf_bridge;

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_aprime_bridge = table(coh_today', b_inf_bridge', c_bridge', aprime', aprime_nobridge');
    tab_aprime_bridge.Properties.VariableNames = {<span class="string">'coh_today'</span>, <span class="string">'b_inf_bridge'</span>, <span class="string">'c_bridge'</span>, <span class="string">'aprime'</span>, <span class="string">'aprime_nobridge'</span>};
    disp(<span class="string">'coh_today: includes all income - debt'</span>);
    disp(tab_aprime_bridge);
<span class="keyword">end</span>
</pre><pre class="codeoutput">coh_today: includes all income - debt
    coh_today    b_inf_bridge    c_bridge    aprime    aprime_nobridge
    _________    ____________    ________    ______    _______________

        1              0              0         -5            -5      
       -1             -1          -1.15         -5            -4      
        1              0              0       -4.5          -4.5      
       -1             -1          -1.15       -4.5          -3.5      
        1              0              0       -0.1          -0.1      
        0              0              0       -0.1          -0.1      

</pre><h2 id="6">Compute Consumption Informal Borrowing only</h2><pre class="codeinput">b_infonly_inf = (aprime_nobridge);
c_infonly = b_infonly_inf.*(1+fl_r_inf);

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_c_infonly = table(aprime_nobridge', b_infonly_inf', c_infonly');
    tab_c_infonly.Properties.VariableNames = {<span class="string">'aprime_nobridge'</span>,<span class="string">'b_infonly_inf'</span>,<span class="string">'c_infonly'</span>};
    disp([<span class="string">'informal borrow interest (fl_r_inf):'</span>, num2str(fl_r_inf)]);
    disp(tab_c_infonly);
<span class="keyword">end</span>
</pre><pre class="codeoutput">informal borrow interest (fl_r_inf):0.15
    aprime_nobridge    b_infonly_inf    c_infonly
    _______________    _____________    _________

           -5                -5           -5.75  
           -4                -4            -4.6  
         -4.5              -4.5          -5.175  
         -3.5              -3.5          -4.025  
         -0.1              -0.1          -0.115  
         -0.1              -0.1          -0.115  

</pre><h2 id="7">Compute Consumption Values Formal + Informal Borrowing Jointly</h2><p>if right on grid, informal could be zero.</p><pre class="codeinput">for_br_block_dvd = aprime_nobridge./fl_for_br_block;
for_br_block_dvd_floor = abs(floor(for_br_block_dvd).*fl_for_br_block);
for_br_block_dvd_ceil = abs(ceil(for_br_block_dvd).*fl_for_br_block);

b_infforb_inf = (aprime_nobridge + for_br_block_dvd_floor);
b_infforb_for = -(for_br_block_dvd_floor);
c_infforb =  (b_infforb_inf.*(1+fl_r_inf) + b_infforb_for.*(1+fl_r_fbr));

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_c_infforb = table(aprime_nobridge', b_infforb_for', b_infforb_inf', c_infforb');
    tab_c_infforb.Properties.VariableNames = {<span class="string">'aprime_nobridge'</span>,<span class="string">'b_infforb_for'</span>,<span class="string">'b_infforb_inf'</span>,<span class="string">'c_infforb'</span>};
    disp([<span class="string">'formal borrow interest (fl_r_fbr):'</span>, num2str(fl_r_fbr)]);
    disp([<span class="string">'informal borrow interest (fl_r_inf):'</span>, num2str(fl_r_inf)]);
    disp([<span class="string">'formal block size (fl_for_br_block):'</span>, num2str(fl_for_br_block)]);
    disp(tab_c_infforb);
<span class="keyword">end</span>
</pre><pre class="codeoutput">formal borrow interest (fl_r_fbr):0.06
informal borrow interest (fl_r_inf):0.15
formal block size (fl_for_br_block):-1
    aprime_nobridge    b_infforb_for    b_infforb_inf    c_infforb
    _______________    _____________    _____________    _________

           -5               -5                 0            -5.3  
           -4               -4                 0           -4.24  
         -4.5               -4              -0.5          -4.815  
         -3.5               -3              -0.5          -3.755  
         -0.1                0              -0.1          -0.115  
         -0.1                0              -0.1          -0.115  

</pre><h2 id="8">Compute Consumption Values Formal Borrowing + Formal Savings</h2><pre class="codeinput">b_forbrsv_sav = (aprime_nobridge + for_br_block_dvd_ceil);
b_forbrsv_brr = -(for_br_block_dvd_ceil);
c_forbrsv = (b_forbrsv_sav*(1+fl_r_fsv) + b_forbrsv_brr*(1+fl_r_fbr));

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_c_forbrsv = table(aprime_nobridge', b_forbrsv_brr', b_forbrsv_sav', c_forbrsv');
    tab_c_forbrsv.Properties.VariableNames = {<span class="string">'aprime_nobridge'</span>,<span class="string">'b_forbrsv_brr'</span>,<span class="string">'b_forbrsv_sav'</span>,<span class="string">'c_infforb'</span>};
    disp([<span class="string">'formal borrow interest (fl_r_fbr):'</span>, num2str(fl_r_fbr)]);
    disp([<span class="string">'savings interest (fl_r_fsv):'</span>, num2str(fl_r_fsv)]);
    disp([<span class="string">'formal block size (fl_for_br_block):'</span>, num2str(fl_for_br_block)]);
    disp(tab_c_forbrsv);
<span class="keyword">end</span>
</pre><pre class="codeoutput">formal borrow interest (fl_r_fbr):0.06
savings interest (fl_r_fsv):0.01
formal block size (fl_for_br_block):-1
    aprime_nobridge    b_forbrsv_brr    b_forbrsv_sav    c_infforb
    _______________    _____________    _____________    _________

           -5               -5                 0            -5.3  
           -4               -4                 0           -4.24  
         -4.5               -5               0.5          -4.795  
         -3.5               -4               0.5          -3.735  
         -0.1               -1               0.9          -0.151  
         -0.1               -1               0.9          -0.151  

</pre><h2 id="9">Maximize Consumption For non-Bridge Loan Component</h2><p>Trying to minimize consumption costs</p><pre class="codeinput">[max_c_nextperiod_nobridge, max_idx] = max([c_infonly; c_infforb; c_forbrsv],[], 1);

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_c_max = table(aprime_nobridge', max_c_nextperiod_nobridge', max_idx', c_infonly', c_infforb', c_forbrsv');
    tab_c_max.Properties.VariableNames = {<span class="string">'aprime_nobridge'</span>, <span class="string">'max_c_nextperiod_nobridge'</span>, <span class="string">'max_idx'</span>, <span class="string">'c_infonly'</span>,<span class="string">'c_infforb'</span>,<span class="string">'c_forbrsv'</span>};
    disp([<span class="string">'informal borrow interest (fl_r_inf):'</span>, num2str(fl_r_inf)]);
    disp([<span class="string">'formal borrow interest (fl_r_fbr):'</span>, num2str(fl_r_fbr)]);
    disp([<span class="string">'savings interest (fl_r_fsv):'</span>, num2str(fl_r_fsv)]);
    disp([<span class="string">'formal block size (fl_for_br_block):'</span>, num2str(fl_for_br_block)]);
    disp(tab_c_max);
<span class="keyword">end</span>
</pre><pre class="codeoutput">informal borrow interest (fl_r_inf):0.15
formal borrow interest (fl_r_fbr):0.06
savings interest (fl_r_fsv):0.01
formal block size (fl_for_br_block):-1
    aprime_nobridge    max_c_nextperiod_nobridge    max_idx    c_infonly    c_infforb    c_forbrsv
    _______________    _________________________    _______    _________    _________    _________

           -5                     -5.3                 2         -5.75         -5.3         -5.3  
           -4                    -4.24                 2          -4.6        -4.24        -4.24  
         -4.5                   -4.795                 3        -5.175       -4.815       -4.795  
         -3.5                   -3.735                 3        -4.025       -3.755       -3.735  
         -0.1                   -0.115                 1        -0.115       -0.115       -0.151  
         -0.1                   -0.115                 1        -0.115       -0.115       -0.151  

</pre><h2 id="10">Consumption Cost of Aprime Choice Bridge Loan includes</h2><pre class="codeinput">aprime_c_cost_total = c_bridge + max_c_nextperiod_nobridge;

<span class="keyword">if</span> (bl_display_fibs_min_coh_aprime)
    tab_c_max = table(coh_today', aprime', aprime_nobridge', aprime_c_cost_total', <span class="keyword">...</span>
                        c_bridge', max_c_nextperiod_nobridge');
    tab_c_max.Properties.VariableNames = {<span class="string">'coh_today'</span>, <span class="string">'aprime'</span>, <span class="string">'aprime_c_cost_total'</span>, <span class="string">'aprime_nobridge'</span>,<span class="keyword">...</span>
                        <span class="string">'c_bridge'</span>, <span class="string">'max_c_nextperiod_nobridge'</span>};
    disp(tab_c_max);
<span class="keyword">end</span>
</pre><pre class="codeoutput">    coh_today    aprime    aprime_c_cost_total    aprime_nobridge    c_bridge    max_c_nextperiod_nobridge
    _________    ______    ___________________    _______________    ________    _________________________

        1           -5              -5                  -5.3              0                 -5.3          
       -1           -5              -4                 -5.39          -1.15                -4.24          
        1         -4.5            -4.5                -4.795              0               -4.795          
       -1         -4.5            -3.5                -4.885          -1.15               -3.735          
        1         -0.1            -0.1                -0.115              0               -0.115          
        0         -0.1            -0.1                -0.115              0               -0.115          

</pre><h2 id="11">Process Results</h2><pre class="codeinput">fl_for_borr = zeros(size(c_infonly));
fl_for_save = zeros(size(c_infonly));
fl_inf_borr = zeros(size(c_infonly));
fl_coh_add = zeros(size(c_infonly));

idx_infonly = (c_infonly==max_c_nextperiod_nobridge);
idx_infforb = (c_infforb==max_c_nextperiod_nobridge);
idx_forbrsv = (c_forbrsv==max_c_nextperiod_nobridge);

fl_inf_borr(idx_infonly) = b_infonly_inf(idx_infonly);
fl_coh_add(idx_infonly) = c_infonly(idx_infonly);

fl_for_borr(idx_infforb) = b_infforb_for(idx_infforb);
fl_inf_borr(idx_infforb) = b_infforb_inf(idx_infforb);
fl_coh_add(idx_infforb) = c_infforb(idx_infforb);

fl_for_borr(idx_forbrsv) = b_forbrsv_brr(idx_forbrsv);
fl_for_save(idx_forbrsv) = b_forbrsv_sav(idx_forbrsv);
fl_coh_add(idx_forbrsv) = c_forbrsv(idx_forbrsv);
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans =

   -5.3000   -4.2400   -4.7950   -3.7350   -0.1150   -0.1150

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%%
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

function [max_c_nextperiod_nobridge, fl_for_borr, fl_for_save, fl_inf_borr] = ffs_fibs_min_coh_aprime_wthbridge(varargin)
%% FFS_FIB_MIN_COH_aprime optimal borrow for+inf given borrowing
% Suppose I want to borrow 5 dollar today. That will increase current
% consumption by 5 dollars, but its cost to next period cash-on-hand is a
% function of how I get the 5 dollar of borrowing, whether I borrow from
% formal sources, informal or joint sources. Suppose the formal borrowing
% grid has three points, you can borrow 0, 3 or 6, these are the options:
%
% # borrow all 5 informally
% # borrow 3 formally and 2 informally
% # borrow 6 formally and save 1
% # additionally, if 5 is actually on the grid, you would borrow 5 only
% formally if that offers the lower interest rate. 
% 
% This function here finds which one of of these options is optimal
% conditional on aprime choice. Households choose among the different
% aprime choices given these within aprime choice optimal formal/informal
% allocations. 
%
% *aprime* is the borrowing choices that do not include bridge
% loan. The additional borrowing on top of bridge loans.
%
% @param fl_r_inf float informal interest rate
%
% @param fl_r_fsv float (formal) savings interest rate
%
% @param fl_r_fbr float borrowing interest rate
%
% @param aprime array level of aggregate borrowing excluding
% bridge loan. Note that bridge loan is needed if coh is negative and
% households can not pay back principle and interests.
%
% @param coh_today array the level of cash-on-hand today, when the
% borrowing and savings decisions are made. If this is positive, then
% households freely borrow, do not need bridge loans. If this is negative
% households need to first borrow to meet bridge loan needs. 
%
% @return max_c_nextperiod array maximum next period consumption given aprime and
% optimal formal informal choices
%
% @return fl_for_borr array formal borrowing choices that maximized next
% period consumption for each element of aprime vector
%
% @return fl_for_save array (formal) savings choices that maximized next
% period consumption for each element of aprime vector
%
% @return fl_inf_borr array informal borrowing choices that maximized next
% period consumption for each element of aprime vector
%
% @example
%
%   [max_c, fl_for_borr, fl_for_save, fl_inf_borr, fl_coh_add] = ...
%        ffs_akz_set_functions(fl_r_inf, fl_r_fsv, fl_r_fbr, fl_for_br_block, aprime);
%

%% Default
[fl_r_inf, fl_r_fsv, fl_r_fbr] = deal(0.15, 0.01, 0.06);
[fl_for_br_block] = -1;
[aprime] =    [-5,-5, -4.5,-4.5, -0.1,-0.1];
[coh_today] = [ 1, -1,   1,-1,      1,0 ];
bl_display_fibs_min_coh_aprime = true;
default_params = {fl_r_inf fl_r_fsv fl_r_fbr fl_for_br_block aprime coh_today bl_display_fibs_min_coh_aprime};

%% Parse Parameters

% numvarargs is the number of varagin inputted
[default_params{1:length(varargin)}] = varargin{:};
[fl_r_inf, fl_r_fsv, fl_r_fbr, fl_for_br_block, aprime, coh_today, ...
    bl_display_fibs_min_coh_aprime] = default_params{:};

%% Bridge Loan Required

b_inf_bridge = zeros(size(coh_today));
b_inf_bridge(coh_today<0) = coh_today(coh_today<0);
c_bridge = b_inf_bridge.*(1+fl_r_inf);
aprime_nobridge = aprime - b_inf_bridge;

if (bl_display_fibs_min_coh_aprime)
    tab_aprime_bridge = table(coh_today', b_inf_bridge', c_bridge', aprime', aprime_nobridge');
    tab_aprime_bridge.Properties.VariableNames = {'coh_today', 'b_inf_bridge', 'c_bridge', 'aprime', 'aprime_nobridge'};
    disp('coh_today: includes all income - debt');
    disp(tab_aprime_bridge);    
end

%% Compute Consumption Informal Borrowing only

b_infonly_inf = (aprime_nobridge);
c_infonly = b_infonly_inf.*(1+fl_r_inf);

if (bl_display_fibs_min_coh_aprime)
    tab_c_infonly = table(aprime_nobridge', b_infonly_inf', c_infonly');
    tab_c_infonly.Properties.VariableNames = {'aprime_nobridge','b_infonly_inf','c_infonly'};
    disp(['informal borrow interest (fl_r_inf):', num2str(fl_r_inf)]);
    disp(tab_c_infonly);    
end

%% Compute Consumption Values Formal + Informal Borrowing Jointly
% if right on grid, informal could be zero. 

for_br_block_dvd = aprime_nobridge./fl_for_br_block;
for_br_block_dvd_floor = abs(floor(for_br_block_dvd).*fl_for_br_block);
for_br_block_dvd_ceil = abs(ceil(for_br_block_dvd).*fl_for_br_block);

b_infforb_inf = (aprime_nobridge + for_br_block_dvd_floor);
b_infforb_for = -(for_br_block_dvd_floor);
c_infforb =  (b_infforb_inf.*(1+fl_r_inf) + b_infforb_for.*(1+fl_r_fbr));

if (bl_display_fibs_min_coh_aprime)
    tab_c_infforb = table(aprime_nobridge', b_infforb_for', b_infforb_inf', c_infforb');
    tab_c_infforb.Properties.VariableNames = {'aprime_nobridge','b_infforb_for','b_infforb_inf','c_infforb'};
    disp(['formal borrow interest (fl_r_fbr):', num2str(fl_r_fbr)]);
    disp(['informal borrow interest (fl_r_inf):', num2str(fl_r_inf)]);
    disp(['formal block size (fl_for_br_block):', num2str(fl_for_br_block)]);
    disp(tab_c_infforb);    
end

%% Compute Consumption Values Formal Borrowing + Formal Savings

b_forbrsv_sav = (aprime_nobridge + for_br_block_dvd_ceil);
b_forbrsv_brr = -(for_br_block_dvd_ceil);
c_forbrsv = (b_forbrsv_sav*(1+fl_r_fsv) + b_forbrsv_brr*(1+fl_r_fbr));

if (bl_display_fibs_min_coh_aprime)
    tab_c_forbrsv = table(aprime_nobridge', b_forbrsv_brr', b_forbrsv_sav', c_forbrsv');
    tab_c_forbrsv.Properties.VariableNames = {'aprime_nobridge','b_forbrsv_brr','b_forbrsv_sav','c_infforb'};
    disp(['formal borrow interest (fl_r_fbr):', num2str(fl_r_fbr)]);
    disp(['savings interest (fl_r_fsv):', num2str(fl_r_fsv)]);
    disp(['formal block size (fl_for_br_block):', num2str(fl_for_br_block)]);
    disp(tab_c_forbrsv);    
end

%% Maximize Consumption For non-Bridge Loan Component
% Trying to minimize consumption costs
[max_c_nextperiod_nobridge, max_idx] = max([c_infonly; c_infforb; c_forbrsv],[], 1);

if (bl_display_fibs_min_coh_aprime)
    tab_c_max = table(aprime_nobridge', max_c_nextperiod_nobridge', max_idx', c_infonly', c_infforb', c_forbrsv');
    tab_c_max.Properties.VariableNames = {'aprime_nobridge', 'max_c_nextperiod_nobridge', 'max_idx', 'c_infonly','c_infforb','c_forbrsv'};
    disp(['informal borrow interest (fl_r_inf):', num2str(fl_r_inf)]);    
    disp(['formal borrow interest (fl_r_fbr):', num2str(fl_r_fbr)]);
    disp(['savings interest (fl_r_fsv):', num2str(fl_r_fsv)]);
    disp(['formal block size (fl_for_br_block):', num2str(fl_for_br_block)]);
    disp(tab_c_max);    
end

%% Consumption Cost of Aprime Choice Bridge Loan includes
aprime_c_cost_total = c_bridge + max_c_nextperiod_nobridge;

if (bl_display_fibs_min_coh_aprime)
    tab_c_max = table(coh_today', aprime', aprime_nobridge', aprime_c_cost_total', ...
                        c_bridge', max_c_nextperiod_nobridge');
    tab_c_max.Properties.VariableNames = {'coh_today', 'aprime', 'aprime_c_cost_total', 'aprime_nobridge',...
                        'c_bridge', 'max_c_nextperiod_nobridge'};
    disp(tab_c_max);    
end


%% Process Results
fl_for_borr = zeros(size(c_infonly));
fl_for_save = zeros(size(c_infonly));
fl_inf_borr = zeros(size(c_infonly));
fl_coh_add = zeros(size(c_infonly));

idx_infonly = (c_infonly==max_c_nextperiod_nobridge);
idx_infforb = (c_infforb==max_c_nextperiod_nobridge);
idx_forbrsv = (c_forbrsv==max_c_nextperiod_nobridge);

fl_inf_borr(idx_infonly) = b_infonly_inf(idx_infonly);
fl_coh_add(idx_infonly) = c_infonly(idx_infonly);

fl_for_borr(idx_infforb) = b_infforb_for(idx_infforb);
fl_inf_borr(idx_infforb) = b_infforb_inf(idx_infforb);
fl_coh_add(idx_infforb) = c_infforb(idx_infforb);

fl_for_borr(idx_forbrsv) = b_forbrsv_brr(idx_forbrsv);
fl_for_save(idx_forbrsv) = b_forbrsv_sav(idx_forbrsv);
fl_coh_add(idx_forbrsv) = c_forbrsv(idx_forbrsv);

end

##### SOURCE END #####
--></body></html>