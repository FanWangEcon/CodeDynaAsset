
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Graph for For Inf Borr Save Outcomes for One Endo Asset Model</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-08-06"><meta name="DC.source" content="ff_az_fibs_vf_post_graph.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Graph for For Inf Borr Save Outcomes for One Endo Asset Model</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_AZ_FIBS_VF_POST_GRAPH genereate 3 graphs</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">Generate Limited Legends</a></li><li><a href="#6">Graph Optimal Discrete</a></li><li><a href="#7">Graph Choice Levels</a></li><li><a href="#8">Graph Choice Percentages</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> ff_az_fibs_vf_post_graph(varargin)
</pre><h2 id="2">FF_AZ_FIBS_VF_POST_GRAPH genereate 3 graphs</h2><p>Generates these graphs:</p><div><ol><li>Stacked borrowing choices: separate subplot for different shocks; share y-axis scales; each chart, x-axis, current cash-on-hand levels, y-axis plot out results of several arrays. 1st array is formal choice, scattered height with unique color. 2nd array is the sum of formal + informal bridge. 3rd sum informal from formal+informal. 4th, formal savings. each use a different shape with increasing size so that later choices can show through. overall sum at the end should equal to aprime.</li></ol></div><div><ol><li>Percentage credit market choices: similar file as above, except that now, rather than showing levels. Show percentages. divide each by aggregate asset level. Same Graph strategy. if 4 subplots, plotting with four levels of shocks.</li></ol></div><div><ol><li>Participation regions, come up with all the possible formal and informal participation categories. What does the sorting map look like?</li></ol></div><p>Run this function directly with randomly generates matrixes for graphs and tables.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param result_map container contains policy function matrix, value function matrix, iteration results; als coh consumption and other matrixes</p><p>@example</p><p>@include</p><div><ul><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_set_default_param.html">ffs_abz_fibs_set_default_param</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_get_funcgrid.html">ffs_abz_fibs_get_funcgrid</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost_bridge.html">ffs_fibs_min_c_cost_bridge</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_inf_bridge.html">ffs_fibs_inf_bridge</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost.html">ffs_fibs_min_c_cost</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html">ff_az_vf_post</a></li></ul></div><h2 id="3">Default</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    <span class="comment">% if invoked from outside overrid fully</span>
    [param_map, support_map, armt_map, func_map, result_map] = varargin{:};

<span class="keyword">else</span>

    clear <span class="string">all</span>;
    close <span class="string">all</span>;

    <span class="comment">% 1. internal invoke for testing</span>
    it_param_set = 4;
    bl_input_override = true;

    <span class="comment">% 2. Get Parameters</span>
    [param_map, support_map] = ffs_abzr_fibs_set_default_param(it_param_set);
    [armt_map, func_map] = ffs_abzr_fibs_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>

    <span class="comment">% 3. Get Arrays and Functions</span>
    params_group = values(param_map, {<span class="string">'it_a_n'</span>, <span class="string">'it_z_n'</span>});
    [it_a_n, it_z_n] = params_group{:};
    params_group = values(armt_map, {<span class="string">'ar_a'</span>});
    [ar_a] = params_group{:};
    params_group = values(armt_map, {<span class="string">'ar_z_r_infbr_mesh_wage'</span>, <span class="string">'ar_z_wage_mesh_r_infbr'</span>});
    [ar_z_r_inf_mesh_wage, ar_z_wage_mesh_r_inf] = params_group{:};
    params_group = values(func_map, {<span class="string">'f_util_standin'</span>, <span class="string">'f_cons_coh_fbis'</span>, <span class="string">'f_cons_coh_save'</span>, <span class="string">'f_coh'</span>});
    [f_util_standin, f_cons_coh_fbis, f_cons_coh_save, f_coh] = params_group{:};

    <span class="comment">% 4. Value Default</span>
    mt_val = f_util_standin(ar_z_r_inf_mesh_wage, ar_a');

    <span class="comment">% 5. default optimal asset choices (overall, interesint + principle from</span>
    <span class="comment">% different formal and informal sources following how model is solved)</span>
    mt_pol_a = zeros(size(mt_val)) + <span class="keyword">...</span>
        ar_a'*(cumsum(sort(ar_z_r_inf_mesh_wage))/sum(ar_z_r_inf_mesh_wage)*0.4 + 0.4);

    <span class="comment">% 6. Default COH</span>
    mt_coh = f_coh(ar_z_r_inf_mesh_wage, ar_a');

    <span class="comment">% 7. Set Default Consumption</span>
    mt_pol_a_pos_idx = (mt_pol_a &gt; 0);
    mt_pol_cons = zeros(size(mt_pol_a));
    mt_pol_cons(mt_pol_a_pos_idx) = f_cons_coh_save(mt_coh(mt_pol_a_pos_idx), mt_pol_a(mt_pol_a_pos_idx));
    mt_pol_cons(~mt_pol_a_pos_idx) = f_cons_coh_fbis(mt_coh(~mt_pol_a_pos_idx), mt_pol_a(~mt_pol_a_pos_idx));

    <span class="comment">% 8. Find Formal Informal Choices given Fake Data</span>
    mt_pol_b_bridge = zeros(it_a_n,it_z_n);
    mt_pol_inf_borr_nobridge = zeros(it_a_n,it_z_n);
    mt_pol_for_borr = zeros(it_a_n,it_z_n);
    mt_pol_for_save = zeros(it_a_n,it_z_n);

    <span class="comment">% 9. Solve for formal and informal combinations given the overall fake</span>
    <span class="comment">% choices.</span>
    <span class="keyword">for</span> it_z_i = 1:it_z_n
        <span class="keyword">for</span> it_a_j = 1:it_a_n

            fl_z_r_borr = ar_z_r_inf_mesh_wage(it_z_i);
            fl_z_wage = ar_z_wage_mesh_r_inf(it_z_i);
            param_map(<span class="string">'fl_r_inf'</span>) = fl_z_r_borr;

            fl_a = ar_a(it_a_j);
            fl_coh = f_coh(fl_z_wage, fl_a);
            fl_a_opti = mt_pol_a(it_a_j, it_z_i);

            <span class="comment">% call formal and informal function.</span>
            [~, fl_opti_b_bridge, fl_opti_inf_borr_nobridge, fl_opti_for_borr, fl_opti_for_save] = <span class="keyword">...</span>
                ffs_fibs_min_c_cost_bridge(fl_a_opti, fl_coh, <span class="keyword">...</span>
                param_map, support_map, armt_map, func_map, bl_input_override);

            <span class="comment">% store savings and borrowing formal and inf optimal choices</span>
            mt_pol_b_bridge(it_a_j,it_z_i) = fl_opti_b_bridge;
            mt_pol_inf_borr_nobridge(it_a_j,it_z_i) = fl_opti_inf_borr_nobridge;
            mt_pol_for_borr(it_a_j,it_z_i) = fl_opti_for_borr;
            mt_pol_for_save(it_a_j,it_z_i) = fl_opti_for_save;

        <span class="keyword">end</span>
    <span class="keyword">end</span>

    <span class="comment">% 10. Set Results Map</span>
    result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    result_map(<span class="string">'mt_val'</span>) = mt_val;
    result_map(<span class="string">'cl_mt_pol_a'</span>) = {mt_pol_a, zeros(1)};
    result_map(<span class="string">'cl_mt_coh'</span>) = {mt_coh, zeros(1)};

    result_map(<span class="string">'cl_mt_pol_c'</span>) = {mt_pol_cons, zeros(1)};
    result_map(<span class="string">'cl_mt_pol_b_bridge'</span>) = {mt_pol_b_bridge, zeros(1)};
    result_map(<span class="string">'cl_mt_pol_inf_borr_nobridge'</span>) = {mt_pol_inf_borr_nobridge, zeros(1)};
    result_map(<span class="string">'cl_mt_pol_for_borr'</span>) = {mt_pol_for_borr, zeros(1)};
    result_map(<span class="string">'cl_mt_pol_for_save'</span>) = {mt_pol_for_save, zeros(1)};

    <span class="comment">% Input over-ride</span>
    bl_input_override = true;
    result_map = ffs_fibs_identify_discrete(result_map, bl_input_override);

    <span class="comment">% Control which results to graph</span>
    support_map(<span class="string">'bl_graph_forinf_discrete'</span>) = true;
    support_map(<span class="string">'bl_graph_forinf_pol_lvl'</span>) = true;
    support_map(<span class="string">'bl_graph_forinf_pol_pct'</span>) = true;

<span class="keyword">end</span>
</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput"><span class="comment">% Model Name</span>
params_group = values(param_map, {<span class="string">'st_model'</span>});
[st_model] = params_group{:};

<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'it_z_n'</span>});
[it_z_n] = params_group{:};

<span class="comment">% support_map4</span>
params_group = values(support_map, {<span class="string">'bl_graph_onebyones'</span>, <span class="string">'bl_graph_forinf_discrete'</span>, <span class="string">'bl_graph_forinf_pol_lvl'</span>, <span class="string">'bl_graph_forinf_pol_pct'</span>});
[bl_graph_onebyones, bl_graph_forinf_discrete, bl_graph_forinf_pol_lvl, bl_graph_forinf_pol_pct] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_img_save'</span>, <span class="string">'st_img_path'</span>, <span class="string">'st_img_prefix'</span>, <span class="string">'st_img_name_main'</span>, <span class="string">'st_img_suffix'</span>});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {<span class="string">'st_title_prefix'</span>});
[st_title_prefix] = params_group{:};

<span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_a'</span>});
[ar_a] = params_group{:};

<span class="keyword">if</span> (ismember(st_model, [<span class="string">"ipwkbzr_fibs"</span>, <span class="string">"abzr_fibs"</span>]))
    params_group = values(param_map, {<span class="string">'fl_z_r_infbr_n'</span>});
    [fl_z_r_borr_n] = params_group{:};
    <span class="keyword">if</span> (ismember(st_model, [<span class="string">"ipwkbzr_fibs"</span>]))
        params_group = values(armt_map, {<span class="string">'ar_z_r_infbr_mesh_wage_w1r2'</span>, <span class="string">'ar_z_wage_mesh_r_infbr_w1r2'</span>});
    <span class="keyword">elseif</span> (ismember(st_model, [<span class="string">"abzr_fibs"</span>]))
        params_group = values(armt_map, {<span class="string">'ar_z_r_infbr_mesh_wage'</span>, <span class="string">'ar_z_wage_mesh_r_infbr'</span>});
    <span class="keyword">end</span>
    [ar_z_r_inf_mesh_wage, ar_z_wage_mesh_r_inf] = params_group{:};
    params_group = values(param_map, {<span class="string">'it_z_wage_n'</span>});
    [it_z_wage_n] = params_group{:};
<span class="keyword">else</span>
    fl_z_r_borr_n = 1;
    params_group = values(armt_map, {<span class="string">'ar_z'</span>});
    [ar_z_wage_mesh_r_inf] = params_group{:};
    params_group = values(param_map, {<span class="string">'it_z_n'</span>});
    [it_z_wage_n] = params_group{:};
<span class="keyword">end</span>

<span class="comment">% result_map standards</span>
params_group = values(result_map, {<span class="string">'cl_mt_pol_a'</span>});
[cl_mt_pol_a] = params_group{:};
[mt_pol_a] = deal(cl_mt_pol_a{1});

<span class="comment">% result_map continuous formal informal choices</span>
params_group = values(result_map, {<span class="string">'cl_mt_pol_b_bridge'</span>, <span class="string">'cl_mt_pol_inf_borr_nobridge'</span>, <span class="keyword">...</span>
    <span class="string">'cl_mt_pol_for_borr'</span>, <span class="string">'cl_mt_pol_for_save'</span>});
[cl_mt_pol_b_bridge, cl_mt_pol_inf_borr_nobridge, cl_mt_pol_for_borr, cl_mt_pol_for_save] = params_group{:};
[mt_pol_b_bridge, mt_pol_inf_borr_nobridge, mt_pol_for_borr, mt_pol_for_save] = <span class="keyword">...</span>
    deal(cl_mt_pol_b_bridge{1}, cl_mt_pol_inf_borr_nobridge{1}, cl_mt_pol_for_borr{1}, cl_mt_pol_for_save{1});

<span class="comment">% result_map discrete formal informal choices</span>
params_group = values(result_map, {<span class="string">'mt_it_frmsavng_only'</span>, <span class="string">'mt_it_b_bridge_idx'</span>, <span class="string">'mt_it_for_only_nbdg'</span>, <span class="keyword">...</span>
    <span class="string">'mt_it_inf_only_nbdg'</span>, <span class="string">'mt_it_frin_brr_nbdg'</span>, <span class="string">'mt_it_fr_brrsv_nbdg'</span>});
[mt_it_frmsavng_only, mt_it_b_bridge_idx, mt_it_for_only_nbdg, <span class="keyword">...</span>
    mt_it_inf_only_nbdg, mt_it_frin_brr_nbdg, mt_it_fr_brrsv_nbdg] = params_group{:};

<span class="comment">% How many zs to Graph</span>
ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
</pre><h2 id="5">Generate Limited Legends</h2><pre class="codeinput"><span class="comment">% 8 graph points, 2 levels of borrow rates, and 4 levels of rbr rates</span>
ar_it_z_r_borr = ([1 round((fl_z_r_borr_n)/2) (fl_z_r_borr_n)]);
ar_it_z_wage = ([1 round((it_z_wage_n)/2) (it_z_wage_n)]);

<span class="comment">% combine by index</span>
mt_it_z_graph = ar_it_z_wage' + it_z_wage_n*(ar_it_z_r_borr-1);
ar_it_z_graph = mt_it_z_graph(:)';

<span class="comment">% legends index final</span>
ar_it_legend2plot = ar_it_z_graph;
ar_it_legend2plot_lth = ar_it_z_graph;
<span class="keyword">if</span> (ismember(st_model, [<span class="string">"ipwkbzr_fibs"</span>, <span class="string">"abzr_fibs"</span>]))
    cl_st_legendCell = cellstr([num2str(ar_z_r_inf_mesh_wage', <span class="string">'zr=%3.2f;'</span>), <span class="keyword">...</span>
                                num2str(ar_z_wage_mesh_r_inf', <span class="string">'zw=%3.2f'</span>)]);
<span class="keyword">else</span>
    cl_st_legendCell = cellstr([num2str(ar_z_wage_mesh_r_inf', <span class="string">'zw=%3.2f'</span>)]);
<span class="keyword">end</span>
</pre><h2 id="6">Graph Optimal Discrete</h2><p>States: cash-on-hand, shock Choices: discrete optimal choices</p><pre class="codeinput"><span class="keyword">if</span> (bl_graph_forinf_discrete)

    <span class="keyword">if</span> (~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
        ar_sub_j = 1:1:2;
    <span class="keyword">else</span>
        ar_sub_j = [1 2];
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j = ar_sub_j

    <span class="comment">% start figure</span>
    <span class="keyword">if</span> (~bl_graph_onebyones)
        subplot(1, 2, sub_j);
    <span class="keyword">else</span>
        figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    <span class="keyword">end</span>
    hold <span class="string">on</span>;

    <span class="comment">% Graph Optimal Discrete Gen Discrete Outcomes</span>
    <span class="comment">% * formal only (no bridge)</span>
    <span class="comment">% * Informal borrow only (no bridge)</span>
    <span class="comment">% * formal + informal borrow (no bridge)</span>
    <span class="comment">% * formal save + borrow (no bridge)</span>
    <span class="comment">% * bridge loan areas</span>

    <span class="comment">% Generate x and y arrays</span>
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z_wage_mesh_r_inf, ar_a);

    mt_x = ar_w_mz;
    mt_y = ar_z_mw;

    <span class="comment">% colors etc</span>
    cl_colors = {<span class="string">'blue'</span>, <span class="string">'red'</span>, <span class="string">'black'</span>, [0 0.4471 0.7412], <span class="string">'blue'</span>, [.61 .51 .74]};
    cl_legend = {<span class="string">'For Borr'</span>, <span class="string">'Inf Borr'</span>, <span class="string">'For+Inf Br'</span>, <span class="string">'For+Br+Save'</span>, <span class="string">'Bridge Loan'</span>, <span class="string">'For Save'</span>};
    cl_shapes = {<span class="string">'s'</span>,<span class="string">'x'</span>,<span class="string">'o'</span>,<span class="string">'d'</span>,<span class="string">'p'</span>,<span class="string">'*'</span>};
    it_basesize = 20;
    cl_csizes = {10*it_basesize, 20*it_basesize, 10*it_basesize, 10*it_basesize, 1*it_basesize, 2*it_basesize};

    <span class="comment">% graphs to run</span>
    ar_it_graphs_run = 1:6;
<span class="comment">%     ar_it_graphs_run = [6];</span>
    it_graph_counter = 0;
    <span class="keyword">for</span> it_fig = ar_it_graphs_run

        <span class="comment">% count cur graph</span>
        it_graph_counter = it_graph_counter + 1;

        <span class="keyword">if</span> (it_fig == 1)
            mt_cur_use_idx = mt_it_for_only_nbdg;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (it_fig == 2)
            mt_cur_use_idx = mt_it_inf_only_nbdg;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (it_fig == 3)
            mt_cur_use_idx = mt_it_frin_brr_nbdg;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (it_fig == 4)
            mt_cur_use_idx = mt_it_fr_brrsv_nbdg;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (it_fig == 5)
            mt_cur_use_idx = mt_it_b_bridge_idx;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (it_fig == 6)
            mt_cur_use_idx = mt_it_frmsavng_only;
        <span class="keyword">end</span>

        <span class="comment">% Generate x and y</span>
        ar_x = mt_x(mt_cur_use_idx);
        ar_y = mt_y(mt_cur_use_idx);

        <span class="comment">% Color and Size etc</span>
        it_csize = cl_csizes{it_fig};
        ar_color = cl_colors{it_fig};
        st_shape = cl_shapes{it_fig};

        <span class="comment">% Figure Collect</span>
        <span class="keyword">if</span> (ismember(sub_j, [1]))
            ar_x_use = ar_x;
            st_legend_loc = <span class="string">'northeast'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [2]))
            ar_x_use = log(ar_x - min(ar_a) + 1);
            st_legend_loc = <span class="string">'northeast'</span>;
        <span class="keyword">end</span>

        <span class="comment">% Graph</span>
        ls_chart(it_graph_counter) = scatter(ar_x_use, ar_y, it_csize, ar_color, st_shape);
        cl_legend{it_graph_counter} = cl_legend{it_fig};
    <span class="keyword">end</span>

    <span class="comment">% legend</span>
    legend(ls_chart, cl_legend, <span class="string">'Location'</span>, st_legend_loc);

    <span class="comment">% labeling</span>
    title(<span class="string">'Borrow and Save Regions'</span>)
    ylabel(<span class="string">'Shocks'</span>)
    <span class="keyword">if</span> (ismember(sub_j, [1]))
        st_x_label = {<span class="string">'Asset State'</span>};
    <span class="keyword">end</span>
    <span class="keyword">if</span> (ismember(sub_j, [2]))
        st_x_label = {<span class="string">'log(Asset State - min(asset) + 1)'</span>};
    <span class="keyword">end</span>

    <span class="comment">% Turn on X and Y lines or Not</span>
    <span class="keyword">if</span> (ismember(sub_j, [2]))
        xline0 = xline(log(0-min(ar_a)+1));
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;
    <span class="keyword">else</span>
        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;
    <span class="keyword">end</span>

    grid <span class="string">on</span>;

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        <span class="keyword">if</span> ~exist(support_map(<span class="string">'st_img_path'</span>),<span class="string">'dir'</span>); mkdir(support_map(<span class="string">'st_img_path'</span>)); <span class="keyword">end</span>;
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_fibs5'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_01.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_02.png" alt=""> <h2 id="7">Graph Choice Levels</h2><p>How much borrowing and savings of different types given a and shocks</p><pre class="codeinput"><span class="keyword">if</span> (bl_graph_forinf_pol_lvl)

    <span class="keyword">if</span> (~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 28 8]);
        ar_sub_j = 1:1:8;
    <span class="keyword">else</span>
        ar_sub_j = [1 5 2 6 3 7 4 8];
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j = ar_sub_j

        <span class="keyword">if</span> (ismember(sub_j, [1,5]))
            mt_outcome = mt_pol_b_bridge;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [2,6]))
            mt_outcome = mt_pol_inf_borr_nobridge;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [3,7]))
            mt_outcome = mt_pol_for_borr;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [4,8]))
            mt_outcome = mt_pol_for_save;
        <span class="keyword">end</span>

        <span class="keyword">if</span> (~bl_graph_onebyones)
            subplot(2, 4, sub_j);
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        <span class="comment">% Color Set</span>
        clr = jet(length(ar_it_z_graph));

        <span class="comment">% Iterate over Shocks to Graph (Finite Graphs)</span>
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph

            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
                <span class="comment">% levels</span>
                ar_a_curz_use = ar_a';
                ar_opti_curz_use = ar_opti_curz';
            <span class="keyword">elseif</span> (ismember(sub_j, [5,6,7,8]))
                <span class="comment">% logs</span>
                ar_a_curz_use = log(ar_a' - min(ar_a) + 1);
                <span class="keyword">if</span> (ismember(sub_j, [5,6,7]))
                    <span class="comment">% Borrowing Choices -(log(-(-5)+1))</span>
                    ar_opti_curz_use = -log( - ar_opti_curz' + 1);
                <span class="keyword">end</span>
                <span class="keyword">if</span> (ismember(sub_j, [8]))
                    <span class="comment">% Savings Choices</span>
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            scatter(ar_a_curz_use, ar_opti_curz_use, 5, <span class="keyword">...</span>
                    <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                    <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        <span class="comment">% X Label</span>
        <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
            st_x_label = {<span class="string">'Asset State'</span>};
            st_graph_loc = <span class="string">'northwest'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [5,6,7,8]))
            st_x_label = {<span class="string">'log(Asset State - min(asset) + 1)'</span>};
            <span class="keyword">if</span> (ismember(sub_j, [5]))
                st_graph_loc = <span class="string">'southeast'</span>;
            <span class="keyword">elseif</span> (ismember(sub_j, [6]))
                st_graph_loc = <span class="string">'southeast'</span>;
            <span class="keyword">elseif</span> (ismember(sub_j, [7]))
                st_graph_loc = <span class="string">'southeast'</span>;
            <span class="keyword">elseif</span> (ismember(sub_j, [8]))
                st_graph_loc = <span class="string">'northwest'</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">% Y Label</span>
        <span class="keyword">if</span> (ismember(sub_j, [1,5]))
            st_y_label = <span class="string">'Bridge Loan Borrowing'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [5]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [2,6]))
            st_y_label = <span class="string">'Inf Borr (-bridge)'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [6]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [3,7]))
            st_y_label = <span class="string">'For Borr Menu'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [7]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [4,8]))
            st_y_label = <span class="string">'Savings'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [8]))
                st_y_label = [<span class="string">'log('</span> st_y_label <span class="string">'+1)'</span> ];
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">% Grid</span>
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;

        <span class="comment">% Legend</span>
<span class="comment">%         legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));</span>
<span class="comment">%         legend(legendCell(ar_it_z_graph), 'Location', st_graph_loc);</span>
        legend(cl_st_legendCell(ar_it_legend2plot), <span class="string">'Location'</span>, st_graph_loc);

        <span class="comment">% Title and X Y Labels</span>
        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);

        <span class="comment">% 45 Degree Line</span>
        <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
            hline = refline([1 0]);
            hline.Color = <span class="string">'k'</span>;
            hline.LineStyle = <span class="string">':'</span>;
            hline.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>

        <span class="comment">% Turn on X and Y lines or Not</span>
        <span class="keyword">if</span> (ismember(sub_j, [5,6,7,8]))
            xline0 = xline(log(0-min(ar_a)+1));
            xline0.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [5,6,7]))
                yline0 = yline(-log(0+1));
                yline0.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span> (ismember(sub_j, [8]))
                yline0 = yline(log(0+1));
                yline0.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">end</span>
        <span class="keyword">else</span>
            xline0 = xline(0);
            xline0.HandleVisibility = <span class="string">'off'</span>;
            yline0 = yline(0);
            yline0.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        <span class="keyword">if</span> ~exist(support_map(<span class="string">'st_img_path'</span>),<span class="string">'dir'</span>); mkdir(support_map(<span class="string">'st_img_path'</span>)); <span class="keyword">end</span>;
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_pol_lvl'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_03.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_04.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_05.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_06.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_07.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_08.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_09.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_10.png" alt=""> <h2 id="8">Graph Choice Percentages</h2><p>Percentage of Aggregate accounted for by this choice. Very similar to above, except now divide by mt_pol_a</p><pre class="codeinput"><span class="keyword">if</span> (bl_graph_forinf_pol_pct)

    <span class="keyword">if</span> (~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 28 8]);
        ar_sub_j = 1:1:8;
    <span class="keyword">else</span>
        ar_sub_j = [1 5 2 6 3 7 4 8];
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j = ar_sub_j

        <span class="keyword">if</span> (ismember(sub_j, [1,5]))
            mt_outcome = mt_pol_b_bridge./mt_pol_a;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [2,6]))
            mt_outcome = mt_pol_inf_borr_nobridge./mt_pol_a;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [3,7]))
            mt_outcome = mt_pol_for_borr./mt_pol_a;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [4,8]))
            mt_outcome = mt_pol_for_save./mt_pol_a;
        <span class="keyword">end</span>

        <span class="keyword">if</span> (~bl_graph_onebyones)
            subplot(2, 4, sub_j);
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        <span class="comment">% Color Set</span>
        clr = jet(length(ar_it_z_graph));

        <span class="comment">% Iterate over Shocks to Graph (Finite Graphs)</span>
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph

            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
                <span class="comment">% levels</span>
                ar_a_curz_use = ar_a';
                ar_opti_curz_use = ar_opti_curz';
            <span class="keyword">elseif</span> (ismember(sub_j, [5,6,7,8]))
                <span class="comment">% logs</span>
                ar_a_curz_use = log(ar_a' - min(ar_a) + 1);
                <span class="keyword">if</span> (ismember(sub_j, [5,6,7]))
                    <span class="comment">% Borrowing Choices -(log(-(-5)+1))</span>
                    ar_opti_curz_use = -log( - ar_opti_curz' + 1);
                <span class="keyword">end</span>
                <span class="keyword">if</span> (ismember(sub_j, [8]))
                    <span class="comment">% Savings Choices</span>
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                <span class="keyword">end</span>
            <span class="keyword">end</span>

            scatter(real(ar_a_curz_use), real(ar_opti_curz_use), 5, <span class="keyword">...</span>
                    <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                    <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        <span class="comment">% X Label</span>
        <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
            st_x_label = {<span class="string">'Asset State'</span>};
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [5,6,7,8]))
            st_x_label = {<span class="string">'log(Asset State - min(asset) + 1)'</span>};
        <span class="keyword">end</span>

        <span class="comment">% Y Label</span>
        <span class="keyword">if</span> (ismember(sub_j, [1,5]))
            st_y_label = <span class="string">'Bridge Loan Share'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [5]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
            <span class="keyword">end</span>
            st_graph_loc = <span class="string">'northeast'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [2,6]))
            st_y_label = <span class="string">'Inf Borr (-bridge) Share'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [6]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
                st_graph_loc = <span class="string">'northwest'</span>;
            <span class="keyword">else</span>
                st_graph_loc = <span class="string">'northeast'</span>;
            <span class="keyword">end</span>

        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [3,7]))
            st_y_label = <span class="string">'For Borr Menu Share'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [7]))
                st_y_label = [<span class="string">'-log(-('</span> st_y_label <span class="string">')+1)'</span> ];
                st_graph_loc = <span class="string">'northwest'</span>;
            <span class="keyword">else</span>
                st_graph_loc = <span class="string">'northeast'</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>
        <span class="keyword">if</span> (ismember(sub_j, [4,8]))
            st_y_label = <span class="string">'Savings Share'</span>;
            <span class="keyword">if</span> (ismember(sub_j, [8]))
                st_y_label = [<span class="string">'log('</span> st_y_label <span class="string">'+1)'</span> ];
                st_graph_loc = <span class="string">'southwest'</span>;
            <span class="keyword">else</span>
                st_graph_loc = <span class="string">'southeast'</span>;
            <span class="keyword">end</span>

        <span class="keyword">end</span>

        <span class="comment">% Grid</span>
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;

        <span class="comment">% Legend</span>
<span class="comment">%         legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));</span>
<span class="comment">%         legend(legendCell(ar_it_z_graph), 'Location', st_graph_loc);</span>
        legend(cl_st_legendCell(ar_it_legend2plot), <span class="string">'Location'</span>, st_graph_loc);

        <span class="comment">% Title and X Y Labels</span>
        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);


        <span class="comment">% Turn on X and Y lines or Not</span>
        <span class="keyword">if</span> (ismember(sub_j, [5,6,7,8]))
            xline0 = xline(log(0-min(ar_a)+1));
            xline0.HandleVisibility = <span class="string">'off'</span>;

            <span class="keyword">if</span> (ismember(sub_j, [5,6,7]))
                yline0 = yline(-log(0+1));
                yline0.HandleVisibility = <span class="string">'off'</span>;

                yline1 = yline(+log(1));
                yline1.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">end</span>
            <span class="keyword">if</span> (ismember(sub_j, [8]))
                yline0 = yline(log(0+1));
                yline0.HandleVisibility = <span class="string">'off'</span>;

                yline1 = yline(log(1));
                yline1.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">end</span>

        <span class="keyword">else</span>

            xline0 = xline(0);
            xline0.HandleVisibility = <span class="string">'off'</span>;
            yline0 = yline(0);
            yline0.HandleVisibility = <span class="string">'off'</span>;

            <span class="keyword">if</span> (ismember(sub_j, [1,2,3]))
                <span class="comment">% borrowing/borrow positive</span>
                yline1 = yline(1);
                yline1.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">elseif</span> (ismember(sub_j, [4]))
                <span class="comment">% savings/borrow save/save</span>
                yline1 = yline(+1);
                yline1.HandleVisibility = <span class="string">'off'</span>;
                ylineneg1 = yline(-1);
                ylineneg1.HandleVisibility = <span class="string">'off'</span>;
            <span class="keyword">end</span>
        <span class="keyword">end</span>



    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        <span class="keyword">if</span> ~exist(support_map(<span class="string">'st_img_path'</span>),<span class="string">'dir'</span>); mkdir(support_map(<span class="string">'st_img_path'</span>)); <span class="keyword">end</span>;
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_pol_pct'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_11.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_12.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_13.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_14.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_15.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_16.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_17.png" alt=""> <img vspace="5" hspace="5" src="ff_az_fibs_vf_post_graph_18.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Graph for For Inf Borr Save Outcomes for One Endo Asset Model
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function ff_az_fibs_vf_post_graph(varargin)
%% FF_AZ_FIBS_VF_POST_GRAPH genereate 3 graphs
% Generates these graphs:
%
% # Stacked borrowing choices: separate subplot for different shocks; share
% y-axis scales; each chart, x-axis, current cash-on-hand levels, y-axis
% plot out results of several arrays. 1st array is formal choice, scattered
% height with unique color. 2nd array is the sum of formal + informal
% bridge. 3rd sum informal from formal+informal. 4th, formal savings. each
% use a different shape with increasing size so that later choices can show
% through. overall sum at the end should equal to aprime. 
%
% # Percentage credit market choices: similar file as above, except that
% now, rather than showing levels. Show percentages. divide each by
% aggregate asset level. Same Graph strategy. if 4 subplots, plotting
% with four levels of shocks. 
%
% # Participation regions, come up with all the possible formal and
% informal participation categories. What does the sorting map look like?
%
% Run this function directly with randomly generates matrixes for graphs
% and tables.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param result_map container contains policy function matrix, value
% function matrix, iteration results; als coh consumption and other matrixes
%
% @example
%
% @include
%
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_set_default_param.html ffs_abz_fibs_set_default_param>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_get_funcgrid.html ffs_abz_fibs_get_funcgrid>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost_bridge.html ffs_fibs_min_c_cost_bridge>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_inf_bridge.html ffs_fibs_inf_bridge>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost.html ffs_fibs_min_c_cost>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html ff_az_vf_post>
%

%% Default

if (~isempty(varargin))
    
    % if invoked from outside overrid fully
    [param_map, support_map, armt_map, func_map, result_map] = varargin{:};

else
    
    clear all;
    close all;

    % 1. internal invoke for testing
    it_param_set = 4;
    bl_input_override = true;

    % 2. Get Parameters
    [param_map, support_map] = ffs_abzr_fibs_set_default_param(it_param_set);
    [armt_map, func_map] = ffs_abzr_fibs_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override

    % 3. Get Arrays and Functions
    params_group = values(param_map, {'it_a_n', 'it_z_n'});
    [it_a_n, it_z_n] = params_group{:};    
    params_group = values(armt_map, {'ar_a'});
    [ar_a] = params_group{:};
    params_group = values(armt_map, {'ar_z_r_infbr_mesh_wage', 'ar_z_wage_mesh_r_infbr'});
    [ar_z_r_inf_mesh_wage, ar_z_wage_mesh_r_inf] = params_group{:};    
    params_group = values(func_map, {'f_util_standin', 'f_cons_coh_fbis', 'f_cons_coh_save', 'f_coh'});
    [f_util_standin, f_cons_coh_fbis, f_cons_coh_save, f_coh] = params_group{:};
    
    % 4. Value Default
    mt_val = f_util_standin(ar_z_r_inf_mesh_wage, ar_a');
    
    % 5. default optimal asset choices (overall, interesint + principle from
    % different formal and informal sources following how model is solved)
    mt_pol_a = zeros(size(mt_val)) + ...
        ar_a'*(cumsum(sort(ar_z_r_inf_mesh_wage))/sum(ar_z_r_inf_mesh_wage)*0.4 + 0.4);
    
    % 6. Default COH
    mt_coh = f_coh(ar_z_r_inf_mesh_wage, ar_a');
    
    % 7. Set Default Consumption
    mt_pol_a_pos_idx = (mt_pol_a > 0);
    mt_pol_cons = zeros(size(mt_pol_a));
    mt_pol_cons(mt_pol_a_pos_idx) = f_cons_coh_save(mt_coh(mt_pol_a_pos_idx), mt_pol_a(mt_pol_a_pos_idx));
    mt_pol_cons(~mt_pol_a_pos_idx) = f_cons_coh_fbis(mt_coh(~mt_pol_a_pos_idx), mt_pol_a(~mt_pol_a_pos_idx));
    
    % 8. Find Formal Informal Choices given Fake Data
    mt_pol_b_bridge = zeros(it_a_n,it_z_n);
    mt_pol_inf_borr_nobridge = zeros(it_a_n,it_z_n);
    mt_pol_for_borr = zeros(it_a_n,it_z_n);
    mt_pol_for_save = zeros(it_a_n,it_z_n);
    
    % 9. Solve for formal and informal combinations given the overall fake
    % choices.
    for it_z_i = 1:it_z_n
        for it_a_j = 1:it_a_n

            fl_z_r_borr = ar_z_r_inf_mesh_wage(it_z_i);
            fl_z_wage = ar_z_wage_mesh_r_inf(it_z_i);
            param_map('fl_r_inf') = fl_z_r_borr;
            
            fl_a = ar_a(it_a_j);
            fl_coh = f_coh(fl_z_wage, fl_a);
            fl_a_opti = mt_pol_a(it_a_j, it_z_i);
            
            % call formal and informal function.
            [~, fl_opti_b_bridge, fl_opti_inf_borr_nobridge, fl_opti_for_borr, fl_opti_for_save] = ...
                ffs_fibs_min_c_cost_bridge(fl_a_opti, fl_coh, ...
                param_map, support_map, armt_map, func_map, bl_input_override);
            
            % store savings and borrowing formal and inf optimal choices
            mt_pol_b_bridge(it_a_j,it_z_i) = fl_opti_b_bridge;
            mt_pol_inf_borr_nobridge(it_a_j,it_z_i) = fl_opti_inf_borr_nobridge;
            mt_pol_for_borr(it_a_j,it_z_i) = fl_opti_for_borr;
            mt_pol_for_save(it_a_j,it_z_i) = fl_opti_for_save;
            
        end
    end

    % 10. Set Results Map
    result_map = containers.Map('KeyType','char', 'ValueType','any');
    result_map('mt_val') = mt_val;
    result_map('cl_mt_pol_a') = {mt_pol_a, zeros(1)};
    result_map('cl_mt_coh') = {mt_coh, zeros(1)};

    result_map('cl_mt_pol_c') = {mt_pol_cons, zeros(1)};
    result_map('cl_mt_pol_b_bridge') = {mt_pol_b_bridge, zeros(1)};
    result_map('cl_mt_pol_inf_borr_nobridge') = {mt_pol_inf_borr_nobridge, zeros(1)};
    result_map('cl_mt_pol_for_borr') = {mt_pol_for_borr, zeros(1)};
    result_map('cl_mt_pol_for_save') = {mt_pol_for_save, zeros(1)};
    
    % Input over-ride
    bl_input_override = true;
    result_map = ffs_fibs_identify_discrete(result_map, bl_input_override);
    
    % Control which results to graph
    support_map('bl_graph_forinf_discrete') = true;
    support_map('bl_graph_forinf_pol_lvl') = true;
    support_map('bl_graph_forinf_pol_pct') = true;
    
end

%% Parse Parameters

% Model Name
params_group = values(param_map, {'st_model'});
[st_model] = params_group{:};

% param_map
params_group = values(param_map, {'it_z_n'});
[it_z_n] = params_group{:};

% support_map4
params_group = values(support_map, {'bl_graph_onebyones', 'bl_graph_forinf_discrete', 'bl_graph_forinf_pol_lvl', 'bl_graph_forinf_pol_pct'});
[bl_graph_onebyones, bl_graph_forinf_discrete, bl_graph_forinf_pol_lvl, bl_graph_forinf_pol_pct] = params_group{:};
params_group = values(support_map, {'bl_img_save', 'st_img_path', 'st_img_prefix', 'st_img_name_main', 'st_img_suffix'});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {'st_title_prefix'});
[st_title_prefix] = params_group{:};

% armt_map
params_group = values(armt_map, {'ar_a'});
[ar_a] = params_group{:};

if (ismember(st_model, ["ipwkbzr_fibs", "abzr_fibs"]))
    params_group = values(param_map, {'fl_z_r_infbr_n'});
    [fl_z_r_borr_n] = params_group{:};
    if (ismember(st_model, ["ipwkbzr_fibs"]))
        params_group = values(armt_map, {'ar_z_r_infbr_mesh_wage_w1r2', 'ar_z_wage_mesh_r_infbr_w1r2'});
    elseif (ismember(st_model, ["abzr_fibs"]))
        params_group = values(armt_map, {'ar_z_r_infbr_mesh_wage', 'ar_z_wage_mesh_r_infbr'});
    end    
    [ar_z_r_inf_mesh_wage, ar_z_wage_mesh_r_inf] = params_group{:};    
    params_group = values(param_map, {'it_z_wage_n'});
    [it_z_wage_n] = params_group{:};    
else
    fl_z_r_borr_n = 1;
    params_group = values(armt_map, {'ar_z'});
    [ar_z_wage_mesh_r_inf] = params_group{:};
    params_group = values(param_map, {'it_z_n'});
    [it_z_wage_n] = params_group{:};
end

% result_map standards
params_group = values(result_map, {'cl_mt_pol_a'});
[cl_mt_pol_a] = params_group{:};
[mt_pol_a] = deal(cl_mt_pol_a{1});

% result_map continuous formal informal choices
params_group = values(result_map, {'cl_mt_pol_b_bridge', 'cl_mt_pol_inf_borr_nobridge', ...
    'cl_mt_pol_for_borr', 'cl_mt_pol_for_save'});
[cl_mt_pol_b_bridge, cl_mt_pol_inf_borr_nobridge, cl_mt_pol_for_borr, cl_mt_pol_for_save] = params_group{:};
[mt_pol_b_bridge, mt_pol_inf_borr_nobridge, mt_pol_for_borr, mt_pol_for_save] = ...
    deal(cl_mt_pol_b_bridge{1}, cl_mt_pol_inf_borr_nobridge{1}, cl_mt_pol_for_borr{1}, cl_mt_pol_for_save{1});

% result_map discrete formal informal choices
params_group = values(result_map, {'mt_it_frmsavng_only', 'mt_it_b_bridge_idx', 'mt_it_for_only_nbdg', ...
    'mt_it_inf_only_nbdg', 'mt_it_frin_brr_nbdg', 'mt_it_fr_brrsv_nbdg'});
[mt_it_frmsavng_only, mt_it_b_bridge_idx, mt_it_for_only_nbdg, ...
    mt_it_inf_only_nbdg, mt_it_frin_brr_nbdg, mt_it_fr_brrsv_nbdg] = params_group{:};

% How many zs to Graph
ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);

%% Generate Limited Legends
    
% 8 graph points, 2 levels of borrow rates, and 4 levels of rbr rates
ar_it_z_r_borr = ([1 round((fl_z_r_borr_n)/2) (fl_z_r_borr_n)]);
ar_it_z_wage = ([1 round((it_z_wage_n)/2) (it_z_wage_n)]);

% combine by index
mt_it_z_graph = ar_it_z_wage' + it_z_wage_n*(ar_it_z_r_borr-1);
ar_it_z_graph = mt_it_z_graph(:)';

% legends index final
ar_it_legend2plot = ar_it_z_graph;
ar_it_legend2plot_lth = ar_it_z_graph;
if (ismember(st_model, ["ipwkbzr_fibs", "abzr_fibs"]))
    cl_st_legendCell = cellstr([num2str(ar_z_r_inf_mesh_wage', 'zr=%3.2f;'), ...
                                num2str(ar_z_wage_mesh_r_inf', 'zw=%3.2f')]);
else
    cl_st_legendCell = cellstr([num2str(ar_z_wage_mesh_r_inf', 'zw=%3.2f')]);
end

%% Graph Optimal Discrete
% States: cash-on-hand, shock
% Choices: discrete optimal choices

if (bl_graph_forinf_discrete)

    if (~bl_graph_onebyones)
        figure('PaperPosition', [0 0 14 4]);
        ar_sub_j = 1:1:2;
    else
        ar_sub_j = [1 2];
    end
    
    for sub_j = ar_sub_j
    
    % start figure
    if (~bl_graph_onebyones)
        subplot(1, 2, sub_j);
    else
        figure('PaperPosition', [0 0 7 4]);
    end
    hold on;        

    % Graph Optimal Discrete Gen Discrete Outcomes    
    % * formal only (no bridge)
    % * Informal borrow only (no bridge)
    % * formal + informal borrow (no bridge)
    % * formal save + borrow (no bridge)
    % * bridge loan areas
    
    % Generate x and y arrays
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z_wage_mesh_r_inf, ar_a);
    
    mt_x = ar_w_mz;
    mt_y = ar_z_mw;
        
    % colors etc    
    cl_colors = {'blue', 'red', 'black', [0 0.4471 0.7412], 'blue', [.61 .51 .74]};
    cl_legend = {'For Borr', 'Inf Borr', 'For+Inf Br', 'For+Br+Save', 'Bridge Loan', 'For Save'};
    cl_shapes = {'s','x','o','d','p','*'};
    it_basesize = 20;
    cl_csizes = {10*it_basesize, 20*it_basesize, 10*it_basesize, 10*it_basesize, 1*it_basesize, 2*it_basesize};
    
    % graphs to run       
    ar_it_graphs_run = 1:6;
%     ar_it_graphs_run = [6];
    it_graph_counter = 0;
    for it_fig = ar_it_graphs_run
        
        % count cur graph
        it_graph_counter = it_graph_counter + 1;
        
        if (it_fig == 1)
            mt_cur_use_idx = mt_it_for_only_nbdg;
        end
        if (it_fig == 2)
            mt_cur_use_idx = mt_it_inf_only_nbdg;
        end
        if (it_fig == 3)
            mt_cur_use_idx = mt_it_frin_brr_nbdg;
        end
        if (it_fig == 4)
            mt_cur_use_idx = mt_it_fr_brrsv_nbdg;
        end
        if (it_fig == 5)
            mt_cur_use_idx = mt_it_b_bridge_idx;
        end
        if (it_fig == 6)
            mt_cur_use_idx = mt_it_frmsavng_only;
        end
                
        % Generate x and y
        ar_x = mt_x(mt_cur_use_idx);
        ar_y = mt_y(mt_cur_use_idx);
        
        % Color and Size etc
        it_csize = cl_csizes{it_fig};
        ar_color = cl_colors{it_fig};
        st_shape = cl_shapes{it_fig};
        
        % Figure Collect
        if (ismember(sub_j, [1]))
            ar_x_use = ar_x;
            st_legend_loc = 'northeast';
        end
        if (ismember(sub_j, [2]))
            ar_x_use = log(ar_x - min(ar_a) + 1);
            st_legend_loc = 'northeast';
        end
        
        % Graph
        ls_chart(it_graph_counter) = scatter(ar_x_use, ar_y, it_csize, ar_color, st_shape);
        cl_legend{it_graph_counter} = cl_legend{it_fig};
    end
    
    % legend
    legend(ls_chart, cl_legend, 'Location', st_legend_loc);
    
    % labeling
    title('Borrow and Save Regions')
    ylabel('Shocks')
    if (ismember(sub_j, [1]))
        st_x_label = {'Asset State'};
    end
    if (ismember(sub_j, [2]))
        st_x_label = {'log(Asset State - min(asset) + 1)'};
    end
    
    % Turn on X and Y lines or Not        
    if (ismember(sub_j, [2]))
        xline0 = xline(log(0-min(ar_a)+1));
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';
    else
        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';
    end    

    grid on;
        
    % save file
    if (bl_img_save)
        if ~exist(support_map('st_img_path'),'dir'); mkdir(support_map('st_img_path')); end;
        st_file_name = [st_img_prefix st_img_name_main '_fibs5' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    end

end

%% Graph Choice Levels
% How much borrowing and savings of different types given a and shocks

if (bl_graph_forinf_pol_lvl)    
    
    if (~bl_graph_onebyones)
        figure('PaperPosition', [0 0 28 8]);
        ar_sub_j = 1:1:8;
    else
        ar_sub_j = [1 5 2 6 3 7 4 8];
    end

    for sub_j = ar_sub_j

        if (ismember(sub_j, [1,5]))
            mt_outcome = mt_pol_b_bridge;   
        end
        if (ismember(sub_j, [2,6]))
            mt_outcome = mt_pol_inf_borr_nobridge;
        end
        if (ismember(sub_j, [3,7]))
            mt_outcome = mt_pol_for_borr;
        end
        if (ismember(sub_j, [4,8]))
            mt_outcome = mt_pol_for_save;
        end

        if (~bl_graph_onebyones)
            subplot(2, 4, sub_j);
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        hold on;
        
        % Color Set
        clr = jet(length(ar_it_z_graph));
        
        % Iterate over Shocks to Graph (Finite Graphs)
        i_ctr = 0;
        for i = ar_it_z_graph
            
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            if (ismember(sub_j, [1,2,3,4]))
                % levels
                ar_a_curz_use = ar_a';
                ar_opti_curz_use = ar_opti_curz';                
            elseif (ismember(sub_j, [5,6,7,8]))
                % logs
                ar_a_curz_use = log(ar_a' - min(ar_a) + 1);
                if (ismember(sub_j, [5,6,7]))
                    % Borrowing Choices -(log(-(-5)+1))
                    ar_opti_curz_use = -log( - ar_opti_curz' + 1);
                end
                if (ismember(sub_j, [8]))
                    % Savings Choices
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                end
            end
                        
            scatter(ar_a_curz_use, ar_opti_curz_use, 5, ...
                    'MarkerEdgeColor', clr(i_ctr,:), ...
                    'MarkerFaceColor', clr(i_ctr,:));
        end
        
        % X Label
        if (ismember(sub_j, [1,2,3,4]))
            st_x_label = {'Asset State'};
            st_graph_loc = 'northwest';
        end
        if (ismember(sub_j, [5,6,7,8]))
            st_x_label = {'log(Asset State - min(asset) + 1)'};
            if (ismember(sub_j, [5]))
                st_graph_loc = 'southeast';
            elseif (ismember(sub_j, [6]))
                st_graph_loc = 'southeast';                
            elseif (ismember(sub_j, [7]))
                st_graph_loc = 'southeast';                
            elseif (ismember(sub_j, [8]))
                st_graph_loc = 'northwest';
            end
        end
        
        % Y Label
        if (ismember(sub_j, [1,5]))
            st_y_label = 'Bridge Loan Borrowing';
            if (ismember(sub_j, [5]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
            end
        end
        if (ismember(sub_j, [2,6]))
            st_y_label = 'Inf Borr (-bridge)';
            if (ismember(sub_j, [6]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
            end
        end
        if (ismember(sub_j, [3,7]))
            st_y_label = 'For Borr Menu';
            if (ismember(sub_j, [7]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
            end
        end
        if (ismember(sub_j, [4,8]))
            st_y_label = 'Savings';
            if (ismember(sub_j, [8]))
                st_y_label = ['log(' st_y_label '+1)' ];
            end
        end
        
        % Grid
        grid on;
        grid minor;
        
        % Legend
%         legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
%         legend(legendCell(ar_it_z_graph), 'Location', st_graph_loc);
        legend(cl_st_legendCell(ar_it_legend2plot), 'Location', st_graph_loc);
        
        % Title and X Y Labels
        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);
        
        % 45 Degree Line
        if (ismember(sub_j, [1,2,3,4]))
            hline = refline([1 0]);
            hline.Color = 'k';
            hline.LineStyle = ':';
            hline.HandleVisibility = 'off';
        end

        % Turn on X and Y lines or Not        
        if (ismember(sub_j, [5,6,7,8]))
            xline0 = xline(log(0-min(ar_a)+1));
            xline0.HandleVisibility = 'off';
            if (ismember(sub_j, [5,6,7]))
                yline0 = yline(-log(0+1));
                yline0.HandleVisibility = 'off';
            end
            if (ismember(sub_j, [8]))
                yline0 = yline(log(0+1));
                yline0.HandleVisibility = 'off';
            end
        else
            xline0 = xline(0);
            xline0.HandleVisibility = 'off';
            yline0 = yline(0);
            yline0.HandleVisibility = 'off';
        end
        
    end

    % save file
    if (bl_img_save)
        if ~exist(support_map('st_img_path'),'dir'); mkdir(support_map('st_img_path')); end;
        st_file_name = [st_img_prefix st_img_name_main '_pol_lvl' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

end

%% Graph Choice Percentages
% Percentage of Aggregate accounted for by this choice. Very similar to
% above, except now divide by mt_pol_a

if (bl_graph_forinf_pol_pct)

    if (~bl_graph_onebyones)
        figure('PaperPosition', [0 0 28 8]);
        ar_sub_j = 1:1:8;
    else
        ar_sub_j = [1 5 2 6 3 7 4 8];
    end

    for sub_j = ar_sub_j

        if (ismember(sub_j, [1,5]))
            mt_outcome = mt_pol_b_bridge./mt_pol_a;
        end
        if (ismember(sub_j, [2,6]))
            mt_outcome = mt_pol_inf_borr_nobridge./mt_pol_a;
        end
        if (ismember(sub_j, [3,7]))
            mt_outcome = mt_pol_for_borr./mt_pol_a;
        end
        if (ismember(sub_j, [4,8]))
            mt_outcome = mt_pol_for_save./mt_pol_a;
        end

        if (~bl_graph_onebyones)
            subplot(2, 4, sub_j);
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        hold on;
        
        % Color Set
        clr = jet(length(ar_it_z_graph));
        
        % Iterate over Shocks to Graph (Finite Graphs)
        i_ctr = 0;
        for i = ar_it_z_graph
            
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            if (ismember(sub_j, [1,2,3,4]))
                % levels
                ar_a_curz_use = ar_a';
                ar_opti_curz_use = ar_opti_curz';                
            elseif (ismember(sub_j, [5,6,7,8]))
                % logs
                ar_a_curz_use = log(ar_a' - min(ar_a) + 1);
                if (ismember(sub_j, [5,6,7]))
                    % Borrowing Choices -(log(-(-5)+1))
                    ar_opti_curz_use = -log( - ar_opti_curz' + 1);
                end
                if (ismember(sub_j, [8]))
                    % Savings Choices
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                end
            end
                        
            scatter(real(ar_a_curz_use), real(ar_opti_curz_use), 5, ...
                    'MarkerEdgeColor', clr(i_ctr,:), ...
                    'MarkerFaceColor', clr(i_ctr,:));
        end
        
        % X Label
        if (ismember(sub_j, [1,2,3,4]))
            st_x_label = {'Asset State'};
        end
        if (ismember(sub_j, [5,6,7,8]))
            st_x_label = {'log(Asset State - min(asset) + 1)'};
        end
        
        % Y Label
        if (ismember(sub_j, [1,5]))
            st_y_label = 'Bridge Loan Share';
            if (ismember(sub_j, [5]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
            end
            st_graph_loc = 'northeast';
        end
        if (ismember(sub_j, [2,6]))
            st_y_label = 'Inf Borr (-bridge) Share';
            if (ismember(sub_j, [6]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
                st_graph_loc = 'northwest';
            else
                st_graph_loc = 'northeast';
            end
            
        end
        if (ismember(sub_j, [3,7]))
            st_y_label = 'For Borr Menu Share';
            if (ismember(sub_j, [7]))
                st_y_label = ['-log(-(' st_y_label ')+1)' ];
                st_graph_loc = 'northwest';
            else
                st_graph_loc = 'northeast';
            end            
        end
        if (ismember(sub_j, [4,8]))
            st_y_label = 'Savings Share';
            if (ismember(sub_j, [8]))
                st_y_label = ['log(' st_y_label '+1)' ];
                st_graph_loc = 'southwest';
            else
                st_graph_loc = 'southeast';
            end
            
        end
        
        % Grid
        grid on;
        grid minor;
        
        % Legend
%         legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
%         legend(legendCell(ar_it_z_graph), 'Location', st_graph_loc);
        legend(cl_st_legendCell(ar_it_legend2plot), 'Location', st_graph_loc);
        
        % Title and X Y Labels
        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);
        

        % Turn on X and Y lines or Not        
        if (ismember(sub_j, [5,6,7,8]))
            xline0 = xline(log(0-min(ar_a)+1));
            xline0.HandleVisibility = 'off';
            
            if (ismember(sub_j, [5,6,7]))
                yline0 = yline(-log(0+1));
                yline0.HandleVisibility = 'off';
                
                yline1 = yline(+log(1));
                yline1.HandleVisibility = 'off';
            end
            if (ismember(sub_j, [8]))
                yline0 = yline(log(0+1));
                yline0.HandleVisibility = 'off';
                
                yline1 = yline(log(1));
                yline1.HandleVisibility = 'off';                
            end
            
        else
            
            xline0 = xline(0);
            xline0.HandleVisibility = 'off';
            yline0 = yline(0);
            yline0.HandleVisibility = 'off';
            
            if (ismember(sub_j, [1,2,3]))
                % borrowing/borrow positive
                yline1 = yline(1);
                yline1.HandleVisibility = 'off';
            elseif (ismember(sub_j, [4]))
                % savings/borrow save/save
                yline1 = yline(+1);
                yline1.HandleVisibility = 'off';
                ylineneg1 = yline(-1);
                ylineneg1.HandleVisibility = 'off';
            end            
        end
        

        
    end

    % save file
    if (bl_img_save)
        if ~exist(support_map('st_img_path'),'dir'); mkdir(support_map('st_img_path')); end;
        st_file_name = [st_img_prefix st_img_name_main '_pol_pct' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

end

end

##### SOURCE END #####
--></body></html>