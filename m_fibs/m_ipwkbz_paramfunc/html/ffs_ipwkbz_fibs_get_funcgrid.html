
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Generate States, Choices and Shocks Grids and Get Functions (Interpolated + Percentage + Risky + Safe Asset + FIBS)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-07-02"><meta name="DC.source" content="ffs_ipwkbz_fibs_get_funcgrid.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Generate States, Choices and Shocks Grids and Get Functions (Interpolated + Percentage + Risky + Safe Asset + FIBS)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FFS_IPWKBZ_FIBS_GET_FUNCGRID get funcs, params, states choices shocks grids</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">G1: Generate Asset and Choice Grid for 2nd stage Problem</a></li><li><a href="#6">G2: Expand A and K Arrays further if bridge is allowed</a></li><li><a href="#7">G3: Flatten Choices to Arrays to be Combined with Shocks as Columns.</a></li><li><a href="#8">F1: Get Shock Grids</a></li><li><a href="#9">FIBS1: Get Equations</a></li><li><a href="#10">FIBS2: Get Formal Borrowing Blocks</a></li><li><a href="#11">Find Formal and Informal Choices for Borrowing points</a></li><li><a href="#12">FIBS3: Generate C cost Matrix when aggregate savings = k'+b' is negative</a></li><li><a href="#13">FIBS3: Generate C cost Cash-on-Hand/State Matrix when aggregate savings is positive</a></li><li><a href="#14">COH1: Combine overall Reachable Cash-on-Hand Levels</a></li><li><a href="#15">COH2: Check if COH is within Borrowing Bounds</a></li><li><a href="#16">COH3: Update Valid 2nd stage choice matrix</a></li><li><a href="#17">COH4: Select only Valid (k(w), a) choices</a></li><li><a href="#18">Generate 1st Stage States: Interpolation Cash-on-hand Interpolation Grid</a></li><li><a href="#19">Generate 1st Stage Choices: Interpolation Cash-on-hand Interpolation Grid</a></li><li><a href="#20">Generate 1st Stage Choices: Percent of W for Covering Bridge Loans</a></li><li><a href="#21">Generate Interpolation Consumption Grid</a></li><li><a href="#22">Initialize armt_map to store, state, choice, shock matrixes</a></li><li><a href="#23">Store armt_map (1): 2nd Stage Problem Arrays and Matrixes</a></li><li><a href="#24">Store armt_map (2): First Stage Aggregate Savings</a></li><li><a href="#25">Store armt_map (3): First Stage Consumption and Cash-on-Hand Grids</a></li><li><a href="#26">Store armt_map (4): Shock Grids</a></li><li><a href="#27">Store Function Map</a></li><li><a href="#28">Graph</a></li><li><a href="#30">Graph 1: a and k choice grid graphs</a></li><li><a href="#31">Graph 2: coh by shock</a></li><li><a href="#32">Graph 3: 1st State Aggregate Savings Choices by COH interpolation grids</a></li><li><a href="#34">Graph Details, Generally do Not Run</a></li><li><a href="#36">Graph 1: 2nd stage coh reached by k' b' choices by index</a></li><li><a href="#37">Graph 2: 2nd stage coh reached by k' b' choices  by coh</a></li><li><a href="#39">Display</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [armt_map, func_map] = ffs_ipwkbz_fibs_get_funcgrid(varargin)
</pre><h2 id="2">FFS_IPWKBZ_FIBS_GET_FUNCGRID get funcs, params, states choices shocks grids</h2><p>This file is based on <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html">ffs_ipwkbz_get_funcgrid</a>, see that file for more comments and compare differences in graphs and tables to see how the inclusion of formal and informal choices that consider bridge loans impact choice sets.</p><p>Also compare against <a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_paramfunc/html/ffs_abz_fibs_get_funcgrid.html">ffs_abz_fibs_get_funcgrid</a> where the results are also considering formal and informal choices etc in the context of <b>abz fibs</b>.</p><p>In contrast to ff_ipwkbz_evf.m, here, we need to deal with borrowing and savings formal and informal. These will change how the testing matrix is constructed. When bridge loan is allowed, we also need to construct the output matrixes differently. In ff_ipwkbz_evf.m, the assumption is that coh today does not matter, so to find optimal k* choice, we only need to know the aggregate savings level. But now, we need to know the coh level as well.</p><p>Below two reachable coh matrixes are constructed, one for when aggregate savings choice w &gt;= 0, and another for when aggregate savings &lt;= 0. Then they are stacked together. And we still have the same outputs as ff_ipwkbz_evf.m. The difference is that while for savings where w &gt;=0, each row are w levels for the output matrixes, but for w &lt;=0, each row is for w level + coh percentage combinations.</p><div><ul><li><i>ar_w_level</i>: What are the feasible grid of w = k'+b', these are to be interpolated later, these are level grid, not percentage grid</li><li><i>ar_w_level</i>: What are the percentage based choices points for k' and b' given each w. These are <i>ar_a_meshk</i>, <i>ar_k_mesha</i>. Note here these are principles, k + b' is the total aggregate savings in period t. b is be a combination of formal and informal choices, but our percentage point for b is the overall principle of all formal and informal choices</li><li><i>mt_coh_wkb_full</i> : These are the cash-on-hand levels reacheable given the choice percentages of k and b'. The problem here is more complicated than <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html">ffs_ipwkbz_get_funcgrid</a> because here we can not get to coh tomorrow by multiplying principle by savings or borrowing interest rates, if borrowing, we have to optimize among formal and informal choices. That is computationally trivial because it's a static choice unrelated to the dynamic problem. The slightly more complicated thing is that we also have to consider percentages of b' that has to go to bridge loans due to negative cash-on-hand in period t. That makes the reachable cash-on-hand grid significantly larger than the grid in <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html">ffs_ipwkbz_get_funcgrid</a>, we have to expand the grid by another percentage dimension--percentages of b' going to bridge--for negative levels of w=k'+b' overall choice.</li></ul></div><h2 id="3">Default</h2><p>Results identical to <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html">ffs_ipwkbz_get_funcgrid</a> is obtained by running default with: st_param_which = 'ffs_ipwkbz_get_funcgrid';</p><pre class="codeinput">bl_input_override = 0;
<span class="keyword">if</span> (length(varargin) == 3)
    bl_input_override = varargin{3};
<span class="keyword">end</span>
<span class="keyword">if</span> (bl_input_override)
    <span class="comment">% override when called from outside</span>
    [param_map, support_map, ~] = varargin{:};
<span class="keyword">else</span>
    <span class="comment">% default internal run</span>
    [param_map, support_map] = ffs_ipwkbz_fibs_set_default_param();
    support_map(<span class="string">'bl_graph_funcgrids'</span>) = true;
    support_map(<span class="string">'bl_graph_funcgrids_detail'</span>) = true;
    support_map(<span class="string">'bl_display_funcgrids'</span>) = true;

    st_param_which = <span class="string">'small'</span>;

    <span class="keyword">if</span> (ismember(st_param_which, [<span class="string">'default'</span>, <span class="string">'ffs_ipwkbz_get_funcgrid'</span>]))

        <span class="comment">% to be able to visually see choice grid points</span>
        param_map(<span class="string">'fl_b_bd'</span>) = -20; <span class="comment">% borrow bound, = 0 if save only</span>
        param_map(<span class="string">'fl_default_aprime'</span>) = 0;
        param_map(<span class="string">'bl_default'</span>) = 0; <span class="comment">% if borrowing is default allowed</span>

        param_map(<span class="string">'fl_w_min'</span>) = param_map(<span class="string">'fl_b_bd'</span>);
        param_map(<span class="string">'it_w_perc_n'</span>) = 25;
        param_map(<span class="string">'it_ak_perc_n'</span>) = 45;

        param_map(<span class="string">'fl_w_interp_grid_gap'</span>) = 2;
        param_map(<span class="string">'fl_coh_interp_grid_gap'</span>) = 2;

        <span class="comment">% Note it_coh_bridge_perc is percentage NOT for BRIDGE</span>
        <span class="keyword">if</span> (strcmp(st_param_which, <span class="string">'default'</span>))

            param_map(<span class="string">'it_coh_bridge_perc_n'</span>) = 3;

            <span class="comment">% Adjust interest rates</span>
            param_map(<span class="string">'fl_r_inf'</span>) = 0.30;
            param_map(<span class="string">'fl_r_inf_bridge'</span>) = 0.30;
            param_map(<span class="string">'bl_bridge'</span>) = true;

        <span class="keyword">elseif</span> (strcmp(st_param_which, <span class="string">'ffs_ipwkbz_get_funcgrid'</span>))


            param_map(<span class="string">'fl_r_inf'</span>) = 0.025;
            param_map(<span class="string">'fl_r_inf_bridge'</span>) = 0.025;
            param_map(<span class="string">'bl_bridge'</span>) = false;
            <span class="comment">% when bl_bridge = false, it_coh_bridge_perc_n = 1</span>

        <span class="keyword">end</span>

    <span class="keyword">elseif</span> (strcmp(st_param_which, <span class="string">'small'</span>))

        param_map(<span class="string">'bl_bridge'</span>) = true;

        <span class="comment">% Adjust interest rates</span>
        param_map(<span class="string">'fl_r_inf'</span>) = 0.30;
        param_map(<span class="string">'fl_r_inf_bridge'</span>) = 0.30;

        <span class="comment">% to be able to visually see choice grid points</span>
        param_map(<span class="string">'fl_b_bd'</span>) = -20; <span class="comment">% borrow bound, = 0 if save only</span>
        param_map(<span class="string">'fl_default_aprime'</span>) = 0;
        param_map(<span class="string">'bl_default'</span>) = false; <span class="comment">% if borrowing is default allowed</span>

        param_map(<span class="string">'fl_w_min'</span>) = param_map(<span class="string">'fl_b_bd'</span>);
        param_map(<span class="string">'it_w_perc_n'</span>) = 7;
        param_map(<span class="string">'it_ak_perc_n'</span>) = 7;
        param_map(<span class="string">'it_coh_bridge_perc_n'</span>) = 3;

        param_map(<span class="string">'fl_w_interp_grid_gap'</span>) = 2;
        param_map(<span class="string">'fl_coh_interp_grid_gap'</span>) = 2;

    <span class="keyword">end</span>


    default_maps = {param_map, support_map};

    <span class="comment">% numvarargs is the number of varagin inputted</span>
    [default_maps{1:length(varargin)}] = varargin{:};
    param_map = [param_map; default_maps{1}];
    support_map = [support_map; default_maps{2}];
<span class="keyword">end</span>
</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput">params_group = values(param_map, {<span class="string">'it_z_n'</span>, <span class="string">'fl_z_mu'</span>, <span class="string">'fl_z_rho'</span>, <span class="string">'fl_z_sig'</span>});
[it_z_n, fl_z_mu, fl_z_rho, fl_z_sig] = params_group{:};

params_group = values(param_map, {<span class="string">'fl_nan_replace'</span>, <span class="string">'fl_b_bd'</span>, <span class="string">'fl_w_min'</span>, <span class="string">'fl_w_max'</span>, <span class="keyword">...</span>
    <span class="string">'it_w_perc_n'</span>, <span class="string">'fl_w_interp_grid_gap'</span>, <span class="string">'fl_coh_interp_grid_gap'</span>});
[fl_nan_replace, fl_b_bd, fl_w_min, fl_w_max, <span class="keyword">...</span>
    it_w_perc_n, fl_w_interp_grid_gap, fl_coh_interp_grid_gap] = params_group{:};

params_group = values(param_map, {<span class="string">'fl_k_min'</span>, <span class="string">'fl_k_max'</span>, <span class="string">'it_ak_perc_n'</span>});
[fl_k_min, fl_k_max, it_ak_perc_n] = params_group{:};

params_group = values(param_map, {<span class="string">'fl_crra'</span>, <span class="string">'fl_c_min'</span>, <span class="string">'it_c_interp_grid_gap'</span>});
[fl_crra, fl_c_min, it_c_interp_grid_gap] = params_group{:};

params_group = values(param_map, {<span class="string">'fl_Amean'</span>, <span class="string">'fl_alpha'</span>, <span class="string">'fl_delta'</span>});
[fl_Amean, fl_alpha, fl_delta] = params_group{:};

params_group = values(param_map, {<span class="string">'bl_bridge'</span>, <span class="string">'it_coh_bridge_perc_n'</span>});
[bl_bridge, it_coh_bridge_perc_n] = params_group{:};

params_group = values(param_map, {<span class="string">'bl_b_is_principle'</span>, <span class="string">'fl_r_fbr'</span>, <span class="string">'fl_r_fsv'</span>, <span class="string">'fl_r_inf'</span>, <span class="string">'fl_w'</span>});
[bl_b_is_principle, fl_r_fbr, fl_r_fsv, fl_r_inf, fl_w] = params_group{:};

params_group = values(param_map, {<span class="string">'st_forbrblk_type'</span>, <span class="string">'fl_forbrblk_brmost'</span>, <span class="string">'fl_forbrblk_brleast'</span>, <span class="string">'fl_forbrblk_gap'</span>});
[st_forbrblk_type, fl_forbrblk_brmost, fl_forbrblk_brleast, fl_forbrblk_gap] = params_group{:};

params_group = values(support_map, {<span class="string">'bl_display_minccost'</span>, <span class="string">'bl_graph_funcgrids'</span>, <span class="string">'bl_graph_funcgrids_detail'</span>, <span class="string">'bl_display_funcgrids'</span>});
[bl_display_minccost, bl_graph_funcgrids, bl_graph_funcgrids_detail, bl_display_funcgrids] = params_group{:};
</pre><h2 id="5">G1: Generate Asset and Choice Grid for 2nd stage Problem</h2><p>This generate triangular choice structure. Household choose total aggregate savings, and within that how much to put into risky capital and how much to put into safe assets, in percentages. See <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_fibs_set_default_param.html">ffs_ipwkbz_fibs_set_default_param</a> for details.</p><p>@example</p><pre>  % For 2nd stage Grid
  ar_w_level = [-2,0,2]
  fl_b_bd = -4
  ar_k_max = ar_w_level - fl_b_bd
  ar_ak_perc = [0.001, 0.1,0.3,0.7,0.9, 0.999]
  mt_k = (ar_k_max'*ar_ak_perc)'
  mt_a = (ar_w_level - mt_k)</pre><pre class="codeinput"><span class="comment">% percentage grid for 1st stage choice problem, level grid for 2nd stage</span>
<span class="comment">% solving optimal k given w and z.</span>
ar_w_perc = linspace(0.001, 0.999, it_w_perc_n);
it_w_interp_n = (fl_w_max-fl_w_min)/(fl_w_interp_grid_gap);
ar_w_level_full = fft_array_add_zero(linspace(fl_w_min, fl_w_max, it_w_interp_n), true);
ar_w_level = ar_w_level_full;

<span class="comment">% max k given w, need to consider the possibility of borrowing.</span>
ar_k_max = ar_w_level_full - fl_b_bd;

<span class="comment">% k percentage choice grid</span>
ar_ak_perc = linspace(0.001, 0.999, it_ak_perc_n);

<span class="comment">% 2nd stage percentage choice matrixes</span>
<span class="comment">% (ar_k_max') is it_w_interp_n by 1, and (ar_ak_perc) is 1 by it_ak_perc_n</span>
<span class="comment">% mt_k is a it_w_interp_n by it_ak_perc_n matrix of choice points of k'</span>
<span class="comment">% conditional on w, each column is a different w, each row for each col a</span>
<span class="comment">% different k' value.</span>
mt_k = (ar_k_max'*ar_ak_perc)';
mt_a = (ar_w_level_full - mt_k);

<span class="comment">% can not have choice that are beyond feasible bound given the percentage</span>
<span class="comment">% structure here.</span>
mt_bl_constrained = (mt_a &lt; fl_b_bd);
<span class="keyword">if</span> (sum(mt_bl_constrained) &gt; 0 )
    error(<span class="string">'at %s second stage choice points, percentage choice exceed bounds, can not happen'</span>,<span class="keyword">...</span>
        num2str(sum(mt_bl_constrained)));
<span class="keyword">end</span>
</pre><h2 id="6">G2: Expand A and K Arrays further if bridge is allowed</h2><p>Crucially, when a fraction of overall borrowing/savings needs to go pay negative coh, that comes out of w, fraction of w = k' + b' that goes to this. NOT a fraction of the b' choice condition on w, which would change for the same w as w' changes. We are fixing bridge repay level for w.</p><p>@example</p><pre>  clear all
  % Same as above
  ar_w_level = [-2,-1,-0.1]
  fl_b_bd = -4
  ar_k_max = ar_w_level - fl_b_bd
  ar_ak_perc = [0.001, 0.1,0.3,0.7,0.9, 0.999]
  mt_k = (ar_k_max'*ar_ak_perc)'
  mt_a = (ar_w_level - mt_k)</pre><pre>  % fraction of borrowing for bridge loan
  ar_coh_bridge_perc = [0, 0.5, 0.999];</pre><pre>  % Expand matrix to include coh percentage dimension
  mt_k = repmat(mt_k, [1, length(ar_coh_bridge_perc)])
  mt_a = repmat(mt_a, [1, length(ar_coh_bridge_perc)])</pre><pre>  % bridge loan component of borrowing
  ar_brdige_a = (ar_coh_bridge_perc'*ar_w_level)'
  ar_brdige_a = ar_brdige_a(:)'</pre><pre>  % borrowing choices excluding bridge loan
  mt_a_nobridge = mt_a - ar_brdige_a</pre><pre class="codeinput"><span class="comment">% 1. negative part of w</span>
ar_bl_w_neg = (ar_w_level &lt; 0);
ar_w_level_neg = ar_w_level(ar_bl_w_neg);

<span class="keyword">if</span> (bl_bridge)

    <span class="comment">% 1. select mt_k and mt_a where w_level &lt;= 0</span>
    mt_a_wneg_cols = mt_a(:, ar_bl_w_neg);
    mt_k_wneg_cols = mt_k(:, ar_bl_w_neg);

    <span class="comment">% 2. fraction of borrowing NOT for bridge loan</span>
    <span class="comment">% 0 means 100 percent of w will go to bridge, 1 mean nothing for bridge</span>
    ar_coh_bridge_perc = linspace(0, 1.0, it_coh_bridge_perc_n);

    <span class="comment">% 3. Expand matrix to include coh percentage dimension</span>
    mt_k_wneg_cols = repmat(mt_k_wneg_cols, [1, length(ar_coh_bridge_perc)]);
    mt_a_wneg_cols = repmat(mt_a_wneg_cols, [1, length(ar_coh_bridge_perc)]);

    <span class="comment">% 4. bridge loan component of borrowing</span>
    ar_brdige_a = ((1-ar_coh_bridge_perc)'*ar_w_level_neg)';
    ar_brdige_a = ar_brdige_a(:)';

    <span class="comment">% 5. borrowing choices excluding bridge loan</span>
    mt_a_wneg_nobridge = mt_a_wneg_cols - ar_brdige_a;

    <span class="comment">% 6. Matrix combine, negative than positive</span>
    mt_a_wpos_cols = mt_a(:, ~ar_bl_w_neg);
    mt_k_wpos_cols = mt_k(:, ~ar_bl_w_neg);
    mt_a_nobridge = [mt_a_wneg_nobridge  mt_a_wpos_cols];
    mt_k = [mt_k_wneg_cols                mt_k_wpos_cols];

    <span class="comment">% 7. Expand Bridge Choices to have the same size as mt_a</span>
    mt_bridge_a= zeros(size(mt_a_nobridge));
    mt_bridge_a(:, 1:1:size(mt_a_wneg_nobridge,2)) = zeros(size(mt_a_wneg_nobridge)) + ar_brdige_a;

    <span class="comment">% 8. Overall borrowing and savings choices</span>
    mt_a = mt_a_nobridge + mt_bridge_a;

    <span class="comment">% 9. Update w</span>
    ar_w_level_full = zeros(size(mt_a_nobridge(1,:)));
    ar_w_level_neg_rep = repmat(ar_w_level_neg, [1, length(ar_coh_bridge_perc)]);
    ar_w_level_full(1:1:size(mt_a_wneg_nobridge,2)) = ar_w_level_neg_rep;
    ar_w_level_full((size(mt_a_wneg_nobridge,2)+1):1:length(ar_w_level_full)) = ar_w_level(~ar_bl_w_neg);

    <span class="comment">% 10. Pre-generate Interpolation matrix for negative w levels</span>
    [mt_w_level_neg_mesh_coh_bridge_perc, mt_coh_bridge_perc_mesh_w_level_neg] = <span class="keyword">...</span>
        ndgrid(ar_w_level_neg, ar_coh_bridge_perc);

<span class="keyword">else</span>

    <span class="comment">% If bridge loans are not needed, do not need to do expansions</span>
    <span class="comment">% All zeros, no bridge</span>
    mt_bridge_a = zeros(size(mt_a));
    mt_a_nobridge = mt_a;
    ar_coh_bridge_perc = [1];

    [mt_w_level_neg_mesh_coh_bridge_perc, mt_coh_bridge_perc_mesh_w_level_neg] = <span class="keyword">...</span>
        ndgrid(ar_w_level_neg, ar_coh_bridge_perc);

<span class="keyword">end</span>
</pre><h2 id="7">G3: Flatten Choices to Arrays to be Combined with Shocks as Columns.</h2><p>For the arrays below, their dimensionality are all: N_neg*N^2 + N_pos*N number of rows. Where N is the percentage grid point for coh as well as k' choices: N = it_ak_perc_n = it_coh_bridge_perc_n; And N_neg + N_pos = numger of grid points for ar_w_level</p><div><ol><li><b>mt_a</b> includes aggregate/total borrowing and savings levels. b &lt; 0 happens alot when w &gt;= 0. The mt_a_nobridge</li><li><b>mt_a_nobridge</b> includes all aggregate/total borrowing and savings whether w &gt; 0 or w &lt; 0, however, it subtracts away the borrowing that is for bridge loans when b &lt; 0</li><li><b>mt_bridge_a</b> is the bridge loan amount.</li></ol></div><pre class="codeinput">ar_a_meshk_full = mt_a(:);
ar_a_nobridge_meshk_full = mt_a_nobridge(:);
ar_k_mesha_full = mt_k(:);
ar_bridge_a_full = mt_bridge_a(:);

ar_a_meshk = ar_a_meshk_full;
ar_a_nobridge_meshk = ar_a_nobridge_meshk_full;
ar_k_mesha = ar_k_mesha_full;
ar_bridge_a = ar_bridge_a_full;
</pre><h2 id="8">F1: Get Shock Grids</h2><pre class="codeinput">[~, mt_z_trans, ar_stationary, ar_z] = ffto_gen_tauchen_jhl(fl_z_mu,fl_z_rho,fl_z_sig,it_z_n);
</pre><h2 id="9">FIBS1: Get Equations</h2><pre class="codeinput">[f_util_log, f_util_crra, f_util_standin, f_prod, f_inc, f_coh, f_coh_fbis, f_coh_save, f_cons] = <span class="keyword">...</span>
    ffs_ipwkbz_fibs_set_functions(fl_crra, fl_c_min, fl_b_bd, fl_Amean, fl_alpha, fl_delta, fl_w, fl_r_fbr, fl_r_fsv);
</pre><h2 id="10">FIBS2: Get Formal Borrowing Blocks</h2><pre class="codeinput">[ar_forbrblk, ar_forbrblk_r] = <span class="keyword">...</span>
        ffs_for_br_block_gen(fl_r_fbr, st_forbrblk_type, fl_forbrblk_brmost, fl_forbrblk_brleast, fl_forbrblk_gap);
</pre><h2 id="11">Find Formal and Informal Choices for Borrowing points</h2><p>Here we solve for the optimal formal and informal choices given b. Note that kind of like the static firm's maximization problem. Here the optimization problem is static, and can be done independently of the overall dynamic optimization problem.</p><pre class="codeinput"><span class="comment">% When borrowing index and array</span>
<span class="comment">% note index for negative is from _ar_a_meshk_full_, but value from</span>
<span class="comment">% _ar_a_nobridge_meshk_. Index from _ar_a_meshk_full_, which means at some</span>
<span class="comment">% of these points _ar_a_nobridge_meshk_ = 0. But need to use</span>
<span class="comment">% _ar_bl_ameshk_neg_idx_ because *f_coh_fbis* function below applies to all</span>
<span class="comment">% borrowing.</span>
ar_bl_ameshk_neg_idx = (ar_a_meshk_full &lt; 0);
ar_a_meshk_nobridge_aneg = ar_a_nobridge_meshk(ar_bl_ameshk_neg_idx);

<span class="comment">% Given b, solve for optimal formal and informal choices.</span>
bl_input_override = true;
[~, ar_inf_borr_nobridge_aneg, ar_for_borr_aneg, ar_for_save_aneg] = <span class="keyword">...</span>
   ffs_fibs_min_c_cost(bl_b_is_principle, fl_r_inf, fl_r_fsv, <span class="keyword">...</span>
                         ar_forbrblk_r, ar_forbrblk, <span class="keyword">...</span>
                         ar_a_meshk_nobridge_aneg, bl_display_minccost, bl_input_override);
</pre><h2 id="12">FIBS3: Generate C cost Matrix when aggregate savings = k'+b' is negative</h2><p><b>ar_coh_fbis_aneg</b>: the consumption cost to t+1 from borrowing in t given formal and informal joint choice optimization.</p><p>Reachable cash-on-hand borrowing points: N_neg*N^2 rows</p><p>Additionally, need to convert borrowing choices to consumption units next period. borrowing choices in percentage are in unit of last period borrowing, principles only, need to convert to interest rates plus principle which means considering which formal informal choice combination maximizes cash-on-hand for the same level of overall principles.</p><p>Construct another percentage, which is, percentages of ar_a_meshk_full when w &lt; 0. Percentage represents what fraction of the a debt is going towards bridge loan debts. Note that as long as w &lt; 0, b &lt; 0 must be the case as well. So for negative elements of w, there is a triple mesh: N points for A x N points for K x N points for Bridge.</p><pre class="codeinput">ar_coh_fbis_aneg = f_coh_fbis(fl_r_inf, <span class="keyword">...</span>
                                ar_for_borr_aneg, <span class="keyword">...</span>
                                ar_inf_borr_nobridge_aneg + ar_bridge_a(ar_bl_ameshk_neg_idx), <span class="keyword">...</span>
                                ar_for_save_aneg);
</pre><h2 id="13">FIBS3: Generate C cost Cash-on-Hand/State Matrix when aggregate savings is positive</h2><p><b>ar_coh_save_apos</b>: the consumption gain to t+1 from savings in t</p><pre class="codeinput">ar_a_meshk_apos = ar_a_meshk(~ar_bl_ameshk_neg_idx);
ar_coh_save_apos = f_coh_save(ar_a_meshk_apos);
</pre><h2 id="14">COH1: Combine overall Reachable Cash-on-Hand Levels</h2><p>N_neg*N^2 + N_pos*N rows total row count, and N_z shock column count. These are the cash-on-hand points reachable given percentage grid choice structure and the possibility of bridge loans.</p><pre class="codeinput">ar_ameshk_tnext_with_r = zeros(size(ar_k_mesha));
ar_ameshk_tnext_with_r(ar_bl_ameshk_neg_idx) = ar_coh_fbis_aneg;
ar_ameshk_tnext_with_r(~ar_bl_ameshk_neg_idx) = ar_coh_save_apos;

mt_coh_wkb_full = f_coh(ar_z, ar_ameshk_tnext_with_r, ar_k_mesha);

<span class="keyword">if</span> (bl_display_funcgrids)

    <span class="comment">% Generate Aggregate Variables</span>
    ar_aplusk_mesha = ar_a_meshk + ar_k_mesha;
    ar_bwithrplusk_mesha = ar_ameshk_tnext_with_r + ar_k_mesha;

    <span class="comment">% Genereate Table</span>
    tab_ak_choices = array2table([ar_bwithrplusk_mesha, ar_aplusk_mesha, <span class="keyword">...</span>
        ar_k_mesha, ar_ameshk_tnext_with_r, ar_a_meshk, ar_a_nobridge_meshk, ar_bridge_a]);
    cl_col_names = {<span class="string">'ar_bwithrplusk_mesha'</span>, <span class="string">'ar_aplusk_mesha'</span>, <span class="keyword">...</span>
        <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_ameshk_tnext_with_r'</span>, <span class="string">'ar_a_meshk'</span>, <span class="string">'ar_a_nobridge_meshk'</span>, <span class="string">'ar_bridge_a'</span>};
    tab_ak_choices.Properties.VariableNames = cl_col_names;

    <span class="comment">% Label Table Variables</span>
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_bwithrplusk_mesha'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_bwithrplusk_mesha*: '</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_aplusk_mesha'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_aplusk_mesha*:'</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_k_mesha'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_k_mesha*:'</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_ameshk_tnext_with_r'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_ameshk_tnext_with_r*:'</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_a_meshk'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_a_meshk*:'</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_a_nobridge_meshk'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_aprime_nobridge*:'</span>;
    tab_ak_choices.Properties.VariableDescriptions{<span class="string">'ar_bridge_a'</span>} = <span class="keyword">...</span>
        <span class="string">'*ar_bridge_a*:'</span>;

    cl_var_desc = tab_ak_choices.Properties.VariableDescriptions;
    <span class="keyword">for</span> it_var_name = 1:length(cl_var_desc)
        disp(cl_var_desc{it_var_name});
    <span class="keyword">end</span>

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'tab_ak_choices'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    it_rows_toshow = length(ar_w_level)*2;
    disp(size(tab_ak_choices));
    disp(head(array2table(tab_ak_choices), it_rows_toshow));
    disp(tail(array2table(tab_ak_choices), it_rows_toshow));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_coh_wkb_full'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_coh_wkb_full));
    disp(head(array2table(mt_coh_wkb_full), it_rows_toshow));
    disp(tail(array2table(mt_coh_wkb_full), it_rows_toshow));

<span class="keyword">end</span>
</pre><pre class="codeoutput">*ar_bwithrplusk_mesha*:
*ar_aplusk_mesha*:
*ar_k_mesha*:
*ar_ameshk_tnext_with_r*:
*ar_a_meshk*:
*ar_aprime_nobridge*:
*ar_bridge_a*:
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
tab_ak_choices
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   385     7

      tab_ak_choices1       tab_ak_choices2    tab_ak_choices3       tab_ak_choices4        tab_ak_choices5      tab_ak_choices6      tab_ak_choices7
    ar_bwithrplusk_mesha    ar_aplusk_mesha      ar_k_mesha       ar_ameshk_tnext_with_r      ar_a_meshk       ar_a_nobridge_meshk      ar_bridge_a  
    ____________________    _______________    _______________    ______________________    _______________    ___________________    _______________

              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
              -26                   -20                  0                   -26                    -20                     0                 -20    
          -23.243               -17.879          0.0021212               -23.245                -17.881            -0.0021212             -17.879    
          -23.261               -17.879            0.35495               -23.616                -18.234              -0.35495             -17.879    
           -23.27               -17.879            0.70778               -23.978                -18.587              -0.70778             -17.879    
          -23.294               -17.879             1.0606               -24.355                -18.939               -1.0606             -17.879    
          -23.303               -17.879             1.4134               -24.716                -19.292               -1.4134             -17.879    
          -23.312               -17.879             1.7663               -25.078                -19.645               -1.7663             -17.879    
           -23.32               -17.879             2.1191               -25.439                -19.998               -2.1191             -17.879    
          -20.486               -15.758          0.0042424                -20.49                -15.762            -0.0042424             -15.758    
          -20.513               -15.758             0.7099               -21.222                -16.467               -0.7099             -15.758    
          -20.545               -15.758             1.4156               -21.961                -17.173               -1.4156             -15.758    
          -20.563               -15.758             2.1212               -22.684                -17.879               -2.1212             -15.758    
          -20.596               -15.758             2.8269               -23.422                -18.584               -2.8269             -15.758    
          -20.613               -15.758             3.5325               -24.146                 -19.29               -3.5325             -15.758    
          -20.646               -15.758             4.2382               -24.884                -19.996               -4.2382             -15.758    
          -17.729               -13.636          0.0063636               -17.736                -13.643            -0.0063636             -13.636    
          -17.779               -13.636             1.0648               -18.844                -14.701               -1.0648             -13.636    
          -17.805               -13.636             2.1233               -19.929                 -15.76               -2.1233             -13.636    
          -17.847               -13.636             3.1818               -21.029                -16.818               -3.1818             -13.636    
          -17.888               -13.636             4.2403               -22.129                -17.877               -4.2403             -13.636    
          -17.915               -13.636             5.2988               -23.214                -18.935               -5.2988             -13.636    
          -17.956               -13.636             6.3573               -24.313                -19.994               -6.3573             -13.636    
          -14.972               -11.515          0.0084848               -14.981                -11.524            -0.0084848             -11.515    
           -15.03               -11.515             1.4198                -16.45                -12.935               -1.4198             -11.515    
           -15.08               -11.515             2.8311               -17.912                -14.346               -2.8311             -11.515    
          -15.131               -11.515             4.2424               -19.373                -15.758               -4.2424             -11.515    
          -15.181               -11.515             5.6537               -20.835                -17.169               -5.6537             -11.515    
          -15.234               -11.515             7.0651               -22.299                 -18.58               -7.0651             -11.515    
          -15.282               -11.515             8.4764               -23.758                -19.992               -8.4764             -11.515    
          -12.215               -9.3939           0.010606               -12.226                -9.4045             -0.010606             -9.3939    
          -12.281               -9.3939             1.7747               -14.056                -11.169               -1.7747             -9.3939    
          -12.341               -9.3939             3.5389               -15.879                -12.933               -3.5389             -9.3939    
            -12.4               -9.3939              5.303               -17.703                -14.697                -5.303             -9.3939    
          -12.477               -9.3939             7.0672               -19.544                -16.461               -7.0672             -9.3939    
          -12.533               -9.3939             8.8313               -21.364                -18.225               -8.8313             -9.3939    
          -12.622               -9.3939             10.595               -23.217                -19.989               -10.595             -9.3939    
          -9.4584               -7.2727           0.012727               -9.4711                -7.2855             -0.012727             -7.2727    
          -9.5328               -7.2727             2.1297               -11.662                -9.4024               -2.1297             -7.2727    
          -9.6157               -7.2727             4.2467               -13.862                -11.519               -4.2467             -7.2727    
          -9.6836               -7.2727             6.3636               -16.047                -13.636               -6.3636             -7.2727    
          -9.7666               -7.2727             8.4806               -18.247                -15.753               -8.4806             -7.2727    
          -9.8645               -7.2727             10.598               -20.462                 -17.87               -10.598             -7.2727    
          -9.9174               -7.2727             12.715               -22.632                -19.987               -12.715             -7.2727    
          -6.7014               -5.1515           0.014848               -6.7163                -5.1664             -0.014848             -5.1515    
          -6.7841               -5.1515             2.4846               -9.2687                -7.6362               -2.4846             -5.1515    
          -6.8758               -5.1515             4.9544                -11.83                -10.106               -4.9544             -5.1515    
          -6.9826               -5.1515             7.4242               -14.407                -12.576               -7.4242             -5.1515    
          -7.0443               -5.1515              9.894               -16.938                -15.046                -9.894             -5.1515    
          -7.1511               -5.1515             12.364               -19.515                -17.515               -12.364             -5.1515    
          -7.2578               -5.1515             14.834               -22.091                -19.985               -14.834             -5.1515    
          -3.9445               -3.0303            0.01697               -3.9615                -3.0473              -0.01697             -3.0303    
          -4.0504               -3.0303             2.8396                 -6.89                -5.8699               -2.8396             -3.0303    
          -4.1509               -3.0303             5.6622               -9.8132                -8.6925               -5.6622             -3.0303    
          -4.2515               -3.0303             8.4848               -12.736                -11.515               -8.4848             -3.0303    
          -4.3671               -3.0303             11.307               -15.675                -14.338               -11.307             -3.0303    
          -4.4376               -3.0303              14.13               -18.568                 -17.16                -14.13             -3.0303    
          -4.5532               -3.0303             16.953               -21.506                -19.983               -16.953             -3.0303    
          -1.1875              -0.90909           0.019091               -1.2066               -0.92818             -0.019091            -0.90909    
          -1.3017              -0.90909             3.1945               -4.4962                -4.1036               -3.1945            -0.90909    
          -1.4111              -0.90909               6.37               -7.7811                -7.2791                 -6.37            -0.90909    
          -1.5205              -0.90909             9.5455               -11.066                -10.455               -9.5455            -0.90909    
          -1.6448              -0.90909             12.721               -14.366                 -13.63               -12.721            -0.90909    
          -1.7692              -0.90909             15.896               -17.666                -16.805               -15.896            -0.90909    
          -1.8684              -0.90909             19.072                -20.94                -19.981               -19.072            -0.90909    

      tab_ak_choices1       tab_ak_choices2    tab_ak_choices3       tab_ak_choices4        tab_ak_choices5      tab_ak_choices6      tab_ak_choices7
    ar_bwithrplusk_mesha    ar_aplusk_mesha      ar_k_mesha       ar_ameshk_tnext_with_r      ar_a_meshk       ar_a_nobridge_meshk      ar_bridge_a  
    ____________________    _______________    _______________    ______________________    _______________    ___________________    _______________

           31.681               30.909            0.050909                  31.63                30.858               30.858                 0       
           31.469               30.909              8.5188                  22.95                 22.39                22.39                 0       
           31.257               30.909              16.987                  14.27                13.922               13.922                 0       
           31.045               30.909              25.455                 5.5909                5.4545               5.4545                 0       
           30.794               30.909              33.922                -3.1287               -3.0133              -3.0133                 0       
           30.477               30.909               42.39                -11.913               -11.481              -11.481                 0       
           29.959               30.909              50.858                -20.899               -19.949              -19.949                 0       
           33.855                33.03             0.05303                 33.802                32.977               32.977                 0       
           33.634                33.03              8.8737                  24.76                24.157               24.157                 0       
           33.414                33.03              17.694                 15.719                15.336               15.336                 0       
           33.193                33.03              26.515                  6.678                6.5152               6.5152                 0       
           32.948                33.03              35.336                -2.3882               -2.3056              -2.3056                 0       
           32.607                33.03              44.157                -11.549               -11.126              -11.126                 0       
           32.081                33.03              52.977                -20.896               -19.947              -19.947                 0       
           36.029               35.152            0.055152                 35.974                35.096               35.096                 0       
             35.8               35.152              9.2287                 26.571                25.923               25.923                 0       
            35.57               35.152              18.402                 17.168                16.749               16.749                 0       
           35.341               35.152              27.576                 7.7652                7.5758               7.5758                 0       
           35.087               35.152              36.749                -1.6627               -1.5978              -1.5978                 0       
           34.737               35.152              45.923                -11.186               -10.771              -10.771                 0       
           34.203               35.152              55.096                -20.893               -19.945              -19.945                 0       
           38.203               37.273            0.057273                 38.146                37.215               37.215                 0       
           37.965               37.273              9.5836                 28.381                27.689               27.689                 0       
           37.727               37.273               19.11                 18.617                18.163               18.163                 0       
           37.489               37.273              28.636                 8.8523                8.6364               8.6364                 0       
            37.24               37.273              38.163               -0.92225                 -0.89                -0.89                 0       
           36.867               37.273              47.689                -10.822               -10.416              -10.416                 0       
           36.325               37.273              57.215                -20.891               -19.943              -19.943                 0       
           40.377               39.394            0.059394                 40.318                39.335               39.335                 0       
            40.13               39.394              9.9386                 30.192                29.455               29.455                 0       
           39.883               39.394              19.818                 20.066                19.576               19.576                 0       
           39.636               39.394              29.697                 9.9394                 9.697                9.697                 0       
           39.379               39.394              39.576               -0.19678              -0.18222             -0.18222                 0       
           39.026               39.394              49.455                 -10.43               -10.061              -10.061                 0       
           38.447               39.394              59.335                -20.888               -19.941              -19.941                 0       
           42.551               41.515            0.061515                  42.49                41.454               41.454                 0       
           42.296               41.515              10.294                 32.002                31.222               31.222                 0       
            42.04               41.515              20.526                 21.514                 20.99                20.99                 0       
           41.784               41.515              30.758                 11.027                10.758               10.758                 0       
           41.528               41.515               40.99                0.53869               0.52556              0.52556                 0       
           41.172               41.515              51.222                -10.049               -9.7065              -9.7065                 0       
           40.569               41.515              61.454                -20.885               -19.938              -19.938                 0       
           44.726               43.636            0.063636                 44.662                43.573               43.573                 0       
           44.461               43.636              10.648                 33.813                32.988               32.988                 0       
           44.196               43.636              21.233                 22.963                22.403               22.403                 0       
           43.932               43.636              31.818                 12.114                11.818               11.818                 0       
           43.667               43.636              42.403                 1.2642                1.2333               1.2333                 0       
           43.303               43.636              52.988                -9.6853               -9.3515              -9.3515                 0       
            42.69               43.636              63.573                -20.882               -19.936              -19.936                 0       
             46.9               45.758            0.065758                 46.834                45.692               45.692                 0       
           46.626               45.758              11.003                 35.623                34.754               34.754                 0       
           46.353               45.758              21.941                 24.412                23.816               23.816                 0       
            46.08               45.758              32.879                 13.201                12.879               12.879                 0       
           45.806               45.758              43.816                 1.9896                1.9411               1.9411                 0       
           45.433               45.758              54.754                -9.3215               -8.9966              -8.9966                 0       
           44.812               45.758              65.692                 -20.88               -19.934              -19.934                 0       
           49.074               47.879            0.067879                 49.006                47.811               47.811                 0       
           48.792               47.879              11.358                 37.433                 36.52                36.52                 0       
            48.51               47.879              22.649                 25.861                 25.23                25.23                 0       
           48.227               47.879              33.939                 14.288                13.939               13.939                 0       
           47.945               47.879               45.23                 2.7151                2.6489               2.6489                 0       
           47.563               47.879               56.52                -8.9577               -8.6416              -8.6416                 0       
           46.934               47.879              67.811                -20.877               -19.932              -19.932                 0       
           51.248                   50                0.07                 51.178                 49.93                49.93                 0       
           50.957                   50              11.713                 39.244                38.287               38.287                 0       
           50.666                   50              23.357                 27.309                26.643               26.643                 0       
           50.375                   50                  35                 15.375                    15                   15                 0       
           50.084                   50              46.643                 3.4406                3.3567               3.3567                 0       
           49.693                   50              58.287                -8.5938               -8.2867              -8.2867                 0       
           49.056                   50               69.93                -20.874                -19.93               -19.93                 0       

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_coh_wkb_full
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   385    15

    mt_coh_wkb_full1    mt_coh_wkb_full2    mt_coh_wkb_full3    mt_coh_wkb_full4    mt_coh_wkb_full5    mt_coh_wkb_full6    mt_coh_wkb_full7    mt_coh_wkb_full8    mt_coh_wkb_full9    mt_coh_wkb_full10    mt_coh_wkb_full11    mt_coh_wkb_full12    mt_coh_wkb_full13    mt_coh_wkb_full14    mt_coh_wkb_full15
    ________________    ________________    ________________    ________________    ________________    ________________    ________________    ________________    ________________    _________________    _________________    _________________    _________________    _________________    _________________

         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556             -25.556              -25.556              -25.556              -25.556               -25.556              -25.556    
         -22.762             -22.756             -22.749             -22.741             -22.733             -22.722              -22.71             -22.697             -22.681             -22.663              -22.642              -22.617              -22.589               -22.557               -22.52    
         -22.607              -22.57             -22.528             -22.479             -22.422             -22.357             -22.282             -22.196             -22.096             -21.981              -21.848              -21.694              -21.517               -21.313              -21.078    
         -22.576             -22.529             -22.475             -22.412              -22.34             -22.256              -22.16             -22.049             -21.921             -21.773              -21.603              -21.406               -21.18               -20.918              -20.616    
          -22.58             -22.526             -22.463              -22.39             -22.307              -22.21             -22.099             -21.971             -21.822             -21.652              -21.454              -21.227              -20.965               -20.662              -20.313    
         -22.579             -22.518             -22.449             -22.368             -22.275             -22.168             -22.045             -21.903             -21.738             -21.549               -21.33              -21.078              -20.787               -20.452              -20.065    
         -22.583             -22.517             -22.442             -22.355             -22.254             -22.138             -22.005              -21.85             -21.672             -21.467               -21.23              -20.957              -20.642               -20.278              -19.859    
         -22.591             -22.521              -22.44             -22.347              -22.24             -22.116             -21.974             -21.809             -21.619               -21.4              -21.147              -20.855              -20.518                -20.13              -19.682    
         -19.994             -19.987             -19.978             -19.968             -19.957             -19.944             -19.928             -19.911              -19.89             -19.867               -19.84              -19.809              -19.773               -19.731              -19.684    
         -19.819             -19.771             -19.717             -19.654             -19.582             -19.498             -19.402             -19.291             -19.163             -19.015              -18.844              -18.648              -18.421               -18.159              -17.857    
         -19.821             -19.761             -19.691              -19.61             -19.518             -19.411             -19.287             -19.145              -18.98             -18.791              -18.572               -18.32              -18.029               -17.693              -17.306    
         -19.834             -19.764             -19.683              -19.59             -19.482             -19.359             -19.216             -19.051             -18.861             -18.642              -18.389              -18.097               -17.76               -17.372              -16.924    
         -19.873             -19.795             -19.706             -19.603             -19.484             -19.346             -19.188             -19.005             -18.794             -18.551              -18.271              -17.947              -17.574               -17.143              -16.646    
         -19.905             -19.821             -19.724             -19.612             -19.483             -19.334             -19.163             -18.965             -18.736             -18.473              -18.169              -17.818              -17.414               -16.947              -16.409    
         -19.957             -19.867             -19.764             -19.644             -19.507             -19.348             -19.164             -18.953             -18.709             -18.428              -18.103              -17.729              -17.297               -16.799              -16.224    
          -17.23             -17.221             -17.211               -17.2             -17.186             -17.171             -17.153             -17.133              -17.11             -17.083              -17.051              -17.015              -16.974               -16.926               -16.87    
         -17.065             -17.011             -16.948             -16.875             -16.791             -16.695             -16.583             -16.454             -16.306             -16.135              -15.938               -15.71              -15.447               -15.144              -14.795    
         -17.076             -17.006             -16.925             -16.832             -16.725             -16.601             -16.458             -16.293             -16.103             -15.884              -15.631              -15.339              -15.002               -14.613              -14.165    
         -17.131              -17.05             -16.956             -16.849             -16.725             -16.581             -16.416             -16.225             -16.005             -15.751              -15.459              -15.121              -14.731               -14.282              -13.764    
         -17.199              -17.11             -17.006             -16.887             -16.749              -16.59             -16.407             -16.195             -15.951              -15.67              -15.345              -14.971              -14.539               -14.041              -13.466    
         -17.262             -17.165             -17.052             -16.923             -16.774             -16.602             -16.403             -16.174             -15.909             -15.605              -15.253              -14.847              -14.379               -13.839              -13.216    
         -17.345             -17.241             -17.121             -16.983             -16.824              -16.64             -16.428             -16.183             -15.901             -15.575                -15.2              -14.767              -14.267                -13.69              -13.025    
         -14.467             -14.457             -14.446             -14.433             -14.419             -14.402             -14.382              -14.36             -14.334             -14.304              -14.269              -14.229              -14.183                -14.13              -14.068    
         -14.306             -14.245             -14.176             -14.095             -14.002             -13.895             -13.771             -13.629             -13.464             -13.274              -13.056              -12.803              -12.512               -12.176              -11.788    
         -14.358              -14.28             -14.191             -14.088             -13.969             -13.831             -13.673              -13.49             -13.279             -13.036              -12.755              -12.431              -12.058               -11.627               -11.13    
         -14.442             -14.352             -14.249             -14.129             -13.991             -13.833             -13.649             -13.438             -13.194             -12.912              -12.588              -12.213              -11.781               -11.283              -10.708    
         -14.542             -14.442             -14.327             -14.195             -14.042             -13.866             -13.662             -13.428             -13.157             -12.845              -12.485               -12.07              -11.591               -11.038                -10.4    
         -14.653             -14.546             -14.421             -14.278             -14.112             -13.921             -13.701             -13.447             -13.154             -12.815              -12.425              -11.975              -11.456               -10.857              -10.166    
         -14.766             -14.651             -14.518             -14.365             -14.188             -13.984             -13.749             -13.478             -13.165             -12.804              -12.387              -11.906              -11.352               -10.713              -9.9751    
         -11.705             -11.695             -11.683             -11.669             -11.653             -11.634             -11.613             -11.589              -11.56             -11.528               -11.49              -11.447              -11.397               -11.339              -11.273    
         -11.553             -11.487             -11.411             -11.324             -11.224             -11.107             -10.973             -10.819             -10.641             -10.435              -10.198               -9.924              -9.6083               -9.2441              -8.8239    
         -11.632             -11.548             -11.451              -11.34              -11.21             -11.062              -10.89             -10.692             -10.463             -10.199              -9.8952              -9.5444              -9.1396               -8.6727              -8.1341    
         -11.747              -11.65             -11.537             -11.408             -11.259             -11.086             -10.888             -10.659             -10.394             -10.089              -9.7373              -9.3315              -8.8633               -8.3232              -7.7001    
         -11.897             -11.789             -11.664             -11.521             -11.355             -11.164             -10.944              -10.69             -10.397             -10.058              -9.6682              -9.2181              -8.6989                  -8.1              -7.4091    
         -12.035             -11.918             -11.783             -11.628             -11.448             -11.241             -11.002             -10.727             -10.409             -10.043              -9.6201              -9.1325              -8.5699                -7.921              -7.1724    
         -12.213             -12.089             -11.945             -11.779             -11.587             -11.366             -11.111             -10.817             -10.478             -10.087              -9.6352              -9.1145              -8.5138               -7.8209              -7.0215    
         -8.9435             -8.9324             -8.9197             -8.9049             -8.8879             -8.8682             -8.8456             -8.8195             -8.7893             -8.7546              -8.7145              -8.6682              -8.6148               -8.5533              -8.4822    
         -8.8034             -8.7334             -8.6526             -8.5594             -8.4519             -8.3279             -8.1848             -8.0198             -7.8294             -7.6098              -7.3564              -7.0642              -6.7271               -6.3382              -5.8896    
         -8.9271             -8.8373             -8.7337             -8.6142             -8.4764             -8.3174              -8.134             -7.9224             -7.6783             -7.3968               -7.072              -6.6973              -6.2651               -5.7665              -5.1914    
         -9.0727             -8.9689              -8.849             -8.7108             -8.5514             -8.3675             -8.1553             -7.9106             -7.6282             -7.3025              -6.9268              -6.4934              -5.9935               -5.4167              -4.7514    
         -9.2513             -9.1362             -9.0033               -8.85             -8.6732             -8.4693              -8.234             -7.9626             -7.6495             -7.2883              -6.8717              -6.3911              -5.8367               -5.1972              -4.4594    
          -9.456             -9.3312             -9.1872             -9.0211             -8.8296             -8.6086             -8.3536             -8.0596             -7.7203              -7.329              -6.8776              -6.3568              -5.7561               -5.0631              -4.2638    
         -9.6232             -9.4899             -9.3362             -9.1589             -8.9543             -8.7184             -8.4462             -8.1322             -7.7699             -7.3521              -6.8701               -6.314              -5.6726               -4.9327              -4.0791    
         -6.1826             -6.1709             -6.1574             -6.1418             -6.1238             -6.1031             -6.0791             -6.0515             -6.0196             -5.9829              -5.9405              -5.8916              -5.8352               -5.7701               -5.695    
         -6.0571             -5.9831             -5.8977             -5.7992             -5.6855             -5.5544             -5.4032             -5.2287             -5.0275             -4.7953              -4.5275              -4.2186              -3.8623               -3.4512              -2.9769    
         -6.2105             -6.1156             -6.0061             -5.8798             -5.7341              -5.566             -5.3721             -5.1484             -4.8904             -4.5928              -4.2495              -3.8534              -3.3966               -2.8695              -2.2616    
         -6.4179             -6.3081             -6.1815             -6.0354             -5.8668             -5.6724             -5.4481             -5.1894              -4.891             -4.5467              -4.1496              -3.6914               -3.163               -2.5533              -1.8501    
         -6.5994             -6.4776             -6.3372             -6.1752             -5.9883             -5.7727              -5.524             -5.2371             -4.9061             -4.5244               -4.084              -3.5759              -2.9899               -2.3138               -1.534    
         -6.8375             -6.7056             -6.5534             -6.3778             -6.1753             -5.9417             -5.6723             -5.3614             -5.0028             -4.5891               -4.112              -3.5615              -2.9265                -2.194               -1.349    
         -7.0836             -6.9427             -6.7802             -6.5928             -6.3766             -6.1271             -5.8394             -5.5075             -5.1246             -4.6829              -4.1734              -3.5856              -2.9076               -2.1255              -1.2232    
         -3.4221             -3.4098             -3.3956             -3.3793             -3.3604             -3.3386             -3.3135             -3.2845             -3.2511             -3.2125               -3.168              -3.1167              -3.0575               -2.9892              -2.9105    
         -3.3281             -3.2504             -3.1608             -3.0574             -2.9382             -2.8006             -2.6419             -2.4589             -2.2477             -2.0042              -1.7232               -1.399              -1.0251              -0.59379            -0.096218    
         -3.5118             -3.4122             -3.2973             -3.1648             -3.0119             -2.8356             -2.6321             -2.3974             -2.1267             -1.8145              -1.4542              -1.0387             -0.55929            -0.0063072               0.6316    
         -3.7365             -3.6213             -3.4884             -3.3351             -3.1583             -2.9543              -2.719             -2.4475             -2.1344             -1.7731              -1.3564             -0.87575             -0.32124               0.31842               1.0563    
         -3.9962             -3.8684             -3.7211             -3.5511              -3.355             -3.1288             -2.8678             -2.5668             -2.2195              -1.819              -1.3569             -0.82383             -0.20893               0.50041               1.3187    
         -4.2231             -4.0846              -3.925             -3.7408             -3.5283             -3.2832             -3.0004             -2.6743              -2.298              -1.864              -1.3633             -0.78574             -0.11947               0.64911               1.5357    
         -4.5034             -4.3556             -4.1851             -3.9884             -3.7615             -3.4998             -3.1979             -2.8496             -2.4479             -1.9844              -1.4498             -0.83312             -0.12171               0.69895               1.6456    
        -0.66188            -0.64905            -0.63425            -0.61717            -0.59748            -0.57476            -0.54855            -0.51832            -0.48344            -0.44321              -0.3968             -0.34326              -0.2815              -0.21026             -0.12808    
        -0.58585             -0.5048            -0.41131            -0.30347            -0.17906           -0.035547                0.13             0.32098             0.54128             0.79541               1.0886               1.4267               1.8168                2.2669                2.786    
        -0.80042            -0.69652            -0.57666             -0.4384             -0.2789           -0.094912             0.11733             0.36217              0.6446             0.97041               1.3462               1.7798               2.2799                2.8569               3.5224    
         -1.0578             -0.9376            -0.79896            -0.63902            -0.45453             -0.2417           0.0038105             0.28702             0.61373              0.9906               1.4254               1.9269               2.5054                3.1728               3.9426    
          -1.351             -1.2177             -1.0639            -0.88659              -0.682            -0.44599            -0.17374             0.14032             0.50261             0.92053               1.4026               1.9588               2.6003                3.3404               4.1941    
         -1.6569             -1.5125             -1.3459             -1.1537            -0.93205            -0.67633            -0.38133            -0.04104             0.35151             0.80434               1.3267               1.9293               2.6244                3.4263               4.3513    
         -1.9463             -1.7922             -1.6143             -1.4091             -1.1724            -0.89933            -0.58435              -0.221             0.19815             0.68167               1.2394               1.8829               2.6251                3.4813                4.469    

    mt_coh_wkb_full1    mt_coh_wkb_full2    mt_coh_wkb_full3    mt_coh_wkb_full4    mt_coh_wkb_full5    mt_coh_wkb_full6    mt_coh_wkb_full7    mt_coh_wkb_full8    mt_coh_wkb_full9    mt_coh_wkb_full10    mt_coh_wkb_full11    mt_coh_wkb_full12    mt_coh_wkb_full13    mt_coh_wkb_full14    mt_coh_wkb_full15
    ________________    ________________    ________________    ________________    ________________    ________________    ________________    ________________    ________________    _________________    _________________    _________________    _________________    _________________    _________________

         32.239              32.257              32.278              32.303              32.331              32.363                32.4              32.443              32.493               32.55               32.616               32.693                32.78               32.882               32.999      
         31.982              32.098              32.231              32.384              32.561              32.766              33.001              33.273              33.587              33.948               34.366               34.847               35.402               36.043               36.782      
         31.305              31.453              31.624               31.82              32.047              32.309              32.611               32.96              33.362              33.826               34.361               34.978                35.69               36.511               37.458      
         30.567              30.738              30.935              31.163              31.426              31.729              32.078              32.481              32.946              33.483               34.102               34.815               35.639               36.589               37.685      
         29.759              29.949              30.168               30.42              30.711              31.047              31.435              31.882              32.398              32.992               33.679                34.47               35.384               36.437               37.652      
         28.868              29.074              29.311              29.584                29.9              30.264              30.684              31.168              31.727              32.372               33.115               33.973               34.962               36.104               37.421      
         27.764              27.983              28.236              28.528              28.865              29.254              29.702               30.22              30.816              31.505               32.299               33.214               34.271                35.49               36.896      
         34.415              34.433              34.455              34.479              34.508              34.541              34.579              34.622              34.673              34.731               34.798               34.875               34.964               35.067               35.186      
          34.13              34.247              34.382              34.538              34.718              34.925              35.164               35.44              35.759              36.126               36.549               37.038               37.601               38.251               39.001      
         33.419              33.569              33.742              33.942              34.173              34.438              34.745              35.099              35.507              35.977                36.52               37.146               37.869               38.702               39.664      
         32.646               32.82               33.02              33.251              33.518              33.825               34.18              34.589              35.061              35.605               36.233               36.958               37.793               38.757               39.869      
         31.818              32.011              32.233              32.489              32.785              33.125              33.519              33.972              34.496              35.099               35.796               36.599               37.526               38.595               39.828      
         30.877              31.085              31.326              31.604              31.924              32.293              32.719              33.211              33.778              34.432               35.187               36.057               37.061                38.22               39.556      
         29.737               29.96              30.217              30.513              30.855               31.25              31.705               32.23              32.835              33.533               34.339               35.269               36.341               37.578               39.004      
         36.591              36.609              36.631              36.656              36.685              36.718              36.757              36.801              36.852              36.911               36.979               37.057               37.148               37.252               37.373      
         36.278              36.397              36.534              36.692              36.874              37.084              37.327              37.607              37.929              38.302               38.731               39.227               39.798               40.458               41.218      
         35.533              35.685              35.861              36.063              36.297              36.567              36.878              37.236               37.65              38.127               38.678               39.313               40.046               40.891               41.866      
         34.725              34.901              35.104              35.339              35.609              35.921               36.28              36.695              37.174              37.726               38.363               39.098               39.946               40.923               42.051      
         33.862              34.057              34.282              34.542              34.842              35.188              35.587              36.047              36.577               37.19               37.896               38.711               39.651               40.735               41.986      
         32.885              33.096               33.34              33.622              33.947              34.321              34.754              35.252              35.827              36.491               37.256               38.139               39.157               40.332               41.687      
          31.71              31.936              32.197              32.497              32.844              33.244              33.706              34.238              34.852               35.56               36.378                37.32               38.408               39.662               41.109      
         38.766              38.785              38.807              38.833              38.862              38.896              38.935              38.979              39.031              39.091                39.16               39.239               39.331               39.437               39.559      
         38.426              38.546              38.685              38.845               39.03              39.243              39.489              39.772                40.1              40.477               40.912               41.415               41.994               42.662               43.433      
         37.646              37.801              37.979              38.184              38.421              38.694              39.009              39.373              39.793              40.276               40.835               41.478               42.221               43.078               44.066      
         36.804              36.982              37.188              37.426                37.7              38.016               38.38              38.801              39.286              39.846               40.491               41.236               42.095               43.087                44.23      
          35.92              36.118              36.346               36.61              36.914              37.264              37.668              38.135              38.673              39.294               40.009               40.835               41.788               42.887               44.155      
         34.892              35.107              35.354               35.64              35.969              36.349              36.787              37.292              37.875              38.548               39.323               40.218               41.251               42.442               43.815      
         33.683              33.912              34.176               34.48              34.832              35.238              35.705              36.245              36.867              37.585               38.414               39.369               40.472               41.743                43.21      
         40.942              40.961              40.983              41.009              41.039              41.073              41.112              41.158               41.21              41.271               41.341               41.421               41.514               41.621               41.745      
         40.573              40.695              40.836              40.998              41.185              41.401               41.65              41.937              42.269              42.651               43.092               43.601               44.188               44.865               45.647      
          39.76              39.916              40.096              40.304              40.544              40.821              41.141              41.509              41.934              42.424                42.99               43.642               44.395               45.263               46.264      
         38.882              39.063              39.271              39.512               39.79               40.11              40.479              40.905              41.397              41.964               42.618               43.373               44.243               45.248               46.406      
         37.963              38.163              38.395              38.662              38.969              39.325              39.734              40.207              40.752              41.381               42.106               42.943               43.908               45.022               46.306      
         36.928              37.145              37.396              37.685              38.018              38.403              38.847              39.359               39.95              40.631               41.417               42.324                43.37               44.576               45.968      
         35.655              35.887              36.154              36.463              36.819               37.23              37.704              38.251              38.881              39.609               40.448               41.416               42.533               43.821               45.308      
         43.118              43.137               43.16              43.186              43.216               43.25               43.29              43.336              43.389              43.451               43.521               43.603               43.697               43.806               43.931      
          42.72              42.844              42.986               43.15               43.34              43.559              43.811              44.102              44.438              44.825               45.272               45.787               46.381               47.067               47.858      
         41.873              42.031              42.213              42.424              42.667              42.948              43.271              43.644              44.074              44.571               45.144               45.804               46.566               47.446                48.46      
          40.96              41.143              41.354              41.598              41.879              42.203              42.577              43.009              43.507              44.081               44.744               45.508               46.389               47.406                48.58      
         40.015              40.218              40.453              40.723              41.035              41.394              41.809              42.288               42.84              43.477               44.211               45.059               46.036               47.164               48.465      
         38.951              39.171              39.425              39.718              40.056              40.446              40.895              41.414              42.012              42.702               43.498               44.416               45.475               46.697               48.107      
         37.626              37.861              38.132              38.445              38.805              39.222              39.702              40.255              40.894              41.631               42.481               43.461               44.592               45.897               47.402      
         45.293              45.313              45.336              45.362              45.392              45.427              45.468              45.515              45.568               45.63               45.702               45.785                45.88                45.99               46.117      
         44.867              44.992              45.136              45.302              45.494              45.716              45.971              46.266              46.606              46.998                47.45               47.971               48.573               49.267               50.068      
         43.985              44.145               44.33              44.544               44.79              45.073              45.401              45.778              46.214              46.717               47.296               47.965               48.737               49.627               50.653      
         43.037              43.223              43.437              43.683              43.968              44.296              44.675              45.112              45.616              46.197               46.868               47.641               48.534               49.563               50.751      
         42.057              42.263                42.5              42.774              43.089              43.453              43.873              44.358              44.917              45.561               46.305               47.163               48.152               49.294               50.611      
         40.958              41.181              41.438              41.734              42.076               42.47              42.925               43.45              44.056              44.754                45.56                46.49               47.562               48.799               50.226      
         39.597              39.835              40.109              40.426              40.791              41.212              41.698              42.259              42.905              43.651               44.511               45.504               46.649                47.97               49.493      
         47.469              47.489              47.512              47.538              47.569              47.605              47.646              47.693              47.747               47.81               47.882               47.966               48.062               48.174               48.302      
         47.014               47.14              47.286              47.454              47.648              47.872              48.131              48.429              48.773              49.169               49.627               50.155               50.764               51.466               52.276      
         46.097               46.26              46.447              46.662              46.911              47.199               47.53              47.912              48.353              48.861               49.448               50.125               50.905               51.806               52.845      
         45.114              45.302              45.518              45.768              46.056              46.388              46.772              47.214              47.723              48.312                48.99               49.773               50.676               51.718               52.919      
         44.099              44.307              44.547              44.824              45.143              45.512              45.937              46.427              46.992              47.645               48.397               49.265               50.266               51.422               52.754      
         42.964              43.189              43.449              43.749              44.095              44.494              44.955              45.486              46.099              46.805               47.621               48.561               49.646               50.898               52.342      
         41.568              41.809              42.086              42.406              42.776              43.202              43.694              44.261              44.915               45.67                46.54               47.545               48.703                50.04               51.581      
         49.644              49.664              49.688              49.715              49.746              49.782              49.823              49.871              49.926              49.989               50.063               50.147               50.245               50.357               50.487      
          49.16              49.288              49.436              49.606              49.802              50.029               50.29              50.592              50.939              51.341               51.804               52.337               52.953               53.664               54.483      
         48.209              48.374              48.563              48.781              49.033              49.323              49.658              50.045              50.491              51.005               51.599               52.283               53.073               53.984               55.034      
         47.191              47.381                47.6              47.853              48.144               48.48              48.867              49.315               49.83              50.425               51.112               51.904               52.817               53.871               55.086      
          46.14              46.351              46.594              46.874              47.197              47.569              47.999              48.495              49.067              49.727               50.488               51.366               52.379               53.547               54.895      
         44.969              45.197               45.46              45.764              46.114              46.518              46.983              47.521               48.14              48.855                49.68               50.631               51.729               52.995               54.455      
         43.538              43.782              44.062              44.386               44.76              45.191              45.689              46.262              46.924              47.687               48.568               49.584               50.756               52.107               53.667      
          51.82               51.84              51.864              51.891              51.922              51.959              52.001              52.049              52.105              52.169               52.243               52.328               52.427               52.541               52.672      
         51.306              51.436              51.585              51.757              51.956              52.185              52.449              52.754              53.106              53.511               53.979               54.519               55.142                55.86               56.689      
         50.321              50.487              50.679              50.899              51.154              51.448              51.786              52.177              52.628              53.148               53.748                54.44               55.239                56.16               57.222      
         49.268               49.46              49.681              49.937              50.231              50.571              50.963              51.415              51.936              52.538               53.232               54.033               54.956               56.022               57.251      
         48.182              48.394               48.64              48.923               49.25              49.626              50.061              50.562              51.141              51.808               52.577               53.465               54.489               55.671               57.034      
         46.975              47.205              47.471              47.778              48.132               48.54              49.011              49.554              50.181              50.904               51.738                 52.7               53.809                55.09               56.566      
         45.508              45.754              46.038              46.366              46.744               47.18              47.682              48.263              48.932              49.704               50.594               51.621               52.806               54.173                55.75      

</pre><h2 id="15">COH2: Check if COH is within Borrowing Bounds</h2><p>some coh levels are below borrowing bound, can not borrow enough to pay debt</p><pre class="codeinput">mt_bl_coh_wkb_invalid = (mt_coh_wkb_full &lt; fl_b_bd);

<span class="comment">% (k,a) invalid if coh(k,a,z) &lt; bd for any z</span>
ar_bl_wkb_invalid = max(mt_bl_coh_wkb_invalid,[], 2);
mt_bl_wkb_invalid = reshape(ar_bl_wkb_invalid, size(mt_a));

<span class="comment">% find the first w_level choice where some k(w) percent choices are valid?</span>
ar_bl_w_level_invalid =  min(mt_bl_wkb_invalid, [], 1);

<span class="comment">% w choices can not be lower than fl_w_level_min_valid. If w choices are</span>
<span class="comment">% lower, given the current borrowing interest rate as well as the minimum</span>
<span class="comment">% income level in the future, and the maximum borrowing level available</span>
<span class="comment">% next period, and given the shock distribution, there exists some state in</span>
<span class="comment">% the future when the household when making this choice will be unable to</span>
<span class="comment">% borrow sufficiently to maintain positive consumption.</span>
fl_w_level_min_valid = min(ar_w_level_full(~ar_bl_w_level_invalid));
</pre><h2 id="16">COH3: Update Valid 2nd stage choice matrix</h2><p>ar_w_level = linspace(fl_w_level_min_valid, fl_w_max, it_w_interp_n); ar_k_max = ar_w_level - fl_b_bd; mt_k = (ar_k_max'*ar_ak_perc)'; mt_a = (ar_w_level - mt_k); ar_a_meshk = mt_a(:); ar_k_mesha = mt_k(:);</p><h2 id="17">COH4: Select only Valid (k(w), a) choices</h2><pre class="codeinput"><span class="comment">% mt_coh_wkb = mt_coh_wkb_full(~ar_bl_wkb_invalid, :);</span>
mt_coh_wkb = mt_coh_wkb_full;
mt_z_mesh_coh_wkb = repmat(ar_z, [size(mt_coh_wkb,1),1]);
</pre><h2 id="18">Generate 1st Stage States: Interpolation Cash-on-hand Interpolation Grid</h2><p>For the iwkz problems, we solve the problem along a grid of cash-on-hand values, the interpolate to find v(k',b',z) at (k',b') choices. Crucially, we have to coh matrxies</p><pre class="codeinput">fl_max_mt_coh = max(max(mt_coh_wkb));

<span class="comment">% This is savings only condition</span>
<span class="comment">% fl_min_mt_coh = min(min(mt_coh_wkb));</span>

<span class="comment">% This could be condition if no defaults are allowed</span>
<span class="comment">% fl_min_mt_coh = fl_w_level_min_valid;</span>

<span class="comment">% This is borrowing with default or not condition</span>
fl_min_mt_coh = fl_b_bd;

it_coh_interp_n = (fl_max_mt_coh-fl_min_mt_coh)/(fl_coh_interp_grid_gap);
ar_interp_coh_grid = fft_array_add_zero(linspace(fl_min_mt_coh, fl_max_mt_coh, it_coh_interp_n), true);
[mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid] = ndgrid(ar_interp_coh_grid, ar_z);
mt_interp_coh_grid_mesh_w_perc = repmat(ar_interp_coh_grid, [it_w_perc_n, 1]);
</pre><h2 id="19">Generate 1st Stage Choices: Interpolation Cash-on-hand Interpolation Grid</h2><p>previously, our ar_w was the first stage choice grid, the grid was the same for all coh levels. Now, for each coh level, there is a different ar_w. ar_interp_coh_grid is (1 by ar_interp_coh_grid) and ar_w_perc is ( 1 by it_w_perc_n). Conditional on z, each choice matrix is (it_w_perc_n by ar_interp_coh_grid). Here we are pre-computing the choice matrix. This could be a large matrix if the choice grid is large. This is the matrix of aggregate savings choices</p><pre class="codeinput"><span class="comment">% 1. Given COH grid, w choices in terms of cash-on-hand percentages</span>
<span class="keyword">if</span> (fl_min_mt_coh &lt; 0)
    <span class="comment">% borrowing bound is below zero</span>
    mt_w_by_interp_coh_interp_grid = ((ar_interp_coh_grid-fl_min_mt_coh)'*ar_w_perc)' + fl_min_mt_coh;
<span class="keyword">else</span>
    <span class="comment">% savings only</span>
    mt_w_by_interp_coh_interp_grid = ((ar_interp_coh_grid)'*ar_w_perc)';
<span class="keyword">end</span>

<span class="comment">% 2. Some w &lt; 0, some w &gt; 0. When w &lt; 0, coh &gt; 0 or coh &lt; 0 both possible.</span>
<span class="comment">% Need to interplate in ff_ipwkbz_fibs_vecsv differently for w &lt; 0 because</span>
<span class="comment">% there both w as well as coh matters, if coh &lt; 0 and w &lt; 0, a fraction of</span>
<span class="comment">% w goes to getting informal bridge loans.</span>
mt_bl_w_by_interp_coh_interp_grid_wneg = (mt_w_by_interp_coh_interp_grid &lt; 0);
mt_w_by_interp_coh_interp_grid_wneg = mt_w_by_interp_coh_interp_grid(mt_bl_w_by_interp_coh_interp_grid_wneg);
mt_w_by_interp_coh_interp_grid_wpos = mt_w_by_interp_coh_interp_grid(~mt_bl_w_by_interp_coh_interp_grid_wneg);
</pre><h2 id="20">Generate 1st Stage Choices: Percent of W for Covering Bridge Loans</h2><p>If bridge loan does not matter, do not need to cover bridge loan. Then these percentages should reflect what happens when param_map('bl_bridge') = false, and, param_map('it_coh_bridge_perc_n') = 1;</p><pre class="codeinput"><span class="comment">% 1. Expand cash-on-hand by w_perc grid</span>
mt_interp_coh_grid_mesh_w_perc = zeros(size(mt_w_by_interp_coh_interp_grid)) + ar_interp_coh_grid;

<span class="comment">% 2. How much is coh as perc of w_perc grid level choice based on w_perc</span>
mt_coh_w_perc_ratio = (1-(mt_interp_coh_grid_mesh_w_perc./mt_w_by_interp_coh_interp_grid));

<span class="comment">% 3. The ratio only relevant for where w &lt; 0 and where coh &lt; 0. Note the</span>
<span class="comment">% ratio we want is: ar_coh_bridge_perc, which is percent of w NOT going to</span>
<span class="comment">% bridge.</span>
mt_coh_w_perc_ratio(mt_interp_coh_grid_mesh_w_perc &gt;= 0) = 1;
mt_coh_w_perc_ratio_wneg = mt_coh_w_perc_ratio(mt_bl_w_by_interp_coh_interp_grid_wneg);
</pre><h2 id="21">Generate Interpolation Consumption Grid</h2><p>We also interpolate over consumption to speed the program up. We only solve for u(c) at this grid for the iwkz problmes, and then interpolate other c values.</p><pre class="codeinput">fl_c_max = max(max(mt_coh_wkb_full)) - fl_b_bd;
it_interp_c_grid_n = (fl_c_max-fl_c_min)/(it_c_interp_grid_gap);
ar_interp_c_grid = linspace(fl_c_min, fl_c_max, it_interp_c_grid_n);
</pre><h2 id="22">Initialize armt_map to store, state, choice, shock matrixes</h2><pre class="codeinput">armt_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
armtdesc_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
</pre><h2 id="23">Store armt_map (1): 2nd Stage Problem Arrays and Matrixes</h2><p>ar_a_meshk is t: b ar_ameshk_tnext_with_r is t+1: b*(1+r) with for inf ar_coh_bridge_perc: this is percentage of w NOT for bridge loan</p><pre class="codeinput">armt_map(<span class="string">'ar_coh_bridge_perc'</span>) = ar_coh_bridge_perc;
armt_map(<span class="string">'ar_ak_perc'</span>) = ar_ak_perc;
armt_map(<span class="string">'mt_k'</span>) = mt_k;
armt_map(<span class="string">'ar_a_meshk'</span>) = ar_a_meshk;
armt_map(<span class="string">'ar_ameshk_tnext_with_r'</span>) = ar_ameshk_tnext_with_r;
armt_map(<span class="string">'ar_k_mesha'</span>) = ar_k_mesha;
armt_map(<span class="string">'it_ameshk_n'</span>) = length(ar_a_meshk);
armt_map(<span class="string">'mt_coh_wkb'</span>) = mt_coh_wkb_full;
armt_map(<span class="string">'mt_z_mesh_coh_wkb'</span>) = mt_z_mesh_coh_wkb;
</pre><h2 id="24">Store armt_map (2): First Stage Aggregate Savings</h2><p>w = k' + b', w is aggregate Savings</p><div><ol><li><b>ar_w_perc</b> 1st stage, percentage w choice given coh, at each coh level the number of choice points is the same for this problem with percentage grid points.</li><li><b>ar_w_level</b> 2nd stage, level of w over which we solve the optimal percentage k' choices. Need to generate interpolant based on this so that we know optimal k* given ar_w_perc(coh) in the 1st stage</li><li><b>ar_w_level_full</b>: in <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/solve/html/ff_ipwkbz_vf_vecsv.html">ff_ipwkbz_vf_vecsv</a>, <i>ar_w_level</i> and <i>ar_w_level_full</i> were the same. Now have this thing which is stored (length(ar_w_level_full)) by (length(ar_z)). <i>ar_w_level_full</i> includes not just different levels of <i>ar_w_level</i>, but also repeats the elements of <i>ar_w_level</i> that are &lt; 0 by <i>it_coh_bridge_perc_n</i> times, starting with what corresponds to 100 percent of w should go to cover bridge loan, until 0 percent for w &lt; 0, which then proceeds to w &gt; 0. So the last segment of <i>ar_w_level_full</i> is the same as ar_w_level: ar_w_level_full((end-length(ar_w_level)+1):end) = ar_w_level.</li><li><b>mt_w_by_interp_coh_interp_grid</b> 1st stage, generate w(coh, percent), meaning the level of w given coh and the percentage grid of ar_w_perc. Mesh this with the coh grid, Rows here correspond to percentage of w choices, columns correspond to cash-on-hand. The columns of cash-on-hand is determined by ar_interp_coh_grid, because we solve the 1st stage problem at that coh grid.</li></ol></div><pre class="codeinput">armt_map(<span class="string">'ar_w_perc'</span>) = ar_w_perc;
armt_map(<span class="string">'ar_w_level'</span>) = ar_w_level;
armt_map(<span class="string">'ar_w_level_full'</span>) = ar_w_level_full;

armt_map(<span class="string">'mt_w_level_neg_mesh_coh_bridge_perc'</span>) = mt_w_level_neg_mesh_coh_bridge_perc;
armt_map(<span class="string">'mt_coh_bridge_perc_mesh_w_level_neg'</span>) = mt_coh_bridge_perc_mesh_w_level_neg;

armt_map(<span class="string">'mt_w_by_interp_coh_interp_grid'</span>) = mt_w_by_interp_coh_interp_grid;
armt_map(<span class="string">'mt_interp_coh_grid_mesh_w_perc'</span>) = mt_interp_coh_grid_mesh_w_perc;

armt_map(<span class="string">'mt_bl_w_by_interp_coh_interp_grid_wneg'</span>) = mt_bl_w_by_interp_coh_interp_grid_wneg;
armt_map(<span class="string">'mt_w_by_interp_coh_interp_grid_wneg'</span>) = mt_w_by_interp_coh_interp_grid_wneg;
armt_map(<span class="string">'mt_w_by_interp_coh_interp_grid_wpos'</span>) = mt_w_by_interp_coh_interp_grid_wpos;
armt_map(<span class="string">'mt_coh_w_perc_ratio_wneg'</span>) = mt_coh_w_perc_ratio_wneg;
</pre><h2 id="25">Store armt_map (3): First Stage Consumption and Cash-on-Hand Grids</h2><pre class="codeinput">armt_map(<span class="string">'ar_interp_c_grid'</span>) = ar_interp_c_grid;
armt_map(<span class="string">'ar_interp_coh_grid'</span>) = ar_interp_coh_grid;
armt_map(<span class="string">'mt_interp_coh_grid_mesh_z'</span>) = mt_interp_coh_grid_mesh_z;
armt_map(<span class="string">'mt_z_mesh_coh_interp_grid'</span>) = mt_z_mesh_coh_interp_grid;
</pre><h2 id="26">Store armt_map (4): Shock Grids</h2><pre class="codeinput">armt_map(<span class="string">'mt_z_trans'</span>) = mt_z_trans;
armt_map(<span class="string">'ar_stationary'</span>) = ar_stationary;
armt_map(<span class="string">'ar_z'</span>) = ar_z;
</pre><h2 id="27">Store Function Map</h2><pre class="codeinput">func_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
func_map(<span class="string">'f_util_log'</span>) = f_util_log;
func_map(<span class="string">'f_util_crra'</span>) = f_util_crra;
func_map(<span class="string">'f_util_standin'</span>) = f_util_standin;
func_map(<span class="string">'f_prod'</span>) = f_prod;
func_map(<span class="string">'f_inc'</span>) = f_inc;
func_map(<span class="string">'f_coh'</span>) = f_coh;
func_map(<span class="string">'f_cons'</span>) = f_cons;
</pre><h2 id="28">Graph</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_funcgrids)
</pre><h2 id="30">Graph 1: a and k choice grid graphs</h2><p>compare the figure here to the same figure in <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html">ffs_akz_get_funcgrid</a>. there the grid points are on an even grid, half of the grid points have NA. for the grid here, the grid points get denser as we get closer to low w = k'+b' levels. This is what is different visually about percentage points based choice grid for the 2nd stage problem.</p><p>Plot end because earlier parts have repeating w and a levels due to potentially bridge which are coh percentage dependent. This will only plot out the grid basically when coh percentage for bridge loan = 0</p><pre class="codeinput">    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    hold <span class="string">on</span>;

    it_col_end = size(mt_a, 2);
    it_col_start = size(mt_a, 2) - length(ar_w_level) + 1;

    chart = plot(mt_a(:,it_col_start:it_col_end), <span class="keyword">...</span>
                 mt_k(:,it_col_start:it_col_end), <span class="keyword">...</span>
                 <span class="string">'blue'</span>);

    clr = jet(numel(chart));
    <span class="keyword">for</span> m = 1:numel(chart)
        set(chart(m),<span class="string">'Color'</span>,clr(m,:))
    <span class="keyword">end</span>

    it_col_end = length(ar_a_meshk);
    it_col_start = length(ar_a_meshk) - length(ar_w_level)*it_ak_perc_n + 1;

<span class="comment">%     if (length(ar_w_level_full) &lt;= 100)</span>
    scatter(ar_a_meshk(it_col_start:it_col_end), <span class="keyword">...</span>
            ar_k_mesha(it_col_start:it_col_end), <span class="keyword">...</span>
            3, <span class="string">'filled'</span>, <span class="string">'MarkerEdgeColor'</span>, <span class="string">'b'</span>, <span class="string">'MarkerFaceColor'</span>, <span class="string">'b'</span>);
<span class="comment">%     end</span>
    <span class="keyword">if</span> (length(ar_w_level) &lt;= 100)
        gf_invalid_scatter = scatter(ar_a_meshk_full(ar_bl_wkb_invalid),<span class="keyword">...</span>
                                     ar_k_mesha_full(ar_bl_wkb_invalid),<span class="keyword">...</span>
                20, <span class="string">'O'</span>, <span class="string">'MarkerEdgeColor'</span>, <span class="string">'black'</span>, <span class="string">'MarkerFaceColor'</span>, <span class="string">'black'</span>);
    <span class="keyword">end</span>

    xline(0);
    yline(0);

    title({<span class="string">'Risky K Percentage Grids Given w=k+a (2nd Stage)'</span><span class="keyword">...</span>
           <span class="string">'(Bridge Borrow Share = 0)'</span>})
    ylabel(<span class="string">'Capital Choice (mt\_k)'</span>)
    xlabel({<span class="string">'Borrowing (&lt;0) or Saving (&gt;0) (mt\_a)'</span><span class="keyword">...</span>
        <span class="string">'Each Diagonal Line a Different w=k+a level'</span><span class="keyword">...</span>
        <span class="string">'Percentage for Risky K along Each Diagonal'</span>})

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_w_level', <span class="string">'k+a=%3.2f'</span>));

    <span class="keyword">if</span> (length(ar_w_level) &lt;= 100)
        chart(length(chart)+1) = gf_invalid_scatter;
        legendCell{length(legendCell) + 1} = <span class="string">'Invalid: COH(a,b,z)&lt;bar(b) some z'</span>;
        legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), <span class="string">'Location'</span>, <span class="string">'northeast'</span>);
    <span class="keyword">else</span>
        legend(chart([legend2plot]), legendCell([legend2plot]), <span class="string">'Location'</span>, <span class="string">'northeast'</span>);
    <span class="keyword">end</span>

    grid <span class="string">on</span>;
</pre><img vspace="5" hspace="5" src="ffs_ipwkbz_fibs_get_funcgrid_01.png" alt=""> <h2 id="31">Graph 2: coh by shock</h2><p>compare the figure here to the same figure in <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html">ffs_akz_get_funcgrid</a>. there the grid points are on an even grid. Visually, one could see that the blue/red line segments here are always the same length, but in the ffs_akz_get_funcgrid figure, they are increasingly longer as we move towards the right. They are even because the number of percentage points available is constant regardless of w = k' + b' levels. But previously, the number of grid points available is increasing as w increases since choice grid is based on levels.</p><pre class="codeinput">    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    chart = plot(0:1:(size(mt_coh_wkb_full,1)-1), mt_coh_wkb_full);
    clr = jet(numel(chart));
    <span class="keyword">for</span> m = 1:numel(chart)
        set(chart(m),<span class="string">'Color'</span>,clr(m,:))
    <span class="keyword">end</span>

    <span class="comment">% zero lines</span>
    xline(0);
    yline(0);

    <span class="comment">% invalid points separating lines</span>
    yline_borrbound = yline(fl_b_bd);
    yline_borrbound.HandleVisibility = <span class="string">'on'</span>;
    yline_borrbound.LineStyle = <span class="string">'--'</span>;
    yline_borrbound.Color = <span class="string">'blue'</span>;
    yline_borrbound.LineWidth = 2.5;

    title(<span class="string">'Cash-on-Hand given w(k+b),k,z'</span>);
    ylabel(<span class="string">'Cash-on-Hand (mt\_coh\_wkb\_full)'</span>);
    xlabel({<span class="string">'Index of Cash-on-Hand Discrete Point (0:1:(size(mt\_coh\_wkb\_full,1)-1))'</span><span class="keyword">...</span>
        <span class="string">'Each Segment is a w=k+b; within segment increasing k'</span><span class="keyword">...</span>
        <span class="string">'For each w and z, coh maximizing k is different'</span>});

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));

    legendCell{length(legendCell) + 1} = <span class="string">'borrow-constraint'</span>;
    chart(length(chart)+1) = yline_borrbound;
    legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), <span class="string">'Location'</span>, <span class="string">'northwest'</span>);

    grid <span class="string">on</span>;
</pre><img vspace="5" hspace="5" src="ffs_ipwkbz_fibs_get_funcgrid_02.png" alt=""> <h2 id="32">Graph 3: 1st State Aggregate Savings Choices by COH interpolation grids</h2><pre class="codeinput">    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    hold <span class="string">on</span>;

    chart = plot(ar_interp_coh_grid, mt_w_by_interp_coh_interp_grid');

    clr = jet(numel(chart));
    <span class="keyword">for</span> m = 1:numel(chart)
        set(chart(m),<span class="string">'Color'</span>,clr(m,:))
    <span class="keyword">end</span>
    <span class="keyword">if</span> (length(ar_interp_coh_grid) &lt;= 100)
        [~, mt_interp_coh_grid_mesh_w_perc] = ndgrid(ar_w_perc, ar_interp_coh_grid);
        scatter(mt_interp_coh_grid_mesh_w_perc(:), mt_w_by_interp_coh_interp_grid(:), 3, <span class="string">'filled'</span>, <span class="keyword">...</span>
            <span class="string">'MarkerEdgeColor'</span>, <span class="string">'b'</span>, <span class="string">'MarkerFaceColor'</span>, <span class="string">'b'</span>);
    <span class="keyword">end</span>

    <span class="comment">% invalid points separating lines</span>
    yline_borrbound = yline(fl_w_level_min_valid);
    yline_borrbound.HandleVisibility = <span class="string">'on'</span>;
    yline_borrbound.LineStyle = <span class="string">'--'</span>;
    yline_borrbound.Color = <span class="string">'red'</span>;
    yline_borrbound.LineWidth = 2.5;

    xline0 = xline(0);
    xline0.HandleVisibility = <span class="string">'off'</span>;
    yline0 = yline(0);
    yline0.HandleVisibility = <span class="string">'off'</span>;

    title({<span class="string">'Aggregate Savings Percentage Grids (1st Stage)'</span> <span class="keyword">...</span>
           <span class="string">'y=mt\_w\_by\_interp\_coh\_interp\_grid, and, y=ar\_interp\_coh\_grid'</span>});
    ylabel(<span class="string">'1st Stage Aggregate Savings Choices'</span>);
    xlabel({<span class="string">'Cash-on-Hand Levels (Interpolation Points)'</span><span class="keyword">...</span>
            <span class="string">'w(coh)&gt;min-agg-save, coh(k(w),w-k)&gt;=bar(b)'</span>});

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_w_perc', <span class="string">'ar w perc=%3.2f'</span>));
    legendCell{length(legendCell) + 1} = <span class="string">'min-agg-save'</span>;
    chart(length(chart)+1) = yline_borrbound;
    legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), <span class="string">'Location'</span>, <span class="string">'northwest'</span>);

    grid <span class="string">on</span>;
</pre><img vspace="5" hspace="5" src="ffs_ipwkbz_fibs_get_funcgrid_03.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="34">Graph Details, Generally do Not Run</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_funcgrids_detail)
</pre><h2 id="36">Graph 1: 2nd stage coh reached by k' b' choices by index</h2><pre class="codeinput">    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    ar_coh_kpzgrid_unique = unique(sort(mt_coh_wkb_full(:)));
    scatter(1:length(ar_coh_kpzgrid_unique), ar_coh_kpzgrid_unique);
    xline(0);
    yline(0);
    title(<span class="string">'Cash-on-Hand given w(k+b),k,z'</span>);
    ylabel(<span class="string">'Cash-on-Hand (y=ar\_coh\_kpzgrid\_unique)'</span>);
    xlabel({<span class="string">'Index of Cash-on-Hand Discrete Point'</span> <span class="string">'x = 1:length(ar\_coh\_kpzgrid\_unique)'</span>});
    grid <span class="string">on</span>;
</pre><img vspace="5" hspace="5" src="ffs_ipwkbz_fibs_get_funcgrid_04.png" alt=""> <h2 id="37">Graph 2: 2nd stage coh reached by k' b' choices  by coh</h2><pre class="codeinput">    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    ar_coh_kpzgrid_unique = unique(sort(mt_coh_wkb_full(:)));
    scatter(ar_coh_kpzgrid_unique, ar_coh_kpzgrid_unique, <span class="string">'.'</span>);
    xline(0);
    yline(0);
    title(<span class="string">'Cash-on-Hand given w(k+b),k,z; See Clearly Sparsity Density of Grid across Z'</span>);
    ylabel(<span class="string">'Cash-on-Hand (y = ar\_coh\_kpzgrid\_unique)'</span>);
    xlabel({<span class="string">'Cash-on-Hand'</span> <span class="string">'x = ar\_coh\_kpzgrid\_unique'</span>});
    grid <span class="string">on</span>;
</pre><img vspace="5" hspace="5" src="ffs_ipwkbz_fibs_get_funcgrid_05.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="39">Display</h2><pre class="codeinput"><span class="keyword">if</span> (bl_display_funcgrids)

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_z'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(ar_z));
    disp(ar_z);

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_w_level_full'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(ar_w_level_full));
    disp(ar_w_level_full);

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_w_by_interp_coh_interp_grid'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_w_by_interp_coh_interp_grid));
    disp(head(array2table(mt_w_by_interp_coh_interp_grid), 10));
    disp(tail(array2table(mt_w_by_interp_coh_interp_grid), 10));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_z_trans'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_z_trans));
    disp(head(array2table(mt_z_trans), 10));
    disp(tail(array2table(mt_z_trans), 10));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_interp_coh_grid'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    summary(array2table(ar_interp_coh_grid'));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_interp_c_grid'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    summary(array2table(ar_interp_c_grid'));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_interp_coh_grid_mesh_z'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_interp_coh_grid_mesh_z));
    disp(head(array2table(mt_interp_coh_grid_mesh_z), 10));
    disp(tail(array2table(mt_interp_coh_grid_mesh_z), 10));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_a'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_a));
    disp(head(array2table(mt_a), 10));
    disp(tail(array2table(mt_a), 10));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_a_meshk'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    summary(array2table(ar_a_meshk));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_k'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_k));
    disp(head(array2table(mt_k), 10));
    disp(tail(array2table(mt_k), 10));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'ar_k_mesha'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    summary(array2table(ar_k_mesha));

    param_map_keys = keys(func_map);
    param_map_vals = values(func_map);
    <span class="keyword">for</span> i = 1:length(func_map)
        st_display = strjoin([<span class="string">'pos ='</span> num2str(i) <span class="string">'; key ='</span> string(param_map_keys{i}) <span class="string">'; val ='</span> func2str(param_map_vals{i})]);
        disp(st_display);
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_z
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     1    15

  Columns 1 through 7

    0.3474    0.4008    0.4623    0.5333    0.6152    0.7097    0.8186

  Columns 8 through 14

    0.9444    1.0894    1.2567    1.4496    1.6723    1.9291    2.2253

  Column 15

    2.5670

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_w_level_full
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     1    55

  Columns 1 through 7

  -20.0000  -17.8788  -15.7576  -13.6364  -11.5152   -9.3939   -7.2727

  Columns 8 through 14

   -5.1515   -3.0303   -0.9091  -20.0000  -17.8788  -15.7576  -13.6364

  Columns 15 through 21

  -11.5152   -9.3939   -7.2727   -5.1515   -3.0303   -0.9091  -20.0000

  Columns 22 through 28

  -17.8788  -15.7576  -13.6364  -11.5152   -9.3939   -7.2727   -5.1515

  Columns 29 through 35

   -3.0303   -0.9091         0    1.2121    3.3333    5.4545    7.5758

  Columns 36 through 42

    9.6970   11.8182   13.9394   16.0606   18.1818   20.3030   22.4242

  Columns 43 through 49

   24.5455   26.6667   28.7879   30.9091   33.0303   35.1515   37.2727

  Columns 50 through 55

   39.3939   41.5152   43.6364   45.7576   47.8788   50.0000

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_w_by_interp_coh_interp_grid
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     7    38

    mt_w_by_interp_coh_interp_grid1    mt_w_by_interp_coh_interp_grid2    mt_w_by_interp_coh_interp_grid3    mt_w_by_interp_coh_interp_grid4    mt_w_by_interp_coh_interp_grid5    mt_w_by_interp_coh_interp_grid6    mt_w_by_interp_coh_interp_grid7    mt_w_by_interp_coh_interp_grid8    mt_w_by_interp_coh_interp_grid9    mt_w_by_interp_coh_interp_grid10    mt_w_by_interp_coh_interp_grid11    mt_w_by_interp_coh_interp_grid12    mt_w_by_interp_coh_interp_grid13    mt_w_by_interp_coh_interp_grid14    mt_w_by_interp_coh_interp_grid15    mt_w_by_interp_coh_interp_grid16    mt_w_by_interp_coh_interp_grid17    mt_w_by_interp_coh_interp_grid18    mt_w_by_interp_coh_interp_grid19    mt_w_by_interp_coh_interp_grid20    mt_w_by_interp_coh_interp_grid21    mt_w_by_interp_coh_interp_grid22    mt_w_by_interp_coh_interp_grid23    mt_w_by_interp_coh_interp_grid24    mt_w_by_interp_coh_interp_grid25    mt_w_by_interp_coh_interp_grid26    mt_w_by_interp_coh_interp_grid27    mt_w_by_interp_coh_interp_grid28    mt_w_by_interp_coh_interp_grid29    mt_w_by_interp_coh_interp_grid30    mt_w_by_interp_coh_interp_grid31    mt_w_by_interp_coh_interp_grid32    mt_w_by_interp_coh_interp_grid33    mt_w_by_interp_coh_interp_grid34    mt_w_by_interp_coh_interp_grid35    mt_w_by_interp_coh_interp_grid36    mt_w_by_interp_coh_interp_grid37    mt_w_by_interp_coh_interp_grid38
    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________

                  -20                              -19.998                            -19.996                            -19.994                            -19.991                            -19.989                            -19.987                            -19.985                            -19.983                             -19.981                             -19.98                             -19.979                              -19.976                            -19.974                             -19.972                               -19.97                            -19.968                             -19.966                             -19.964                              -19.961                            -19.959                             -19.957                             -19.955                             -19.953                             -19.951                             -19.948                             -19.946                             -19.944                              -19.942                              -19.94                            -19.938                             -19.936                             -19.933                             -19.931                             -19.929                             -19.927                             -19.925                             -19.923             
                  -20                              -19.641                            -19.282                            -18.923                            -18.564                            -18.205                            -17.846                            -17.486                            -17.127                             -16.768                            -16.653                             -16.409                               -16.05                            -15.691                             -15.332                              -14.973                            -14.614                             -14.255                             -13.896                              -13.537                            -13.178                             -12.819                             -12.459                               -12.1                             -11.741                             -11.382                             -11.023                             -10.664                              -10.305                              -9.946                            -9.5869                             -9.2278                             -8.8688                             -8.5097                             -8.1506                             -7.7915                             -7.4325                             -7.0734             
                  -20                              -19.284                            -18.568                            -17.852                            -17.136                             -16.42                            -15.704                            -14.988                            -14.272                             -13.556                            -13.327                              -12.84                              -12.124                            -11.408                             -10.692                               -9.976                              -9.26                              -8.544                              -7.828                               -7.112                             -6.396                               -5.68                              -4.964                              -4.248                              -3.532                              -2.816                                -2.1                              -1.384                             -0.66803                            0.047969                            0.76397                                1.48                               2.196                               2.912                               3.628                               4.344                                5.06                               5.776             
                  -20                              -18.927                            -17.854                            -16.781                            -15.708                            -14.635                            -13.562                             -12.49                            -11.417                             -10.344                                -10                             -9.2707                              -8.1978                            -7.1249                              -6.052                               -4.979                            -3.9061                             -2.8332                             -1.7603                             -0.68734                            0.38558                              1.4585                              2.5314                              3.6044                              4.6773                              5.7502                              6.8231                              7.8961                                8.969                              10.042                             11.115                              12.188                              13.261                              14.334                              15.407                              16.479                              17.552                              18.625             
                  -20                               -18.57                             -17.14                             -15.71                            -14.281                            -12.851                            -11.421                             -9.991                            -8.5612                             -7.1313                            -6.6733                             -5.7015                              -4.2716                            -2.8418                             -1.4119                             0.017927                             1.4478                              2.8776                              4.3075                               5.7373                             7.1672                               8.597                              10.027                              11.457                              12.887                              14.316                              15.746                              17.176                               18.606                              20.036                             21.466                              22.896                              24.325                              25.755                              27.185                              28.615                              30.045                              31.475             
                  -20                              -18.213                            -16.426                             -14.64                            -12.853                            -11.066                            -9.2793                            -7.4926                            -5.7058                              -3.919                            -3.3467                             -2.1322                             -0.34544                             1.4413                              3.2281                               5.0149                             6.8017                              8.5885                              10.375                               12.162                             13.949                              15.736                              17.522                              19.309                              21.096                              22.883                              24.669                              26.456                               28.243                               30.03                             31.817                              33.603                               35.39                              37.177                              38.964                               40.75                              42.537                              44.324             
                  -20                              -17.856                            -15.713                            -13.569                            -11.425                            -9.2815                            -7.1378                            -4.9941                            -2.8504                            -0.70666                              -0.02                               1.437                               3.5808                             5.7245                              7.8682                               10.012                             12.156                              14.299                              16.443                               18.587                              20.73                              22.874                              25.018                              27.162                              29.305                              31.449                              33.593                              35.736                                37.88                              40.024                             42.167                              44.311                              46.455                              48.599                              50.742                              52.886                               55.03                              57.173             

    mt_w_by_interp_coh_interp_grid1    mt_w_by_interp_coh_interp_grid2    mt_w_by_interp_coh_interp_grid3    mt_w_by_interp_coh_interp_grid4    mt_w_by_interp_coh_interp_grid5    mt_w_by_interp_coh_interp_grid6    mt_w_by_interp_coh_interp_grid7    mt_w_by_interp_coh_interp_grid8    mt_w_by_interp_coh_interp_grid9    mt_w_by_interp_coh_interp_grid10    mt_w_by_interp_coh_interp_grid11    mt_w_by_interp_coh_interp_grid12    mt_w_by_interp_coh_interp_grid13    mt_w_by_interp_coh_interp_grid14    mt_w_by_interp_coh_interp_grid15    mt_w_by_interp_coh_interp_grid16    mt_w_by_interp_coh_interp_grid17    mt_w_by_interp_coh_interp_grid18    mt_w_by_interp_coh_interp_grid19    mt_w_by_interp_coh_interp_grid20    mt_w_by_interp_coh_interp_grid21    mt_w_by_interp_coh_interp_grid22    mt_w_by_interp_coh_interp_grid23    mt_w_by_interp_coh_interp_grid24    mt_w_by_interp_coh_interp_grid25    mt_w_by_interp_coh_interp_grid26    mt_w_by_interp_coh_interp_grid27    mt_w_by_interp_coh_interp_grid28    mt_w_by_interp_coh_interp_grid29    mt_w_by_interp_coh_interp_grid30    mt_w_by_interp_coh_interp_grid31    mt_w_by_interp_coh_interp_grid32    mt_w_by_interp_coh_interp_grid33    mt_w_by_interp_coh_interp_grid34    mt_w_by_interp_coh_interp_grid35    mt_w_by_interp_coh_interp_grid36    mt_w_by_interp_coh_interp_grid37    mt_w_by_interp_coh_interp_grid38
    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    _______________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________    ________________________________

                  -20                              -19.998                            -19.996                            -19.994                            -19.991                            -19.989                            -19.987                            -19.985                            -19.983                             -19.981                             -19.98                             -19.979                              -19.976                            -19.974                             -19.972                               -19.97                            -19.968                             -19.966                             -19.964                              -19.961                            -19.959                             -19.957                             -19.955                             -19.953                             -19.951                             -19.948                             -19.946                             -19.944                              -19.942                              -19.94                            -19.938                             -19.936                             -19.933                             -19.931                             -19.929                             -19.927                             -19.925                             -19.923             
                  -20                              -19.641                            -19.282                            -18.923                            -18.564                            -18.205                            -17.846                            -17.486                            -17.127                             -16.768                            -16.653                             -16.409                               -16.05                            -15.691                             -15.332                              -14.973                            -14.614                             -14.255                             -13.896                              -13.537                            -13.178                             -12.819                             -12.459                               -12.1                             -11.741                             -11.382                             -11.023                             -10.664                              -10.305                              -9.946                            -9.5869                             -9.2278                             -8.8688                             -8.5097                             -8.1506                             -7.7915                             -7.4325                             -7.0734             
                  -20                              -19.284                            -18.568                            -17.852                            -17.136                             -16.42                            -15.704                            -14.988                            -14.272                             -13.556                            -13.327                              -12.84                              -12.124                            -11.408                             -10.692                               -9.976                              -9.26                              -8.544                              -7.828                               -7.112                             -6.396                               -5.68                              -4.964                              -4.248                              -3.532                              -2.816                                -2.1                              -1.384                             -0.66803                            0.047969                            0.76397                                1.48                               2.196                               2.912                               3.628                               4.344                                5.06                               5.776             
                  -20                              -18.927                            -17.854                            -16.781                            -15.708                            -14.635                            -13.562                             -12.49                            -11.417                             -10.344                                -10                             -9.2707                              -8.1978                            -7.1249                              -6.052                               -4.979                            -3.9061                             -2.8332                             -1.7603                             -0.68734                            0.38558                              1.4585                              2.5314                              3.6044                              4.6773                              5.7502                              6.8231                              7.8961                                8.969                              10.042                             11.115                              12.188                              13.261                              14.334                              15.407                              16.479                              17.552                              18.625             
                  -20                               -18.57                             -17.14                             -15.71                            -14.281                            -12.851                            -11.421                             -9.991                            -8.5612                             -7.1313                            -6.6733                             -5.7015                              -4.2716                            -2.8418                             -1.4119                             0.017927                             1.4478                              2.8776                              4.3075                               5.7373                             7.1672                               8.597                              10.027                              11.457                              12.887                              14.316                              15.746                              17.176                               18.606                              20.036                             21.466                              22.896                              24.325                              25.755                              27.185                              28.615                              30.045                              31.475             
                  -20                              -18.213                            -16.426                             -14.64                            -12.853                            -11.066                            -9.2793                            -7.4926                            -5.7058                              -3.919                            -3.3467                             -2.1322                             -0.34544                             1.4413                              3.2281                               5.0149                             6.8017                              8.5885                              10.375                               12.162                             13.949                              15.736                              17.522                              19.309                              21.096                              22.883                              24.669                              26.456                               28.243                               30.03                             31.817                              33.603                               35.39                              37.177                              38.964                               40.75                              42.537                              44.324             
                  -20                              -17.856                            -15.713                            -13.569                            -11.425                            -9.2815                            -7.1378                            -4.9941                            -2.8504                            -0.70666                              -0.02                               1.437                               3.5808                             5.7245                              7.8682                               10.012                             12.156                              14.299                              16.443                               18.587                              20.73                              22.874                              25.018                              27.162                              29.305                              31.449                              33.593                              35.736                                37.88                              40.024                             42.167                              44.311                              46.455                              48.599                              50.742                              52.886                               55.03                              57.173             

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_z_trans
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    15    15

    mt_z_trans1    mt_z_trans2    mt_z_trans3    mt_z_trans4    mt_z_trans5    mt_z_trans6    mt_z_trans7    mt_z_trans8    mt_z_trans9    mt_z_trans10    mt_z_trans11    mt_z_trans12    mt_z_trans13    mt_z_trans14    mt_z_trans15
    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________    ____________    ____________    ____________    ____________    ____________

       0.26016        0.26831        0.25551        0.14921       0.053403      0.011702       0.0015678     0.00012823     6.3911e-06      1.9381e-07      3.5701e-09      3.9889e-11      2.7001e-13      1.1102e-15               0 
       0.11232        0.19622         0.2763        0.23861        0.12635      0.040998       0.0081429     0.00098855     7.3236e-05      3.3054e-06      9.0736e-08      1.5125e-09      1.5289e-11      9.3592e-14      3.3307e-16 
      0.037073        0.10492         0.2185        0.27902         0.2185       0.10492        0.030863      0.0055558     0.00061112      4.1008e-05      1.6758e-06       4.164e-08      6.2811e-10      5.7438e-12      3.1863e-14 
     0.0092081       0.040998        0.12635        0.23861         0.2763       0.19622        0.085427       0.022782      0.0037167       0.0003704      2.2511e-05      8.3291e-07      1.8732e-08      2.5567e-10      2.1255e-12 
     0.0017026       0.011702       0.053403        0.14921        0.25551       0.26831         0.17279       0.068209       0.016489       0.0024379       0.0002201      1.2114e-05       4.058e-07      8.2598e-09      1.0277e-10 
    0.00023263      0.0024379       0.016489       0.068209        0.17279       0.26831         0.25551        0.14921       0.053403        0.011702       0.0015678      0.00012823      6.3911e-06      1.9381e-07      3.6102e-09 
    2.3363e-05      0.0003704      0.0037167       0.022782       0.085427       0.19622          0.2763        0.23861        0.12635        0.040998       0.0081429      0.00098855      7.3236e-05      3.3054e-06      9.2263e-08 
    1.7181e-06     4.1008e-05     0.00061112      0.0055558       0.030863       0.10492          0.2185        0.27902         0.2185         0.10492        0.030863       0.0055558      0.00061112      4.1008e-05      1.7181e-06 
    9.2263e-08     3.3054e-06     7.3236e-05     0.00098855      0.0081429      0.040998         0.12635        0.23861         0.2763         0.19622        0.085427        0.022782       0.0037167       0.0003704      2.3363e-05 
    3.6102e-09     1.9381e-07     6.3911e-06     0.00012823      0.0015678      0.011702        0.053403        0.14921        0.25551         0.26831         0.17279        0.068209        0.016489       0.0024379      0.00023263 

    mt_z_trans1    mt_z_trans2    mt_z_trans3    mt_z_trans4    mt_z_trans5    mt_z_trans6    mt_z_trans7    mt_z_trans8    mt_z_trans9    mt_z_trans10    mt_z_trans11    mt_z_trans12    mt_z_trans13    mt_z_trans14    mt_z_trans15
    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ___________    ____________    ____________    ____________    ____________    ____________    ____________

    0.00023263      0.0024379       0.016489       0.068209        0.17279        0.26831        0.25551        0.14921       0.053403       0.011702       0.0015678       0.00012823      6.3911e-06      1.9381e-07      3.6102e-09 
    2.3363e-05      0.0003704      0.0037167       0.022782       0.085427        0.19622         0.2763        0.23861        0.12635       0.040998       0.0081429       0.00098855      7.3236e-05      3.3054e-06      9.2263e-08 
    1.7181e-06     4.1008e-05     0.00061112      0.0055558       0.030863        0.10492         0.2185        0.27902         0.2185        0.10492        0.030863        0.0055558      0.00061112      4.1008e-05      1.7181e-06 
    9.2263e-08     3.3054e-06     7.3236e-05     0.00098855      0.0081429       0.040998        0.12635        0.23861         0.2763        0.19622        0.085427         0.022782       0.0037167       0.0003704      2.3363e-05 
    3.6102e-09     1.9381e-07     6.3911e-06     0.00012823      0.0015678       0.011702       0.053403        0.14921        0.25551        0.26831         0.17279         0.068209        0.016489       0.0024379      0.00023263 
    1.0277e-10     8.2598e-09      4.058e-07     1.2114e-05      0.0002201      0.0024379       0.016489       0.068209        0.17279        0.26831         0.25551          0.14921        0.053403        0.011702       0.0017026 
    2.1256e-12     2.5567e-10     1.8732e-08     8.3291e-07     2.2511e-05      0.0003704      0.0037167       0.022782       0.085427        0.19622          0.2763          0.23861         0.12635        0.040998       0.0092081 
    3.1909e-14     5.7438e-12     6.2811e-10      4.164e-08     1.6758e-06     4.1008e-05     0.00061112      0.0055558       0.030863        0.10492          0.2185          0.27902          0.2185         0.10492        0.037073 
     3.474e-16     9.3597e-14     1.5289e-11     1.5125e-09     9.0736e-08     3.3054e-06     7.3236e-05     0.00098855      0.0081429       0.040998         0.12635          0.23861          0.2763         0.19622         0.11232 
    2.7412e-18     1.1057e-15     2.6998e-13     3.9889e-11     3.5701e-09     1.9381e-07     6.3911e-06     0.00012823      0.0015678       0.011702        0.053403          0.14921         0.25551         0.26831         0.26016 

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_interp_coh_grid
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Variables:

    Var1: 38&times;1 double

        Values:

            Min          -20
            Median    17.552
            Max       57.251

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_interp_c_grid
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Variables:

    Var1: 772496&times;1 double

        Values:

            Min        0.001
            Median    38.626
            Max       77.251

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_interp_coh_grid_mesh_z
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    38    15

    mt_interp_coh_grid_mesh_z1    mt_interp_coh_grid_mesh_z2    mt_interp_coh_grid_mesh_z3    mt_interp_coh_grid_mesh_z4    mt_interp_coh_grid_mesh_z5    mt_interp_coh_grid_mesh_z6    mt_interp_coh_grid_mesh_z7    mt_interp_coh_grid_mesh_z8    mt_interp_coh_grid_mesh_z9    mt_interp_coh_grid_mesh_z10    mt_interp_coh_grid_mesh_z11    mt_interp_coh_grid_mesh_z12    mt_interp_coh_grid_mesh_z13    mt_interp_coh_grid_mesh_z14    mt_interp_coh_grid_mesh_z15
    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    ___________________________    ___________________________    ___________________________    ___________________________    ___________________________    ___________________________

                  -20                           -20                           -20                           -20                           -20                           -20                           -20                           -20                           -20                           -20                            -20                            -20                            -20                            -20                            -20          
              -17.854                       -17.854                       -17.854                       -17.854                       -17.854                       -17.854                       -17.854                       -17.854                       -17.854                       -17.854                        -17.854                        -17.854                        -17.854                        -17.854                        -17.854          
              -15.708                       -15.708                       -15.708                       -15.708                       -15.708                       -15.708                       -15.708                       -15.708                       -15.708                       -15.708                        -15.708                        -15.708                        -15.708                        -15.708                        -15.708          
              -13.562                       -13.562                       -13.562                       -13.562                       -13.562                       -13.562                       -13.562                       -13.562                       -13.562                       -13.562                        -13.562                        -13.562                        -13.562                        -13.562                        -13.562          
              -11.417                       -11.417                       -11.417                       -11.417                       -11.417                       -11.417                       -11.417                       -11.417                       -11.417                       -11.417                        -11.417                        -11.417                        -11.417                        -11.417                        -11.417          
              -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                       -9.2707                        -9.2707                        -9.2707                        -9.2707                        -9.2707                        -9.2707          
              -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                       -7.1249                        -7.1249                        -7.1249                        -7.1249                        -7.1249                        -7.1249          
               -4.979                        -4.979                        -4.979                        -4.979                        -4.979                        -4.979                        -4.979                        -4.979                        -4.979                        -4.979                         -4.979                         -4.979                         -4.979                         -4.979                         -4.979          
              -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                       -2.8332                        -2.8332                        -2.8332                        -2.8332                        -2.8332                        -2.8332          
             -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                      -0.68734                       -0.68734                       -0.68734                       -0.68734                       -0.68734                       -0.68734          

    mt_interp_coh_grid_mesh_z1    mt_interp_coh_grid_mesh_z2    mt_interp_coh_grid_mesh_z3    mt_interp_coh_grid_mesh_z4    mt_interp_coh_grid_mesh_z5    mt_interp_coh_grid_mesh_z6    mt_interp_coh_grid_mesh_z7    mt_interp_coh_grid_mesh_z8    mt_interp_coh_grid_mesh_z9    mt_interp_coh_grid_mesh_z10    mt_interp_coh_grid_mesh_z11    mt_interp_coh_grid_mesh_z12    mt_interp_coh_grid_mesh_z13    mt_interp_coh_grid_mesh_z14    mt_interp_coh_grid_mesh_z15
    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    __________________________    ___________________________    ___________________________    ___________________________    ___________________________    ___________________________    ___________________________

              37.938                        37.938                        37.938                        37.938                        37.938                        37.938                        37.938                        37.938                        37.938                        37.938                         37.938                         37.938                         37.938                         37.938                         37.938           
              40.084                        40.084                        40.084                        40.084                        40.084                        40.084                        40.084                        40.084                        40.084                        40.084                         40.084                         40.084                         40.084                         40.084                         40.084           
               42.23                         42.23                         42.23                         42.23                         42.23                         42.23                         42.23                         42.23                         42.23                         42.23                          42.23                          42.23                          42.23                          42.23                          42.23           
              44.376                        44.376                        44.376                        44.376                        44.376                        44.376                        44.376                        44.376                        44.376                        44.376                         44.376                         44.376                         44.376                         44.376                         44.376           
              46.521                        46.521                        46.521                        46.521                        46.521                        46.521                        46.521                        46.521                        46.521                        46.521                         46.521                         46.521                         46.521                         46.521                         46.521           
              48.667                        48.667                        48.667                        48.667                        48.667                        48.667                        48.667                        48.667                        48.667                        48.667                         48.667                         48.667                         48.667                         48.667                         48.667           
              50.813                        50.813                        50.813                        50.813                        50.813                        50.813                        50.813                        50.813                        50.813                        50.813                         50.813                         50.813                         50.813                         50.813                         50.813           
              52.959                        52.959                        52.959                        52.959                        52.959                        52.959                        52.959                        52.959                        52.959                        52.959                         52.959                         52.959                         52.959                         52.959                         52.959           
              55.105                        55.105                        55.105                        55.105                        55.105                        55.105                        55.105                        55.105                        55.105                        55.105                         55.105                         55.105                         55.105                         55.105                         55.105           
              57.251                        57.251                        57.251                        57.251                        57.251                        57.251                        57.251                        57.251                        57.251                        57.251                         57.251                         57.251                         57.251                         57.251                         57.251           

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_a
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     7    55

    mt_a1     mt_a2      mt_a3      mt_a4      mt_a5      mt_a6      mt_a7      mt_a8      mt_a9      mt_a10     mt_a11    mt_a12     mt_a13     mt_a14     mt_a15     mt_a16     mt_a17     mt_a18     mt_a19      mt_a20     mt_a21    mt_a22     mt_a23     mt_a24     mt_a25     mt_a26     mt_a27     mt_a28     mt_a29      mt_a30     mt_a31     mt_a32      mt_a33     mt_a34     mt_a35      mt_a36     mt_a37     mt_a38     mt_a39      mt_a40     mt_a41     mt_a42     mt_a43     mt_a44     mt_a45     mt_a46     mt_a47     mt_a48     mt_a49      mt_a50     mt_a51     mt_a52     mt_a53     mt_a54     mt_a55 
    _____    _______    _______    _______    _______    _______    _______    _______    _______    ________    ______    _______    _______    _______    _______    _______    _______    _______    _______    ________    ______    _______    _______    _______    _______    _______    _______    _______    _______    ________    _______    _______    ________    _______    _______    ________    _______    _______    _______    ________    _______    _______    _______    _______    _______    _______    _______    _______    _______    ________    _______    _______    _______    _______    _______

     -20     -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818     -20      -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818     -20      -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818      -0.02     1.1909        3.31     5.4291     7.5482      9.6673     11.786     13.905     16.025      18.144     20.263     22.382     24.501      26.62     28.739     30.858     32.977     35.096     37.215      39.335     41.454     43.573     45.692     47.811      49.93
     -20     -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036     -20      -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036     -20      -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036    -3.3467    -2.3374    -0.57111     1.1952     2.9614      4.7277     6.4939     8.2602     10.026      11.793     13.559     15.325     17.092     18.858     20.624      22.39     24.157     25.923     27.689      29.455     31.222     32.988     34.754      36.52     38.287
     -20     -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791     -20      -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791     -20      -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791    -6.6733    -5.8657     -4.4522    -3.0388    -1.6254    -0.21192     1.2015     2.6149     4.0284      5.4418     6.8553     8.2687     9.6821     11.096     12.509     13.922     15.336     16.749     18.163      19.576      20.99     22.403     23.816      25.23     26.643
     -20     -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455     -20      -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455     -20      -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455        -10    -9.3939     -8.3333    -7.2727    -6.2121     -5.1515    -4.0909    -3.0303    -1.9697    -0.90909    0.15152     1.2121     2.2727     3.3333     4.3939     5.4545     6.5152     7.5758     8.6364       9.697     10.758     11.818     12.879     13.939         15
     -20     -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63     -20      -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63     -20      -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63    -13.327    -12.922     -12.214    -11.507    -10.799     -10.091    -9.3833    -8.6756    -7.9678       -7.26    -6.5522    -5.8444    -5.1367    -4.4289    -3.7211    -3.0133    -2.3056    -1.5978      -0.89    -0.18222    0.52556     1.2333     1.9411     2.6489     3.3567
     -20     -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805     -20      -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805     -20      -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805    -16.653    -16.451     -16.096    -15.741    -15.386     -15.031    -14.676    -14.321    -13.966     -13.611    -13.256    -12.901    -12.546    -12.191    -11.836    -11.481    -11.126    -10.771    -10.416     -10.061    -9.7065    -9.3515    -8.9966    -8.6416    -8.2867
     -20     -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -20      -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -20      -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -19.98    -19.979     -19.977    -19.975    -19.972      -19.97    -19.968    -19.966    -19.964     -19.962     -19.96    -19.958    -19.955    -19.953    -19.951    -19.949    -19.947    -19.945    -19.943     -19.941    -19.938    -19.936    -19.934    -19.932     -19.93

    mt_a1     mt_a2      mt_a3      mt_a4      mt_a5      mt_a6      mt_a7      mt_a8      mt_a9      mt_a10     mt_a11    mt_a12     mt_a13     mt_a14     mt_a15     mt_a16     mt_a17     mt_a18     mt_a19      mt_a20     mt_a21    mt_a22     mt_a23     mt_a24     mt_a25     mt_a26     mt_a27     mt_a28     mt_a29      mt_a30     mt_a31     mt_a32      mt_a33     mt_a34     mt_a35      mt_a36     mt_a37     mt_a38     mt_a39      mt_a40     mt_a41     mt_a42     mt_a43     mt_a44     mt_a45     mt_a46     mt_a47     mt_a48     mt_a49      mt_a50     mt_a51     mt_a52     mt_a53     mt_a54     mt_a55 
    _____    _______    _______    _______    _______    _______    _______    _______    _______    ________    ______    _______    _______    _______    _______    _______    _______    _______    _______    ________    ______    _______    _______    _______    _______    _______    _______    _______    _______    ________    _______    _______    ________    _______    _______    ________    _______    _______    _______    ________    _______    _______    _______    _______    _______    _______    _______    _______    _______    ________    _______    _______    _______    _______    _______

     -20     -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818     -20      -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818     -20      -17.881    -15.762    -13.643    -11.524    -9.4045    -7.2855    -5.1664    -3.0473    -0.92818      -0.02     1.1909        3.31     5.4291     7.5482      9.6673     11.786     13.905     16.025      18.144     20.263     22.382     24.501      26.62     28.739     30.858     32.977     35.096     37.215      39.335     41.454     43.573     45.692     47.811      49.93
     -20     -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036     -20      -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036     -20      -18.234    -16.467    -14.701    -12.935    -11.169    -9.4024    -7.6362    -5.8699     -4.1036    -3.3467    -2.3374    -0.57111     1.1952     2.9614      4.7277     6.4939     8.2602     10.026      11.793     13.559     15.325     17.092     18.858     20.624      22.39     24.157     25.923     27.689      29.455     31.222     32.988     34.754      36.52     38.287
     -20     -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791     -20      -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791     -20      -18.587    -17.173     -15.76    -14.346    -12.933    -11.519    -10.106    -8.6925     -7.2791    -6.6733    -5.8657     -4.4522    -3.0388    -1.6254    -0.21192     1.2015     2.6149     4.0284      5.4418     6.8553     8.2687     9.6821     11.096     12.509     13.922     15.336     16.749     18.163      19.576      20.99     22.403     23.816      25.23     26.643
     -20     -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455     -20      -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455     -20      -18.939    -17.879    -16.818    -15.758    -14.697    -13.636    -12.576    -11.515     -10.455        -10    -9.3939     -8.3333    -7.2727    -6.2121     -5.1515    -4.0909    -3.0303    -1.9697    -0.90909    0.15152     1.2121     2.2727     3.3333     4.3939     5.4545     6.5152     7.5758     8.6364       9.697     10.758     11.818     12.879     13.939         15
     -20     -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63     -20      -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63     -20      -19.292    -18.584    -17.877    -17.169    -16.461    -15.753    -15.046    -14.338      -13.63    -13.327    -12.922     -12.214    -11.507    -10.799     -10.091    -9.3833    -8.6756    -7.9678       -7.26    -6.5522    -5.8444    -5.1367    -4.4289    -3.7211    -3.0133    -2.3056    -1.5978      -0.89    -0.18222    0.52556     1.2333     1.9411     2.6489     3.3567
     -20     -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805     -20      -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805     -20      -19.645     -19.29    -18.935     -18.58    -18.225     -17.87    -17.515     -17.16     -16.805    -16.653    -16.451     -16.096    -15.741    -15.386     -15.031    -14.676    -14.321    -13.966     -13.611    -13.256    -12.901    -12.546    -12.191    -11.836    -11.481    -11.126    -10.771    -10.416     -10.061    -9.7065    -9.3515    -8.9966    -8.6416    -8.2867
     -20     -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -20      -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -20      -19.998    -19.996    -19.994    -19.992    -19.989    -19.987    -19.985    -19.983     -19.981     -19.98    -19.979     -19.977    -19.975    -19.972      -19.97    -19.968    -19.966    -19.964     -19.962     -19.96    -19.958    -19.955    -19.953    -19.951    -19.949    -19.947    -19.945    -19.943     -19.941    -19.938    -19.936    -19.934    -19.932     -19.93

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_a_meshk
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Variables:

    ar_a_meshk: 385&times;1 double

        Values:

            Min             -20   
            Median      -12.933   
            Max           49.93   

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_k
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     7    55

    mt_k1      mt_k2        mt_k3        mt_k4        mt_k5       mt_k6       mt_k7       mt_k8       mt_k9      mt_k10     mt_k11     mt_k12       mt_k13       mt_k14       mt_k15       mt_k16      mt_k17      mt_k18     mt_k19      mt_k20     mt_k21     mt_k22       mt_k23       mt_k24       mt_k25       mt_k26      mt_k27      mt_k28     mt_k29      mt_k30     mt_k31     mt_k32      mt_k33      mt_k34      mt_k35      mt_k36      mt_k37      mt_k38      mt_k39      mt_k40      mt_k41      mt_k42      mt_k43      mt_k44      mt_k45      mt_k46     mt_k47      mt_k48      mt_k49      mt_k50      mt_k51      mt_k52      mt_k53      mt_k54     mt_k55
    _____    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    _______    ________    ________    ________    ________    ________    ________    ________    ______

      0      0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0       0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0       0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0.02    0.021212    0.023333    0.025455    0.027576    0.029697    0.031818    0.033939    0.036061    0.038182    0.040303    0.042424    0.044545    0.046667    0.048788    0.050909    0.05303    0.055152    0.057273    0.059394    0.061515    0.063636    0.065758    0.067879      0.07
      0        0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945      0         0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945      0         0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945    3.3467      3.5495      3.9044      4.2594      4.6143      4.9693      5.3242      5.6792      6.0341      6.3891       6.744       7.099      7.4539      7.8089      8.1638      8.5188     8.8737      9.2287      9.5836      9.9386      10.294      10.648      11.003      11.358    11.713
      0        0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37      0         0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37      0         0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37    6.6733      7.0778      7.7856      8.4933      9.2011      9.9089      10.617      11.324      12.032       12.74      13.448      14.156      14.863      15.571      16.279      16.987     17.694      18.402       19.11      19.818      20.526      21.233      21.941      22.649    23.357
      0         1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455      0          1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455      0          1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455        10      10.606      11.667      12.727      13.788      14.848      15.909       16.97       18.03      19.091      20.152      21.212      22.273      23.333      24.394      25.455     26.515      27.576      28.636      29.697      30.758      31.818      32.879      33.939        35
      0         1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721      0          1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721      0          1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721    13.327      14.134      15.548      16.961      18.375      19.788      21.202      22.615      24.028      25.442      26.855      28.269      29.682      31.096      32.509      33.922     35.336      36.749      38.163      39.576       40.99      42.403      43.816       45.23    46.643
      0         1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896      0          1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896      0          1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896    16.653      17.663      19.429      21.195      22.961      24.728      26.494       28.26      30.026      31.793      33.559      35.325      37.092      38.858      40.624       42.39     44.157      45.923      47.689      49.455      51.222      52.988      54.754       56.52    58.287
      0         2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072      0          2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072      0          2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072     19.98      21.191       23.31      25.429      27.548      29.667      31.786      33.905      36.025      38.144      40.263      42.382      44.501       46.62      48.739      50.858     52.977      55.096      57.215      59.335      61.454      63.573      65.692      67.811     69.93

    mt_k1      mt_k2        mt_k3        mt_k4        mt_k5       mt_k6       mt_k7       mt_k8       mt_k9      mt_k10     mt_k11     mt_k12       mt_k13       mt_k14       mt_k15       mt_k16      mt_k17      mt_k18     mt_k19      mt_k20     mt_k21     mt_k22       mt_k23       mt_k24       mt_k25       mt_k26      mt_k27      mt_k28     mt_k29      mt_k30     mt_k31     mt_k32      mt_k33      mt_k34      mt_k35      mt_k36      mt_k37      mt_k38      mt_k39      mt_k40      mt_k41      mt_k42      mt_k43      mt_k44      mt_k45      mt_k46     mt_k47      mt_k48      mt_k49      mt_k50      mt_k51      mt_k52      mt_k53      mt_k54     mt_k55
    _____    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    _________    _________    _________    _________    ________    ________    ________    _______    ________    ______    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    ________    _______    ________    ________    ________    ________    ________    ________    ________    ______

      0      0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0       0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0       0.0021212    0.0042424    0.0063636    0.0084848    0.010606    0.012727    0.014848    0.01697    0.019091      0.02    0.021212    0.023333    0.025455    0.027576    0.029697    0.031818    0.033939    0.036061    0.038182    0.040303    0.042424    0.044545    0.046667    0.048788    0.050909    0.05303    0.055152    0.057273    0.059394    0.061515    0.063636    0.065758    0.067879      0.07
      0        0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945      0         0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945      0         0.35495       0.7099       1.0648       1.4198      1.7747      2.1297      2.4846     2.8396      3.1945    3.3467      3.5495      3.9044      4.2594      4.6143      4.9693      5.3242      5.6792      6.0341      6.3891       6.744       7.099      7.4539      7.8089      8.1638      8.5188     8.8737      9.2287      9.5836      9.9386      10.294      10.648      11.003      11.358    11.713
      0        0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37      0         0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37      0         0.70778       1.4156       2.1233       2.8311      3.5389      4.2467      4.9544     5.6622        6.37    6.6733      7.0778      7.7856      8.4933      9.2011      9.9089      10.617      11.324      12.032       12.74      13.448      14.156      14.863      15.571      16.279      16.987     17.694      18.402       19.11      19.818      20.526      21.233      21.941      22.649    23.357
      0         1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455      0          1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455      0          1.0606       2.1212       3.1818       4.2424       5.303      6.3636      7.4242     8.4848      9.5455        10      10.606      11.667      12.727      13.788      14.848      15.909       16.97       18.03      19.091      20.152      21.212      22.273      23.333      24.394      25.455     26.515      27.576      28.636      29.697      30.758      31.818      32.879      33.939        35
      0         1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721      0          1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721      0          1.4134       2.8269       4.2403       5.6537      7.0672      8.4806       9.894     11.307      12.721    13.327      14.134      15.548      16.961      18.375      19.788      21.202      22.615      24.028      25.442      26.855      28.269      29.682      31.096      32.509      33.922     35.336      36.749      38.163      39.576       40.99      42.403      43.816       45.23    46.643
      0         1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896      0          1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896      0          1.7663       3.5325       5.2988       7.0651      8.8313      10.598      12.364      14.13      15.896    16.653      17.663      19.429      21.195      22.961      24.728      26.494       28.26      30.026      31.793      33.559      35.325      37.092      38.858      40.624       42.39     44.157      45.923      47.689      49.455      51.222      52.988      54.754       56.52    58.287
      0         2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072      0          2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072      0          2.1191       4.2382       6.3573       8.4764      10.595      12.715      14.834     16.953      19.072     19.98      21.191       23.31      25.429      27.548      29.667      31.786      33.905      36.025      38.144      40.263      42.382      44.501       46.62      48.739      50.858     52.977      55.096      57.215      59.335      61.454      63.573      65.692      67.811     69.93

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
ar_k_mesha
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx

Variables:

    ar_k_mesha: 385&times;1 double

        Values:

            Min               0   
            Median       7.0672   
            Max           69.93   

pos = 1 ; key = f_coh ; val = @(z,b_with_r,k)(f_prod(z,k)+k*(1-fl_delta)+fl_w+b_with_r)
pos = 2 ; key = f_cons ; val = @(coh,bprime,kprime)(coh-kprime-bprime)
pos = 3 ; key = f_inc ; val = @(z,k,fl_r_inf,ar_for_borr,ar_inf_borr,ar_for_save)(f_prod(z,k)-(fl_delta)*k+fl_w+(ar_for_borr.*(fl_r_fbr)+ar_inf_borr.*(fl_r_inf)+ar_for_save.*(fl_r_fsv)))
pos = 4 ; key = f_prod ; val = @(z,k)((fl_Amean.*(z)).*(k.^(fl_alpha)))
pos = 5 ; key = f_util_crra ; val = @(c)(((c).^(1-fl_crra)-1)./(1-fl_crra))
pos = 6 ; key = f_util_log ; val = @(c)log(c)
pos = 7 ; key = f_util_standin ; val = @(z,b,k)f_util_log((f_coh(z,b,k)-fl_b_bd).*((f_coh(z,b,k)-fl_b_bd)&gt;fl_c_min)+fl_c_min.*((f_coh(z,b,k)-fl_b_bd)&lt;=fl_c_min))
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 27
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Generate States, Choices and Shocks Grids and Get Functions (Interpolated + Percentage + Risky + Safe Asset + FIBS)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function [armt_map, func_map] = ffs_ipwkbz_fibs_get_funcgrid(varargin)
%% FFS_IPWKBZ_FIBS_GET_FUNCGRID get funcs, params, states choices shocks grids
% This file is based on
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html
% ffs_ipwkbz_get_funcgrid>, see that file for more comments and compare
% differences in graphs and tables to see how the inclusion of formal and
% informal choices that consider bridge loans impact choice sets.
%
% Also compare against
% <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_paramfunc/html/ffs_abz_fibs_get_funcgrid.html
% ffs_abz_fibs_get_funcgrid> where the results are also considering formal
% and informal choices etc in the context of *abz fibs*.
%
% In contrast to ff_ipwkbz_evf.m, here, we need to deal with borrowing and
% savings formal and informal. These will change how the testing matrix is
% constructed. When bridge loan is allowed, we also need to construct the
% output matrixes differently. In ff_ipwkbz_evf.m, the assumption is that
% coh today does not matter, so to find optimal k* choice, we only need to
% know the aggregate savings level. But now, we need to know the coh level
% as well.
%
% Below two reachable coh matrixes are constructed, one for when aggregate
% savings choice w >= 0, and another for when aggregate savings <= 0. Then
% they are stacked together. And we still have the same outputs as
% ff_ipwkbz_evf.m. The difference is that while for savings where w >=0,
% each row are w levels for the output matrixes, but for w <=0, each row is
% for w level + coh percentage combinations.
%
% * _ar_w_level_: What are the feasible grid of w = k'+b', these are to be interpolated
% later, these are level grid, not percentage grid
% * _ar_w_level_: What are the percentage based choices points for k' and
% b' given each w. These are _ar_a_meshk_, _ar_k_mesha_. Note here these
% are principles, k + b' is the total aggregate savings in period t. b is
% be a combination of formal and informal choices, but our percentage point
% for b is the overall principle of all formal and informal choices
% * _mt_coh_wkb_full_ : These are the cash-on-hand levels reacheable given
% the choice percentages of k and b'. The problem here is more complicated
% than
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html
% ffs_ipwkbz_get_funcgrid> because here we can not get to coh tomorrow by
% multiplying principle by savings or borrowing interest rates, if
% borrowing, we have to optimize among formal and informal choices. That is
% computationally trivial because it's a static choice unrelated to the
% dynamic problem. The slightly more complicated thing is that we also have
% to consider percentages of b' that has to go to bridge loans due to
% negative cash-on-hand in period t. That makes the reachable cash-on-hand
% grid significantly larger than the grid in
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html
% ffs_ipwkbz_get_funcgrid>, we have to expand the grid by another
% percentage dimensionREPLACE_WITH_DASH_DASHpercentages of b' going to bridgeREPLACE_WITH_DASH_DASHfor negative
% levels of w=k'+b' overall choice.
%

%% Default
% Results identical to
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_get_funcgrid.html
% ffs_ipwkbz_get_funcgrid> is obtained by running default with:
% st_param_which = 'ffs_ipwkbz_get_funcgrid';
%

bl_input_override = 0;
if (length(varargin) == 3)
    bl_input_override = varargin{3};
end
if (bl_input_override)
    % override when called from outside
    [param_map, support_map, ~] = varargin{:};
else
    % default internal run
    [param_map, support_map] = ffs_ipwkbz_fibs_set_default_param();
    support_map('bl_graph_funcgrids') = true;
    support_map('bl_graph_funcgrids_detail') = true;
    support_map('bl_display_funcgrids') = true;

    st_param_which = 'small';

    if (ismember(st_param_which, ['default', 'ffs_ipwkbz_get_funcgrid']))

        % to be able to visually see choice grid points
        param_map('fl_b_bd') = -20; % borrow bound, = 0 if save only
        param_map('fl_default_aprime') = 0;
        param_map('bl_default') = 0; % if borrowing is default allowed

        param_map('fl_w_min') = param_map('fl_b_bd');
        param_map('it_w_perc_n') = 25;
        param_map('it_ak_perc_n') = 45;

        param_map('fl_w_interp_grid_gap') = 2;
        param_map('fl_coh_interp_grid_gap') = 2;
        
        % Note it_coh_bridge_perc is percentage NOT for BRIDGE
        if (strcmp(st_param_which, 'default'))
            
            param_map('it_coh_bridge_perc_n') = 3;

            % Adjust interest rates
            param_map('fl_r_inf') = 0.30;
            param_map('fl_r_inf_bridge') = 0.30;
            param_map('bl_bridge') = true;

        elseif (strcmp(st_param_which, 'ffs_ipwkbz_get_funcgrid'))


            param_map('fl_r_inf') = 0.025;
            param_map('fl_r_inf_bridge') = 0.025;
            param_map('bl_bridge') = false;
            % when bl_bridge = false, it_coh_bridge_perc_n = 1

        end

    elseif (strcmp(st_param_which, 'small'))

        param_map('bl_bridge') = true;

        % Adjust interest rates
        param_map('fl_r_inf') = 0.30;
        param_map('fl_r_inf_bridge') = 0.30;

        % to be able to visually see choice grid points
        param_map('fl_b_bd') = -20; % borrow bound, = 0 if save only
        param_map('fl_default_aprime') = 0;
        param_map('bl_default') = false; % if borrowing is default allowed

        param_map('fl_w_min') = param_map('fl_b_bd');
        param_map('it_w_perc_n') = 7;
        param_map('it_ak_perc_n') = 7;
        param_map('it_coh_bridge_perc_n') = 3;

        param_map('fl_w_interp_grid_gap') = 2;
        param_map('fl_coh_interp_grid_gap') = 2;

    end


    default_maps = {param_map, support_map};

    % numvarargs is the number of varagin inputted
    [default_maps{1:length(varargin)}] = varargin{:};
    param_map = [param_map; default_maps{1}];
    support_map = [support_map; default_maps{2}];
end

%% Parse Parameters

params_group = values(param_map, {'it_z_n', 'fl_z_mu', 'fl_z_rho', 'fl_z_sig'});
[it_z_n, fl_z_mu, fl_z_rho, fl_z_sig] = params_group{:};

params_group = values(param_map, {'fl_nan_replace', 'fl_b_bd', 'fl_w_min', 'fl_w_max', ...
    'it_w_perc_n', 'fl_w_interp_grid_gap', 'fl_coh_interp_grid_gap'});
[fl_nan_replace, fl_b_bd, fl_w_min, fl_w_max, ...
    it_w_perc_n, fl_w_interp_grid_gap, fl_coh_interp_grid_gap] = params_group{:};

params_group = values(param_map, {'fl_k_min', 'fl_k_max', 'it_ak_perc_n'});
[fl_k_min, fl_k_max, it_ak_perc_n] = params_group{:};

params_group = values(param_map, {'fl_crra', 'fl_c_min', 'it_c_interp_grid_gap'});
[fl_crra, fl_c_min, it_c_interp_grid_gap] = params_group{:};

params_group = values(param_map, {'fl_Amean', 'fl_alpha', 'fl_delta'});
[fl_Amean, fl_alpha, fl_delta] = params_group{:};

params_group = values(param_map, {'bl_bridge', 'it_coh_bridge_perc_n'});
[bl_bridge, it_coh_bridge_perc_n] = params_group{:};

params_group = values(param_map, {'bl_b_is_principle', 'fl_r_fbr', 'fl_r_fsv', 'fl_r_inf', 'fl_w'});
[bl_b_is_principle, fl_r_fbr, fl_r_fsv, fl_r_inf, fl_w] = params_group{:};

params_group = values(param_map, {'st_forbrblk_type', 'fl_forbrblk_brmost', 'fl_forbrblk_brleast', 'fl_forbrblk_gap'});
[st_forbrblk_type, fl_forbrblk_brmost, fl_forbrblk_brleast, fl_forbrblk_gap] = params_group{:};

params_group = values(support_map, {'bl_display_minccost', 'bl_graph_funcgrids', 'bl_graph_funcgrids_detail', 'bl_display_funcgrids'});
[bl_display_minccost, bl_graph_funcgrids, bl_graph_funcgrids_detail, bl_display_funcgrids] = params_group{:};

%% G1: Generate Asset and Choice Grid for 2nd stage Problem
% This generate triangular choice structure. Household choose total
% aggregate savings, and within that how much to put into risky capital and
% how much to put into safe assets, in percentages. See
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_fibs_set_default_param.html
% ffs_ipwkbz_fibs_set_default_param> for details.
%
% @example
%
%    % For 2nd stage Grid
%    ar_w_level = [-2,0,2]
%    fl_b_bd = -4
%    ar_k_max = ar_w_level - fl_b_bd
%    ar_ak_perc = [0.001, 0.1,0.3,0.7,0.9, 0.999]
%    mt_k = (ar_k_max'*ar_ak_perc)'
%    mt_a = (ar_w_level - mt_k)
%

% percentage grid for 1st stage choice problem, level grid for 2nd stage
% solving optimal k given w and z.
ar_w_perc = linspace(0.001, 0.999, it_w_perc_n);
it_w_interp_n = (fl_w_max-fl_w_min)/(fl_w_interp_grid_gap);
ar_w_level_full = fft_array_add_zero(linspace(fl_w_min, fl_w_max, it_w_interp_n), true);
ar_w_level = ar_w_level_full;

% max k given w, need to consider the possibility of borrowing.
ar_k_max = ar_w_level_full - fl_b_bd;

% k percentage choice grid
ar_ak_perc = linspace(0.001, 0.999, it_ak_perc_n);

% 2nd stage percentage choice matrixes
% (ar_k_max') is it_w_interp_n by 1, and (ar_ak_perc) is 1 by it_ak_perc_n
% mt_k is a it_w_interp_n by it_ak_perc_n matrix of choice points of k'
% conditional on w, each column is a different w, each row for each col a
% different k' value.
mt_k = (ar_k_max'*ar_ak_perc)';
mt_a = (ar_w_level_full - mt_k);

% can not have choice that are beyond feasible bound given the percentage
% structure here.
mt_bl_constrained = (mt_a < fl_b_bd);
if (sum(mt_bl_constrained) > 0 )
    error('at %s second stage choice points, percentage choice exceed bounds, can not happen',...
        num2str(sum(mt_bl_constrained)));
end

%% G2: Expand A and K Arrays further if bridge is allowed
% Crucially, when a fraction of overall borrowing/savings needs to go pay
% negative coh, that comes out of w, fraction of w = k' + b' that goes to
% this. NOT a fraction of the b' choice condition on w, which would change
% for the same w as w' changes. We are fixing bridge repay level for w.
%
% @example
%
%    clear all
%    % Same as above
%    ar_w_level = [-2,-1,-0.1]
%    fl_b_bd = -4
%    ar_k_max = ar_w_level - fl_b_bd
%    ar_ak_perc = [0.001, 0.1,0.3,0.7,0.9, 0.999]
%    mt_k = (ar_k_max'*ar_ak_perc)'
%    mt_a = (ar_w_level - mt_k)
%
%    % fraction of borrowing for bridge loan
%    ar_coh_bridge_perc = [0, 0.5, 0.999];
%
%    % Expand matrix to include coh percentage dimension
%    mt_k = repmat(mt_k, [1, length(ar_coh_bridge_perc)])
%    mt_a = repmat(mt_a, [1, length(ar_coh_bridge_perc)])
%
%    % bridge loan component of borrowing
%    ar_brdige_a = (ar_coh_bridge_perc'*ar_w_level)'
%    ar_brdige_a = ar_brdige_a(:)'
%
%    % borrowing choices excluding bridge loan
%    mt_a_nobridge = mt_a - ar_brdige_a
%

% 1. negative part of w
ar_bl_w_neg = (ar_w_level < 0);
ar_w_level_neg = ar_w_level(ar_bl_w_neg);

if (bl_bridge)

    % 1. select mt_k and mt_a where w_level <= 0
    mt_a_wneg_cols = mt_a(:, ar_bl_w_neg);
    mt_k_wneg_cols = mt_k(:, ar_bl_w_neg);

    % 2. fraction of borrowing NOT for bridge loan
    % 0 means 100 percent of w will go to bridge, 1 mean nothing for bridge
    ar_coh_bridge_perc = linspace(0, 1.0, it_coh_bridge_perc_n);

    % 3. Expand matrix to include coh percentage dimension
    mt_k_wneg_cols = repmat(mt_k_wneg_cols, [1, length(ar_coh_bridge_perc)]);
    mt_a_wneg_cols = repmat(mt_a_wneg_cols, [1, length(ar_coh_bridge_perc)]);

    % 4. bridge loan component of borrowing
    ar_brdige_a = ((1-ar_coh_bridge_perc)'*ar_w_level_neg)';
    ar_brdige_a = ar_brdige_a(:)';

    % 5. borrowing choices excluding bridge loan
    mt_a_wneg_nobridge = mt_a_wneg_cols - ar_brdige_a;

    % 6. Matrix combine, negative than positive
    mt_a_wpos_cols = mt_a(:, ~ar_bl_w_neg);
    mt_k_wpos_cols = mt_k(:, ~ar_bl_w_neg);
    mt_a_nobridge = [mt_a_wneg_nobridge  mt_a_wpos_cols];
    mt_k = [mt_k_wneg_cols                mt_k_wpos_cols];

    % 7. Expand Bridge Choices to have the same size as mt_a
    mt_bridge_a= zeros(size(mt_a_nobridge));
    mt_bridge_a(:, 1:1:size(mt_a_wneg_nobridge,2)) = zeros(size(mt_a_wneg_nobridge)) + ar_brdige_a;

    % 8. Overall borrowing and savings choices
    mt_a = mt_a_nobridge + mt_bridge_a;

    % 9. Update w
    ar_w_level_full = zeros(size(mt_a_nobridge(1,:)));
    ar_w_level_neg_rep = repmat(ar_w_level_neg, [1, length(ar_coh_bridge_perc)]);
    ar_w_level_full(1:1:size(mt_a_wneg_nobridge,2)) = ar_w_level_neg_rep;
    ar_w_level_full((size(mt_a_wneg_nobridge,2)+1):1:length(ar_w_level_full)) = ar_w_level(~ar_bl_w_neg);
    
    % 10. Pre-generate Interpolation matrix for negative w levels
    [mt_w_level_neg_mesh_coh_bridge_perc, mt_coh_bridge_perc_mesh_w_level_neg] = ...
        ndgrid(ar_w_level_neg, ar_coh_bridge_perc);
    
else

    % If bridge loans are not needed, do not need to do expansions
    % All zeros, no bridge
    mt_bridge_a = zeros(size(mt_a));
    mt_a_nobridge = mt_a;
    ar_coh_bridge_perc = [1];

    [mt_w_level_neg_mesh_coh_bridge_perc, mt_coh_bridge_perc_mesh_w_level_neg] = ...
        ndgrid(ar_w_level_neg, ar_coh_bridge_perc);
    
end

%% G3: Flatten Choices to Arrays to be Combined with Shocks as Columns.
% For the arrays below, their dimensionality are all: N_neg*N^2 + N_pos*N
% number of rows. Where N is the percentage grid point for coh as well as
% k' choices: N = it_ak_perc_n = it_coh_bridge_perc_n; And N_neg + N_pos =
% numger of grid points for ar_w_level
%
% # *mt_a* includes aggregate/total borrowing and savings levels. b < 0 happens
% alot when w >= 0. The mt_a_nobridge
% # *mt_a_nobridge* includes all aggregate/total borrowing and savings
% whether w > 0 or w < 0, however, it subtracts away the borrowing that is
% for bridge loans when b < 0
% # *mt_bridge_a* is the bridge loan amount.
%

ar_a_meshk_full = mt_a(:);
ar_a_nobridge_meshk_full = mt_a_nobridge(:);
ar_k_mesha_full = mt_k(:);
ar_bridge_a_full = mt_bridge_a(:);

ar_a_meshk = ar_a_meshk_full;
ar_a_nobridge_meshk = ar_a_nobridge_meshk_full;
ar_k_mesha = ar_k_mesha_full;
ar_bridge_a = ar_bridge_a_full;

%% F1: Get Shock Grids

[~, mt_z_trans, ar_stationary, ar_z] = ffto_gen_tauchen_jhl(fl_z_mu,fl_z_rho,fl_z_sig,it_z_n);

%% FIBS1: Get Equations

[f_util_log, f_util_crra, f_util_standin, f_prod, f_inc, f_coh, f_coh_fbis, f_coh_save, f_cons] = ...
    ffs_ipwkbz_fibs_set_functions(fl_crra, fl_c_min, fl_b_bd, fl_Amean, fl_alpha, fl_delta, fl_w, fl_r_fbr, fl_r_fsv);

%% FIBS2: Get Formal Borrowing Blocks

[ar_forbrblk, ar_forbrblk_r] = ...
        ffs_for_br_block_gen(fl_r_fbr, st_forbrblk_type, fl_forbrblk_brmost, fl_forbrblk_brleast, fl_forbrblk_gap);

%% Find Formal and Informal Choices for Borrowing points
% Here we solve for the optimal formal and informal choices given b. Note
% that kind of like the static firm's maximization problem. Here the
% optimization problem is static, and can be done independently of the
% overall dynamic optimization problem.

% When borrowing index and array
% note index for negative is from _ar_a_meshk_full_, but value from
% _ar_a_nobridge_meshk_. Index from _ar_a_meshk_full_, which means at some
% of these points _ar_a_nobridge_meshk_ = 0. But need to use
% _ar_bl_ameshk_neg_idx_ because *f_coh_fbis* function below applies to all
% borrowing.
ar_bl_ameshk_neg_idx = (ar_a_meshk_full < 0);
ar_a_meshk_nobridge_aneg = ar_a_nobridge_meshk(ar_bl_ameshk_neg_idx);

% Given b, solve for optimal formal and informal choices.
bl_input_override = true;
[~, ar_inf_borr_nobridge_aneg, ar_for_borr_aneg, ar_for_save_aneg] = ...
   ffs_fibs_min_c_cost(bl_b_is_principle, fl_r_inf, fl_r_fsv, ...
                         ar_forbrblk_r, ar_forbrblk, ...
                         ar_a_meshk_nobridge_aneg, bl_display_minccost, bl_input_override);

%% FIBS3: Generate C cost Matrix when aggregate savings = k'+b' is negative
% *ar_coh_fbis_aneg*: the consumption cost to t+1 from borrowing in t given
% formal and informal joint choice optimization.
%
% Reachable cash-on-hand borrowing points: N_neg*N^2 rows
%
% Additionally, need to convert borrowing choices to consumption units next
% period. borrowing choices in percentage are in unit of last period
% borrowing, principles only, need to convert to interest rates plus
% principle which means considering which formal informal choice
% combination maximizes cash-on-hand for the same level of overall
% principles.
%
% Construct another percentage, which is, percentages of ar_a_meshk_full
% when w < 0. Percentage represents what fraction of the a debt is going
% towards bridge loan debts. Note that as long as w < 0, b < 0 must be the
% case as well. So for negative elements of w, there is a triple mesh: N
% points for A x N points for K x N points for Bridge.
%

ar_coh_fbis_aneg = f_coh_fbis(fl_r_inf, ...
                                ar_for_borr_aneg, ...
                                ar_inf_borr_nobridge_aneg + ar_bridge_a(ar_bl_ameshk_neg_idx), ...
                                ar_for_save_aneg);

%% FIBS3: Generate C cost Cash-on-Hand/State Matrix when aggregate savings is positive
% *ar_coh_save_apos*: the consumption gain to t+1 from savings in t

ar_a_meshk_apos = ar_a_meshk(~ar_bl_ameshk_neg_idx);
ar_coh_save_apos = f_coh_save(ar_a_meshk_apos);

%% COH1: Combine overall Reachable Cash-on-Hand Levels
% N_neg*N^2 + N_pos*N rows total row count, and N_z shock column count.
% These are the cash-on-hand points reachable given percentage grid choice
% structure and the possibility of bridge loans.

ar_ameshk_tnext_with_r = zeros(size(ar_k_mesha));
ar_ameshk_tnext_with_r(ar_bl_ameshk_neg_idx) = ar_coh_fbis_aneg;
ar_ameshk_tnext_with_r(~ar_bl_ameshk_neg_idx) = ar_coh_save_apos;

mt_coh_wkb_full = f_coh(ar_z, ar_ameshk_tnext_with_r, ar_k_mesha);

if (bl_display_funcgrids)

    % Generate Aggregate Variables
    ar_aplusk_mesha = ar_a_meshk + ar_k_mesha;
    ar_bwithrplusk_mesha = ar_ameshk_tnext_with_r + ar_k_mesha;

    % Genereate Table
    tab_ak_choices = array2table([ar_bwithrplusk_mesha, ar_aplusk_mesha, ...
        ar_k_mesha, ar_ameshk_tnext_with_r, ar_a_meshk, ar_a_nobridge_meshk, ar_bridge_a]);
    cl_col_names = {'ar_bwithrplusk_mesha', 'ar_aplusk_mesha', ...
        'ar_k_mesha', 'ar_ameshk_tnext_with_r', 'ar_a_meshk', 'ar_a_nobridge_meshk', 'ar_bridge_a'};
    tab_ak_choices.Properties.VariableNames = cl_col_names;

    % Label Table Variables
    tab_ak_choices.Properties.VariableDescriptions{'ar_bwithrplusk_mesha'} = ...
        '*ar_bwithrplusk_mesha*: ';
    tab_ak_choices.Properties.VariableDescriptions{'ar_aplusk_mesha'} = ...
        '*ar_aplusk_mesha*:';
    tab_ak_choices.Properties.VariableDescriptions{'ar_k_mesha'} = ...
        '*ar_k_mesha*:';
    tab_ak_choices.Properties.VariableDescriptions{'ar_ameshk_tnext_with_r'} = ...
        '*ar_ameshk_tnext_with_r*:';
    tab_ak_choices.Properties.VariableDescriptions{'ar_a_meshk'} = ...
        '*ar_a_meshk*:';
    tab_ak_choices.Properties.VariableDescriptions{'ar_a_nobridge_meshk'} = ...
        '*ar_aprime_nobridge*:';
    tab_ak_choices.Properties.VariableDescriptions{'ar_bridge_a'} = ...
        '*ar_bridge_a*:';

    cl_var_desc = tab_ak_choices.Properties.VariableDescriptions;
    for it_var_name = 1:length(cl_var_desc)
        disp(cl_var_desc{it_var_name});
    end

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('tab_ak_choices');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    it_rows_toshow = length(ar_w_level)*2;
    disp(size(tab_ak_choices));
    disp(head(array2table(tab_ak_choices), it_rows_toshow));
    disp(tail(array2table(tab_ak_choices), it_rows_toshow));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_coh_wkb_full');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_coh_wkb_full));
    disp(head(array2table(mt_coh_wkb_full), it_rows_toshow));
    disp(tail(array2table(mt_coh_wkb_full), it_rows_toshow));

end

%% COH2: Check if COH is within Borrowing Bounds
% some coh levels are below borrowing bound, can not borrow enough to pay
% debt

mt_bl_coh_wkb_invalid = (mt_coh_wkb_full < fl_b_bd);

% (k,a) invalid if coh(k,a,z) < bd for any z
ar_bl_wkb_invalid = max(mt_bl_coh_wkb_invalid,[], 2);
mt_bl_wkb_invalid = reshape(ar_bl_wkb_invalid, size(mt_a));

% find the first w_level choice where some k(w) percent choices are valid?
ar_bl_w_level_invalid =  min(mt_bl_wkb_invalid, [], 1);

% w choices can not be lower than fl_w_level_min_valid. If w choices are
% lower, given the current borrowing interest rate as well as the minimum
% income level in the future, and the maximum borrowing level available
% next period, and given the shock distribution, there exists some state in
% the future when the household when making this choice will be unable to
% borrow sufficiently to maintain positive consumption.
fl_w_level_min_valid = min(ar_w_level_full(~ar_bl_w_level_invalid));

%% COH3: Update Valid 2nd stage choice matrix
% ar_w_level = linspace(fl_w_level_min_valid, fl_w_max, it_w_interp_n);
% ar_k_max = ar_w_level - fl_b_bd;
% mt_k = (ar_k_max'*ar_ak_perc)';
% mt_a = (ar_w_level - mt_k);
% ar_a_meshk = mt_a(:);
% ar_k_mesha = mt_k(:);

%% COH4: Select only Valid (k(w), a) choices

% mt_coh_wkb = mt_coh_wkb_full(~ar_bl_wkb_invalid, :);
mt_coh_wkb = mt_coh_wkb_full;
mt_z_mesh_coh_wkb = repmat(ar_z, [size(mt_coh_wkb,1),1]);

%% Generate 1st Stage States: Interpolation Cash-on-hand Interpolation Grid
% For the iwkz problems, we solve the problem along a grid of cash-on-hand
% values, the interpolate to find v(k',b',z) at (k',b') choices. Crucially,
% we have to coh matrxies

fl_max_mt_coh = max(max(mt_coh_wkb));

% This is savings only condition
% fl_min_mt_coh = min(min(mt_coh_wkb));

% This could be condition if no defaults are allowed
% fl_min_mt_coh = fl_w_level_min_valid;

% This is borrowing with default or not condition
fl_min_mt_coh = fl_b_bd;

it_coh_interp_n = (fl_max_mt_coh-fl_min_mt_coh)/(fl_coh_interp_grid_gap);
ar_interp_coh_grid = fft_array_add_zero(linspace(fl_min_mt_coh, fl_max_mt_coh, it_coh_interp_n), true);
[mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid] = ndgrid(ar_interp_coh_grid, ar_z);
mt_interp_coh_grid_mesh_w_perc = repmat(ar_interp_coh_grid, [it_w_perc_n, 1]);

%% Generate 1st Stage Choices: Interpolation Cash-on-hand Interpolation Grid
% previously, our ar_w was the first stage choice grid, the grid was the
% same for all coh levels. Now, for each coh level, there is a different
% ar_w. ar_interp_coh_grid is (1 by ar_interp_coh_grid) and ar_w_perc is (
% 1 by it_w_perc_n). Conditional on z, each choice matrix is (it_w_perc_n
% by ar_interp_coh_grid). Here we are pre-computing the choice matrix. This
% could be a large matrix if the choice grid is large. This is the matrix
% of aggregate savings choices
%

% 1. Given COH grid, w choices in terms of cash-on-hand percentages
if (fl_min_mt_coh < 0)
    % borrowing bound is below zero
    mt_w_by_interp_coh_interp_grid = ((ar_interp_coh_grid-fl_min_mt_coh)'*ar_w_perc)' + fl_min_mt_coh;
else
    % savings only
    mt_w_by_interp_coh_interp_grid = ((ar_interp_coh_grid)'*ar_w_perc)';
end

% 2. Some w < 0, some w > 0. When w < 0, coh > 0 or coh < 0 both possible.
% Need to interplate in ff_ipwkbz_fibs_vecsv differently for w < 0 because
% there both w as well as coh matters, if coh < 0 and w < 0, a fraction of
% w goes to getting informal bridge loans.
mt_bl_w_by_interp_coh_interp_grid_wneg = (mt_w_by_interp_coh_interp_grid < 0);
mt_w_by_interp_coh_interp_grid_wneg = mt_w_by_interp_coh_interp_grid(mt_bl_w_by_interp_coh_interp_grid_wneg);
mt_w_by_interp_coh_interp_grid_wpos = mt_w_by_interp_coh_interp_grid(~mt_bl_w_by_interp_coh_interp_grid_wneg);

%% Generate 1st Stage Choices: Percent of W for Covering Bridge Loans
% If bridge loan does not matter, do not need to cover bridge loan. Then
% these percentages should reflect what happens when param_map('bl_bridge')
% = false, and, param_map('it_coh_bridge_perc_n') = 1;

% 1. Expand cash-on-hand by w_perc grid
mt_interp_coh_grid_mesh_w_perc = zeros(size(mt_w_by_interp_coh_interp_grid)) + ar_interp_coh_grid;

% 2. How much is coh as perc of w_perc grid level choice based on w_perc
mt_coh_w_perc_ratio = (1-(mt_interp_coh_grid_mesh_w_perc./mt_w_by_interp_coh_interp_grid));

% 3. The ratio only relevant for where w < 0 and where coh < 0. Note the
% ratio we want is: ar_coh_bridge_perc, which is percent of w NOT going to
% bridge.
mt_coh_w_perc_ratio(mt_interp_coh_grid_mesh_w_perc >= 0) = 1;
mt_coh_w_perc_ratio_wneg = mt_coh_w_perc_ratio(mt_bl_w_by_interp_coh_interp_grid_wneg);

%% Generate Interpolation Consumption Grid
% We also interpolate over consumption to speed the program up. We only
% solve for u(c) at this grid for the iwkz problmes, and then interpolate
% other c values.

fl_c_max = max(max(mt_coh_wkb_full)) - fl_b_bd;
it_interp_c_grid_n = (fl_c_max-fl_c_min)/(it_c_interp_grid_gap);
ar_interp_c_grid = linspace(fl_c_min, fl_c_max, it_interp_c_grid_n);

%% Initialize armt_map to store, state, choice, shock matrixes

armt_map = containers.Map('KeyType','char', 'ValueType','any');
armtdesc_map = containers.Map('KeyType','char', 'ValueType','any');

%% Store armt_map (1): 2nd Stage Problem Arrays and Matrixes
% ar_a_meshk is t: b
% ar_ameshk_tnext_with_r is t+1: b*(1+r) with for inf
% ar_coh_bridge_perc: this is percentage of w NOT for bridge loan

armt_map('ar_coh_bridge_perc') = ar_coh_bridge_perc;
armt_map('ar_ak_perc') = ar_ak_perc;
armt_map('mt_k') = mt_k;
armt_map('ar_a_meshk') = ar_a_meshk;
armt_map('ar_ameshk_tnext_with_r') = ar_ameshk_tnext_with_r;
armt_map('ar_k_mesha') = ar_k_mesha;
armt_map('it_ameshk_n') = length(ar_a_meshk);
armt_map('mt_coh_wkb') = mt_coh_wkb_full;
armt_map('mt_z_mesh_coh_wkb') = mt_z_mesh_coh_wkb;

%% Store armt_map (2): First Stage Aggregate Savings
% w = k' + b', w is aggregate Savings
%
% # *ar_w_perc* 1st stage, percentage w choice given coh, at each coh level
% the number of choice points is the same for this problem with percentage
% grid points.
% # *ar_w_level* 2nd stage, level of w over which we solve the optimal
% percentage k' choices. Need to generate interpolant based on this so that
% we know optimal k* given ar_w_perc(coh) in the 1st stage
% # *ar_w_level_full*: in
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/solve/html/ff_ipwkbz_vf_vecsv.html
% ff_ipwkbz_vf_vecsv>, _ar_w_level_ and _ar_w_level_full_ were the same.
% Now have this thing which is stored (length(ar_w_level_full)) by
% (length(ar_z)). _ar_w_level_full_ includes not just different levels of
% _ar_w_level_, but also repeats the elements of _ar_w_level_ that are < 0
% by _it_coh_bridge_perc_n_ times, starting with what corresponds to 100
% percent of w should go to cover bridge loan, until 0 percent for w < 0,
% which then proceeds to w > 0. So the last segment of _ar_w_level_full_ is
% the same as ar_w_level: ar_w_level_full((end-length(ar_w_level)+1):end) =
% ar_w_level.
% # *mt_w_by_interp_coh_interp_grid* 1st stage, generate w(coh, percent),
% meaning the level of w given coh and the percentage grid of ar_w_perc.
% Mesh this with the coh grid, Rows here correspond to percentage of w
% choices, columns correspond to cash-on-hand. The columns of cash-on-hand
% is determined by ar_interp_coh_grid, because we solve the 1st stage
% problem at that coh grid.
%

armt_map('ar_w_perc') = ar_w_perc;
armt_map('ar_w_level') = ar_w_level;
armt_map('ar_w_level_full') = ar_w_level_full;

armt_map('mt_w_level_neg_mesh_coh_bridge_perc') = mt_w_level_neg_mesh_coh_bridge_perc;
armt_map('mt_coh_bridge_perc_mesh_w_level_neg') = mt_coh_bridge_perc_mesh_w_level_neg;

armt_map('mt_w_by_interp_coh_interp_grid') = mt_w_by_interp_coh_interp_grid;
armt_map('mt_interp_coh_grid_mesh_w_perc') = mt_interp_coh_grid_mesh_w_perc;

armt_map('mt_bl_w_by_interp_coh_interp_grid_wneg') = mt_bl_w_by_interp_coh_interp_grid_wneg;
armt_map('mt_w_by_interp_coh_interp_grid_wneg') = mt_w_by_interp_coh_interp_grid_wneg;
armt_map('mt_w_by_interp_coh_interp_grid_wpos') = mt_w_by_interp_coh_interp_grid_wpos;
armt_map('mt_coh_w_perc_ratio_wneg') = mt_coh_w_perc_ratio_wneg;

%% Store armt_map (3): First Stage Consumption and Cash-on-Hand Grids

armt_map('ar_interp_c_grid') = ar_interp_c_grid;
armt_map('ar_interp_coh_grid') = ar_interp_coh_grid;
armt_map('mt_interp_coh_grid_mesh_z') = mt_interp_coh_grid_mesh_z;
armt_map('mt_z_mesh_coh_interp_grid') = mt_z_mesh_coh_interp_grid;

%% Store armt_map (4): Shock Grids
armt_map('mt_z_trans') = mt_z_trans;
armt_map('ar_stationary') = ar_stationary;
armt_map('ar_z') = ar_z;

%% Store Function Map
func_map = containers.Map('KeyType','char', 'ValueType','any');
func_map('f_util_log') = f_util_log;
func_map('f_util_crra') = f_util_crra;
func_map('f_util_standin') = f_util_standin;
func_map('f_prod') = f_prod;
func_map('f_inc') = f_inc;
func_map('f_coh') = f_coh;
func_map('f_cons') = f_cons;

%% Graph

if (bl_graph_funcgrids)

    %% Graph 1: a and k choice grid graphs
    % compare the figure here to the same figure in
    % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html
    % ffs_akz_get_funcgrid>. there the grid points are on an even grid,
    % half of the grid points have NA. for the grid here, the grid points
    % get denser as we get closer to low w = k'+b' levels. This is what is
    % different visually about percentage points based choice grid for the
    % 2nd stage problem.
    %
    % Plot end because earlier parts have repeating w and a levels due to
    % potentially bridge which are coh percentage dependent. This will only
    % plot out the grid basically when coh percentage for bridge loan = 0
    %

    figure('PaperPosition', [0 0 7 4]);
    hold on;

    it_col_end = size(mt_a, 2);
    it_col_start = size(mt_a, 2) - length(ar_w_level) + 1;

    chart = plot(mt_a(:,it_col_start:it_col_end), ...
                 mt_k(:,it_col_start:it_col_end), ...
                 'blue');

    clr = jet(numel(chart));
    for m = 1:numel(chart)
        set(chart(m),'Color',clr(m,:))
    end

    it_col_end = length(ar_a_meshk);
    it_col_start = length(ar_a_meshk) - length(ar_w_level)*it_ak_perc_n + 1;

%     if (length(ar_w_level_full) <= 100)
    scatter(ar_a_meshk(it_col_start:it_col_end), ...
            ar_k_mesha(it_col_start:it_col_end), ...
            3, 'filled', 'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');
%     end
    if (length(ar_w_level) <= 100)
        gf_invalid_scatter = scatter(ar_a_meshk_full(ar_bl_wkb_invalid),...
                                     ar_k_mesha_full(ar_bl_wkb_invalid),...
                20, 'O', 'MarkerEdgeColor', 'black', 'MarkerFaceColor', 'black');
    end

    xline(0);
    yline(0);

    title({'Risky K Percentage Grids Given w=k+a (2nd Stage)'...
           '(Bridge Borrow Share = 0)'})
    ylabel('Capital Choice (mt\_k)')
    xlabel({'Borrowing (<0) or Saving (>0) (mt\_a)'...
        'Each Diagonal Line a Different w=k+a level'...
        'Percentage for Risky K along Each Diagonal'})

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_w_level', 'k+a=%3.2f'));

    if (length(ar_w_level) <= 100)
        chart(length(chart)+1) = gf_invalid_scatter;
        legendCell{length(legendCell) + 1} = 'Invalid: COH(a,b,z)<bar(b) some z';
        legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), 'Location', 'northeast');
    else
        legend(chart([legend2plot]), legendCell([legend2plot]), 'Location', 'northeast');
    end

    grid on;

    %% Graph 2: coh by shock
    % compare the figure here to the same figure in
    % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html
    % ffs_akz_get_funcgrid>. there the grid points are on an even grid.
    % Visually, one could see that the blue/red line segments here are
    % always the same length, but in the ffs_akz_get_funcgrid figure, they
    % are increasingly longer as we move towards the right. They are even
    % because the number of percentage points available is constant
    % regardless of w = k' + b' levels. But previously, the number of grid
    % points available is increasing as w increases since choice grid is
    % based on levels.
    %

    figure('PaperPosition', [0 0 7 4]);
    chart = plot(0:1:(size(mt_coh_wkb_full,1)-1), mt_coh_wkb_full);
    clr = jet(numel(chart));
    for m = 1:numel(chart)
        set(chart(m),'Color',clr(m,:))
    end

    % zero lines
    xline(0);
    yline(0);

    % invalid points separating lines
    yline_borrbound = yline(fl_b_bd);
    yline_borrbound.HandleVisibility = 'on';
    yline_borrbound.LineStyle = 'REPLACE_WITH_DASH_DASH';
    yline_borrbound.Color = 'blue';
    yline_borrbound.LineWidth = 2.5;

    title('Cash-on-Hand given w(k+b),k,z');
    ylabel('Cash-on-Hand (mt\_coh\_wkb\_full)');
    xlabel({'Index of Cash-on-Hand Discrete Point (0:1:(size(mt\_coh\_wkb\_full,1)-1))'...
        'Each Segment is a w=k+b; within segment increasing k'...
        'For each w and z, coh maximizing k is different'});

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));

    legendCell{length(legendCell) + 1} = 'borrow-constraint';
    chart(length(chart)+1) = yline_borrbound;
    legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), 'Location', 'northwest');

    grid on;

    %% Graph 3: 1st State Aggregate Savings Choices by COH interpolation grids

    figure('PaperPosition', [0 0 7 4]);
    hold on;

    chart = plot(ar_interp_coh_grid, mt_w_by_interp_coh_interp_grid');

    clr = jet(numel(chart));
    for m = 1:numel(chart)
        set(chart(m),'Color',clr(m,:))
    end
    if (length(ar_interp_coh_grid) <= 100)
        [~, mt_interp_coh_grid_mesh_w_perc] = ndgrid(ar_w_perc, ar_interp_coh_grid);
        scatter(mt_interp_coh_grid_mesh_w_perc(:), mt_w_by_interp_coh_interp_grid(:), 3, 'filled', ...
            'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');
    end

    % invalid points separating lines
    yline_borrbound = yline(fl_w_level_min_valid);
    yline_borrbound.HandleVisibility = 'on';
    yline_borrbound.LineStyle = 'REPLACE_WITH_DASH_DASH';
    yline_borrbound.Color = 'red';
    yline_borrbound.LineWidth = 2.5;

    xline0 = xline(0);
    xline0.HandleVisibility = 'off';
    yline0 = yline(0);
    yline0.HandleVisibility = 'off';

    title({'Aggregate Savings Percentage Grids (1st Stage)' ...
           'y=mt\_w\_by\_interp\_coh\_interp\_grid, and, y=ar\_interp\_coh\_grid'});
    ylabel('1st Stage Aggregate Savings Choices');
    xlabel({'Cash-on-Hand Levels (Interpolation Points)'...
            'w(coh)>min-agg-save, coh(k(w),w-k)>=bar(b)'});

    legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
    legendCell = cellstr(num2str(ar_w_perc', 'ar w perc=%3.2f'));
    legendCell{length(legendCell) + 1} = 'min-agg-save';
    chart(length(chart)+1) = yline_borrbound;
    legend(chart([legend2plot length(legendCell)]), legendCell([legend2plot length(legendCell)]), 'Location', 'northwest');

    grid on;

end


%% Graph Details, Generally do Not Run
if (bl_graph_funcgrids_detail)

    %% Graph 1: 2nd stage coh reached by k' b' choices by index

    figure('PaperPosition', [0 0 7 4]);
    ar_coh_kpzgrid_unique = unique(sort(mt_coh_wkb_full(:)));
    scatter(1:length(ar_coh_kpzgrid_unique), ar_coh_kpzgrid_unique);
    xline(0);
    yline(0);
    title('Cash-on-Hand given w(k+b),k,z');
    ylabel('Cash-on-Hand (y=ar\_coh\_kpzgrid\_unique)');
    xlabel({'Index of Cash-on-Hand Discrete Point' 'x = 1:length(ar\_coh\_kpzgrid\_unique)'});
    grid on;

    %% Graph 2: 2nd stage coh reached by k' b' choices  by coh

    figure('PaperPosition', [0 0 7 4]);
    ar_coh_kpzgrid_unique = unique(sort(mt_coh_wkb_full(:)));
    scatter(ar_coh_kpzgrid_unique, ar_coh_kpzgrid_unique, '.');
    xline(0);
    yline(0);
    title('Cash-on-Hand given w(k+b),k,z; See Clearly Sparsity Density of Grid across Z');
    ylabel('Cash-on-Hand (y = ar\_coh\_kpzgrid\_unique)');
    xlabel({'Cash-on-Hand' 'x = ar\_coh\_kpzgrid\_unique'});
    grid on;
end

%% Display

if (bl_display_funcgrids)

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_z');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(ar_z));
    disp(ar_z);

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_w_level_full');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(ar_w_level_full));
    disp(ar_w_level_full);

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_w_by_interp_coh_interp_grid');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_w_by_interp_coh_interp_grid));
    disp(head(array2table(mt_w_by_interp_coh_interp_grid), 10));
    disp(tail(array2table(mt_w_by_interp_coh_interp_grid), 10));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_z_trans');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_z_trans));
    disp(head(array2table(mt_z_trans), 10));
    disp(tail(array2table(mt_z_trans), 10));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_interp_coh_grid');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    summary(array2table(ar_interp_coh_grid'));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_interp_c_grid');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    summary(array2table(ar_interp_c_grid'));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_interp_coh_grid_mesh_z');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_interp_coh_grid_mesh_z));
    disp(head(array2table(mt_interp_coh_grid_mesh_z), 10));
    disp(tail(array2table(mt_interp_coh_grid_mesh_z), 10));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_a');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_a));
    disp(head(array2table(mt_a), 10));
    disp(tail(array2table(mt_a), 10));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_a_meshk');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    summary(array2table(ar_a_meshk));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_k');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_k));
    disp(head(array2table(mt_k), 10));
    disp(tail(array2table(mt_k), 10));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('ar_k_mesha');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    summary(array2table(ar_k_mesha));

    param_map_keys = keys(func_map);
    param_map_vals = values(func_map);
    for i = 1:length(func_map)
        st_display = strjoin(['pos =' num2str(i) '; key =' string(param_map_keys{i}) '; val =' func2str(param_map_vals{i})]);
        disp(st_display);
    end

end

end

##### SOURCE END #####
--></body></html>