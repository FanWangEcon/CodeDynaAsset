
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Solve For+Inf+Borr+Save Dynamic Programming Problem (Optimized-Vectorized)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-07-01"><meta name="DC.source" content="ff_abz_fibs_vf_vecsv.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Solve For+Inf+Borr+Save Dynamic Programming Problem (Optimized-Vectorized)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_ABZ_FIBS_VF_VECSV solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Iterate Value Function</a></li><li><a href="#10">Solve Optimization Problem Current Iteration</a></li><li><a href="#12">Solve the Formal Informal Problem for each a' and coh: c_forinf(a')</a></li><li><a href="#14">Update Consumption Matrix <b>CASE A + B + C</b> Consumptions</a></li><li><a href="#15">Evaluate u(c) and store</a></li><li><a href="#17">Solve Optimization Problem: max_{a'} (u(c_forinf(a')) + EV(a',z'))</a></li><li><a href="#19">Check Tolerance and Continuation</a></li><li><a href="#21">Process Optimal Choices</a></li><li><a href="#22">Post Solution Graph and Table Generation</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> result_map = ff_abz_fibs_vf_vecsv(varargin)
</pre><h2 id="2">FF_ABZ_FIBS_VF_VECSV solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic single asset and single shock problem with vectorized codes. <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_fibs_vf.html">ff_abz_fibs_vf</a> shows looped codes. The solution is the same.</p><p>The model could be invoked mainly in sveral ways:</p><div><ol><li>param_map('bl_default') = true;  param_map('bl_bridge') = false; param_map('bl_rollover') = true; Given these, default is possible, bridge loans are not needed because rollover is allowed for formal loans (or informal loans)</li><li>we change param_map('bl_bridge') = true, that means rollover is still allowed, but only allowed using informal sources, formal loans no longer allow for roll-over. Furthermore, if both bl_bridge and bl_rollover are false, that means we are not allowing for rollover at all, so households can not borrow such that they end up with negative cash-on-hand.</li></ol></div><p>Default simulation bl_bridge = false.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>@example</p><pre>  % Get Default Parameters
  it_param_set = 4;
  [param_map, support_map] = ffs_abz_fibs_set_default_param(it_param_set);
  % Chnage param_map keys for borrowing
  param_map('fl_b_bd') = -20; % borrow bound
  param_map('bl_default') = false; % true if allow for default
  param_map('fl_c_min') = 0.0001; % u(c_min) when default
  % Change Keys in param_map
  param_map('it_a_n') = 500;
  param_map('it_z_n') = 11;
  param_map('fl_a_max') = 100;
  param_map('fl_w') = 1.3;
  param_map('fl_r_inf') = 0.06;
  param_map('fl_r_fsv') = 0.01;
  param_map('fl_r_fbr') = 0.035;
  param_map('bl_b_is_principle') = false;
  % see: ffs_for_br_block.m
  param_map('st_forbrblk_type') = 'seg3';
  param_map('fl_forbrblk_brmost') = -10;
  param_map('fl_forbrblk_brleast') = -1;
  param_map('fl_forbrblk_gap') = -1;
  % Change Keys support_map
  support_map('bl_display') = false;
  support_map('bl_post') = true;
  support_map('bl_display_final') = false;
  % Call Program with external parameters that override defaults.
  ff_abz_fibs_vf_vecsv(param_map, support_map);</pre><p>@include</p><div><ul><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_set_default_param.html">ffs_abz_fibs_set_default_param</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_get_funcgrid.html">ffs_abz_fibs_get_funcgrid</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost_bridge.html">ffs_fibs_min_c_cost_bridge</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_inf_bridge.html">ffs_fibs_inf_bridge</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost.html">ffs_fibs_min_c_cost</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html">ff_az_vf_post</a></li></ul></div><p>@seealso</p><div><ul><li>for/inf + save + borr loop: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf.html">ff_abz_fibs_vf</a></li><li>for/inf + borr vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf_vec.html">ff_abz_fibs_vf_vec</a></li><li>for/inf + borr optimized-vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf_vecsv.html">ff_abz_fibs_vf_vecsv</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><p>go to <a href="https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_fibs_set_default_param.html">ffs_abz_fibs_fibs_set_default_param</a> to change parameters in param_map container. The parameters can also be updated here directly after obtaining them from ffs_abz_fibs_set_default_param as we possibly change it_a_n and it_z_n here.</p><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_abz_fibs_set_default_param(it_param_set);

<span class="comment">% Note: param_map and support_map can be adjusted here or outside to override defaults</span>
<span class="comment">% To generate results as if formal informal do not matter</span>
<span class="comment">% param_map('fl_r_fsv') = 0.025;</span>
<span class="comment">% param_map('fl_r_inf') = 0.035;</span>
<span class="comment">% param_map('fl_r_inf_bridge') = 0.035;</span>
<span class="comment">% param_map('fl_r_fbr') = 0.035;</span>
<span class="comment">% param_map('bl_b_is_principle') = false;</span>
<span class="comment">% param_map('st_forbrblk_type') = 'seg3';</span>
<span class="comment">% param_map('fl_forbrblk_brmost') = -19;</span>
<span class="comment">% param_map('fl_forbrblk_brleast') = -1;</span>
<span class="comment">% param_map('fl_forbrblk_gap') = -1.5;</span>
<span class="comment">% param_map('bl_b_is_principle') = false;</span>
<span class="comment">% param_map('it_a_n') = 750;</span>
<span class="comment">% param_map('it_z_n') = 15;</span>

[armt_map, func_map] = ffs_abz_fibs_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_abz_fibs_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_abz_fibs_vf_vecsv'</span>;
support_map(<span class="string">'st_profile_name_main'</span>) = [st_func_name support_map(<span class="string">'st_profile_name_main'</span>)];
support_map(<span class="string">'st_mat_name_main'</span>) = [st_func_name support_map(<span class="string">'st_mat_name_main'</span>)];
support_map(<span class="string">'st_img_name_main'</span>) = [st_func_name support_map(<span class="string">'st_img_name_main'</span>)];
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_a'</span>, <span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>});
[ar_a, mt_z_trans, ar_z] = params_group{:};

<span class="comment">% Formal choice Menu/Grid and Interest Rate Menu/Grid</span>
params_group = values(armt_map, {<span class="string">'ar_forbrblk_r'</span>, <span class="string">'ar_forbrblk'</span>});
[ar_forbrblk_r, ar_forbrblk] = params_group{:};

<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_coh'</span>, <span class="string">'f_cons_coh_fbis'</span>, <span class="string">'f_cons_coh_save'</span>});
[f_util_log, f_util_crra, f_coh, f_cons_coh_fbis, f_cons_coh_save] = params_group{:};

<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'it_a_n'</span>, <span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="string">'fl_c_min'</span>,<span class="keyword">...</span>
    <span class="string">'fl_nan_replace'</span>, <span class="string">'bl_default'</span>, <span class="string">'bl_bridge'</span>, <span class="string">'bl_rollover'</span>, <span class="string">'fl_default_aprime'</span>});
[it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min, <span class="keyword">...</span>
    fl_nan_replace, bl_default, bl_bridge, bl_rollover, fl_default_aprime] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

<span class="comment">% param_map, Formal informal</span>
params_group = values(param_map, {<span class="string">'fl_r_inf'</span>, <span class="string">'fl_r_fsv'</span>, <span class="string">'bl_b_is_principle'</span>});
[fl_r_inf, fl_r_fsv, bl_b_is_principle] = params_group{:};

<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_display_minccost'</span>, <span class="string">'bl_display_infbridge'</span>, <span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_display_minccost, bl_display_infbridge, <span class="keyword">...</span>
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><p>include mt_pol_idx which we did not have in looped code</p><pre class="codeinput">mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_idx = zeros(length(ar_a),length(ar_z));
mt_pol_cons = zeros(length(ar_a),length(ar_z));

<span class="comment">% collect optimal borrowing formal and informal choices</span>
mt_pol_b_bridge = zeros(length(ar_a),length(ar_z));
mt_pol_inf_borr_nobridge = zeros(length(ar_a),length(ar_z));
mt_pol_for_borr = zeros(length(ar_a),length(ar_z));
mt_pol_for_save = zeros(length(ar_a),length(ar_z));

<span class="comment">% We did not need these in ff_abz_vf or ff_abz_vf_vec</span>
<span class="comment">% see</span>
<span class="comment">% &lt;https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html</span>
<span class="comment">% fs_u_c_partrepeat_main&gt; for why store using cells.</span>
cl_u_c_store = cell([it_z_n, 1]);
cl_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="10">Solve Optimization Problem Current Iteration</h2><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)
</pre><h2 id="12">Solve the Formal Informal Problem for each a' and coh: c_forinf(a')</h2><p>find the today's consumption maximizing formal and informal choices given a' and coh. The formal and informal choices need to generate exactly a', but depending on which formal and informal joint choice is used, the consumption cost today a' is different. Note here, a is principle + interests. Three areas:</p><div><ul><li><b>CASE A</b> a' &gt; 0: savings, do not need to optimize over formal and informal choices</li><li><b>CASE B</b> a' &lt; 0 &amp; coh &lt; 0: need bridge loan to pay for unpaid debt, and borrowing over-all, need to first pick bridge loan to pay for debt, if bridge loan is insufficient, go into default. After bridge loan, optimize over formal+informal, borrow+save joint choices.</li><li><b>CASE C</b> a' &lt; 0 &amp; coh &gt; 0: do not need to get informal bridge loans, optimize over for+inf save, for+save+borr, inf+borr only, for borrow only.</li></ul></div><pre class="codeinput">        <span class="comment">% 1. Current Shock</span>
        fl_z = ar_z(it_z_i);

        <span class="comment">% 2. cash-on-hand</span>
        ar_coh = f_coh(fl_z, ar_a);

        <span class="comment">% Consumption and u(c) only need to be evaluated once</span>
        <span class="keyword">if</span> (it_iter == 1)
</pre><pre class="codeinput">            <span class="comment">% 3. *CASE A* initiate consumption matrix as if all save</span>
            mt_c = f_cons_coh_save(ar_coh, ar_a');

            <span class="comment">% 4. *CASE B+C* get negative coh index and get borrowing choices index</span>
            ar_coh_neg_idx = (ar_coh &lt;= 0);
            ar_a_neg_idx = (ar_a &lt; 0);
            ar_coh_neg = ar_coh(ar_coh_neg_idx);
            ar_a_neg = ar_a(ar_a_neg_idx);

            <span class="comment">% 5. if coh &gt; 0 and ap &lt; 0, can allow same for+inf result to all coh.</span>
            <span class="comment">% The procedure below works regardless of how ar_coh is sorted. get</span>
            <span class="comment">% the index of all negative coh elements as well as first</span>
            <span class="comment">% non-negative element. We solve the formal and informal problem at</span>
            <span class="comment">% these points, note that we only need to solve the formal and</span>
            <span class="comment">% informal problem for positive coh level once.</span>
            ar_coh_first_pos_idx = (cumsum(ar_coh_neg_idx == 0) == 1);
            ar_coh_forinfsolve_idx = (ar_coh_first_pos_idx | ar_coh_neg_idx);
            ar_coh_forinfsolve_a_neg_idx = (ar_coh(ar_coh_forinfsolve_idx) &lt;= 0);

            <span class="comment">% 6. *CASE B + C* Negative asset choices (borrowing), 1 col Case C</span>
            <span class="comment">% negp1: negative coh + 1, 1 meaning 1 positive coh, first positive</span>
            <span class="comment">% coh column index element grabbed.</span>
            mt_coh_negp1_mesh_neg_aprime = zeros(size(ar_a_neg')) + ar_coh(ar_coh_forinfsolve_idx);
            mt_neg_aprime_mesh_coh_negp1 = zeros(size(mt_coh_negp1_mesh_neg_aprime)) + ar_a_neg';

            <span class="keyword">if</span> (bl_bridge)
                <span class="comment">%         mt_neg_aprime_mesh_coh_1col4poscoh = zeros([length(ar_a_neg), (length(ar_coh_neg)+1)]) + ar_a_neg';</span>
                <span class="comment">%         ar_coh_neg_idx_1col4poscoh = ar_coh_neg_idx(1:(length(ar_coh_neg)+1));</span>

                <span class="comment">% 6. *CASE B* Solve for: if (fl_ap &lt; 0) and if (fl_coh &lt; 0)</span>
                [mt_aprime_nobridge_negcoh, ~, mt_c_bridge_negcoh] = ffs_fibs_inf_bridge(<span class="keyword">...</span>
                    bl_b_is_principle, fl_r_inf, <span class="keyword">...</span>
                    mt_neg_aprime_mesh_coh_negp1(:,ar_coh_forinfsolve_a_neg_idx), <span class="keyword">...</span>
                    mt_coh_negp1_mesh_neg_aprime(:,ar_coh_forinfsolve_a_neg_idx), <span class="keyword">...</span>
                    bl_display_infbridge, bl_input_override);

                <span class="comment">% generate mt_aprime_nobridge</span>
                mt_neg_aprime_mesh_coh_negp1(:, ar_coh_forinfsolve_a_neg_idx) = mt_aprime_nobridge_negcoh;
            <span class="keyword">else</span>
                <span class="comment">% no bridge loan needed means roll over is allowed.</span>
                mt_neg_aprime_mesh_coh_negp1 = ar_a_neg';
            <span class="keyword">end</span>

            <span class="comment">% 7. *CASE B + C* formal and informal joint choices, 1 col Case C</span>
            bl_input_override = true;
            [ar_max_c_nobridge, ~, ~, ~] = <span class="keyword">...</span>
                ffs_fibs_min_c_cost(<span class="keyword">...</span>
                bl_b_is_principle, fl_r_inf, fl_r_fsv, <span class="keyword">...</span>
                ar_forbrblk_r, ar_forbrblk, <span class="keyword">...</span>
                mt_neg_aprime_mesh_coh_negp1(:), <span class="keyword">...</span>
                bl_display_minccost, bl_input_override);
</pre><h2 id="14">Update Consumption Matrix <b>CASE A + B + C</b> Consumptions</h2><p>Current mt_c is assuming all to be case A</p><div><ul><li>Update Columns for case B (negative coh)</li><li>Update Columns for case C (1 column): ar_coh_first_pos_idx, included in ar_coh_forinfsolve_idx</li><li>Update Columns for all case C: ~ar_coh_neg_idx using 1 column result</li></ul></div><pre class="codeinput">            <span class="comment">% 1. Initalize all Neg Aprime consumption cost of aprime inputs</span>
            <span class="comment">% Initialize</span>
            mt_max_c_nobridge_a_neg = zeros([length(ar_a_neg), length(ar_coh)]) + 0;
            mt_c_bridge_coh_a_neg = zeros(size(mt_max_c_nobridge_a_neg)) + 0;

            <span class="comment">% 2. Fill in *Case B* and *Case C* (one column) Other C-cost</span>
            mt_max_c_nobridge_negcohp1 = reshape(ar_max_c_nobridge, [size(mt_neg_aprime_mesh_coh_negp1)]);

            <span class="keyword">if</span> (bl_bridge)
                <span class="comment">% 2. Fill in *Case B* Bridge C-cost</span>
                mt_c_bridge_coh_a_neg(:, ar_coh_neg_idx) = mt_c_bridge_negcoh;

                <span class="comment">% 2. Fill in *Case B* and *Case C* (one column) Other C-cost</span>
                mt_max_c_nobridge_a_neg(:, ar_coh_forinfsolve_idx) = mt_max_c_nobridge_negcohp1;
                mt_max_c_nobridge_a_neg(:, ~ar_coh_forinfsolve_idx) = <span class="keyword">...</span>
                    zeros(size(mt_c(ar_a_neg_idx, ~ar_coh_forinfsolve_idx))) <span class="keyword">...</span>
                    + mt_max_c_nobridge_negcohp1(:, ~ar_coh_forinfsolve_a_neg_idx);
            <span class="keyword">else</span>
                mt_max_c_nobridge_a_neg = zeros([length(ar_a_neg), length(ar_coh)]) + mt_max_c_nobridge_negcohp1;
            <span class="keyword">end</span>

            <span class="comment">% 3. Consumption for B + C Cases</span>
            <span class="comment">% note, the c cost of aprime is the same for all coh &gt; 0, but mt_c</span>
            <span class="comment">% is different still for each coh and aprime.</span>
            mt_c_forinfsolve = f_cons_coh_fbis(ar_coh, mt_c_bridge_coh_a_neg + mt_max_c_nobridge_a_neg);

            <span class="comment">% 4. Update with Case B and C</span>
            mt_c(ar_a_neg_idx, :) = mt_c_forinfsolve;
</pre><h2 id="15">Evaluate u(c) and store</h2><p>1. EVAL current utility: N by N, f_util defined earlier</p><pre class="codeinput">            <span class="keyword">if</span> (fl_crra == 1)
                mt_utility = log(mt_c);
                fl_u_cmin = f_util_log(fl_c_min);
            <span class="keyword">else</span>
                mt_utility = f_util_crra(mt_c);
                fl_u_cmin = f_util_crra(fl_c_min);
            <span class="keyword">end</span>

            <span class="comment">% 2. Invliad consumption points</span>
            mt_it_c_valid_idx = (mt_c &lt;= fl_c_min);
            <span class="comment">% Set below threshold c to c_min</span>
            mt_c(mt_c &lt; fl_c_min) = fl_c_min;

            <span class="comment">% 3. Invalid points if bridge not possible also no rollover</span>
            <span class="keyword">if</span>( ~bl_rollover &amp;&amp; ~bl_bridge)
                mt_it_c_valid_idx(:, ar_coh_neg_idx) = 1;
            <span class="keyword">end</span>

            <span class="comment">% 4. Eliminate Complex Numbers</span>
            mt_utility(mt_it_c_valid_idx) = fl_u_cmin;

            <span class="comment">% 5. Store in cells</span>
            cl_c_store{it_z_i} = mt_c;
            cl_u_c_store{it_z_i} = mt_utility;
            cl_c_valid_idx{it_z_i} = mt_it_c_valid_idx;
</pre><pre class="codeinput">        <span class="keyword">end</span>
</pre><h2 id="17">Solve Optimization Problem: max_{a'} (u(c_forinf(a')) + EV(a',z'))</h2><pre class="codeinput">        <span class="comment">% 1. f(z'|z)</span>
        ar_z_trans_condi = mt_z_trans(it_z_i,:);

        <span class="comment">% 2. EVAL EV((A',K'),Z'|Z) = V((A',K'),Z') x p(z'|z)', (N by Z) x (Z by 1) = N by 1</span>
        <span class="comment">% Note: transpose ar_z_trans_condi from 1 by Z to Z by 1</span>
        <span class="comment">% Note: matrix multiply not dot multiply</span>
        mt_evzp_condi_z = mt_val_cur * ar_z_trans_condi';

        <span class="comment">% 3. EVAL add on future utility, N by N + N by 1, broadcast again</span>
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_evzp_condi_z;

        <span class="comment">% 4. Index update</span>
        <span class="comment">% using the method below is much faster than index replace</span>
        <span class="comment">% see &lt;https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript&gt;</span>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        <span class="comment">% Default or Not Utility Handling</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if default: only today u(cmin), transition out next period, debt wiped out</span>
            fl_v_default = fl_u_cmin + fl_beta*mt_evzp_condi_z(ar_a == fl_default_aprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed: v = u(cmin)</span>
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        <span class="keyword">end</span>

        <span class="comment">% Optimization: remember matlab is column major, rows must be</span>
        <span class="comment">% choices, columns must be states</span>
        <span class="comment">% &lt;https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR&gt;</span>
        <span class="comment">% mt_utility is N by N, rows are choices, cols are states.</span>
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;
        ar_opti_aprime_z = ar_a(ar_opti_idx_z);
        ar_opti_c_z = cl_c_store{it_z_i}(ar_opti_linear_idx_z);

        <span class="comment">% Handle Default is optimal or not</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if defaulting is optimal choice, at these states, not required</span>
            <span class="comment">% to default, non-default possible, but default could be optimal</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_aprime;
            ar_opti_idx_z(ar_opti_c_z &lt;= fl_c_min) = find(ar_a == fl_default_aprime);
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed, then next period same state as now</span>
            <span class="comment">% this is absorbing state, this is the limiting case, single</span>
            <span class="comment">% state space point, lowest a and lowest shock has this.</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = min(ar_a);
        <span class="keyword">end</span>

        <span class="comment">% 6. no bridge and no rollover allowed</span>
        <span class="keyword">if</span>( ~bl_rollover &amp;&amp; ~bl_bridge)
            <span class="keyword">if</span> (bl_default)
                <span class="comment">% if default: only today u(cmin), transition out next period, debt wiped out</span>
                ar_opti_aprime_z(ar_coh_neg_idx) = fl_default_aprime;
            <span class="keyword">else</span>
                <span class="comment">% if default is not allowed: v = fl_nan_replace</span>
                ar_opti_aprime_z(ar_coh_neg_idx) = ar_a(fl_nan_replace);
            <span class="keyword">end</span>
        <span class="keyword">end</span>

        <span class="comment">% store optimal values</span>
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_cons(:,it_z_i) = ar_opti_c_z;

        <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_idx_z;
        <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">end</span>
</pre><h2 id="19">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); <span class="keyword">...</span>
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'Hval'</span>, <span class="string">'Hap'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_a_n,:), highest a state val'</span>)
        disp(<span class="string">'Hap = mt_pol_a_cur(it_a_n,:), highest a state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><h2 id="21">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_idx'</span>) = mt_pol_idx;

<span class="comment">% Find optimal Formal Informal Choices. Could have saved earlier, but was</span>
<span class="comment">% wasteful of resources</span>
<span class="keyword">for</span> it_z_i = 1:length(ar_z)
    <span class="keyword">for</span> it_a_j = 1:length(ar_a)
        fl_z = ar_z(it_z_i);
        fl_a = ar_a(it_a_j);
        fl_coh = f_coh(fl_z, fl_a);
        fl_a_opti = mt_pol_a(it_a_j, it_z_i);

        <span class="comment">% call formal and informal function.</span>
        [~, fl_opti_b_bridge, fl_opti_inf_borr_nobridge, fl_opti_for_borr, fl_opti_for_save] = <span class="keyword">...</span>
            ffs_fibs_min_c_cost_bridge(fl_a_opti, fl_coh, <span class="keyword">...</span>
            param_map, support_map, armt_map, func_map, bl_input_override);

        <span class="comment">% store savings and borrowing formal and inf optimal choices</span>
        mt_pol_b_bridge(it_a_j,it_z_i) = fl_opti_b_bridge;
        mt_pol_inf_borr_nobridge(it_a_j,it_z_i) = fl_opti_inf_borr_nobridge;
        mt_pol_for_borr(it_a_j,it_z_i) = fl_opti_for_borr;
        mt_pol_for_save(it_a_j,it_z_i) = fl_opti_for_save;

    <span class="keyword">end</span>
<span class="keyword">end</span>

result_map(<span class="string">'cl_mt_pol_a'</span>) = {mt_pol_a, zeros(1)};
result_map(<span class="string">'cl_mt_pol_coh'</span>) = {f_coh(ar_z, ar_a'), zeros(1)};

result_map(<span class="string">'cl_mt_pol_c'</span>) = {mt_pol_cons, zeros(1)};
result_map(<span class="string">'cl_mt_pol_b_bridge'</span>) = {mt_pol_b_bridge, zeros(1)};
result_map(<span class="string">'cl_mt_pol_inf_borr_nobridge'</span>) = {mt_pol_inf_borr_nobridge, zeros(1)};
result_map(<span class="string">'cl_mt_pol_for_borr'</span>) = {mt_pol_for_borr, zeros(1)};
result_map(<span class="string">'cl_mt_pol_for_save'</span>) = {mt_pol_for_save, zeros(1)};

result_map(<span class="string">'ar_st_pol_names'</span>) = [<span class="string">"cl_mt_pol_a"</span>, <span class="string">"cl_mt_pol_coh"</span>, <span class="string">"cl_mt_pol_c"</span>, <span class="keyword">...</span>
    <span class="string">"cl_mt_pol_b_bridge"</span>, <span class="string">"cl_mt_pol_inf_borr_nobridge"</span>, <span class="string">"cl_mt_pol_for_borr"</span>, <span class="string">"cl_mt_pol_for_save"</span>];

<span class="comment">% Get Discrete Choice Outcomes</span>
result_map = ffs_fibs_identify_discrete(result_map, bl_input_override);
</pre><h2 id="22">Post Solution Graph and Table Generation</h2><p>Note in comparison with <b>abz</b>, results here, even when using identical parameters would differ because in <b>abz</b> solved where choices are principle. Here choices are principle + interests in order to facilitate using the informal choice functions.</p><p>Note that this means two things are different, on the one hand, the value of asset for to coh is different based on the grid of assets. If the asset grid is negative, now per grid point, there is more coh because that grid point of asset no longer has interest rates. On the other hand, if one has positive asset grid point on arrival, that is worth less to coh. Additionally, when making choices for the next period, now choices aprime includes interests. What these mean is that the a grid no longer has the same meaning. We should expect at higher savings levels, for the same grid points, if optimal grid choices are the same as before, consumption should be lower when b includes interest rates and principle. This is however, not true when arriving in a period with negative a levels, for the same negative a level and same a prime negative choice, could have higher consumption here becasue have to pay less interests on debt. This tends to happen for smaller levels of borrowing choices.</p><p>Graphically, when using interest + principle, big difference in consumption as a fraction of (coh - aprime) figure. In those figures, when counting in principles only, the gap in coh and aprime is consumption, but now, as more is borrowed only a small fraction of coh and aprime gap is consumption, becuase aprime/(1+r) is put into consumption.</p><pre class="codeinput"><span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);

    <span class="comment">% Standard AZ graphs</span>
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);

    <span class="comment">% Graphs for results_map with FIBS contents</span>
    result_map = ff_az_fibs_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">valgap = norm(mt_val - mt_val_cur): value function difference across iterations
polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n): percentage of state space points conditional on shock where the policy function is changing across iterations
                 valgap       polgap        z1           z2           z3          z4           z5          z6           z7           z8          z9          z10          z11          z12          z13          z14          z15   
                _________    ________    _________    _________    ________    _________    ________    _________    _________    ________    ________    _________    _________    _________    _________    _________    _________

    iter=1         194.87      2014.2            1            1           1            1           1            1            1           1           1            1            1            1            1            1            1
    iter=2         141.24      2154.7      0.99467        0.996     0.99733      0.99733     0.99867            1            1           1           1            1            1            1            1            1            1
    iter=3         113.99      716.08        0.992        0.992     0.99467        0.996       0.996      0.99867            1           1           1            1            1            1            1            1            1
    iter=4         95.407       357.6      0.98667        0.988       0.988      0.99067       0.992        0.992      0.99467     0.99733     0.99733      0.99867            1            1            1            1            1
    iter=5         81.368      213.92      0.98133      0.98933       0.984        0.984     0.98667      0.99067        0.992     0.99467     0.99733      0.99733      0.99867            1            1            1            1
    iter=6          70.21      142.42      0.97067      0.97067     0.97733      0.97733     0.97867      0.98267      0.98267     0.98667     0.99333        0.992        0.996        0.996      0.99867            1            1
    iter=7          61.11      101.72      0.96133        0.964       0.964      0.96533       0.972      0.97333      0.97733     0.98267     0.98267      0.98933      0.99067      0.99467      0.99733      0.99867            1
    iter=8         53.525      75.714        0.948      0.95067     0.95333      0.95467     0.96133      0.95867      0.96667       0.968     0.97333      0.97733      0.98667      0.98933      0.99467        0.996            1
    iter=9         47.132      58.526        0.936        0.932       0.936      0.94267        0.94      0.95067      0.95467     0.95867     0.96267      0.96933        0.976      0.98533      0.98933      0.99333      0.99733
    iter=10        41.682      46.699        0.916         0.92       0.924        0.928     0.92933      0.93467      0.93733     0.94267       0.952         0.96      0.96267      0.96933        0.976      0.98267        0.988
    iter=11        36.999      37.997      0.89867      0.90133       0.908        0.908       0.912      0.91733         0.92       0.928     0.93467      0.94533      0.95467         0.96        0.968      0.97733      0.98267
    iter=12         32.96      31.389      0.88133         0.88     0.88267      0.88667     0.89733      0.89867        0.908       0.912     0.91733      0.92667      0.93467        0.944      0.95467      0.96133      0.97067
    iter=13         29.46      26.426      0.85333        0.852       0.864      0.86667     0.87467      0.87467        0.876     0.88933     0.90267      0.91067      0.91867        0.928         0.94        0.948      0.95867
    iter=14        26.413      22.533      0.82533      0.84267       0.828      0.84667     0.84533      0.84267      0.85733     0.86267     0.87467        0.888      0.90267        0.912        0.924        0.936         0.94
    iter=15        23.759      19.208      0.80133      0.80133     0.82267      0.81333       0.816      0.83867      0.84133     0.85067     0.85733      0.86133      0.87067        0.892      0.88933      0.91333      0.91867
    iter=16        21.442      16.609      0.77733      0.77733     0.78533      0.79067     0.80667          0.8        0.804     0.82133     0.83733      0.84533        0.856      0.86133         0.88        0.876          0.9
    iter=17        19.413      14.459      0.73733      0.77467     0.74933      0.78667     0.75733      0.76933      0.78933     0.77867     0.81467      0.79867      0.81467      0.82933      0.84933      0.85867      0.87733
    iter=18        17.635      12.721      0.75067        0.708     0.75333        0.708       0.756      0.77067      0.77067       0.788     0.75733        0.816      0.83467      0.80667        0.852      0.83467      0.86667
    iter=19         16.07      11.239      0.66267      0.71333       0.684      0.73467     0.70267      0.69733      0.71067     0.73467     0.76267      0.74267      0.74133          0.8        0.768        0.832      0.82533
    iter=20         14.69      10.015      0.66933      0.64133     0.67333        0.648        0.68      0.69333      0.69733     0.70133     0.70533        0.748      0.76267      0.73333      0.77333      0.75067      0.77733
    iter=21        13.472      8.9852      0.60667        0.636       0.616      0.64267     0.65467      0.65733        0.668     0.68133     0.66533      0.65733        0.672      0.71067        0.716      0.75733      0.77333
    iter=22        12.396      8.0289      0.58933        0.564       0.608      0.57733       0.592      0.60267      0.60933       0.604     0.65733      0.64267      0.66133        0.692      0.70933      0.68933      0.70933
    iter=23        11.444      7.2756        0.524      0.55867     0.52667        0.576     0.56133      0.56533        0.584     0.58933       0.592      0.62933        0.644      0.61333        0.628      0.65067      0.67067
    iter=24        10.598      6.5909        0.488      0.48533       0.504      0.49467     0.51467      0.52133      0.51867     0.54267     0.55067      0.56133      0.56133      0.57467          0.6      0.64533      0.65333
    iter=25        9.8446      6.0019      0.45067         0.44        0.46        0.472     0.45867      0.47333      0.48133       0.504     0.49467      0.50933         0.52      0.56267      0.56533        0.568      0.58267
    iter=26        9.1719      5.4643      0.38667         0.42     0.39733        0.412       0.432      0.42933      0.44133     0.44267     0.45467        0.464      0.48533      0.50933      0.52933      0.51733        0.528
    iter=27        8.5694      4.9656      0.36533      0.35467     0.37467        0.384     0.38267      0.39867        0.404     0.40667     0.41733      0.42267      0.41867      0.43733      0.45067        0.476      0.49467
    iter=28         8.028        4.51        0.332      0.33333     0.34133      0.33467     0.35067      0.34933        0.364     0.36133     0.38267         0.38        0.412      0.40267      0.41733        0.428      0.46133
    iter=29        7.5393      4.1019      0.30267      0.29867     0.30667        0.308       0.312      0.33467        0.332     0.33733       0.344        0.368        0.352      0.37067        0.376        0.416        0.412
    iter=30        7.0966      3.7084      0.26533        0.284     0.27733      0.29333     0.28667      0.28267      0.29067     0.30667     0.31333      0.31733      0.34533      0.33333      0.33867      0.35333        0.368
    iter=31        6.6938      3.4611      0.26133        0.244       0.268      0.26133     0.26133      0.26933      0.27467     0.27867       0.288        0.292      0.29467      0.31467        0.336      0.33733        0.344
    iter=32        6.3259      3.1536      0.21333      0.23333     0.22133      0.22667     0.24133        0.252      0.25067     0.25333     0.26133        0.256      0.27733      0.28133      0.28667      0.29733      0.30267
    iter=33        5.9882      2.9973        0.212      0.21067     0.21333      0.21733       0.228         0.22      0.23333     0.25333     0.24267      0.25733        0.252        0.276        0.288      0.26667        0.284
    iter=34         5.677       2.737         0.18        0.192       0.188      0.20667     0.19733      0.20667      0.20667       0.212       0.216      0.22533      0.22933        0.228      0.24133      0.25067      0.26267
    iter=35        5.3891      2.5521      0.17733         0.18     0.19067      0.18267       0.192      0.18933        0.192     0.18267     0.20533        0.208      0.21067      0.21467      0.22133        0.236      0.23467
    iter=36        5.1217      2.3528        0.172      0.16267       0.164      0.15867     0.17333      0.17467      0.17733     0.17867        0.18        0.192        0.192      0.19067      0.19867      0.20133      0.22533
    iter=37        4.8723      2.2607         0.14         0.16     0.14533      0.14933     0.15733      0.16267         0.16     0.16267     0.17867      0.17467      0.19333        0.196      0.19067        0.212      0.21333
    iter=38        4.6388      2.0362      0.13733      0.12933     0.13867      0.14667     0.13733        0.152        0.144     0.15333        0.16        0.164      0.16267      0.16933      0.18133      0.18267      0.19333
    iter=39        4.4196       1.882      0.12133      0.12133       0.124        0.132     0.12667        0.128      0.14533       0.148     0.13333        0.156      0.15867        0.156      0.16267      0.18267        0.164
    iter=40        4.2132      1.7751        0.104        0.116       0.112      0.12667        0.12      0.11733        0.136       0.128     0.13467      0.13467        0.136        0.144      0.14533      0.15333      0.16133
    iter=41        4.0182      1.6488      0.10533      0.10533     0.11067        0.108     0.12267      0.11733      0.11733     0.10933     0.12533      0.11867      0.12133      0.12533      0.13733      0.13467      0.14133
    iter=42        3.8337      1.5098      0.10267        0.092     0.10933        0.104     0.10267      0.10267     0.097333     0.10533        0.12      0.11733        0.124      0.12267        0.124         0.12        0.132
    iter=43        3.6585       1.483     0.093333     0.098667       0.096        0.092       0.092     0.098667      0.10133     0.10667         0.1          0.1        0.108        0.128      0.11733         0.12      0.13867
    iter=44         3.492      1.3939        0.088     0.086667    0.082667     0.085333    0.093333        0.088     0.089333       0.096    0.089333      0.10267        0.108      0.10667      0.12133      0.11867        0.116
    iter=45        3.3334      1.3304     0.073333     0.081333    0.073333     0.077333       0.084        0.088          0.1    0.086667    0.089333        0.088        0.104        0.108      0.10267     0.098667        0.108
    iter=46        3.1821      1.1976        0.064     0.070667    0.074667        0.068    0.077333     0.081333     0.077333    0.070667       0.088        0.092     0.085333     0.082667     0.094667      0.10133     0.097333
    iter=47        3.0377      1.1601        0.068     0.066667       0.068        0.064    0.069333     0.074667        0.068    0.073333    0.085333     0.073333     0.081333     0.081333        0.084        0.088     0.089333
    iter=48        2.8998      1.1234     0.061333        0.056        0.06        0.064       0.064     0.066667        0.064    0.069333    0.070667     0.074667        0.068     0.074667         0.08        0.088     0.086667
    iter=49        2.7679       1.039     0.057333     0.057333    0.058667     0.058667    0.061333        0.056     0.058667    0.065333       0.064     0.065333     0.062667        0.072        0.072     0.074667        0.076
    iter=50        2.6416     0.92659        0.048     0.053333       0.048        0.052    0.053333     0.058667     0.058667    0.069333       0.056     0.062667     0.061333        0.068        0.064     0.061333        0.064
    iter=104       0.1455    0.093458            0            0           0            0           0    0.0013333            0           0           0            0            0            0            0            0            0
    iter=105      0.13709    0.093458    0.0013333            0           0            0           0    0.0013333            0           0           0            0            0    0.0013333    0.0013333    0.0013333            0
    iter=106      0.12915    0.093458    0.0013333            0           0    0.0013333           0            0            0           0           0            0            0            0            0    0.0013333            0
    iter=107      0.12165    0.093458            0            0           0    0.0013333           0    0.0013333            0           0           0            0            0            0            0            0            0
    iter=108      0.11458    0.093458    0.0013333    0.0013333           0    0.0013333           0            0            0           0           0            0            0            0            0    0.0013333            0
    iter=109      0.10791     0.13217            0            0           0    0.0026667           0    0.0013333            0           0           0            0            0            0            0    0.0013333    0.0013333
    iter=110      0.10162    0.093458            0            0           0            0           0            0            0           0           0            0    0.0013333            0            0            0            0
    iter=111     0.095681           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=112     0.090084           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=113     0.084808    0.093458            0            0           0            0           0            0            0           0           0    0.0013333            0            0            0    0.0013333            0
    iter=114     0.079833    0.093458    0.0013333            0           0            0           0            0    0.0013333           0           0            0            0            0            0            0            0
    iter=115     0.075145    0.093458            0            0           0            0           0            0            0           0           0            0    0.0013333            0            0            0            0
    iter=116     0.070726    0.093458            0    0.0013333           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=117     0.066563    0.093458            0    0.0013333           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=118     0.062641           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=119     0.058945           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=120     0.055465           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=121     0.052187    0.093458            0            0           0            0           0    0.0013333            0           0           0            0            0            0            0            0            0
    iter=122       0.0491           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=123     0.046193           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=124     0.043456           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=125     0.040879    0.093458            0    0.0013333           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=126     0.038453           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=127      0.03617    0.093458            0            0           0            0           0            0            0           0           0            0            0            0            0    0.0013333            0
    iter=128     0.034021           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=129     0.031999           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=130     0.030095           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=131     0.028304           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=132     0.026619           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=133     0.025033           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=134     0.023541           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=135     0.022138           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=136     0.020817           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=137     0.019575           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=138     0.018407           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=139     0.017307           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=140     0.016274           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=141     0.015301           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=142     0.014387           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=143     0.013527           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=144     0.012718           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=145     0.011958           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=146     0.011242           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=147      0.01057           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=148    0.0099371           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=149    0.0093423           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=150    0.0087831           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=151    0.0082572           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=152    0.0077628           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0
    iter=153    0.0072979           0            0            0           0            0           0            0            0           0           0            0            0            0            0            0            0

tb_val: V(a,z) value at each state space point
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20           -58.467       -58.296       -58.105        -57.9      -37.063       -28.248       -13.133       -10.946       -8.9887       -7.2095        -5.5785       -4.1085
    a2=-19.9065      -58.467       -58.296       -58.105      -44.201      -33.705       -26.881       -12.876        -10.74        -8.823       -7.0694        -5.4591       -4.0042
    a3=-19.8131      -58.467       -58.296       -50.422      -39.794      -31.654       -25.711       -12.627       -10.539       -8.6606       -6.9313         -5.341       -3.9012
    a4=-19.7196      -58.467       -54.612       -45.853      -36.953      -30.118        -24.67       -12.384       -10.343       -8.4999       -6.7952        -5.2234       -3.7992
    a5=-19.6262      -56.648       -50.979       -42.441      -34.862      -28.675       -23.777       -12.145       -10.151       -8.3413       -6.6608        -5.1068       -3.6983
    a6=-19.5327      -54.465       -47.604       -39.843      -33.148       -27.44       -23.012       -11.912       -9.9651       -8.1854        -6.528        -4.9915       -3.5985
    a7=-19.4393      -51.812        -44.78       -37.682      -31.584      -26.403       -22.328       -11.687       -9.7832       -8.0322       -6.3967        -4.8777       -3.4998
    a8=-19.3458      -49.228        -42.28       -35.886      -30.205       -25.49       -21.703        -11.47       -9.6052       -7.8813       -6.2668        -4.7648       -3.4022
    a9=-19.2523      -46.615       -40.139       -34.308      -28.999      -24.673       -21.119       -11.259       -9.4307       -7.7324       -6.1385        -4.6532       -3.3058
    a10=-19.1589     -44.257       -38.225       -32.852      -27.936      -23.932       -20.549       -11.054       -9.2596       -7.5853       -6.0119        -4.5428       -3.2105
    a11=-19.0654     -42.062       -36.533       -31.497      -26.986      -23.248       -20.015       -10.854       -9.0911       -7.4402       -5.8864        -4.4335       -3.1163
    a12=-18.972      -40.085       -35.014       -30.291      -26.118      -22.588       -19.517       -10.658        -8.925       -7.2972       -5.7624        -4.3255       -3.0218
    a13=-18.8785     -38.275       -33.638       -29.198      -25.321      -21.964       -19.048       -10.466       -8.7615       -7.1564       -5.6398        -4.2187       -2.9281
    a14=-18.785      -36.639       -32.381       -28.198      -24.584       -21.38       -18.605       -10.278       -8.6009        -7.017       -5.5183        -4.1133       -2.8353
    a15=-18.6916     -35.142       -31.205       -27.285      -23.898      -20.834       -18.188       -10.092        -8.443       -6.8794       -5.3982        -4.0091       -2.7438
    a16=-18.5981     -33.792       -30.088       -26.445      -23.223      -20.323       -17.793       -9.9107       -8.2873       -6.7435       -5.2795        -3.9047       -2.6533
    a17=-18.5047     -32.559       -29.065       -25.669      -22.597      -19.844       -17.417       -9.7325       -8.1327       -6.6089       -5.1622        -3.8011       -2.5638
    a18=-18.4112     -31.432       -28.128       -24.949      -22.012      -19.387       -17.058       -9.5555       -7.9802        -6.476       -5.0462        -3.6987       -2.4753
    a19=-18.3178     -30.391       -27.259       -24.267      -21.457      -18.956       -16.701       -9.3819       -7.8296       -6.3443       -4.9299        -3.5976       -2.3878
    a20=-18.2243     -29.422       -26.444       -23.624      -20.937      -18.546       -16.359       -9.2114       -7.6809       -6.2143       -4.8145        -3.4978       -2.3016
    a21=-18.1308     -28.529       -25.691       -22.999      -20.447      -18.151       -16.028       -9.0434       -7.5342       -6.0857       -4.7006        -3.3992       -2.2163
    a22=-18.0374     -27.651       -24.992       -22.415       -19.98      -17.763       -15.709       -8.8783        -7.389       -5.9567       -4.5882        -3.3019        -2.132
    a23=-17.9439     -26.841       -24.335       -21.862      -19.538       -17.39       -15.401       -8.7158       -7.2456       -5.8286       -4.4772        -3.2057       -2.0486
    a24=-17.8505     -26.084       -23.717        -21.34      -19.114      -17.031       -15.103       -8.5554       -7.1037       -5.7023       -4.3672        -3.1108       -1.9663
    a25=-17.757      -25.374       -23.132       -20.843      -18.707      -16.685       -14.816       -8.3973       -6.9614       -5.5776       -4.2584        -3.0171       -1.8844
    a26=-17.6636     -24.708       -22.571       -20.369      -18.311      -16.352       -14.537       -8.2408       -6.8203       -5.4547       -4.1511        -2.9246       -1.8035
    a27=-17.5701     -24.073       -22.022       -19.919      -17.926      -16.032       -14.267       -8.0837       -6.6809       -5.3333       -4.0451        -2.8331       -1.7235
    a28=-17.4766     -23.477       -21.503       -19.491      -17.557      -15.723       -14.006       -7.9277       -6.5435       -5.2137       -3.9405        -2.7429       -1.6442
    a29=-17.3832     -22.915       -21.012        -19.08      -17.203      -15.425       -13.753       -7.7737       -6.4079       -5.0956       -3.8373        -2.6533       -1.5657
    a30=-17.2897     -22.382       -20.544       -18.686      -16.861      -15.136       -13.507       -7.6218       -6.2743       -4.9786       -3.7354        -2.5648       -1.4881
    a31=-17.1963     -21.874       -20.095       -18.305       -16.53      -14.856       -13.264        -7.472       -6.1424       -4.8629       -3.6349        -2.4774       -1.4113
    a32=-17.1028     -21.385       -19.663        -17.93      -16.213      -14.586       -13.026       -7.3243       -6.0124       -4.7488       -3.5357        -2.3909       -1.3351
    a33=-17.0093     -20.918       -19.252       -17.569      -15.906      -14.319       -12.791       -7.1787       -5.8842       -4.6362       -3.4378        -2.3054       -1.2596
    a34=-16.9159     -20.458       -18.858       -17.223      -15.606      -14.057       -12.559       -7.0352       -5.7577       -4.5251       -3.3413        -2.2211       -1.1846
    a35=-16.8224     -20.021       -18.475       -16.884      -15.313      -13.802       -12.332       -6.8937        -5.633       -4.4155       -3.2459        -2.1378       -1.1103
    a36=-16.729      -19.599       -18.104       -16.556      -15.027      -13.549       -12.108       -6.7542       -5.5099       -4.3074       -3.1518        -2.0553       -1.0366
    a37=-16.6355     -19.191       -17.744       -16.237      -14.749      -13.301       -11.888       -6.6167       -5.3885       -4.2009       -3.0589        -1.9738      -0.96329
    a38=-16.5421     -18.795       -17.397       -15.928      -14.477      -13.058       -11.672       -6.4811       -5.2688       -4.0957       -2.9674        -1.8932      -0.89136
    a39=-16.4486     -18.416        -17.06       -15.627      -14.211       -12.82       -11.459       -6.3472       -5.1508       -3.9918       -2.8769        -1.8134       -0.8204
    a40=-16.3551     -18.048       -16.732       -15.333       -13.95      -12.586        -11.25       -6.2153       -5.0344       -3.8894       -2.7877        -1.7343      -0.74993
    a41=-16.2617     -17.692       -16.411       -15.046      -13.695      -12.356       -11.045       -6.0852       -4.9195       -3.7886       -2.6998         -1.656      -0.67992
    a42=-16.1682     -17.346       -16.097       -14.767      -13.446      -12.131       -10.843       -5.9569       -4.8061       -3.6891        -2.613        -1.5792      -0.61024
    a43=-16.0748      -17.01       -15.791       -14.494      -13.202       -11.91       -10.645       -5.8303       -4.6945       -3.5911       -2.5273        -1.5035      -0.54102
    a44=-15.9813     -16.684       -15.494       -14.228      -12.961      -11.693        -10.45       -5.7055       -4.5845       -3.4947       -2.4425        -1.4285      -0.47227
    a45=-15.8879     -16.368       -15.204       -13.967      -12.724       -11.48       -10.258       -5.5825       -4.4759       -3.3999       -2.3582         -1.354      -0.40382
    a46=-15.7944      -16.06       -14.922       -13.712      -12.492      -11.271        -10.07       -5.4612       -4.3683       -3.3064       -2.2757          -1.28      -0.33583
    a47=-15.7009     -15.759       -14.645       -13.462      -12.265      -11.066       -9.8841        -5.341       -4.2626       -3.2142       -2.1945        -1.2065      -0.26805
    a48=-15.6075     -15.466       -14.375       -13.218      -12.042      -10.864       -9.7016       -5.2227       -4.1587       -3.1238       -2.1141        -1.1335      -0.20055
    a49=-15.514       -15.18       -14.111       -12.979      -11.823      -10.666       -9.5221       -5.1063       -4.0564       -3.0343       -2.0344        -1.0609      -0.13349
    a50=-15.4206     -14.901       -13.854       -12.744      -11.608      -10.471       -9.3455       -4.9919       -3.9558       -2.9466       -1.9554       -0.98888     -0.066858
    a701=45.4206      13.316        13.368        13.427       13.491       13.561        13.635        13.988        14.093        14.204        14.323         14.446        14.571
    a702=45.514       13.327        13.379        13.438       13.502       13.572        13.646        13.998        14.103        14.214        14.332         14.456         14.58
    a703=45.6075      13.338         13.39        13.449       13.513       13.582        13.656        14.008        14.112        14.224        14.342         14.465        14.589
    a704=45.7009      13.349        13.401         13.46       13.524       13.593        13.667        14.018        14.122        14.233        14.351         14.474        14.598
    a705=45.7944       13.36        13.412         13.47       13.534       13.603        13.677        14.028        14.132        14.243         14.36         14.483        14.607
    a706=45.8879      13.371        13.423        13.481       13.545       13.614        13.688        14.038        14.142        14.252         14.37         14.492        14.616
    a707=45.9813      13.382        13.434        13.492       13.556       13.624        13.698        14.048        14.151        14.262        14.379         14.501        14.625
    a708=46.0748      13.393        13.444        13.503       13.566       13.635        13.708        14.058        14.161        14.271        14.388         14.511        14.634
    a709=46.1682      13.404        13.455        13.513       13.577       13.646        13.719        14.067        14.171        14.281        14.398          14.52        14.643
    a710=46.2617      13.415        13.466        13.524       13.588       13.656        13.729        14.077         14.18         14.29        14.407         14.529        14.652
    a711=46.3551      13.426        13.477        13.535       13.598       13.667         13.74        14.087         14.19          14.3        14.416         14.538         14.66
    a712=46.4486      13.437        13.488        13.546       13.609       13.677         13.75        14.097        14.199        14.309        14.425         14.547        14.669
    a713=46.5421      13.447        13.498        13.556       13.619       13.687         13.76        14.107        14.209        14.319        14.435         14.556        14.678
    a714=46.6355      13.458        13.509        13.567        13.63       13.698        13.771        14.116        14.219        14.328        14.444         14.565        14.687
    a715=46.729       13.469         13.52        13.578       13.641       13.708        13.781        14.126        14.228        14.337        14.453         14.574        14.696
    a716=46.8224       13.48        13.531        13.588       13.651       13.719        13.791        14.136        14.238        14.347        14.462         14.583        14.705
    a717=46.9159      13.491        13.541        13.599       13.662       13.729        13.801        14.146        14.247        14.356        14.472         14.592        14.714
    a718=47.0093      13.501        13.552        13.609       13.672       13.739        13.812        14.155        14.257        14.365        14.481         14.601        14.722
    a719=47.1028      13.512        13.563         13.62       13.682        13.75        13.822        14.165        14.266        14.375         14.49          14.61        14.731
    a720=47.1963      13.523        13.573         13.63       13.693        13.76        13.832        14.175        14.276        14.384        14.499         14.619         14.74
    a721=47.2897      13.534        13.584        13.641       13.703        13.77        13.842        14.184        14.285        14.393        14.508         14.628        14.749
    a722=47.3832      13.544        13.595        13.652       13.714       13.781        13.852        14.194        14.295        14.403        14.517         14.637        14.757
    a723=47.4766      13.555        13.605        13.662       13.724       13.791        13.863        14.203        14.304        14.412        14.526         14.646        14.766
    a724=47.5701      13.566        13.616        13.672       13.735       13.801        13.873        14.213        14.314        14.421        14.536         14.655        14.775
    a725=47.6636      13.576        13.626        13.683       13.745       13.811        13.883        14.223        14.323        14.431        14.545         14.664        14.784
    a726=47.757       13.587        13.637        13.693       13.755       13.822        13.893        14.232        14.332         14.44        14.554         14.673        14.792
    a727=47.8505      13.597        13.647        13.704       13.766       13.832        13.903        14.242        14.342        14.449        14.563         14.681        14.801
    a728=47.9439      13.608        13.658        13.714       13.776       13.842        13.913        14.251        14.351        14.458        14.572          14.69         14.81
    a729=48.0374      13.619        13.668        13.725       13.786       13.852        13.923        14.261        14.361        14.467        14.581         14.699        14.818
    a730=48.1308      13.629        13.679        13.735       13.796       13.862        13.933         14.27         14.37        14.477         14.59         14.708        14.827
    a731=48.2243       13.64        13.689        13.745       13.807       13.873        13.943         14.28        14.379        14.486        14.599         14.717        14.836
    a732=48.3178       13.65          13.7        13.756       13.817       13.883        13.953        14.289        14.389        14.495        14.608         14.726        14.844
    a733=48.4112      13.661         13.71        13.766       13.827       13.893        13.963        14.299        14.398        14.504        14.617         14.734        14.853
    a734=48.5047      13.671         13.72        13.776       13.837       13.903        13.973        14.308        14.407        14.513        14.626         14.743        14.862
    a735=48.5981      13.682        13.731        13.787       13.847       13.913        13.983        14.318        14.416        14.522        14.635         14.752         14.87
    a736=48.6916      13.692        13.741        13.797       13.858       13.923        13.993        14.327        14.426        14.531        14.644         14.761        14.879
    a737=48.785       13.702        13.752        13.807       13.868       13.933        14.003        14.336        14.435         14.54        14.652          14.77        14.887
    a738=48.8785      13.713        13.762        13.817       13.878       13.943        14.013        14.346        14.444         14.55        14.661         14.778        14.896
    a739=48.972       13.723        13.772        13.827       13.888       13.953        14.023        14.355        14.453        14.559         14.67         14.787        14.904
    a740=49.0654      13.734        13.782        13.838       13.898       13.963        14.033        14.364        14.463        14.568        14.679         14.796        14.913
    a741=49.1589      13.744        13.793        13.848       13.908       13.973        14.043        14.374        14.472        14.577        14.688         14.804        14.921
    a742=49.2523      13.754        13.803        13.858       13.918       13.983        14.052        14.383        14.481        14.586        14.697         14.813         14.93
    a743=49.3458      13.765        13.813        13.868       13.928       13.993        14.062        14.392         14.49        14.595        14.706         14.822        14.938
    a744=49.4393      13.775        13.823        13.878       13.938       14.003        14.072        14.402        14.499        14.604        14.715          14.83        14.947
    a745=49.5327      13.785        13.834        13.888       13.948       14.013        14.082        14.411        14.508        14.613        14.723         14.839        14.955
    a746=49.6262      13.796        13.844        13.899       13.958       14.023        14.092         14.42        14.518        14.622        14.732         14.848        14.964
    a747=49.7196      13.806        13.854        13.909       13.968       14.033        14.101         14.43        14.527        14.631        14.741         14.856        14.972
    a748=49.8131      13.816        13.864        13.919       13.978       14.042        14.111        14.439        14.536        14.639         14.75         14.865        14.981
    a749=49.9065      13.826        13.874        13.929       13.988       14.052        14.121        14.448        14.545        14.648        14.758         14.873        14.989
    a750=50           13.836        13.884        13.939       13.998       14.062        14.131        14.457        14.554        14.657        14.767         14.882        14.998

tb_pol_a: optimal asset choice for each state space point
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20                 0             0             0            0          -20       -19.907       -19.533       -19.346       -19.159       -18.972       -18.598       -18.318 
    a2=-19.9065            0             0             0          -20      -19.907       -19.813       -19.439       -19.346       -19.065       -18.879       -18.505       -18.224 
    a3=-19.8131            0             0           -20      -19.907      -19.813       -19.813       -19.346       -19.252       -18.972       -18.785       -18.505       -18.131 
    a4=-19.7196            0           -20       -19.907      -19.813       -19.72        -19.72       -19.346       -19.159       -18.972       -18.692       -18.411       -18.037 
    a5=-19.6262          -20       -19.907       -19.813       -19.72       -19.72       -19.626       -19.252       -19.065       -18.879       -18.598       -18.318       -17.944 
    a6=-19.5327      -19.907       -19.813        -19.72      -19.626      -19.626       -19.533       -19.159       -18.972       -18.785       -18.505       -18.224        -17.85 
    a7=-19.4393      -19.813        -19.72       -19.626      -19.626      -19.533       -19.439       -19.065       -18.879       -18.692       -18.411       -18.131       -17.757 
    a8=-19.3458       -19.72       -19.626       -19.533      -19.533      -19.439       -19.346       -18.972       -18.785       -18.598       -18.318       -18.037       -17.664 
    a9=-19.2523      -19.626       -19.533       -19.439      -19.439      -19.346       -19.346       -18.879       -18.692       -18.505       -18.224       -17.944        -17.57 
    a10=-19.1589     -19.533       -19.439       -19.439      -19.346      -19.252       -19.252       -18.785       -18.598       -18.411       -18.131        -17.85       -17.477 
    a11=-19.0654     -19.439       -19.346       -19.346      -19.252      -19.159       -19.159       -18.692       -18.505       -18.318       -18.037       -17.757       -17.383 
    a12=-18.972      -19.346       -19.252       -19.252      -19.159      -19.159       -19.065       -18.598       -18.411       -18.224       -17.944       -17.664        -17.29 
    a13=-18.8785     -19.252       -19.159       -19.159      -19.065      -19.065       -18.972       -18.505       -18.318       -18.131        -17.85        -17.57       -17.196 
    a14=-18.785      -19.159       -19.065       -19.065      -18.972      -18.972       -18.879       -18.411       -18.224       -18.037       -17.757       -17.477       -17.103 
    a15=-18.6916     -19.065       -19.065       -18.972      -18.972      -18.879       -18.785       -18.318       -18.131       -17.944       -17.664       -17.383       -17.009 
    a16=-18.5981     -18.972       -18.972       -18.879      -18.879      -18.785       -18.692       -18.224       -18.037        -17.85        -17.57        -17.29       -16.916 
    a17=-18.5047     -18.879       -18.879       -18.785      -18.785      -18.692       -18.598       -18.224       -18.037       -17.757       -17.477       -17.196       -16.822 
    a18=-18.4112     -18.785       -18.785       -18.692      -18.692      -18.598       -18.598       -18.131       -17.944       -17.664       -17.383       -17.103       -16.729 
    a19=-18.3178     -18.692       -18.692       -18.598      -18.598      -18.505       -18.505       -18.037        -17.85        -17.57        -17.29       -17.009       -16.636 
    a20=-18.2243     -18.598       -18.598       -18.598      -18.505      -18.411       -18.411       -17.944       -17.757       -17.477       -17.196       -16.916       -16.542 
    a21=-18.1308     -18.598       -18.505       -18.505      -18.411      -18.318       -18.318        -17.85       -17.664       -17.383       -17.103       -16.822       -16.449 
    a22=-18.0374     -18.505       -18.411       -18.411      -18.318      -18.318       -18.224       -17.757        -17.57        -17.29       -17.009       -16.729       -16.355 
    a23=-17.9439     -18.411       -18.318       -18.318      -18.224      -18.224       -18.131       -17.664       -17.477       -17.196       -16.916       -16.636       -16.262 
    a24=-17.8505     -18.318       -18.224       -18.224      -18.131      -18.131       -18.037        -17.57       -17.383       -17.103       -16.916       -16.542       -16.262 
    a25=-17.757      -18.224       -18.131       -18.131      -18.037      -18.037       -17.944       -17.477        -17.29       -17.009       -16.822       -16.449       -16.168 
    a26=-17.6636     -18.131       -18.131       -18.037      -18.037      -17.944        -17.85       -17.383       -17.196       -16.916       -16.729       -16.355       -16.075 
    a27=-17.5701     -18.037       -18.037       -17.944      -17.944       -17.85       -17.757        -17.29       -17.103       -16.822       -16.636       -16.262       -15.981 
    a28=-17.4766     -17.944       -17.944        -17.85       -17.85      -17.757       -17.664       -17.196       -17.009       -16.729       -16.542       -16.168       -15.888 
    a29=-17.3832      -17.85        -17.85       -17.757      -17.757      -17.664        -17.57       -17.103       -16.916       -16.636       -16.449       -16.168       -15.794 
    a30=-17.2897     -17.757       -17.757       -17.664      -17.664       -17.57       -17.477       -17.009       -16.822       -16.636       -16.355       -16.075       -15.701 
    a31=-17.1963     -17.664       -17.664        -17.57       -17.57      -17.477       -17.477       -16.916       -16.729       -16.542       -16.262       -15.981       -15.607 
    a32=-17.1028      -17.57        -17.57        -17.57      -17.477      -17.383       -17.383       -16.822       -16.636       -16.449       -16.168       -15.888       -15.514 
    a33=-17.0093      -17.57       -17.477       -17.477      -17.383       -17.29        -17.29       -16.729       -16.542       -16.355       -16.075       -15.794       -15.421 
    a34=-16.9159     -17.477       -17.383       -17.383       -17.29      -17.196       -17.196       -16.636       -16.449       -16.262       -15.981       -15.701       -15.327 
    a35=-16.8224     -17.383        -17.29        -17.29      -17.196      -17.196       -17.103       -16.542       -16.355       -16.168       -15.888       -15.607       -15.234 
    a36=-16.729       -17.29       -17.196       -17.196      -17.103      -17.103       -17.009       -16.449       -16.262       -16.075       -15.794       -15.514        -15.14 
    a37=-16.6355     -17.196       -17.103       -17.103      -17.009      -17.009       -16.916       -16.355       -16.168       -15.981       -15.701       -15.421       -15.047 
    a38=-16.5421     -17.103       -17.009       -17.009      -16.916      -16.916       -16.822       -16.262       -16.075       -15.888       -15.607       -15.327       -14.953 
    a39=-16.4486     -17.009       -16.916       -16.916      -16.822      -16.822       -16.729       -16.168       -15.981       -15.794       -15.514       -15.234        -14.86 
    a40=-16.3551     -16.916       -16.822       -16.822      -16.729      -16.729       -16.636       -16.075       -15.888       -15.701       -15.421        -15.14       -14.766 
    a41=-16.2617     -16.822       -16.822       -16.729      -16.636      -16.636       -16.542       -15.981       -15.794       -15.607       -15.327       -15.047       -14.673 
    a42=-16.1682     -16.729       -16.729       -16.636      -16.542      -16.542       -16.449       -15.888       -15.701       -15.514       -15.234       -14.953       -14.579 
    a43=-16.0748     -16.636       -16.636       -16.542      -16.449      -16.449       -16.355       -15.794       -15.607       -15.421        -15.14        -14.86       -14.486 
    a44=-15.9813     -16.542       -16.542       -16.449      -16.449      -16.355       -16.262       -15.701       -15.514       -15.327       -15.047       -14.766       -14.393 
    a45=-15.8879     -16.449       -16.449       -16.355      -16.355      -16.262       -16.168       -15.607       -15.514       -15.234       -15.047       -14.673       -14.299 
    a46=-15.7944     -16.355       -16.355       -16.262      -16.262      -16.168       -16.075       -15.607       -15.421        -15.14       -14.953       -14.579       -14.206 
    a47=-15.7009     -16.262       -16.262       -16.168      -16.168      -16.075       -15.981       -15.514       -15.327       -15.047        -14.86       -14.486       -14.112 
    a48=-15.6075     -16.168       -16.168       -16.075      -16.075      -15.981       -15.888       -15.421       -15.234       -15.047       -14.766       -14.393       -14.019 
    a49=-15.514      -16.075       -16.075       -15.981      -15.981      -15.888       -15.794       -15.327        -15.14       -14.953       -14.673       -14.299       -13.925 
    a50=-15.4206     -15.981       -15.981       -15.888      -15.888      -15.794       -15.701       -15.234       -15.047        -14.86       -14.579       -14.299       -13.832 
    a701=45.4206      42.804        42.804        42.897       42.897       42.991        43.084        43.645        43.832        44.112        44.393        44.673        45.047 
    a702=45.514       42.897        42.897        42.991       42.991       43.084        43.178        43.738        43.925        44.206        44.486        44.766         45.14 
    a703=45.6075      42.991        42.991        43.084       43.084       43.178        43.271        43.832        44.019        44.299        44.579         44.86        45.234 
    a704=45.7009      42.991        43.084        43.178       43.178       43.271        43.364        43.925        44.112        44.393        44.579        44.953        45.327 
    a705=45.7944      43.084        43.178        43.271       43.271       43.364        43.458        44.019        44.206        44.486        44.673        45.047        45.421 
    a706=45.8879      43.178        43.271        43.364       43.364       43.458        43.551        44.112        44.299        44.486        44.766         45.14        45.514 
    a707=45.9813      43.271        43.364        43.364       43.458       43.551        43.645        44.206        44.393        44.579         44.86        45.234        45.607 
    a708=46.0748      43.364        43.458        43.458       43.551       43.645        43.738        44.299        44.486        44.673        44.953        45.327        45.701 
    a709=46.1682      43.458        43.551        43.551       43.645       43.738        43.832        44.393        44.579        44.766        45.047        45.421        45.794 
    a710=46.2617      43.551        43.645        43.645       43.738       43.832        43.925        44.486        44.673         44.86         45.14        45.514        45.888 
    a711=46.3551      43.645        43.738        43.738       43.832       43.925        44.019        44.579        44.766        44.953        45.234        45.607        45.981 
    a712=46.4486      43.738        43.832        43.832       43.925       44.019        44.112        44.673         44.86        45.047        45.327        45.701        46.075 
    a713=46.5421      43.832        43.925        43.925       44.019       44.112        44.206        44.766        44.953         45.14        45.421        45.794        46.168 
    a714=46.6355      43.925        44.019        44.019       44.112       44.206        44.299         44.86        45.047        45.234        45.514        45.888        46.262 
    a715=46.729       44.019        44.112        44.112       44.206       44.299        44.393        44.953         45.14        45.327        45.607        45.981        46.355 
    a716=46.8224      44.112        44.206        44.206       44.299       44.393        44.486        45.047        45.234        45.421        45.701        46.075        46.449 
    a717=46.9159      44.206        44.299        44.299       44.393       44.486        44.579         45.14        45.327        45.514        45.794        46.168        46.542 
    a718=47.0093      44.299        44.393        44.393       44.486       44.579        44.673         45.14        45.421        45.607        45.888        46.262        46.636 
    a719=47.1028      44.393        44.486        44.486       44.579       44.673        44.766        45.234        45.514        45.701        45.981        46.355        46.729 
    a720=47.1963      44.486        44.579        44.579       44.673       44.766         44.86        45.327        45.607        45.794        46.075        46.449        46.822 
    a721=47.2897      44.579        44.673        44.673       44.766        44.86        44.953        45.421        45.701        45.888        46.168        46.449        46.916 
    a722=47.3832      44.673        44.673        44.766        44.86       44.953        45.047        45.514        45.794        45.981        46.262        46.542        47.009 
    a723=47.4766      44.766        44.766         44.86       44.953       45.047        45.047        45.607        45.794        46.075        46.355        46.636        47.009 
    a724=47.5701       44.86         44.86        44.953       45.047       45.047         45.14        45.701        45.888        46.168        46.449        46.729        47.103 
    a725=47.6636      44.953        44.953        45.047        45.14        45.14        45.234        45.794        45.981        46.262        46.542        46.822        47.196 
    a726=47.757       45.047        45.047         45.14       45.234       45.234        45.327        45.888        46.075        46.355        46.636        46.916         47.29 
    a727=47.8505       45.14         45.14        45.234       45.327       45.327        45.421        45.981        46.168        46.449        46.729        47.009        47.383 
    a728=47.9439      45.234        45.234        45.327       45.421       45.421        45.514        46.075        46.262        46.542        46.822        47.103        47.477 
    a729=48.0374      45.327        45.327        45.421       45.514       45.514        45.607        46.168        46.355        46.636        46.916        47.196         47.57 
    a730=48.1308      45.421        45.421        45.514       45.607       45.607        45.701        46.262        46.449        46.729        47.009         47.29        47.664 
    a731=48.2243      45.514        45.514        45.607       45.607       45.701        45.794        46.355        46.542        46.822        47.103        47.383        47.757 
    a732=48.3178      45.607        45.607        45.701       45.701       45.794        45.888        46.449        46.636        46.916        47.196        47.477         47.85 
    a733=48.4112      45.701        45.701        45.794       45.794       45.888        45.981        46.542        46.729        47.009         47.29         47.57        47.944 
    a734=48.5047      45.794        45.794        45.888       45.888       45.981        46.075        46.636        46.822        47.103        47.383        47.664        48.037 
    a735=48.5981      45.888        45.888        45.981       45.981       46.075        46.168        46.729        46.916        47.196        47.477        47.757        48.131 
    a736=48.6916      45.981        45.981        46.075       46.075       46.168        46.262        46.822        47.009         47.29         47.57         47.85        48.224 
    a737=48.785       46.075        46.075        46.168       46.168       46.262        46.355        46.916        47.103        47.383        47.664        47.944        48.318 
    a738=48.8785      46.168        46.168        46.262       46.262       46.355        46.449        47.009        47.196        47.477        47.757        48.037        48.411 
    a739=48.972       46.262        46.262        46.355       46.355       46.449        46.542        47.103         47.29         47.57         47.85        48.131        48.505 
    a740=49.0654      46.262        46.355        46.449       46.449       46.542        46.636        47.196        47.383        47.664         47.85        48.224        48.598 
    a741=49.1589      46.355        46.449        46.542       46.542       46.636        46.729         47.29        47.477        47.757        47.944        48.318        48.692 
    a742=49.2523      46.449        46.542        46.542       46.636       46.729        46.822        47.383         47.57        47.757        48.037        48.411        48.785 
    a743=49.3458      46.542        46.636        46.636       46.729       46.822        46.916        47.477        47.664         47.85        48.131        48.505        48.879 
    a744=49.4393      46.636        46.729        46.729       46.822       46.916        47.009         47.57        47.757        47.944        48.224        48.598        48.972 
    a745=49.5327      46.729        46.822        46.822       46.916       47.009        47.103        47.664         47.85        48.037        48.318        48.692        49.065 
    a746=49.6262      46.822        46.916        46.916       47.009       47.103        47.196        47.757        47.944        48.131        48.411        48.785        49.159 
    a747=49.7196      46.916        47.009        47.009       47.103       47.196         47.29         47.85        48.037        48.224        48.505        48.879        49.252 
    a748=49.8131      47.009        47.103        47.103       47.196        47.29        47.383        47.944        48.131        48.318        48.598        48.972        49.346 
    a749=49.9065      47.103        47.196        47.196        47.29       47.383        47.477        48.037        48.224        48.411        48.692        49.065        49.439 
    a750=50           47.196         47.29         47.29       47.383       47.477         47.57        48.131        48.318        48.505        48.785        49.159        49.533 

Warning: Using only the real component of complex data. 
Warning: Using only the real component of complex data. 
Warning: Using only the real component of complex data. 
Warning: Using only the real component of complex data. 
Warning: Using only the real component of complex data. 
mt_pol_b_bridge_print: bridge loans
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20              0             0             0            0            0             0             0             0             0             0             0             0    
    a2=-19.9065         0             0             0            0            0             0             0             0             0             0             0             0    
    a3=-19.8131         0             0             0            0            0             0             0             0             0             0             0             0    
    a4=-19.7196         0             0             0            0            0             0             0             0             0             0             0             0    
    a5=-19.6262         0             0             0            0            0             0             0             0             0             0             0             0    
    a6=-19.5327         0             0             0            0            0             0             0             0             0             0             0             0    
    a7=-19.4393         0             0             0            0            0             0             0             0             0             0             0             0    
    a8=-19.3458         0             0             0            0            0             0             0             0             0             0             0             0    
    a9=-19.2523         0             0             0            0            0             0             0             0             0             0             0             0    
    a10=-19.1589        0             0             0            0            0             0             0             0             0             0             0             0    
    a11=-19.0654        0             0             0            0            0             0             0             0             0             0             0             0    
    a12=-18.972         0             0             0            0            0             0             0             0             0             0             0             0    
    a13=-18.8785        0             0             0            0            0             0             0             0             0             0             0             0    
    a14=-18.785         0             0             0            0            0             0             0             0             0             0             0             0    
    a15=-18.6916        0             0             0            0            0             0             0             0             0             0             0             0    
    a16=-18.5981        0             0             0            0            0             0             0             0             0             0             0             0    
    a17=-18.5047        0             0             0            0            0             0             0             0             0             0             0             0    
    a18=-18.4112        0             0             0            0            0             0             0             0             0             0             0             0    
    a19=-18.3178        0             0             0            0            0             0             0             0             0             0             0             0    
    a20=-18.2243        0             0             0            0            0             0             0             0             0             0             0             0    
    a21=-18.1308        0             0             0            0            0             0             0             0             0             0             0             0    
    a22=-18.0374        0             0             0            0            0             0             0             0             0             0             0             0    
    a23=-17.9439        0             0             0            0            0             0             0             0             0             0             0             0    
    a24=-17.8505        0             0             0            0            0             0             0             0             0             0             0             0    
    a25=-17.757         0             0             0            0            0             0             0             0             0             0             0             0    
    a26=-17.6636        0             0             0            0            0             0             0             0             0             0             0             0    
    a27=-17.5701        0             0             0            0            0             0             0             0             0             0             0             0    
    a28=-17.4766        0             0             0            0            0             0             0             0             0             0             0             0    
    a29=-17.3832        0             0             0            0            0             0             0             0             0             0             0             0    
    a30=-17.2897        0             0             0            0            0             0             0             0             0             0             0             0    
    a31=-17.1963        0             0             0            0            0             0             0             0             0             0             0             0    
    a32=-17.1028        0             0             0            0            0             0             0             0             0             0             0             0    
    a33=-17.0093        0             0             0            0            0             0             0             0             0             0             0             0    
    a34=-16.9159        0             0             0            0            0             0             0             0             0             0             0             0    
    a35=-16.8224        0             0             0            0            0             0             0             0             0             0             0             0    
    a36=-16.729         0             0             0            0            0             0             0             0             0             0             0             0    
    a37=-16.6355        0             0             0            0            0             0             0             0             0             0             0             0    
    a38=-16.5421        0             0             0            0            0             0             0             0             0             0             0             0    
    a39=-16.4486        0             0             0            0            0             0             0             0             0             0             0             0    
    a40=-16.3551        0             0             0            0            0             0             0             0             0             0             0             0    
    a41=-16.2617        0             0             0            0            0             0             0             0             0             0             0             0    
    a42=-16.1682        0             0             0            0            0             0             0             0             0             0             0             0    
    a43=-16.0748        0             0             0            0            0             0             0             0             0             0             0             0    
    a44=-15.9813        0             0             0            0            0             0             0             0             0             0             0             0    
    a45=-15.8879        0             0             0            0            0             0             0             0             0             0             0             0    
    a46=-15.7944        0             0             0            0            0             0             0             0             0             0             0             0    
    a47=-15.7009        0             0             0            0            0             0             0             0             0             0             0             0    
    a48=-15.6075        0             0             0            0            0             0             0             0             0             0             0             0    
    a49=-15.514         0             0             0            0            0             0             0             0             0             0             0             0    
    a50=-15.4206        0             0             0            0            0             0             0             0             0             0             0             0    
    a701=45.4206        0             0             0            0            0             0             0             0             0             0             0             0    
    a702=45.514         0             0             0            0            0             0             0             0             0             0             0             0    
    a703=45.6075        0             0             0            0            0             0             0             0             0             0             0             0    
    a704=45.7009        0             0             0            0            0             0             0             0             0             0             0             0    
    a705=45.7944        0             0             0            0            0             0             0             0             0             0             0             0    
    a706=45.8879        0             0             0            0            0             0             0             0             0             0             0             0    
    a707=45.9813        0             0             0            0            0             0             0             0             0             0             0             0    
    a708=46.0748        0             0             0            0            0             0             0             0             0             0             0             0    
    a709=46.1682        0             0             0            0            0             0             0             0             0             0             0             0    
    a710=46.2617        0             0             0            0            0             0             0             0             0             0             0             0    
    a711=46.3551        0             0             0            0            0             0             0             0             0             0             0             0    
    a712=46.4486        0             0             0            0            0             0             0             0             0             0             0             0    
    a713=46.5421        0             0             0            0            0             0             0             0             0             0             0             0    
    a714=46.6355        0             0             0            0            0             0             0             0             0             0             0             0    
    a715=46.729         0             0             0            0            0             0             0             0             0             0             0             0    
    a716=46.8224        0             0             0            0            0             0             0             0             0             0             0             0    
    a717=46.9159        0             0             0            0            0             0             0             0             0             0             0             0    
    a718=47.0093        0             0             0            0            0             0             0             0             0             0             0             0    
    a719=47.1028        0             0             0            0            0             0             0             0             0             0             0             0    
    a720=47.1963        0             0             0            0            0             0             0             0             0             0             0             0    
    a721=47.2897        0             0             0            0            0             0             0             0             0             0             0             0    
    a722=47.3832        0             0             0            0            0             0             0             0             0             0             0             0    
    a723=47.4766        0             0             0            0            0             0             0             0             0             0             0             0    
    a724=47.5701        0             0             0            0            0             0             0             0             0             0             0             0    
    a725=47.6636        0             0             0            0            0             0             0             0             0             0             0             0    
    a726=47.757         0             0             0            0            0             0             0             0             0             0             0             0    
    a727=47.8505        0             0             0            0            0             0             0             0             0             0             0             0    
    a728=47.9439        0             0             0            0            0             0             0             0             0             0             0             0    
    a729=48.0374        0             0             0            0            0             0             0             0             0             0             0             0    
    a730=48.1308        0             0             0            0            0             0             0             0             0             0             0             0    
    a731=48.2243        0             0             0            0            0             0             0             0             0             0             0             0    
    a732=48.3178        0             0             0            0            0             0             0             0             0             0             0             0    
    a733=48.4112        0             0             0            0            0             0             0             0             0             0             0             0    
    a734=48.5047        0             0             0            0            0             0             0             0             0             0             0             0    
    a735=48.5981        0             0             0            0            0             0             0             0             0             0             0             0    
    a736=48.6916        0             0             0            0            0             0             0             0             0             0             0             0    
    a737=48.785         0             0             0            0            0             0             0             0             0             0             0             0    
    a738=48.8785        0             0             0            0            0             0             0             0             0             0             0             0    
    a739=48.972         0             0             0            0            0             0             0             0             0             0             0             0    
    a740=49.0654        0             0             0            0            0             0             0             0             0             0             0             0    
    a741=49.1589        0             0             0            0            0             0             0             0             0             0             0             0    
    a742=49.2523        0             0             0            0            0             0             0             0             0             0             0             0    
    a743=49.3458        0             0             0            0            0             0             0             0             0             0             0             0    
    a744=49.4393        0             0             0            0            0             0             0             0             0             0             0             0    
    a745=49.5327        0             0             0            0            0             0             0             0             0             0             0             0    
    a746=49.6262        0             0             0            0            0             0             0             0             0             0             0             0    
    a747=49.7196        0             0             0            0            0             0             0             0             0             0             0             0    
    a748=49.8131        0             0             0            0            0             0             0             0             0             0             0             0    
    a749=49.9065        0             0             0            0            0             0             0             0             0             0             0             0    
    a750=50             0             0             0            0            0             0             0             0             0             0             0             0    

mt_pol_inf_borr_nobridge_print: bridge loans
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20                  0             0             0            0       -0.335      -0.24154             0             0             0             0             0             0
    a2=-19.9065             0             0             0       -0.335     -0.24154      -0.14808             0             0             0             0             0             0
    a3=-19.8131             0             0        -0.335     -0.24154     -0.14808      -0.14808             0             0             0             0             0             0
    a4=-19.7196             0        -0.335      -0.24154     -0.14808    -0.054626     -0.054626             0             0             0             0             0             0
    a5=-19.6262        -0.335      -0.24154      -0.14808    -0.054626    -0.054626             0             0             0             0             0             0             0
    a6=-19.5327      -0.24154      -0.14808     -0.054626            0            0             0             0             0             0             0             0             0
    a7=-19.4393      -0.14808     -0.054626             0            0            0             0             0             0             0             0             0             0
    a8=-19.3458     -0.054626             0             0            0            0             0             0             0             0             0             0             0
    a9=-19.2523             0             0             0            0            0             0             0             0             0             0             0             0
    a10=-19.1589            0             0             0            0            0             0             0             0             0             0             0             0
    a11=-19.0654            0             0             0            0            0             0             0             0             0             0             0             0
    a12=-18.972             0             0             0            0            0             0             0             0             0             0             0       -2.2822
    a13=-18.8785            0             0             0            0            0             0             0             0             0             0             0       -2.1888
    a14=-18.785             0             0             0            0            0             0             0             0             0             0             0       -2.0953
    a15=-18.6916            0             0             0            0            0             0             0             0             0             0             0       -2.0018
    a16=-18.5981            0             0             0            0            0             0             0             0             0             0       -2.2822       -1.9084
    a17=-18.5047            0             0             0            0            0             0             0             0             0             0       -2.1888       -1.8149
    a18=-18.4112            0             0             0            0            0             0             0             0             0             0       -2.0953       -1.7215
    a19=-18.3178            0             0             0            0            0             0             0             0             0       -2.2822       -2.0018        -1.628
    a20=-18.2243            0             0             0            0            0             0             0             0             0       -2.1888       -1.9084       -1.5346
    a21=-18.1308            0             0             0            0            0             0             0             0             0       -2.0953       -1.8149       -1.4411
    a22=-18.0374            0             0             0            0            0             0             0             0       -2.2822       -2.0018       -1.7215       -1.3476
    a23=-17.9439            0             0             0            0            0             0             0             0       -2.1888       -1.9084        -1.628       -1.2542
    a24=-17.8505            0             0             0            0            0             0             0             0       -2.0953       -1.9084       -1.5346       -1.2542
    a25=-17.757             0             0             0            0            0             0             0       -2.2822       -2.0018       -1.8149       -1.4411       -1.1607
    a26=-17.6636            0             0             0            0            0             0             0       -2.1888       -1.9084       -1.7215       -1.3476       -1.0673
    a27=-17.5701            0             0             0            0            0             0       -2.2822       -2.0953       -1.8149        -1.628       -1.2542      -0.97381
    a28=-17.4766            0             0             0            0            0             0       -2.1888       -2.0018       -1.7215       -1.5346       -1.1607      -0.88035
    a29=-17.3832            0             0             0            0            0             0       -2.0953       -1.9084        -1.628       -1.4411       -1.1607      -0.78689
    a30=-17.2897            0             0             0            0            0             0       -2.0018       -1.8149        -1.628       -1.3476       -1.0673      -0.69343
    a31=-17.1963            0             0             0            0            0             0       -1.9084       -1.7215       -1.5346       -1.2542      -0.97381      -0.59998
    a32=-17.1028            0             0             0            0            0             0       -1.8149        -1.628       -1.4411       -1.1607      -0.88035      -0.50652
    a33=-17.0093            0             0             0            0      -2.2822       -2.2822       -1.7215       -1.5346       -1.3476       -1.0673      -0.78689      -0.41306
    a34=-16.9159            0             0             0      -2.2822      -2.1888       -2.1888        -1.628       -1.4411       -1.2542      -0.97381      -0.69343       -0.3196
    a35=-16.8224            0       -2.2822       -2.2822      -2.1888      -2.1888       -2.0953       -1.5346       -1.3476       -1.1607      -0.88035      -0.59998      -0.22614
    a36=-16.729       -2.2822       -2.1888       -2.1888      -2.0953      -2.0953       -2.0018       -1.4411       -1.2542       -1.0673      -0.78689      -0.50652      -0.13269
    a37=-16.6355      -2.1888       -2.0953       -2.0953      -2.0018      -2.0018       -1.9084       -1.3476       -1.1607      -0.97381      -0.69343      -0.41306     -0.039229
    a38=-16.5421      -2.0953       -2.0018       -2.0018      -1.9084      -1.9084       -1.8149       -1.2542       -1.0673      -0.88035      -0.59998       -0.3196             0
    a39=-16.4486      -2.0018       -1.9084       -1.9084      -1.8149      -1.8149       -1.7215       -1.1607      -0.97381      -0.78689      -0.50652      -0.22614             0
    a40=-16.3551      -1.9084       -1.8149       -1.8149      -1.7215      -1.7215        -1.628       -1.0673      -0.88035      -0.69343      -0.41306      -0.13269             0
    a41=-16.2617      -1.8149       -1.8149       -1.7215       -1.628       -1.628       -1.5346      -0.97381      -0.78689      -0.59998       -0.3196     -0.039229             0
    a42=-16.1682      -1.7215       -1.7215        -1.628      -1.5346      -1.5346       -1.4411      -0.88035      -0.69343      -0.50652      -0.22614             0             0
    a43=-16.0748       -1.628        -1.628       -1.5346      -1.4411      -1.4411       -1.3476      -0.78689      -0.59998      -0.41306      -0.13269             0             0
    a44=-15.9813      -1.5346       -1.5346       -1.4411      -1.4411      -1.3476       -1.2542      -0.69343      -0.50652       -0.3196     -0.039229             0             0
    a45=-15.8879      -1.4411       -1.4411       -1.3476      -1.3476      -1.2542       -1.1607      -0.59998      -0.50652      -0.22614     -0.039229             0             0
    a46=-15.7944      -1.3476       -1.3476       -1.2542      -1.2542      -1.1607       -1.0673      -0.59998      -0.41306      -0.13269             0             0             0
    a47=-15.7009      -1.2542       -1.2542       -1.1607      -1.1607      -1.0673      -0.97381      -0.50652       -0.3196     -0.039229             0             0             0
    a48=-15.6075      -1.1607       -1.1607       -1.0673      -1.0673     -0.97381      -0.88035      -0.41306      -0.22614     -0.039229             0             0             0
    a49=-15.514       -1.0673       -1.0673      -0.97381     -0.97381     -0.88035      -0.78689       -0.3196      -0.13269             0             0             0             0
    a50=-15.4206     -0.97381      -0.97381      -0.88035     -0.88035     -0.78689      -0.69343      -0.22614     -0.039229             0             0             0             0
    a701=45.4206            0             0             0            0            0             0             0             0             0             0             0             0
    a702=45.514             0             0             0            0            0             0             0             0             0             0             0             0
    a703=45.6075            0             0             0            0            0             0             0             0             0             0             0             0
    a704=45.7009            0             0             0            0            0             0             0             0             0             0             0             0
    a705=45.7944            0             0             0            0            0             0             0             0             0             0             0             0
    a706=45.8879            0             0             0            0            0             0             0             0             0             0             0             0
    a707=45.9813            0             0             0            0            0             0             0             0             0             0             0             0
    a708=46.0748            0             0             0            0            0             0             0             0             0             0             0             0
    a709=46.1682            0             0             0            0            0             0             0             0             0             0             0             0
    a710=46.2617            0             0             0            0            0             0             0             0             0             0             0             0
    a711=46.3551            0             0             0            0            0             0             0             0             0             0             0             0
    a712=46.4486            0             0             0            0            0             0             0             0             0             0             0             0
    a713=46.5421            0             0             0            0            0             0             0             0             0             0             0             0
    a714=46.6355            0             0             0            0            0             0             0             0             0             0             0             0
    a715=46.729             0             0             0            0            0             0             0             0             0             0             0             0
    a716=46.8224            0             0             0            0            0             0             0             0             0             0             0             0
    a717=46.9159            0             0             0            0            0             0             0             0             0             0             0             0
    a718=47.0093            0             0             0            0            0             0             0             0             0             0             0             0
    a719=47.1028            0             0             0            0            0             0             0             0             0             0             0             0
    a720=47.1963            0             0             0            0            0             0             0             0             0             0             0             0
    a721=47.2897            0             0             0            0            0             0             0             0             0             0             0             0
    a722=47.3832            0             0             0            0            0             0             0             0             0             0             0             0
    a723=47.4766            0             0             0            0            0             0             0             0             0             0             0             0
    a724=47.5701            0             0             0            0            0             0             0             0             0             0             0             0
    a725=47.6636            0             0             0            0            0             0             0             0             0             0             0             0
    a726=47.757             0             0             0            0            0             0             0             0             0             0             0             0
    a727=47.8505            0             0             0            0            0             0             0             0             0             0             0             0
    a728=47.9439            0             0             0            0            0             0             0             0             0             0             0             0
    a729=48.0374            0             0             0            0            0             0             0             0             0             0             0             0
    a730=48.1308            0             0             0            0            0             0             0             0             0             0             0             0
    a731=48.2243            0             0             0            0            0             0             0             0             0             0             0             0
    a732=48.3178            0             0             0            0            0             0             0             0             0             0             0             0
    a733=48.4112            0             0             0            0            0             0             0             0             0             0             0             0
    a734=48.5047            0             0             0            0            0             0             0             0             0             0             0             0
    a735=48.5981            0             0             0            0            0             0             0             0             0             0             0             0
    a736=48.6916            0             0             0            0            0             0             0             0             0             0             0             0
    a737=48.785             0             0             0            0            0             0             0             0             0             0             0             0
    a738=48.8785            0             0             0            0            0             0             0             0             0             0             0             0
    a739=48.972             0             0             0            0            0             0             0             0             0             0             0             0
    a740=49.0654            0             0             0            0            0             0             0             0             0             0             0             0
    a741=49.1589            0             0             0            0            0             0             0             0             0             0             0             0
    a742=49.2523            0             0             0            0            0             0             0             0             0             0             0             0
    a743=49.3458            0             0             0            0            0             0             0             0             0             0             0             0
    a744=49.4393            0             0             0            0            0             0             0             0             0             0             0             0
    a745=49.5327            0             0             0            0            0             0             0             0             0             0             0             0
    a746=49.6262            0             0             0            0            0             0             0             0             0             0             0             0
    a747=49.7196            0             0             0            0            0             0             0             0             0             0             0             0
    a748=49.8131            0             0             0            0            0             0             0             0             0             0             0             0
    a749=49.9065            0             0             0            0            0             0             0             0             0             0             0             0
    a750=50                 0             0             0            0            0             0             0             0             0             0             0             0

mt_pol_for_borr_print: formal borrowing
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20                 0             0             0            0      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a2=-19.9065            0             0             0      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a3=-19.8131            0             0       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a4=-19.7196            0       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a5=-19.6262      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a6=-19.5327      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a7=-19.4393      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a8=-19.3458      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a9=-19.2523      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a10=-19.1589     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a11=-19.0654     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665 
    a12=-18.972      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007 
    a13=-18.8785     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007 
    a14=-18.785      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007 
    a15=-18.6916     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007 
    a16=-18.5981     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007 
    a17=-18.5047     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007 
    a18=-18.4112     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007 
    a19=-18.3178     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007 
    a20=-18.2243     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007 
    a21=-18.1308     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007 
    a22=-18.0374     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007       -15.007 
    a23=-17.9439     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007       -15.007 
    a24=-17.8505     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -19.665       -15.007       -15.007       -15.007       -15.007 
    a25=-17.757      -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007 
    a26=-17.6636     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007 
    a27=-17.5701     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a28=-17.4766     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a29=-17.3832     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a30=-17.2897     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a31=-17.1963     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a32=-17.1028     -19.665       -19.665       -19.665      -19.665      -19.665       -19.665       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a33=-17.0093     -19.665       -19.665       -19.665      -19.665      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a34=-16.9159     -19.665       -19.665       -19.665      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a35=-16.8224     -19.665       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a36=-16.729      -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a37=-16.6355     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a38=-16.5421     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a39=-16.4486     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a40=-16.3551     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a41=-16.2617     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a42=-16.1682     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a43=-16.0748     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a44=-15.9813     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a45=-15.8879     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a46=-15.7944     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a47=-15.7009     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a48=-15.6075     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a49=-15.514      -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a50=-15.4206     -15.007       -15.007       -15.007      -15.007      -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007       -15.007 
    a701=45.4206           0             0             0            0            0             0             0             0             0             0             0             0 
    a702=45.514            0             0             0            0            0             0             0             0             0             0             0             0 
    a703=45.6075           0             0             0            0            0             0             0             0             0             0             0             0 
    a704=45.7009           0             0             0            0            0             0             0             0             0             0             0             0 
    a705=45.7944           0             0             0            0            0             0             0             0             0             0             0             0 
    a706=45.8879           0             0             0            0            0             0             0             0             0             0             0             0 
    a707=45.9813           0             0             0            0            0             0             0             0             0             0             0             0 
    a708=46.0748           0             0             0            0            0             0             0             0             0             0             0             0 
    a709=46.1682           0             0             0            0            0             0             0             0             0             0             0             0 
    a710=46.2617           0             0             0            0            0             0             0             0             0             0             0             0 
    a711=46.3551           0             0             0            0            0             0             0             0             0             0             0             0 
    a712=46.4486           0             0             0            0            0             0             0             0             0             0             0             0 
    a713=46.5421           0             0             0            0            0             0             0             0             0             0             0             0 
    a714=46.6355           0             0             0            0            0             0             0             0             0             0             0             0 
    a715=46.729            0             0             0            0            0             0             0             0             0             0             0             0 
    a716=46.8224           0             0             0            0            0             0             0             0             0             0             0             0 
    a717=46.9159           0             0             0            0            0             0             0             0             0             0             0             0 
    a718=47.0093           0             0             0            0            0             0             0             0             0             0             0             0 
    a719=47.1028           0             0             0            0            0             0             0             0             0             0             0             0 
    a720=47.1963           0             0             0            0            0             0             0             0             0             0             0             0 
    a721=47.2897           0             0             0            0            0             0             0             0             0             0             0             0 
    a722=47.3832           0             0             0            0            0             0             0             0             0             0             0             0 
    a723=47.4766           0             0             0            0            0             0             0             0             0             0             0             0 
    a724=47.5701           0             0             0            0            0             0             0             0             0             0             0             0 
    a725=47.6636           0             0             0            0            0             0             0             0             0             0             0             0 
    a726=47.757            0             0             0            0            0             0             0             0             0             0             0             0 
    a727=47.8505           0             0             0            0            0             0             0             0             0             0             0             0 
    a728=47.9439           0             0             0            0            0             0             0             0             0             0             0             0 
    a729=48.0374           0             0             0            0            0             0             0             0             0             0             0             0 
    a730=48.1308           0             0             0            0            0             0             0             0             0             0             0             0 
    a731=48.2243           0             0             0            0            0             0             0             0             0             0             0             0 
    a732=48.3178           0             0             0            0            0             0             0             0             0             0             0             0 
    a733=48.4112           0             0             0            0            0             0             0             0             0             0             0             0 
    a734=48.5047           0             0             0            0            0             0             0             0             0             0             0             0 
    a735=48.5981           0             0             0            0            0             0             0             0             0             0             0             0 
    a736=48.6916           0             0             0            0            0             0             0             0             0             0             0             0 
    a737=48.785            0             0             0            0            0             0             0             0             0             0             0             0 
    a738=48.8785           0             0             0            0            0             0             0             0             0             0             0             0 
    a739=48.972            0             0             0            0            0             0             0             0             0             0             0             0 
    a740=49.0654           0             0             0            0            0             0             0             0             0             0             0             0 
    a741=49.1589           0             0             0            0            0             0             0             0             0             0             0             0 
    a742=49.2523           0             0             0            0            0             0             0             0             0             0             0             0 
    a743=49.3458           0             0             0            0            0             0             0             0             0             0             0             0 
    a744=49.4393           0             0             0            0            0             0             0             0             0             0             0             0 
    a745=49.5327           0             0             0            0            0             0             0             0             0             0             0             0 
    a746=49.6262           0             0             0            0            0             0             0             0             0             0             0             0 
    a747=49.7196           0             0             0            0            0             0             0             0             0             0             0             0 
    a748=49.8131           0             0             0            0            0             0             0             0             0             0             0             0 
    a749=49.9065           0             0             0            0            0             0             0             0             0             0             0             0 
    a750=50                0             0             0            0            0             0             0             0             0             0             0             0 

mt_pol_for_save_print: formal savings
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20                  0             0            0            0             0             0      0.13229       0.31921        0.50612       0.69304        1.0669       1.3472 
    a2=-19.9065             0             0            0            0             0             0      0.22575       0.31921        0.59958        0.7865        1.1603       1.4407 
    a3=-19.8131             0             0            0            0             0             0      0.31921       0.41266        0.69304       0.87995        1.1603       1.5342 
    a4=-19.7196             0             0            0            0             0             0      0.31921       0.50612        0.69304       0.97341        1.2538       1.6276 
    a5=-19.6262             0             0            0            0             0      0.038832      0.41266       0.59958         0.7865        1.0669        1.3472       1.7211 
    a6=-19.5327             0             0            0     0.038832      0.038832       0.13229      0.50612       0.69304        0.87995        1.1603        1.4407       1.8145 
    a7=-19.4393             0             0     0.038832     0.038832       0.13229       0.22575      0.59958        0.7865        0.97341        1.2538        1.5342        1.908 
    a8=-19.3458             0      0.038832      0.13229      0.13229       0.22575       0.31921      0.69304       0.87995         1.0669        1.3472        1.6276       2.0014 
    a9=-19.2523      0.038832       0.13229      0.22575      0.22575       0.31921       0.31921       0.7865       0.97341         1.1603        1.4407        1.7211       2.0949 
    a10=-19.1589      0.13229       0.22575      0.22575      0.31921       0.41266       0.41266      0.87995        1.0669         1.2538        1.5342        1.8145       2.1884 
    a11=-19.0654      0.22575       0.31921      0.31921      0.41266       0.50612       0.50612      0.97341        1.1603         1.3472        1.6276         1.908       2.2818 
    a12=-18.972       0.31921       0.41266      0.41266      0.50612       0.50612       0.59958       1.0669        1.2538         1.4407        1.7211        2.0014            0 
    a13=-18.8785      0.41266       0.50612      0.50612      0.59958       0.59958       0.69304       1.1603        1.3472         1.5342        1.8145        2.0949            0 
    a14=-18.785       0.50612       0.59958      0.59958      0.69304       0.69304        0.7865       1.2538        1.4407         1.6276         1.908        2.1884            0 
    a15=-18.6916      0.59958       0.59958      0.69304      0.69304        0.7865       0.87995       1.3472        1.5342         1.7211        2.0014        2.2818            0 
    a16=-18.5981      0.69304       0.69304       0.7865       0.7865       0.87995       0.97341       1.4407        1.6276         1.8145        2.0949             0            0 
    a17=-18.5047       0.7865        0.7865      0.87995      0.87995       0.97341        1.0669       1.4407        1.6276          1.908        2.1884             0            0 
    a18=-18.4112      0.87995       0.87995      0.97341      0.97341        1.0669        1.0669       1.5342        1.7211         2.0014        2.2818             0            0 
    a19=-18.3178      0.97341       0.97341       1.0669       1.0669        1.1603        1.1603       1.6276        1.8145         2.0949             0             0            0 
    a20=-18.2243       1.0669        1.0669       1.0669       1.1603        1.2538        1.2538       1.7211         1.908         2.1884             0             0            0 
    a21=-18.1308       1.0669        1.1603       1.1603       1.2538        1.3472        1.3472       1.8145        2.0014         2.2818             0             0            0 
    a22=-18.0374       1.1603        1.2538       1.2538       1.3472        1.3472        1.4407        1.908        2.0949              0             0             0            0 
    a23=-17.9439       1.2538        1.3472       1.3472       1.4407        1.4407        1.5342       2.0014        2.1884              0             0             0            0 
    a24=-17.8505       1.3472        1.4407       1.4407       1.5342        1.5342        1.6276       2.0949        2.2818              0             0             0            0 
    a25=-17.757        1.4407        1.5342       1.5342       1.6276        1.6276        1.7211       2.1884             0              0             0             0            0 
    a26=-17.6636       1.5342        1.5342       1.6276       1.6276        1.7211        1.8145       2.2818             0              0             0             0            0 
    a27=-17.5701       1.6276        1.6276       1.7211       1.7211        1.8145         1.908            0             0              0             0             0            0 
    a28=-17.4766       1.7211        1.7211       1.8145       1.8145         1.908        2.0014            0             0              0             0             0            0 
    a29=-17.3832       1.8145        1.8145        1.908        1.908        2.0014        2.0949            0             0              0             0             0            0 
    a30=-17.2897        1.908         1.908       2.0014       2.0014        2.0949        2.1884            0             0              0             0             0            0 
    a31=-17.1963       2.0014        2.0014       2.0949       2.0949        2.1884        2.1884            0             0              0             0             0            0 
    a32=-17.1028       2.0949        2.0949       2.0949       2.1884        2.2818        2.2818            0             0              0             0             0            0 
    a33=-17.0093       2.0949        2.1884       2.1884       2.2818             0             0            0             0              0             0             0            0 
    a34=-16.9159       2.1884        2.2818       2.2818            0             0             0            0             0              0             0             0            0 
    a35=-16.8224       2.2818             0            0            0             0             0            0             0              0             0             0            0 
    a36=-16.729             0             0            0            0             0             0            0             0              0             0             0            0 
    a37=-16.6355            0             0            0            0             0             0            0             0              0             0             0            0 
    a38=-16.5421            0             0            0            0             0             0            0             0              0             0             0     0.054229 
    a39=-16.4486            0             0            0            0             0             0            0             0              0             0             0      0.14769 
    a40=-16.3551            0             0            0            0             0             0            0             0              0             0             0      0.24114 
    a41=-16.2617            0             0            0            0             0             0            0             0              0             0             0       0.3346 
    a42=-16.1682            0             0            0            0             0             0            0             0              0             0      0.054229      0.42806 
    a43=-16.0748            0             0            0            0             0             0            0             0              0             0       0.14769      0.52152 
    a44=-15.9813            0             0            0            0             0             0            0             0              0             0       0.24114      0.61498 
    a45=-15.8879            0             0            0            0             0             0            0             0              0             0        0.3346      0.70843 
    a46=-15.7944            0             0            0            0             0             0            0             0              0      0.054229       0.42806      0.80189 
    a47=-15.7009            0             0            0            0             0             0            0             0              0       0.14769       0.52152      0.89535 
    a48=-15.6075            0             0            0            0             0             0            0             0              0       0.24114       0.61498      0.98881 
    a49=-15.514             0             0            0            0             0             0            0             0       0.054229        0.3346       0.70843       1.0823 
    a50=-15.4206            0             0            0            0             0             0            0             0        0.14769       0.42806       0.70843       1.1757 
    a701=45.4206       42.804        42.804       42.897       42.897        42.991        43.084       43.645        43.832         44.112        44.393        44.673       45.047 
    a702=45.514        42.897        42.897       42.991       42.991        43.084        43.178       43.738        43.925         44.206        44.486        44.766        45.14 
    a703=45.6075       42.991        42.991       43.084       43.084        43.178        43.271       43.832        44.019         44.299        44.579         44.86       45.234 
    a704=45.7009       42.991        43.084       43.178       43.178        43.271        43.364       43.925        44.112         44.393        44.579        44.953       45.327 
    a705=45.7944       43.084        43.178       43.271       43.271        43.364        43.458       44.019        44.206         44.486        44.673        45.047       45.421 
    a706=45.8879       43.178        43.271       43.364       43.364        43.458        43.551       44.112        44.299         44.486        44.766         45.14       45.514 
    a707=45.9813       43.271        43.364       43.364       43.458        43.551        43.645       44.206        44.393         44.579         44.86        45.234       45.607 
    a708=46.0748       43.364        43.458       43.458       43.551        43.645        43.738       44.299        44.486         44.673        44.953        45.327       45.701 
    a709=46.1682       43.458        43.551       43.551       43.645        43.738        43.832       44.393        44.579         44.766        45.047        45.421       45.794 
    a710=46.2617       43.551        43.645       43.645       43.738        43.832        43.925       44.486        44.673          44.86         45.14        45.514       45.888 
    a711=46.3551       43.645        43.738       43.738       43.832        43.925        44.019       44.579        44.766         44.953        45.234        45.607       45.981 
    a712=46.4486       43.738        43.832       43.832       43.925        44.019        44.112       44.673         44.86         45.047        45.327        45.701       46.075 
    a713=46.5421       43.832        43.925       43.925       44.019        44.112        44.206       44.766        44.953          45.14        45.421        45.794       46.168 
    a714=46.6355       43.925        44.019       44.019       44.112        44.206        44.299        44.86        45.047         45.234        45.514        45.888       46.262 
    a715=46.729        44.019        44.112       44.112       44.206        44.299        44.393       44.953         45.14         45.327        45.607        45.981       46.355 
    a716=46.8224       44.112        44.206       44.206       44.299        44.393        44.486       45.047        45.234         45.421        45.701        46.075       46.449 
    a717=46.9159       44.206        44.299       44.299       44.393        44.486        44.579        45.14        45.327         45.514        45.794        46.168       46.542 
    a718=47.0093       44.299        44.393       44.393       44.486        44.579        44.673        45.14        45.421         45.607        45.888        46.262       46.636 
    a719=47.1028       44.393        44.486       44.486       44.579        44.673        44.766       45.234        45.514         45.701        45.981        46.355       46.729 
    a720=47.1963       44.486        44.579       44.579       44.673        44.766         44.86       45.327        45.607         45.794        46.075        46.449       46.822 
    a721=47.2897       44.579        44.673       44.673       44.766         44.86        44.953       45.421        45.701         45.888        46.168        46.449       46.916 
    a722=47.3832       44.673        44.673       44.766        44.86        44.953        45.047       45.514        45.794         45.981        46.262        46.542       47.009 
    a723=47.4766       44.766        44.766        44.86       44.953        45.047        45.047       45.607        45.794         46.075        46.355        46.636       47.009 
    a724=47.5701        44.86         44.86       44.953       45.047        45.047         45.14       45.701        45.888         46.168        46.449        46.729       47.103 
    a725=47.6636       44.953        44.953       45.047        45.14         45.14        45.234       45.794        45.981         46.262        46.542        46.822       47.196 
    a726=47.757        45.047        45.047        45.14       45.234        45.234        45.327       45.888        46.075         46.355        46.636        46.916        47.29 
    a727=47.8505        45.14         45.14       45.234       45.327        45.327        45.421       45.981        46.168         46.449        46.729        47.009       47.383 
    a728=47.9439       45.234        45.234       45.327       45.421        45.421        45.514       46.075        46.262         46.542        46.822        47.103       47.477 
    a729=48.0374       45.327        45.327       45.421       45.514        45.514        45.607       46.168        46.355         46.636        46.916        47.196        47.57 
    a730=48.1308       45.421        45.421       45.514       45.607        45.607        45.701       46.262        46.449         46.729        47.009         47.29       47.664 
    a731=48.2243       45.514        45.514       45.607       45.607        45.701        45.794       46.355        46.542         46.822        47.103        47.383       47.757 
    a732=48.3178       45.607        45.607       45.701       45.701        45.794        45.888       46.449        46.636         46.916        47.196        47.477        47.85 
    a733=48.4112       45.701        45.701       45.794       45.794        45.888        45.981       46.542        46.729         47.009         47.29         47.57       47.944 
    a734=48.5047       45.794        45.794       45.888       45.888        45.981        46.075       46.636        46.822         47.103        47.383        47.664       48.037 
    a735=48.5981       45.888        45.888       45.981       45.981        46.075        46.168       46.729        46.916         47.196        47.477        47.757       48.131 
    a736=48.6916       45.981        45.981       46.075       46.075        46.168        46.262       46.822        47.009          47.29         47.57         47.85       48.224 
    a737=48.785        46.075        46.075       46.168       46.168        46.262        46.355       46.916        47.103         47.383        47.664        47.944       48.318 
    a738=48.8785       46.168        46.168       46.262       46.262        46.355        46.449       47.009        47.196         47.477        47.757        48.037       48.411 
    a739=48.972        46.262        46.262       46.355       46.355        46.449        46.542       47.103         47.29          47.57         47.85        48.131       48.505 
    a740=49.0654       46.262        46.355       46.449       46.449        46.542        46.636       47.196        47.383         47.664         47.85        48.224       48.598 
    a741=49.1589       46.355        46.449       46.542       46.542        46.636        46.729        47.29        47.477         47.757        47.944        48.318       48.692 
    a742=49.2523       46.449        46.542       46.542       46.636        46.729        46.822       47.383         47.57         47.757        48.037        48.411       48.785 
    a743=49.3458       46.542        46.636       46.636       46.729        46.822        46.916       47.477        47.664          47.85        48.131        48.505       48.879 
    a744=49.4393       46.636        46.729       46.729       46.822        46.916        47.009        47.57        47.757         47.944        48.224        48.598       48.972 
    a745=49.5327       46.729        46.822       46.822       46.916        47.009        47.103       47.664         47.85         48.037        48.318        48.692       49.065 
    a746=49.6262       46.822        46.916       46.916       47.009        47.103        47.196       47.757        47.944         48.131        48.411        48.785       49.159 
    a747=49.7196       46.916        47.009       47.009       47.103        47.196         47.29        47.85        48.037         48.224        48.505        48.879       49.252 
    a748=49.8131       47.009        47.103       47.103       47.196         47.29        47.383       47.944        48.131         48.318        48.598        48.972       49.346 
    a749=49.9065       47.103        47.196       47.196        47.29        47.383        47.477       48.037        48.224         48.411        48.692        49.065       49.439 
    a750=50            47.196         47.29        47.29       47.383        47.477         47.57       48.131        48.318         48.505        48.785        49.159       49.533 

</pre><img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_01.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_02.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_03.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_04.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_05.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_06.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_07.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_08.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_09.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_10.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_11.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_12.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_13.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_14.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_15.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_16.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_17.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_18.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_19.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_20.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_21.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_22.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_23.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_24.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_25.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_26.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_27.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_28.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_29.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_fibs_vf_vecsv_30.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 23
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Solve For+Inf+Borr+Save Dynamic Programming Problem (Optimized-Vectorized)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function result_map = ff_abz_fibs_vf_vecsv(varargin)
%% FF_ABZ_FIBS_VF_VECSV solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic single asset and single
% shock problem with vectorized codes.
% <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_fibs_vf.html
% ff_abz_fibs_vf> shows looped codes. The solution is the same.
%
% The model could be invoked mainly in sveral ways:
%
% # param_map('bl_default') = true;  param_map('bl_bridge') = false;
% param_map('bl_rollover') = true; Given these, default is possible, bridge
% loans are not needed because rollover is allowed for formal loans (or
% informal loans)
% # we change param_map('bl_bridge') = true, that means
% rollover is still allowed, but only allowed using informal sources,
% formal loans no longer allow for roll-over. Furthermore, if both
% bl_bridge and bl_rollover are false, that means we are not allowing for
% rollover at all, so households can not borrow such that they end up with
% negative cash-on-hand.
%
% Default simulation bl_bridge = false.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables.
%
% @example
%
%    % Get Default Parameters
%    it_param_set = 4;
%    [param_map, support_map] = ffs_abz_fibs_set_default_param(it_param_set);
%    % Chnage param_map keys for borrowing
%    param_map('fl_b_bd') = -20; % borrow bound
%    param_map('bl_default') = false; % true if allow for default
%    param_map('fl_c_min') = 0.0001; % u(c_min) when default
%    % Change Keys in param_map
%    param_map('it_a_n') = 500;
%    param_map('it_z_n') = 11;
%    param_map('fl_a_max') = 100;
%    param_map('fl_w') = 1.3;
%    param_map('fl_r_inf') = 0.06;
%    param_map('fl_r_fsv') = 0.01;
%    param_map('fl_r_fbr') = 0.035;
%    param_map('bl_b_is_principle') = false;
%    % see: ffs_for_br_block.m
%    param_map('st_forbrblk_type') = 'seg3';
%    param_map('fl_forbrblk_brmost') = -10;
%    param_map('fl_forbrblk_brleast') = -1;
%    param_map('fl_forbrblk_gap') = -1;
%    % Change Keys support_map
%    support_map('bl_display') = false;
%    support_map('bl_post') = true;
%    support_map('bl_display_final') = false;
%    % Call Program with external parameters that override defaults.
%    ff_abz_fibs_vf_vecsv(param_map, support_map);
%
%
% @include
%
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_set_default_param.html ffs_abz_fibs_set_default_param>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_get_funcgrid.html ffs_abz_fibs_get_funcgrid>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost_bridge.html ffs_fibs_min_c_cost_bridge>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_inf_bridge.html ffs_fibs_inf_bridge>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc_fibs/html/ffs_fibs_min_c_cost.html ffs_fibs_min_c_cost>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html ff_az_vf_post>
%
% @seealso
%
% * for/inf + save + borr loop: <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf.html ff_abz_fibs_vf>
% * for/inf + borr vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf_vec.html ff_abz_fibs_vf_vec>
% * for/inf + borr optimized-vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/m_abz_solve/html/ff_abz_fibs_vf_vecsv.html ff_abz_fibs_vf_vecsv>
%

%% Default
%
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button
%
% go to
% <https://fanwangecon.github.io/CodeDynaAsset/m_fibs/paramfunc/html/ffs_abz_fibs_fibs_set_default_param.html
% ffs_abz_fibs_fibs_set_default_param> to change parameters in param_map container.
% The parameters can also be updated here directly after obtaining them
% from ffs_abz_fibs_set_default_param as we possibly change it_a_n and it_z_n
% here.

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_abz_fibs_set_default_param(it_param_set);

% Note: param_map and support_map can be adjusted here or outside to override defaults
% To generate results as if formal informal do not matter
% param_map('fl_r_fsv') = 0.025;
% param_map('fl_r_inf') = 0.035;
% param_map('fl_r_inf_bridge') = 0.035;
% param_map('fl_r_fbr') = 0.035;
% param_map('bl_b_is_principle') = false;
% param_map('st_forbrblk_type') = 'seg3';
% param_map('fl_forbrblk_brmost') = -19;
% param_map('fl_forbrblk_brleast') = -1;
% param_map('fl_forbrblk_gap') = -1.5;
% param_map('bl_b_is_principle') = false;
% param_map('it_a_n') = 750;
% param_map('it_z_n') = 15;

[armt_map, func_map] = ffs_abz_fibs_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_abz_fibs_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

% append function name
st_func_name = 'ff_abz_fibs_vf_vecsv';
support_map('st_profile_name_main') = [st_func_name support_map('st_profile_name_main')];
support_map('st_mat_name_main') = [st_func_name support_map('st_mat_name_main')];
support_map('st_img_name_main') = [st_func_name support_map('st_img_name_main')];

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_a', 'mt_z_trans', 'ar_z'});
[ar_a, mt_z_trans, ar_z] = params_group{:};

% Formal choice Menu/Grid and Interest Rate Menu/Grid
params_group = values(armt_map, {'ar_forbrblk_r', 'ar_forbrblk'});
[ar_forbrblk_r, ar_forbrblk] = params_group{:};

% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_coh', 'f_cons_coh_fbis', 'f_cons_coh_save'});
[f_util_log, f_util_crra, f_coh, f_cons_coh_fbis, f_cons_coh_save] = params_group{:};

% param_map
params_group = values(param_map, {'it_a_n', 'it_z_n', 'fl_crra', 'fl_beta', 'fl_c_min',...
    'fl_nan_replace', 'bl_default', 'bl_bridge', 'bl_rollover', 'fl_default_aprime'});
[it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min, ...
    fl_nan_replace, bl_default, bl_bridge, bl_rollover, fl_default_aprime] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

% param_map, Formal informal
params_group = values(param_map, {'fl_r_inf', 'fl_r_fsv', 'bl_b_is_principle'});
[fl_r_inf, fl_r_fsv, bl_b_is_principle] = params_group{:};

% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_display_minccost', 'bl_display_infbridge', ...
    'bl_time', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_display_minccost, bl_display_infbridge, ...
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes
% include mt_pol_idx which we did not have in looped code

mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_idx = zeros(length(ar_a),length(ar_z));
mt_pol_cons = zeros(length(ar_a),length(ar_z));

% collect optimal borrowing formal and informal choices
mt_pol_b_bridge = zeros(length(ar_a),length(ar_z));
mt_pol_inf_borr_nobridge = zeros(length(ar_a),length(ar_z));
mt_pol_for_borr = zeros(length(ar_a),length(ar_z));
mt_pol_for_save = zeros(length(ar_a),length(ar_z));

% We did not need these in ff_abz_vf or ff_abz_vf_vec
% see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why store using cells.
cl_u_c_store = cell([it_z_n, 1]);
cl_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;
    
    %% Solve Optimization Problem Current Iteration
    
    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)
        
        %% Solve the Formal Informal Problem for each a' and coh: c_forinf(a')
        % find the today's consumption maximizing formal and informal
        % choices given a' and coh. The formal and informal choices need to
        % generate exactly a', but depending on which formal and informal
        % joint choice is used, the consumption cost today a' is different.
        % Note here, a is principle + interests. Three areas:
        %
        % * *CASE A* a' > 0: savings, do not need to optimize over formal and
        % informal choices
        % * *CASE B* a' < 0 & coh < 0: need bridge loan to pay for unpaid debt, and
        % borrowing over-all, need to first pick bridge loan to pay for
        % debt, if bridge loan is insufficient, go into default. After
        % bridge loan, optimize over formal+informal, borrow+save joint
        % choices.
        % * *CASE C* a' < 0 & coh > 0: do not need to get informal bridge loans,
        % optimize over for+inf save, for+save+borr, inf+borr only, for
        % borrow only.
        %
        
        % 1. Current Shock
        fl_z = ar_z(it_z_i);
        
        % 2. cash-on-hand
        ar_coh = f_coh(fl_z, ar_a);
        
        % Consumption and u(c) only need to be evaluated once
        if (it_iter == 1)
            
            % 3. *CASE A* initiate consumption matrix as if all save
            mt_c = f_cons_coh_save(ar_coh, ar_a');
            
            % 4. *CASE B+C* get negative coh index and get borrowing choices index
            ar_coh_neg_idx = (ar_coh <= 0);
            ar_a_neg_idx = (ar_a < 0);
            ar_coh_neg = ar_coh(ar_coh_neg_idx);
            ar_a_neg = ar_a(ar_a_neg_idx);
            
            % 5. if coh > 0 and ap < 0, can allow same for+inf result to all coh.
            % The procedure below works regardless of how ar_coh is sorted. get
            % the index of all negative coh elements as well as first
            % non-negative element. We solve the formal and informal problem at
            % these points, note that we only need to solve the formal and
            % informal problem for positive coh level once.
            ar_coh_first_pos_idx = (cumsum(ar_coh_neg_idx == 0) == 1);
            ar_coh_forinfsolve_idx = (ar_coh_first_pos_idx | ar_coh_neg_idx);
            ar_coh_forinfsolve_a_neg_idx = (ar_coh(ar_coh_forinfsolve_idx) <= 0);
            
            % 6. *CASE B + C* Negative asset choices (borrowing), 1 col Case C
            % negp1: negative coh + 1, 1 meaning 1 positive coh, first positive
            % coh column index element grabbed.
            mt_coh_negp1_mesh_neg_aprime = zeros(size(ar_a_neg')) + ar_coh(ar_coh_forinfsolve_idx);
            mt_neg_aprime_mesh_coh_negp1 = zeros(size(mt_coh_negp1_mesh_neg_aprime)) + ar_a_neg';
            
            if (bl_bridge)
                %         mt_neg_aprime_mesh_coh_1col4poscoh = zeros([length(ar_a_neg), (length(ar_coh_neg)+1)]) + ar_a_neg';
                %         ar_coh_neg_idx_1col4poscoh = ar_coh_neg_idx(1:(length(ar_coh_neg)+1));
                
                % 6. *CASE B* Solve for: if (fl_ap < 0) and if (fl_coh < 0)
                [mt_aprime_nobridge_negcoh, ~, mt_c_bridge_negcoh] = ffs_fibs_inf_bridge(...
                    bl_b_is_principle, fl_r_inf, ...
                    mt_neg_aprime_mesh_coh_negp1(:,ar_coh_forinfsolve_a_neg_idx), ...
                    mt_coh_negp1_mesh_neg_aprime(:,ar_coh_forinfsolve_a_neg_idx), ...
                    bl_display_infbridge, bl_input_override);
                
                % generate mt_aprime_nobridge
                mt_neg_aprime_mesh_coh_negp1(:, ar_coh_forinfsolve_a_neg_idx) = mt_aprime_nobridge_negcoh;
            else
                % no bridge loan needed means roll over is allowed.
                mt_neg_aprime_mesh_coh_negp1 = ar_a_neg';
            end
            
            % 7. *CASE B + C* formal and informal joint choices, 1 col Case C
            bl_input_override = true;
            [ar_max_c_nobridge, ~, ~, ~] = ...
                ffs_fibs_min_c_cost(...
                bl_b_is_principle, fl_r_inf, fl_r_fsv, ...
                ar_forbrblk_r, ar_forbrblk, ...
                mt_neg_aprime_mesh_coh_negp1(:), ...
                bl_display_minccost, bl_input_override);
            
            %% Update Consumption Matrix *CASE A + B + C* Consumptions
            % Current mt_c is assuming all to be case A
            %
            % * Update Columns for case B (negative coh)
            % * Update Columns for case C (1 column): ar_coh_first_pos_idx,
            % included in ar_coh_forinfsolve_idx
            % * Update Columns for all case C: ~ar_coh_neg_idx using 1 column
            % result
            %
            
            % 1. Initalize all Neg Aprime consumption cost of aprime inputs
            % Initialize
            mt_max_c_nobridge_a_neg = zeros([length(ar_a_neg), length(ar_coh)]) + 0;
            mt_c_bridge_coh_a_neg = zeros(size(mt_max_c_nobridge_a_neg)) + 0;
            
            % 2. Fill in *Case B* and *Case C* (one column) Other C-cost
            mt_max_c_nobridge_negcohp1 = reshape(ar_max_c_nobridge, [size(mt_neg_aprime_mesh_coh_negp1)]);
            
            if (bl_bridge)
                % 2. Fill in *Case B* Bridge C-cost
                mt_c_bridge_coh_a_neg(:, ar_coh_neg_idx) = mt_c_bridge_negcoh;
                
                % 2. Fill in *Case B* and *Case C* (one column) Other C-cost
                mt_max_c_nobridge_a_neg(:, ar_coh_forinfsolve_idx) = mt_max_c_nobridge_negcohp1;
                mt_max_c_nobridge_a_neg(:, ~ar_coh_forinfsolve_idx) = ...
                    zeros(size(mt_c(ar_a_neg_idx, ~ar_coh_forinfsolve_idx))) ...
                    + mt_max_c_nobridge_negcohp1(:, ~ar_coh_forinfsolve_a_neg_idx);
            else
                mt_max_c_nobridge_a_neg = zeros([length(ar_a_neg), length(ar_coh)]) + mt_max_c_nobridge_negcohp1;
            end
            
            % 3. Consumption for B + C Cases
            % note, the c cost of aprime is the same for all coh > 0, but mt_c
            % is different still for each coh and aprime.
            mt_c_forinfsolve = f_cons_coh_fbis(ar_coh, mt_c_bridge_coh_a_neg + mt_max_c_nobridge_a_neg);
            
            % 4. Update with Case B and C
            mt_c(ar_a_neg_idx, :) = mt_c_forinfsolve;
            
            %% Evaluate u(c) and store
            % 1. EVAL current utility: N by N, f_util defined earlier
            if (fl_crra == 1)
                mt_utility = log(mt_c);
                fl_u_cmin = f_util_log(fl_c_min);
            else
                mt_utility = f_util_crra(mt_c);
                fl_u_cmin = f_util_crra(fl_c_min);
            end
            
            % 2. Invliad consumption points
            mt_it_c_valid_idx = (mt_c <= fl_c_min);
            % Set below threshold c to c_min
            mt_c(mt_c < fl_c_min) = fl_c_min;
            
            % 3. Invalid points if bridge not possible also no rollover
            if( ~bl_rollover && ~bl_bridge)
                mt_it_c_valid_idx(:, ar_coh_neg_idx) = 1;
            end
            
            % 4. Eliminate Complex Numbers
            mt_utility(mt_it_c_valid_idx) = fl_u_cmin;
            
            % 5. Store in cells
            cl_c_store{it_z_i} = mt_c;
            cl_u_c_store{it_z_i} = mt_utility;
            cl_c_valid_idx{it_z_i} = mt_it_c_valid_idx;
            
        end
        
        %% Solve Optimization Problem: max_{a'} (u(c_forinf(a')) + EV(a',z'))
        
        % 1. f(z'|z)
        ar_z_trans_condi = mt_z_trans(it_z_i,:);
        
        % 2. EVAL EV((A',K'),Z'|Z) = V((A',K'),Z') x p(z'|z)', (N by Z) x (Z by 1) = N by 1
        % Note: transpose ar_z_trans_condi from 1 by Z to Z by 1
        % Note: matrix multiply not dot multiply
        mt_evzp_condi_z = mt_val_cur * ar_z_trans_condi';
        
        % 3. EVAL add on future utility, N by N + N by 1, broadcast again
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_evzp_condi_z;
        
        % 4. Index update
        % using the method below is much faster than index replace
        % see <https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        % Default or Not Utility Handling
        if (bl_default)
            % if default: only today u(cmin), transition out next period, debt wiped out
            fl_v_default = fl_u_cmin + fl_beta*mt_evzp_condi_z(ar_a == fl_default_aprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        else
            % if default is not allowed: v = u(cmin)
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        end
        
        % Optimization: remember matlab is column major, rows must be
        % choices, columns must be states
        % <https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR>
        % mt_utility is N by N, rows are choices, cols are states.
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;
        ar_opti_aprime_z = ar_a(ar_opti_idx_z);
        ar_opti_c_z = cl_c_store{it_z_i}(ar_opti_linear_idx_z);
        
        % Handle Default is optimal or not
        if (bl_default)
            % if defaulting is optimal choice, at these states, not required
            % to default, non-default possible, but default could be optimal
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = fl_default_aprime;
            ar_opti_idx_z(ar_opti_c_z <= fl_c_min) = find(ar_a == fl_default_aprime);
        else
            % if default is not allowed, then next period same state as now
            % this is absorbing state, this is the limiting case, single
            % state space point, lowest a and lowest shock has this.
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = min(ar_a);
        end
        
        % 6. no bridge and no rollover allowed
        if( ~bl_rollover && ~bl_bridge)
            if (bl_default)
                % if default: only today u(cmin), transition out next period, debt wiped out
                ar_opti_aprime_z(ar_coh_neg_idx) = fl_default_aprime;
            else
                % if default is not allowed: v = fl_nan_replace
                ar_opti_aprime_z(ar_coh_neg_idx) = ar_a(fl_nan_replace);
            end
        end
        
        % store optimal values
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_cons(:,it_z_i) = ar_opti_c_z;
        
        if (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_idx_z;
        end
    end
    
    %% Check Tolerance and Continuation
    
    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);
    
    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    
    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); ...
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'Hval', 'Hap'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('Hval = mt_val_cur(it_a_n,:), highest a state val')
        disp('Hap = mt_pol_a_cur(it_a_n,:), highest a state choice')
        disp(tb_valpol_iter);
    end
    
    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    end
    
end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_idx') = mt_pol_idx;

% Find optimal Formal Informal Choices. Could have saved earlier, but was
% wasteful of resources
for it_z_i = 1:length(ar_z)
    for it_a_j = 1:length(ar_a)
        fl_z = ar_z(it_z_i);
        fl_a = ar_a(it_a_j);
        fl_coh = f_coh(fl_z, fl_a);
        fl_a_opti = mt_pol_a(it_a_j, it_z_i);
        
        % call formal and informal function.
        [~, fl_opti_b_bridge, fl_opti_inf_borr_nobridge, fl_opti_for_borr, fl_opti_for_save] = ...
            ffs_fibs_min_c_cost_bridge(fl_a_opti, fl_coh, ...
            param_map, support_map, armt_map, func_map, bl_input_override);
        
        % store savings and borrowing formal and inf optimal choices
        mt_pol_b_bridge(it_a_j,it_z_i) = fl_opti_b_bridge;
        mt_pol_inf_borr_nobridge(it_a_j,it_z_i) = fl_opti_inf_borr_nobridge;
        mt_pol_for_borr(it_a_j,it_z_i) = fl_opti_for_borr;
        mt_pol_for_save(it_a_j,it_z_i) = fl_opti_for_save;
        
    end
end

result_map('cl_mt_pol_a') = {mt_pol_a, zeros(1)};
result_map('cl_mt_pol_coh') = {f_coh(ar_z, ar_a'), zeros(1)};

result_map('cl_mt_pol_c') = {mt_pol_cons, zeros(1)};
result_map('cl_mt_pol_b_bridge') = {mt_pol_b_bridge, zeros(1)};
result_map('cl_mt_pol_inf_borr_nobridge') = {mt_pol_inf_borr_nobridge, zeros(1)};
result_map('cl_mt_pol_for_borr') = {mt_pol_for_borr, zeros(1)};
result_map('cl_mt_pol_for_save') = {mt_pol_for_save, zeros(1)};

result_map('ar_st_pol_names') = ["cl_mt_pol_a", "cl_mt_pol_coh", "cl_mt_pol_c", ...
    "cl_mt_pol_b_bridge", "cl_mt_pol_inf_borr_nobridge", "cl_mt_pol_for_borr", "cl_mt_pol_for_save"];

% Get Discrete Choice Outcomes
result_map = ffs_fibs_identify_discrete(result_map, bl_input_override);

%% Post Solution Graph and Table Generation
% Note in comparison with *abz*, results here, even when using identical
% parameters would differ because in *abz* solved where choices are
% principle. Here choices are principle + interests in order to facilitate
% using the informal choice functions. 
%
% Note that this means two things are
% different, on the one hand, the value of asset for to coh is different
% based on the grid of assets. If the asset grid is negative, now per grid
% point, there is more coh because that grid point of asset no longer has
% interest rates. On the other hand, if one has positive asset grid point
% on arrival, that is worth less to coh. Additionally, when making choices
% for the next period, now choices aprime includes interests. What these
% mean is that the a grid no longer has the same meaning. We should expect
% at higher savings levels, for the same grid points, if optimal grid
% choices are the same as before, consumption should be lower when b
% includes interest rates and principle. This is however, not true when
% arriving in a period with negative a levels, for the same negative a
% level and same a prime negative choice, could have higher consumption
% here becasue have to pay less interests on debt. This tends to happen for
% smaller levels of borrowing choices.
%
% Graphically, when using interest + principle, big difference in
% consumption as a fraction of (coh - aprime) figure. In those figures,
% when counting in principles only, the gap in coh and aprime is
% consumption, but now, as more is borrowed only a small fraction of coh
% and aprime gap is consumption, becuase aprime/(1+r) is put into
% consumption.

if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);
    
    % Standard AZ graphs
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
    
    % Graphs for results_map with FIBS contents
    result_map = ff_az_fibs_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end
##### SOURCE END #####
--></body></html>