
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ff_akz_vf_post_graph</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-06-06"><meta name="DC.source" content="ff_akz_vf_post_graph.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FF_AKZ_VF_POST_GRAPH genereate 3 graphs</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">Graphing Values</a></li><li><a href="#6">Graphing Choice Levels</a></li><li><a href="#7">Graphing Choice Percentages</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> ff_akz_vf_post_graph(varargin)
</pre><h2 id="2">FF_AKZ_VF_POST_GRAPH genereate 3 graphs</h2><p>Generates three graphs:</p><div><ol><li>Value Function Graph</li><li>Policy Function Consumption and Asset Choices, Level and log</li><li>Consumption and Asset as Percentages</li></ol></div><p>Run this function directly with randomly generates matrixes for graphs and tables.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param result_map container contains policy function matrix, value function matrix, iteration results; als coh consumption and other matrixes</p><p>@example</p><pre>  ff_akz_vf_post_graph(param_map, support_map, armt_map, result_map);</pre><h2 id="3">Default</h2><pre class="codeinput">params_len = length(varargin);
bl_input_override = 0;
<span class="keyword">if</span> (params_len == 5)
    bl_input_override = varargin{5};
<span class="keyword">end</span>

<span class="keyword">if</span> (bl_input_override)
    <span class="comment">% if invoked from outside overrid fully</span>
    [param_map, support_map, armt_map, result_map, ~] = varargin{:};
<span class="keyword">else</span>
    clear <span class="string">all</span>;
    close <span class="string">all</span>;

    <span class="comment">% internal invoke for testing</span>
    it_param_set = 4;
    bl_input_override = true;

    <span class="comment">% Get Parameters</span>
    [param_map, support_map] = ffs_akz_set_default_param(it_param_set);
    [armt_map, func_map] = ffs_akz_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>

    <span class="comment">% Generate Default val and policy matrixes</span>
    params_group = values(armt_map, {<span class="string">'ar_a_meshk'</span>, <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_z'</span>, <span class="string">'mt_coh_wkb'</span>});
    [ar_a_meshk, ar_k_mesha, ar_z, mt_coh_wkb] = params_group{:};
    params_group = values(func_map, {<span class="string">'f_util_standin'</span>, <span class="string">'f_cons'</span>, <span class="string">'f_coh'</span>});
    [f_util_standin, f_cons, f_coh] = params_group{:};

    <span class="comment">% Set Defaults</span>
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
    mt_pol_aksum = mt_coh_wkb.*(cumsum(sort(ar_z))/sum(ar_z)*0.4 + 0.4);
    mt_pol_a = mt_pol_aksum.*(0.7 - cumsum(sort(ar_z))/sum(ar_z)*0.3);
    mt_pol_k = mt_pol_aksum - mt_pol_a;
    mt_cons = f_cons(mt_coh_wkb, mt_pol_a, mt_pol_k);

    <span class="comment">% Set Results Map</span>
    result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
    result_map(<span class="string">'mt_val'</span>) = mt_val;
    result_map(<span class="string">'mt_pol_a'</span>) = mt_pol_a;
    result_map(<span class="string">'mt_pol_k'</span>) = mt_pol_k;
    result_map(<span class="string">'mt_cons'</span>) = mt_cons;
<span class="keyword">end</span>
</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput"><span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'fl_b_bd'</span>, <span class="string">'it_z_n'</span>, <span class="string">'fl_w_max'</span>});
[fl_b_bd, it_z_n, fl_w_max] = params_group{:};

<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_graph_onebyones'</span>, <span class="string">'bl_graph_val'</span>, <span class="string">'bl_graph_pol_lvl'</span>, <span class="string">'bl_graph_pol_pct'</span>});
[bl_graph_onebyones, bl_graph_val, bl_graph_pol_lvl, bl_graph_pol_pct] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_img_save'</span>, <span class="string">'st_img_path'</span>, <span class="string">'st_img_prefix'</span>, <span class="string">'st_img_name_main'</span>, <span class="string">'st_img_suffix'</span>});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {<span class="string">'st_title_prefix'</span>});
[st_title_prefix] = params_group{:};

<span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_z'</span>, <span class="string">'mt_coh_wkb'</span>});
[ar_z, mt_coh_wkb] = params_group{:};

<span class="comment">% result_map</span>
params_group = values(result_map, {<span class="string">'mt_cons'</span>, <span class="string">'mt_val'</span>, <span class="string">'mt_pol_a'</span>, <span class="string">'mt_pol_k'</span>});
[mt_cons, mt_val, mt_pol_a, mt_pol_k] = params_group{:};

<span class="comment">% How many zs to Graph</span>
ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
</pre><h2 id="5">Graphing Values</h2><p>when testing with random data using f_util_standin, shocks will not have impacts on z, we will see that lower shocks tend to have slightly lower coh values, but k,b,z effects on f_util_standin fully captured by coh.</p><pre class="codeinput"><span class="keyword">if</span> (bl_graph_val)

    <span class="keyword">if</span>(~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j=1:1:2

        <span class="keyword">if</span>(~bl_graph_onebyones)
            subplot(1,2,sub_j)
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        mt_outcome = mt_val;
        st_y_label = <span class="string">'V(coh(a, k, z), z)'</span>;

        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph
            i_ctr = i_ctr + 1;

            <span class="keyword">if</span> (sub_j == 1)
                ar_x = mt_coh_wkb(:, i);
            <span class="keyword">else</span>
                ar_x = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
            <span class="keyword">end</span>

            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, <span class="keyword">...</span>
                <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
        title([st_title_prefix <span class="string">'V(coh(k,b,z),z)'</span>])
        ylabel(st_y_label)

        <span class="keyword">if</span> (sub_j == 1)
            xlinemax = xline(fl_w_max);
            xlabel({<span class="string">'cash-on-hand'</span>})
        <span class="keyword">else</span>
            xlinemax = xline(log(fl_w_max - fl_b_bd + 1));
            xlabel({<span class="string">'log(COH - borrbound + 1)'</span>})
        <span class="keyword">end</span>


        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        xlinemax.Color = <span class="string">'b'</span>;
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = <span class="string">'max-agg-save'</span>;
        legend(legendCell([ar_it_z_graph length(legendCell)]), <span class="string">'Location'</span>,<span class="string">'southeast'</span>);

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_val'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_akz_vf_post_graph_01.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_02.png" alt=""> <h2 id="6">Graphing Choice Levels</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_pol_lvl)

    <span class="keyword">if</span>(~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 21 8]);
        ar_sub_j = 1:1:6;
    <span class="keyword">else</span>
        ar_sub_j = [1 4 2 5 3 6];
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j = ar_sub_j

        <span class="keyword">if</span>(sub_j==1 || sub_j == 4)
            mt_outcome = mt_pol_a;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==2 || sub_j == 5)
            mt_outcome = mt_pol_k;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==3 || sub_j == 6)
            mt_outcome = mt_cons;
        <span class="keyword">end</span>

        <span class="keyword">if</span>(~bl_graph_onebyones)
            subplot(2,3,sub_j)
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            <span class="keyword">if</span>(sub_j==1 || sub_j == 2 || sub_j == 3)

                ar_a_curz_use = mt_coh_wkb(:,i)';
                ar_opti_curz_use = ar_opti_curz';
                fl_w_max_line = fl_w_max;

            <span class="keyword">elseif</span>(sub_j == 4 || sub_j == 5 || sub_j == 6)

                ar_a_curz_use = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
                fl_w_max_line = log(fl_w_max  - fl_b_bd + 1);

                <span class="keyword">if</span>(sub_j == 4)
                    <span class="comment">% borrow save</span>
                    ar_opti_curz_use = log(ar_opti_curz' - fl_b_bd + 1);
                <span class="keyword">end</span>

                <span class="keyword">if</span>(sub_j == 5 || sub_j == 6)
                    <span class="comment">% risky capital choice and consumption, both are &gt;= 0</span>
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                <span class="keyword">end</span>

            <span class="keyword">end</span>

            ar_x = ar_a_curz_use;
            ar_y = ar_opti_curz_use;

            scatter(ar_x, ar_y, 5, <span class="keyword">...</span>
                <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        <span class="keyword">if</span>(sub_j==1)
            st_y_label = <span class="string">'Safe Savings/Borrowing'</span>;
            st_x_label = <span class="string">'Cash-on-Hand'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==2)
            st_y_label = <span class="string">'Risky K investment'</span>;
            st_x_label = <span class="string">'Cash-on-Hand'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==3)
            st_y_label = <span class="string">'Consumption'</span>;
            st_x_label = <span class="string">'Cash-on-Hand'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==4)
            st_y_label = <span class="string">'log(SaveBorr - borrbound + 1)'</span>;
            st_x_label = <span class="string">'log(COH - borrbound + 1)'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==5)
            st_y_label = <span class="string">'log(Risky K + 1)'</span>;
            st_x_label = <span class="string">'log(COH - borrbound + 1)'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==6)
            st_y_label = <span class="string">'log(Consumption + 1)'</span>;
            st_x_label = <span class="string">'log(COH - borrbound + 1)'</span>;
        <span class="keyword">end</span>


        grid <span class="string">on</span>;

        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);

        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        xlinemax = xline(fl_w_max_line);
        xlinemax.Color = <span class="string">'b'</span>;
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = <span class="string">'max-agg-save'</span>;
        legend(legendCell([ar_it_z_graph length(legendCell)]), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);

        hline = refline([1 0]);
        hline.Color = <span class="string">'k'</span>;
        hline.LineStyle = <span class="string">':'</span>;
        hline.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">if</span>(sub_j==3 || sub_j == 4)
        <span class="keyword">else</span>
            xline0 = xline(0);
            xline0.HandleVisibility = <span class="string">'off'</span>;
            yline0 = yline(0);
            yline0.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_pol_lvl'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_akz_vf_post_graph_03.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_04.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_05.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_06.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_07.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_08.png" alt=""> <h2 id="7">Graphing Choice Percentages</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_pol_pct)

    <span class="keyword">if</span>(~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 24 8]);
        ar_sub_j = 1:1:8;
    <span class="keyword">else</span>
        ar_sub_j = [1 5 2 6 3 7 4 8];
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j = ar_sub_j

        mt_outcome = zeros(size(mt_pol_a));
        mt_it_borr_idx = (mt_pol_a &lt; 0);

        <span class="keyword">if</span> (ismember(sub_j, [1,2,3,4]))
            bl_log_coh = 0;
            st_sv_suffix = <span class="string">'_xcoh'</span>;
            st_title_suffix = <span class="string">' (x=coh)'</span>;
        <span class="keyword">else</span>
            bl_log_coh = 1;
            st_sv_suffix = <span class="string">'_logxcoh'</span>;
            st_title_suffix = <span class="string">' (x=log(coh))'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span>(sub_j==1 || sub_j == 4)
            mt_outcome(mt_it_borr_idx) = -mt_pol_a(mt_it_borr_idx)./fl_b_bd;
            mt_outcome(~mt_it_borr_idx) = mt_pol_a(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = <span class="string">'aprime/borrbound if br; aprime/cashonhand if sv'</span>;
            st_legend_loc = <span class="string">'southeast'</span>;
            st_title = <span class="string">'Save/Borrow % of Borrow Limit or COH'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==2 || sub_j == 5)
            mt_outcome(mt_it_borr_idx) = mt_pol_k(mt_it_borr_idx)./(mt_coh_wkb(mt_it_borr_idx) + mt_pol_a(mt_it_borr_idx));
            mt_outcome(~mt_it_borr_idx) = mt_pol_k(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = <span class="string">'kprime/(coh-aprime) if br; k/cashonhand if sv'</span>;
            st_legend_loc = <span class="string">'southeast'</span>;
            st_title = <span class="string">'Risky Investment % of coh + borrow'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==3 || sub_j == 7)
            <span class="comment">%             If borrowing, how much is what is borrowing going to K?</span>
            <span class="comment">%             If saving, how much is what is total savings in K?</span>
            mt_outcome(mt_it_borr_idx) = mt_pol_a(mt_it_borr_idx)./mt_pol_k(mt_it_borr_idx);
            mt_outcome(~mt_it_borr_idx) = mt_pol_a(~mt_it_borr_idx)./mt_pol_k(~mt_it_borr_idx);
            st_y_label = <span class="string">'aprime/kprime'</span>;
            st_legend_loc = <span class="string">'northwest'</span>;
            st_title = <span class="string">'safe borr/save divide risky k'</span>;
        <span class="keyword">end</span>
        <span class="keyword">if</span>(sub_j==4 || sub_j == 8)
            mt_outcome(mt_it_borr_idx) = mt_cons(mt_it_borr_idx)./(mt_coh_wkb(mt_it_borr_idx) + mt_pol_a(mt_it_borr_idx));
            mt_outcome(~mt_it_borr_idx) = mt_cons(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = <span class="string">'c/(coh-aprime) if br; c/cashonhand if sv'</span>;
            st_legend_loc = <span class="string">'northeast'</span>;
            st_title = <span class="string">'Consumption Choice % of coh + borrow'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span>(~bl_graph_onebyones)
            subplot(2,4,sub_j)
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            <span class="keyword">if</span> (bl_log_coh == 0)
                ar_x = mt_coh_wkb(:,i);
            <span class="keyword">else</span>
                ar_x = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
            <span class="keyword">end</span>

            ar_y = ar_opti_curz;

            scatter(ar_x, ar_y, 5, <span class="keyword">...</span>
                    <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                    <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>
        grid <span class="string">on</span>;

        title([st_title_prefix st_title st_title_suffix])
        ylabel(st_y_label)


        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));

        <span class="keyword">if</span> (bl_log_coh == 0)
            xlinemax = xline(fl_w_max);
            xlabel({<span class="string">'cash-on-hand'</span>})
        <span class="keyword">else</span>
            xlinemax = xline(log(fl_w_max - fl_b_bd + 1));
            xlabel({<span class="string">'log(COH - borrbound + 1)'</span>})
        <span class="keyword">end</span>

        xlinemax.Color = <span class="string">'b'</span>;
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = <span class="string">'max-agg-save'</span>;
        legend(legendCell([ar_it_z_graph length(legendCell)]), <span class="string">'Location'</span>, st_legend_loc);

        <span class="comment">% xlim([min(ar_coh_curz)+1.5 15]);</span>

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;

        <span class="keyword">if</span> (sub_j~=4)
            yline0 = yline(1);
            yline0.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==1)
            yline0 = yline(-1);
            yline0.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_pol_pct'</span> st_sv_suffix st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>


<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_akz_vf_post_graph_09.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_10.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_11.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_12.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_13.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_14.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_15.png" alt=""> <img vspace="5" hspace="5" src="ff_akz_vf_post_graph_16.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository> 
% Table of Content.*

function ff_akz_vf_post_graph(varargin)
%% FF_AKZ_VF_POST_GRAPH genereate 3 graphs
% Generates three graphs:
%
% # Value Function Graph
% # Policy Function Consumption and Asset Choices, Level and log
% # Consumption and Asset as Percentages
%
% Run this function directly with randomly generates matrixes for graphs
% and tables.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param result_map container contains policy function matrix, value
% function matrix, iteration results; als coh consumption and other matrixes
%
% @example
%
%    ff_akz_vf_post_graph(param_map, support_map, armt_map, result_map);
%

%% Default

params_len = length(varargin);
bl_input_override = 0;
if (params_len == 5)
    bl_input_override = varargin{5};
end

if (bl_input_override)
    % if invoked from outside overrid fully
    [param_map, support_map, armt_map, result_map, ~] = varargin{:};      
else
    clear all;
    close all;
    
    % internal invoke for testing
    it_param_set = 4;
    bl_input_override = true;
    
    % Get Parameters
    [param_map, support_map] = ffs_akz_set_default_param(it_param_set);
    [armt_map, func_map] = ffs_akz_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override

    % Generate Default val and policy matrixes
    params_group = values(armt_map, {'ar_a_meshk', 'ar_k_mesha', 'ar_z', 'mt_coh_wkb'});
    [ar_a_meshk, ar_k_mesha, ar_z, mt_coh_wkb] = params_group{:};
    params_group = values(func_map, {'f_util_standin', 'f_cons', 'f_coh'});
    [f_util_standin, f_cons, f_coh] = params_group{:};    
        
    % Set Defaults
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
    mt_pol_aksum = mt_coh_wkb.*(cumsum(sort(ar_z))/sum(ar_z)*0.4 + 0.4);
    mt_pol_a = mt_pol_aksum.*(0.7 - cumsum(sort(ar_z))/sum(ar_z)*0.3);
    mt_pol_k = mt_pol_aksum - mt_pol_a;
    mt_cons = f_cons(mt_coh_wkb, mt_pol_a, mt_pol_k);
    
    % Set Results Map
    result_map = containers.Map('KeyType','char', 'ValueType','any');
    result_map('mt_val') = mt_val;
    result_map('mt_pol_a') = mt_pol_a;
    result_map('mt_pol_k') = mt_pol_k;
    result_map('mt_cons') = mt_cons;
end

%% Parse Parameters

% param_map
params_group = values(param_map, {'fl_b_bd', 'it_z_n', 'fl_w_max'});
[fl_b_bd, it_z_n, fl_w_max] = params_group{:};

% support_map
params_group = values(support_map, {'bl_graph_onebyones', 'bl_graph_val', 'bl_graph_pol_lvl', 'bl_graph_pol_pct'});
[bl_graph_onebyones, bl_graph_val, bl_graph_pol_lvl, bl_graph_pol_pct] = params_group{:};
params_group = values(support_map, {'bl_img_save', 'st_img_path', 'st_img_prefix', 'st_img_name_main', 'st_img_suffix'});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {'st_title_prefix'});
[st_title_prefix] = params_group{:};

% armt_map
params_group = values(armt_map, {'ar_z', 'mt_coh_wkb'});
[ar_z, mt_coh_wkb] = params_group{:};

% result_map
params_group = values(result_map, {'mt_cons', 'mt_val', 'mt_pol_a', 'mt_pol_k'});
[mt_cons, mt_val, mt_pol_a, mt_pol_k] = params_group{:};

% How many zs to Graph
ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);

%% Graphing Values
% when testing with random data using f_util_standin, shocks will not have
% impacts on z, we will see that lower shocks tend to have slightly lower
% coh values, but k,b,z effects on f_util_standin fully captured by coh. 

if (bl_graph_val)
    
    if(~bl_graph_onebyones)
        figure('PaperPosition', [0 0 14 4]);
    end    
    
    for sub_j=1:1:2
        
        if(~bl_graph_onebyones)
            subplot(1,2,sub_j)
        else
            figure('PaperPosition', [0 0 7 4]);
        end        
        hold on;
                
        mt_outcome = mt_val;
        st_y_label = 'V(coh(a, k, z), z)';        
        
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        for i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            
            if (sub_j == 1)
                ar_x = mt_coh_wkb(:, i);
            else
                ar_x = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
            end
            
            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, ...
                'MarkerEdgeColor', clr(i_ctr,:), ...
                'MarkerFaceColor', clr(i_ctr,:));
        end
        
        grid on;
        grid minor;        
        title([st_title_prefix 'V(coh(k,b,z),z)'])
        ylabel(st_y_label)
        
        if (sub_j == 1)
            xlinemax = xline(fl_w_max);
            xlabel({'cash-on-hand'})
        else
            xlinemax = xline(log(fl_w_max - fl_b_bd + 1));
            xlabel({'log(COH - borrbound + 1)'})
        end

        
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        xlinemax.Color = 'b';
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = 'max-agg-save';
        legend(legendCell([ar_it_z_graph length(legendCell)]), 'Location','southeast');
        
        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';        
        
    end
    
    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_val' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    
end

%% Graphing Choice Levels

if (bl_graph_pol_lvl)
    
    if(~bl_graph_onebyones)
        figure('PaperPosition', [0 0 21 8]);
        ar_sub_j = 1:1:6;
    else
        ar_sub_j = [1 4 2 5 3 6];
    end
    
    for sub_j = ar_sub_j
        
        if(sub_j==1 || sub_j == 4)
            mt_outcome = mt_pol_a;
        end
        if(sub_j==2 || sub_j == 5)
            mt_outcome = mt_pol_k;
        end
        if(sub_j==3 || sub_j == 6)
            mt_outcome = mt_cons;            
        end
                
        if(~bl_graph_onebyones)
            subplot(2,3,sub_j)
        else
            figure('PaperPosition', [0 0 7 4]);
        end               
        hold on;
        
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        for i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);
                        
            if(sub_j==1 || sub_j == 2 || sub_j == 3)
                
                ar_a_curz_use = mt_coh_wkb(:,i)';
                ar_opti_curz_use = ar_opti_curz';                
                fl_w_max_line = fl_w_max;
                
            elseif(sub_j == 4 || sub_j == 5 || sub_j == 6)
                
                ar_a_curz_use = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
                fl_w_max_line = log(fl_w_max  - fl_b_bd + 1);
                
                if(sub_j == 4)
                    % borrow save
                    ar_opti_curz_use = log(ar_opti_curz' - fl_b_bd + 1);
                end
                
                if(sub_j == 5 || sub_j == 6)
                    % risky capital choice and consumption, both are >= 0
                    ar_opti_curz_use = log(ar_opti_curz' + 1);
                end
                
            end
            
            ar_x = ar_a_curz_use;
            ar_y = ar_opti_curz_use;
            
            scatter(ar_x, ar_y, 5, ...
                'MarkerEdgeColor', clr(i_ctr,:), ...
                'MarkerFaceColor', clr(i_ctr,:));
        end
        
        if(sub_j==1)            
            st_y_label = 'Safe Savings/Borrowing';
            st_x_label = 'Cash-on-Hand';
        end
        if(sub_j==2)
            st_y_label = 'Risky K investment';
            st_x_label = 'Cash-on-Hand';
        end
        if(sub_j==3)
            st_y_label = 'Consumption';
            st_x_label = 'Cash-on-Hand';
        end
        if(sub_j==4)
            st_y_label = 'log(SaveBorr - borrbound + 1)';
            st_x_label = 'log(COH - borrbound + 1)';
        end
        if(sub_j==5)
            st_y_label = 'log(Risky K + 1)';
            st_x_label = 'log(COH - borrbound + 1)';
        end
        if(sub_j==6)
            st_y_label = 'log(Consumption + 1)';
            st_x_label = 'log(COH - borrbound + 1)';
        end
        
        
        grid on;
        
        title([st_title_prefix st_y_label]);
        ylabel(st_y_label);
        xlabel(st_x_label);
        
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        xlinemax = xline(fl_w_max_line);
        xlinemax.Color = 'b';
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = 'max-agg-save';
        legend(legendCell([ar_it_z_graph length(legendCell)]), 'Location','northwest');
        
        hline = refline([1 0]);
        hline.Color = 'k';
        hline.LineStyle = ':';
        hline.HandleVisibility = 'off';
        if(sub_j==3 || sub_j == 4)
        else
            xline0 = xline(0);
            xline0.HandleVisibility = 'off';
            yline0 = yline(0);
            yline0.HandleVisibility = 'off';
        end
        grid on;
        grid minor;
        
    end
    
    % save file
    if (bl_img_save)        
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_pol_lvl' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));        
    end
    
end

%% Graphing Choice Percentages

if (bl_graph_pol_pct)

    if(~bl_graph_onebyones)
        figure('PaperPosition', [0 0 24 8]);
        ar_sub_j = 1:1:8;
    else
        ar_sub_j = [1 5 2 6 3 7 4 8];
    end

    for sub_j = ar_sub_j

        mt_outcome = zeros(size(mt_pol_a));
        mt_it_borr_idx = (mt_pol_a < 0);
        
        if (ismember(sub_j, [1,2,3,4]))
            bl_log_coh = 0;
            st_sv_suffix = '_xcoh';
            st_title_suffix = ' (x=coh)';
        else
            bl_log_coh = 1;
            st_sv_suffix = '_logxcoh';
            st_title_suffix = ' (x=log(coh))';
        end
            
        if(sub_j==1 || sub_j == 4)
            mt_outcome(mt_it_borr_idx) = -mt_pol_a(mt_it_borr_idx)./fl_b_bd;
            mt_outcome(~mt_it_borr_idx) = mt_pol_a(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = 'aprime/borrbound if br; aprime/cashonhand if sv';
            st_legend_loc = 'southeast';
            st_title = 'Save/Borrow % of Borrow Limit or COH';
        end
        if(sub_j==2 || sub_j == 5)
            mt_outcome(mt_it_borr_idx) = mt_pol_k(mt_it_borr_idx)./(mt_coh_wkb(mt_it_borr_idx) + mt_pol_a(mt_it_borr_idx));
            mt_outcome(~mt_it_borr_idx) = mt_pol_k(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = 'kprime/(coh-aprime) if br; k/cashonhand if sv';            
            st_legend_loc = 'southeast';
            st_title = 'Risky Investment % of coh + borrow';
        end        
        if(sub_j==3 || sub_j == 7)
            %             If borrowing, how much is what is borrowing going to K?
            %             If saving, how much is what is total savings in K?
            mt_outcome(mt_it_borr_idx) = mt_pol_a(mt_it_borr_idx)./mt_pol_k(mt_it_borr_idx);
            mt_outcome(~mt_it_borr_idx) = mt_pol_a(~mt_it_borr_idx)./mt_pol_k(~mt_it_borr_idx);
            st_y_label = 'aprime/kprime';
            st_legend_loc = 'northwest';
            st_title = 'safe borr/save divide risky k';
        end
        if(sub_j==4 || sub_j == 8)
            mt_outcome(mt_it_borr_idx) = mt_cons(mt_it_borr_idx)./(mt_coh_wkb(mt_it_borr_idx) + mt_pol_a(mt_it_borr_idx));
            mt_outcome(~mt_it_borr_idx) = mt_cons(~mt_it_borr_idx)./mt_coh_wkb(~mt_it_borr_idx);
            st_y_label = 'c/(coh-aprime) if br; c/cashonhand if sv';
            st_legend_loc = 'northeast';
            st_title = 'Consumption Choice % of coh + borrow';
        end

        if(~bl_graph_onebyones)
            subplot(2,4,sub_j)
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        hold on;

        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        for i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_opti_curz = mt_outcome(:, i);

            if (bl_log_coh == 0)
                ar_x = mt_coh_wkb(:,i);
            else
                ar_x = log(mt_coh_wkb(:,i)' - fl_b_bd + 1);
            end

            ar_y = ar_opti_curz;

            scatter(ar_x, ar_y, 5, ...
                    'MarkerEdgeColor', clr(i_ctr,:), ...
                    'MarkerFaceColor', clr(i_ctr,:));
        end
        grid on;        

        title([st_title_prefix st_title st_title_suffix])
        ylabel(st_y_label)
        

        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        
        if (bl_log_coh == 0)
            xlinemax = xline(fl_w_max);
            xlabel({'cash-on-hand'})
        else
            xlinemax = xline(log(fl_w_max - fl_b_bd + 1));
            xlabel({'log(COH - borrbound + 1)'})
        end
        
        xlinemax.Color = 'b';
        xlinemax.LineWidth = 1.5;
        legendCell{length(legendCell) + 1} = 'max-agg-save';
        legend(legendCell([ar_it_z_graph length(legendCell)]), 'Location', st_legend_loc);

        % xlim([min(ar_coh_curz)+1.5 15]);

        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);        
        yline0.HandleVisibility = 'off';

        if (sub_j~=4)
            yline0 = yline(1);
            yline0.HandleVisibility = 'off';
        end

        if (sub_j==1)
            yline0 = yline(-1);
            yline0.HandleVisibility = 'off';
        end
        grid on;
        grid minor;
    end

    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_pol_pct' st_sv_suffix st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));        
    end

    
end

end
##### SOURCE END #####
--></body></html>