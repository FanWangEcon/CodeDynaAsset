This is a work-in-progress [website](https://fanwangecon.github.io/CodeDynaAsset/) of collections of code for solving several infinite horizon exogenous incomplete dynamic asset models, produced by [Fan](https://fanwangecon.github.io/). Materials gathered from various [papers](https://fanwangecon.github.io/research) on financial access.

Generally, looped, vectorized, and efficient-vectorized versions of the same code from Matlab (tested with [Matlab 2019a](https://www.mathworks.com/company/newsroom/mathworks-announces-release-2019a-of-matlab-and-simulink.html)) are shown. Looped codes are shown for clarity, vectorized codes are shown for speed.

Each function is written with default parameters and is directly callable: 1, clone the project via github, see [here](docs/gitsetup.md); 2, add project to path; 3, click run any file. Algorithms are language agnostic. Speed difference across languages is not significant when solving models using vectorized grid-based solution algorithms. For functions, files included:

1. **m**: matlab m file, each callable with the whole repository cloned
2. **publish html**: html files generated by pressing the publish button in matlab, includes m file code with mark-ups, and also includes tabular and graphical outputs from benchmark simulation
3. **profile**: html files generated by profiling the m file, shows timing.

Please contact [FanWangEcon](https://fanwangecon.github.io/) for issues or problems.


# 1. Solving the One Asset One Shock Problem
<!-- https://fanwangecon.github.io/CodeDynaAsset/m_az -->

The standard heterogeneous agent model with assets and shocks. Endogenous asset. Income is a function of exogenous wage and endogenous interest earnings. Exogenous incomplete borrowing and savings. Wage shocks follow AR1.

## 1.1 Main Optimization Solution Files

Solving as benchmark with these [parameters](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_set_default_param.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m), in particular:

- savings only problem
- **750** grid points for asset states/choices
- **15** grid points for the AR1 shock

Using three algorithm that provide identical solutions and increases solution speed from 9765.7 seconds to 1.2 seconds.


- *az* model [looped solution](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solve/ff_az_vf.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/profile/ff_az_vf_default_p3/file0.html)
    * speed: 9765.7 seconds (5.5 Hours)
    * loops: 1 for VFI, 1 for shocks, 1 for endo state, 1 for choice, 1 for future shocks
- *az* model [vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vec.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solve/ff_az_vf_vec.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vec.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/profile/ff_az_vf_vec_default_p3/file0.html)    
    * speed: 34.3 seconds
    * loops: 1 for VFI, 1 for shocks, vectorize remaining 3 loops
- *az* model [optimized vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vecsv.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solve/ff_az_vf_vecsv.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vecsv.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/profile/ff_az_vf_vecsv_default_p3/file0.html)    
    * speed: 1.2 seconds
    * loops: 1 for VFI, 1 for shocks, vectorize remaining 3 loops
    * store u(c) in cells, several speed improvements described [here](https://fanwangecon.github.io/M4Econ/)

## 1.2 Asset Distributions

Solving for the asset distribution.

## 1.3 Solution Support Files

*Policy and Value Function Analysis*:
-  *az* model [solution results processing](https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html)
    * table: table showing value and policy function by states and shocks
    * table: table showing iteration convergence criteria and percentage policy function change by shock
    * graph: graph showing value function, policy functions with levels, logged levels and percentages
    * mat: store all workspace matrixes, arrays, scalar values to matrixes
- *az* model [solution results graphing](https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post_graph.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post_graph.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post_graph.html)
    * graph: graph showing value function by asset and shock
    * graph: graph showing consumption and asset choice levels
    * graph: graph showing consumption and asset logged levels
    * graph: graph showing consumption and asset as percentages of coh and assets

*Support*:
- *az* model [set default parameters](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_set_default_param.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_set_default_param.html)
    * param_map: container map for carrying parameters across functions
    * support_map: container map for carrying programming instructions etc across functions
- *az* model [set functions](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_set_functions.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_functions.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_set_functions.html)
    * functions: centrally define functions as function handles
- *az* model [generate states, choices, and shocks grids](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_get_funcgrid.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_get_funcgrid.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_az_get_funcgrid.html)
    * func_map: container map containing all function handles
    * armt_map: container map containing all key model input matrixes for endogenous and exogenous states and choices.


## 1.4 Cash-on-hand and One Shock

Using cash-on-hand as state variable allows for easier inclusion of additional asset states/choices later. Solving with cash-on-hand and shock also allows for a semi-analytical solution for finding the asset distribution. But for one state one shock model, there is practically no difference between this code and earlier codes. For these codes, the asset choice is interpreted to included interest and principles whereas before the asset choice only includes principles. These codes are included for completeness.

The files are almost identical to the earlier files, they are included here for completeness. Speeds are the same as for the az model.

*Main Optimization Solution Files*:
- *coh-z* model [looped solution](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/solve/ff_oz_vf.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/profile/ff_oz_vf_default_p3/file0.html)
- *coh-z* model [vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf_vec.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/solve/ff_oz_vf_vec.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf_vec.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/profile/ff_oz_vf_vec_default_p3/file0.html)    
- *coh-z* model [optimized vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf_vecsv.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/solve/ff_oz_vf_vecsv.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/html/ff_oz_vf_vecsv.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solve/profile/ff_oz_vf_vecsv_default_p3/file0.html)    

*Policy and Value Function Analysis*:
- *coh-z* model [solution results processing](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solvepost/html/ff_oz_vf_post.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/solvepost/ff_oz_vf_post.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solvepost/html/ff_oz_vf_post.html)
- *coh-z* model [solution results graphing](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solvepost/html/ff_oz_vf_post_graph.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/solvepost/ff_oz_vf_post_graph.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/solvepost/html/ff_oz_vf_post_graph.html)

*Support*:
- *coh-z* model [set default parameters](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_set_default_param.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/paramfunc/ffs_oz_set_default_param.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_set_default_param.html)
- *coh-z* model [set functions](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_set_functions.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/paramfunc/ffs_oz_set_functions.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_set_functions.html)
- *coh-z* model [generate states, choices, and shocks grids](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_get_funcgrid.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_oz/paramfunc/ffs_oz_get_funcgrid.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_oz/paramfunc/html/ffs_oz_get_funcgrid.html)


## 1.2 Asset Distributions

Solving for the asset distribution


# 2. Solving the Risky + Safe Asset Problem

Two endogenous assets, one safe one risky. Risky asset could be stock or constant return to scale, or physical capital investment with depreciation and decreasing return to scale. Income is endogenous to risky investment choices and safe savings choices. Note that the utility function is CRRA, however, households do not have constant share of savings in the risky investment when risky asset has decreasing return to scale and when shock is highly persistent.

The problem's computational difficulty now increases dramatically. While there are more analytical solutions to the base version types of problems, grid-based solution shown here allows for some flexibility in having non-differentiable and non-continuous solution objective functions.

## 1.1 Main Optimization Solution Files

Solving as benchmark with these [parameters](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_default_param.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/paramfunc/ffs_akz_set_default_param.m), in particular:

- savings problem with alternative safe and risky asset
- **50** grid points for asset states/choices
- **5** grid points for the AR1 shock

Using three algorithm that provide identical solutions and increases solution speed from 9765.7 seconds to 1.2 seconds.

- *akz* model [looped solution](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solve/ff_akz_vf.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/profile/ff_akz_vf_default_p3/file0.html)
    * speed: 9765.7 seconds (5.5 Hours)
    * loops: 1 for VFI, 1 for shocks, 1 for endo state, 1 for choice, 1 for future shocks
- *akz* model [vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf_vec.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solve/ff_akz_vf_vec.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf_vec.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/profile/ff_akz_vf_vec_default_p3/file0.html)    
    * speed: 34.3 seconds
    * loops: 1 for VFI, 1 for shocks, vectorize remaining 3 loops
- *akz* model [optimized vectorized solution](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf_vecsv.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solve/ff_akz_vf_vecsv.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_akz_vf_vecsv.html) \| [**profile**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/profile/ff_akz_vf_vecsv_default_p3/file0.html)    
    * speed: 1.2 seconds
    * loops: 1 for VFI, 1 for shocks, vectorize remaining 3 loops
    * store u(c) in cells, several speed improvements described [here](https://fanwangecon.github.io/M4Econ/)

## 1.2 Asset Distributions

Solving for the asset distribution.

## 1.3 Solution Support Files

*Policy and Value Function Analysis*:
-  *akz* model [solution results processing](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solvepost/html/ff_akz_vf_post.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solvepost/html/ff_akz_vf_post.html)
    * table: table showing value and policy function by states and shocks
    * table: table showing iteration convergence criteria and percentage policy function change by shock
    * graph: graph showing value function, policy functions with levels, logged levels and percentages
    * mat: store all workspace matrixes, arrays, scalar values to matrixes
- *akz* model [solution results graphing](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solvepost/html/ff_akz_vf_post_graph.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post_graph.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/solvepost/html/ff_akz_vf_post_graph.html)
    * graph: graph showing value function by asset and shock
    * graph: graph showing consumption and asset choice levels
    * graph: graph showing consumption and asset logged levels
    * graph: graph showing consumption and asset as percentages of coh and assets

*Support*:
- *akz* model [set default parameters](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_default_param.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/paramfunc/ffs_akz_set_default_param.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_default_param.html)
    * param_map: container map for carrying parameters across functions
    * support_map: container map for carrying programming instructions etc across functions
- *akz* model [set functions](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/paramfunc/ffs_akz_set_functions.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html)
    * functions: centrally define functions as function handles
- *akz* model [generate states, choices, and shocks grids](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html): [**m**](https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/paramfunc/ffs_akz_get_funcgrid.m) \| [**publish html**](https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_get_funcgrid.html)
    * func_map: container map containing all function handles
    * armt_map: container map containing all key model input matrixes for endogenous and exogenous states and choices.
