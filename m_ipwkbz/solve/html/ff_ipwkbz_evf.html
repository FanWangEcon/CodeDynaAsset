
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>2nd Stage Optimization for Risky + Safe Asset (Save + Borr) Interpolated-Percentage</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-07-27"><meta name="DC.source" content="ff_ipwkbz_evf.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>2nd Stage Optimization for Risky + Safe Asset (Save + Borr) Interpolated-Percentage</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">Integrate <b>E(V(coh(k',b'), z')|z, w)</b></a></li><li><a href="#6">Reshape <b>E(V(coh,z'|z,w))</b> to allow for maxing</a></li><li><a href="#7">Maximize <b>max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</b> optimal value and index</a></li><li><a href="#8">Reindex K' and B' Choices for each State at the Optimal <b>w'=k'+b'</b> choice</a></li><li><a href="#9">Graph</a></li><li><a href="#11">Graph 1, V and EV</a></li><li><a href="#12">Graph 2, max(EV)</a></li><li><a href="#13">Graph 3, at max(EV) optimal choice category, color regions, borrow save</a></li><li><a href="#14">Graph 4, Optimal K' and B' Levels</a></li><li><a href="#16">Display Various Containers</a></li><li><a href="#18">Display 1 support_map</a></li><li><a href="#19">Display 2 armt_map</a></li><li><a href="#20">Display 3 param_map</a></li><li><a href="#21">Display 4 func_map</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [mt_ev_condi_z_max, mt_ev_condi_z_max_idx, mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp] = ff_ipwkbz_evf(varargin)
</pre><h2 id="2">FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings</h2><p>This function follows the structure set up here: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_wkz_evf.html">ff_wkz_evf</a> but now we solve the second stage with percentage choice grid</p><p>We solve along a vector of w_n vector, that is an interpolation vector, not a vector of actual w choices picked in the first stage. k' choices are in terms of percentages. Compared to ff_wkz_evf where we only had an upper triangle of choices, now we have a full matrix of percentage choices.</p><p>@param mt_val matrix state_n I^2 by shock_n. This is the value matrix each row is a feasible reachable state given the choice vectors/matrix and each column is a shock state.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@return mt_ev_condi_z_max matrix choice_w_n by shock_n max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)) conditional on z and w, at the optimal k' choice (w=k'+b') what is the expected utility? This is the value result from the 2nd stage problem. Note the result integrates over z'.</p><p>@return mt_ev_condi_z_max_idx matrix choice_w_n by shock_n this is the argmax from max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)). Given the vector of k' choices, which index maximized conditional on z and w integrating over z'/</p><p>@return mt_ev_condi_z_max_kp matrix choice_w_level_n by shock_n the k' choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</p><p>@return mt_ev_condi_z_max_bp matrix choice_w_n by shock_n the b'=w-k' choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</p><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m">ffs_ipwkbz_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m">ffs_ipwkbz_get_funcgrid</a></li></ul></div><h2 id="3">Default</h2><pre class="codeinput">params_len = length(varargin);
bl_input_override = 0;
<span class="keyword">if</span> (params_len == 5)
    bl_input_override = varargin{5};
<span class="keyword">end</span>
<span class="keyword">if</span> (bl_input_override)
    <span class="comment">% override when called from outside</span>
    [mt_val, param_map, support_map, armt_map, ~] = varargin{:};
<span class="keyword">else</span>
    clear <span class="string">all</span>;
    close <span class="string">all</span>;

    <span class="comment">% Not default parameters, but parameters that generate defaults</span>
    [param_map, support_map] = ffs_ipwkbz_set_default_param();

    support_map(<span class="string">'bl_graph_evf'</span>) = true;
    bl_display_evf = true;
    support_map(<span class="string">'bl_display_evf'</span>) = bl_display_evf;

    param_map(<span class="string">'it_ak_perc_n'</span>) = 250;
    param_map(<span class="string">'fl_w_interp_grid_gap'</span>) = (param_map(<span class="string">'fl_w_max'</span>)-param_map(<span class="string">'fl_b_bd'</span>))/param_map(<span class="string">'it_ak_perc_n'</span>);

    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map); <span class="comment">% 1 for override</span>

    <span class="comment">% Generating Defaults</span>
    params_group = values(armt_map, {<span class="string">'ar_a_meshk'</span>, <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_z'</span>});
    [ar_a_meshk, ar_k_mesha, ar_z] = params_group{:};
    params_group = values(func_map, {<span class="string">'f_util_standin'</span>, <span class="string">'f_coh'</span>});
    [f_util_standin, f_coh] = params_group{:};
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
    mt_coh = f_coh(ar_z, ar_a_meshk, ar_k_mesha);

<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: PARAM_MAP
----------------------------------------
  Map with properties:

        Count: 34
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = bl_default ; val = true
pos = 2 ; key = fl_Amean ; val = 1
pos = 3 ; key = fl_alpha ; val = 0.36
pos = 4 ; key = fl_b_bd ; val = -20
pos = 5 ; key = fl_beta ; val = 0.94
pos = 6 ; key = fl_c_min ; val = 0.02
pos = 7 ; key = fl_coh_interp_grid_gap ; val = 0.1
pos = 8 ; key = fl_crra ; val = 1.5
pos = 9 ; key = fl_default_wprime ; val = 0
pos = 10 ; key = fl_delta ; val = 0.08
pos = 11 ; key = fl_k_max ; val = 70
pos = 12 ; key = fl_k_min ; val = 0
pos = 13 ; key = fl_nan_replace ; val = -9999
pos = 14 ; key = fl_r_borr ; val = 0.095
pos = 15 ; key = fl_r_save ; val = 0.025
pos = 16 ; key = fl_tol_dist ; val = 1e-05
pos = 17 ; key = fl_tol_pol ; val = 1e-05
pos = 18 ; key = fl_tol_val ; val = 1e-05
pos = 19 ; key = fl_w ; val = 0.44365
pos = 20 ; key = fl_w_interp_grid_gap ; val = 0.1
pos = 21 ; key = fl_w_max ; val = 50
pos = 22 ; key = fl_w_min ; val = -20
pos = 23 ; key = fl_z_mu ; val = 0
pos = 24 ; key = fl_z_rho ; val = 0.8
pos = 25 ; key = fl_z_sig ; val = 0.2
pos = 26 ; key = it_ak_perc_n ; val = 50
pos = 27 ; key = it_c_interp_grid_gap ; val = 0.0001
pos = 28 ; key = it_maxiter_dist ; val = 1000
pos = 29 ; key = it_maxiter_val ; val = 250
pos = 30 ; key = it_tol_pol_nochange ; val = 25
pos = 31 ; key = it_w_perc_n ; val = 50
pos = 32 ; key = it_z_n ; val = 15
pos = 33 ; key = st_analytical_stationary_type ; val = eigenvector
pos = 34 ; key = st_model ; val = ipwkbz
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                              i     idx     value 
                              __    ___    _______

    bl_default                 1     1           1
    fl_Amean                   2     2           1
    fl_alpha                   3     3        0.36
    fl_b_bd                    4     4         -20
    fl_beta                    5     5        0.94
    fl_c_min                   6     6        0.02
    fl_coh_interp_grid_gap     7     7         0.1
    fl_crra                    8     8         1.5
    fl_default_wprime          9     9           0
    fl_delta                  10    10        0.08
    fl_k_max                  11    11          70
    fl_k_min                  12    12           0
    fl_nan_replace            13    13       -9999
    fl_r_borr                 14    14       0.095
    fl_r_save                 15    15       0.025
    fl_tol_dist               16    16       1e-05
    fl_tol_pol                17    17       1e-05
    fl_tol_val                18    18       1e-05
    fl_w                      19    19     0.44365
    fl_w_interp_grid_gap      20    20         0.1
    fl_w_max                  21    21          50
    fl_w_min                  22    22         -20
    fl_z_mu                   23    23           0
    fl_z_rho                  24    24         0.8
    fl_z_sig                  25    25         0.2
    it_ak_perc_n              26    26          50
    it_c_interp_grid_gap      27    27      0.0001
    it_maxiter_dist           28    28        1000
    it_maxiter_val            29    29         250
    it_tol_pol_nochange       30    30          25
    it_w_perc_n               31    31          50
    it_z_n                    32    32          15

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Strings in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                                     i    idx
                                     _    ___

    st_analytical_stationary_type    1    33 
    st_model                         2    34 

----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: SUPPORT_MAP
----------------------------------------
  Map with properties:

        Count: 42
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = bl_display ; val = false
pos = 2 ; key = bl_display_defparam ; val = true
pos = 3 ; key = bl_display_dist ; val = false
pos = 4 ; key = bl_display_evf ; val = false
pos = 5 ; key = bl_display_final ; val = true
pos = 6 ; key = bl_display_final_dist ; val = false
pos = 7 ; key = bl_display_final_dist_detail ; val = false
pos = 8 ; key = bl_display_funcgrids ; val = false
pos = 9 ; key = bl_graph ; val = true
pos = 10 ; key = bl_graph_coh_t_coh ; val = true
pos = 11 ; key = bl_graph_evf ; val = false
pos = 12 ; key = bl_graph_funcgrids ; val = false
pos = 13 ; key = bl_graph_funcgrids_detail ; val = false
pos = 14 ; key = bl_graph_onebyones ; val = true
pos = 15 ; key = bl_graph_pol_lvl ; val = true
pos = 16 ; key = bl_graph_pol_pct ; val = true
pos = 17 ; key = bl_graph_val ; val = true
pos = 18 ; key = bl_img_save ; val = false
pos = 19 ; key = bl_mat ; val = false
pos = 20 ; key = bl_post ; val = true
pos = 21 ; key = bl_profile ; val = false
pos = 22 ; key = bl_profile_dist ; val = false
pos = 23 ; key = bl_time ; val = false
pos = 24 ; key = it_display_every ; val = 5
pos = 25 ; key = it_display_final_colmax ; val = 12
pos = 26 ; key = it_display_final_rowmax ; val = 100
pos = 27 ; key = it_display_summmat_colmax ; val = 5
pos = 28 ; key = it_display_summmat_rowmax ; val = 5
pos = 29 ; key = st_img_name_main ; val = _default
pos = 30 ; key = st_img_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/img/
pos = 31 ; key = st_img_prefix ; val = 
pos = 32 ; key = st_img_suffix ; val = _p4.png
pos = 33 ; key = st_mat_name_main ; val = _default
pos = 34 ; key = st_mat_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/mat/
pos = 35 ; key = st_mat_prefix ; val = 
pos = 36 ; key = st_mat_suffix ; val = _p4
pos = 37 ; key = st_matimg_path_root ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz/
pos = 38 ; key = st_profile_name_main ; val = _default
pos = 39 ; key = st_profile_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/profile/
pos = 40 ; key = st_profile_prefix ; val = 
pos = 41 ; key = st_profile_suffix ; val = _p4
pos = 42 ; key = st_title_prefix ; val = 
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                                    i     idx    value
                                    __    ___    _____

    bl_display                       1     1        0 
    bl_display_defparam              2     2        1 
    bl_display_dist                  3     3        0 
    bl_display_evf                   4     4        0 
    bl_display_final                 5     5        1 
    bl_display_final_dist            6     6        0 
    bl_display_final_dist_detail     7     7        0 
    bl_display_funcgrids             8     8        0 
    bl_graph                         9     9        1 
    bl_graph_coh_t_coh              10    10        1 
    bl_graph_evf                    11    11        0 
    bl_graph_funcgrids              12    12        0 
    bl_graph_funcgrids_detail       13    13        0 
    bl_graph_onebyones              14    14        1 
    bl_graph_pol_lvl                15    15        1 
    bl_graph_pol_pct                16    16        1 
    bl_graph_val                    17    17        1 
    bl_img_save                     18    18        0 
    bl_mat                          19    19        0 
    bl_post                         20    20        1 
    bl_profile                      21    21        0 
    bl_profile_dist                 22    22        0 
    bl_time                         23    23        0 
    it_display_every                24    24        5 
    it_display_final_colmax         25    25       12 
    it_display_final_rowmax         26    26      100 
    it_display_summmat_colmax       27    27        5 
    it_display_summmat_rowmax       28    28        5 

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Strings in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                            i     idx
                            __    ___

    st_img_name_main         1    29 
    st_img_path              2    30 
    st_img_prefix            3    31 
    st_img_suffix            4    32 
    st_mat_name_main         5    33 
    st_mat_path              6    34 
    st_mat_prefix            7    35 
    st_mat_suffix            8    36 
    st_matimg_path_root      9    37 
    st_profile_name_main    10    38 
    st_profile_path         11    39 
    st_profile_prefix       12    40 
    st_profile_suffix       13    41 
    st_title_prefix         14    42 

</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput">params_group = values(armt_map, {<span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>,<span class="keyword">...</span>
    <span class="string">'ar_w_level'</span>, <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_a_meshk'</span>, <span class="string">'mt_k'</span>});
[mt_z_trans, ar_z, ar_w_level, <span class="keyword">...</span>
    ar_k_mesha, ar_a_meshk, mt_k] = params_group{:};
params_group = values(param_map, {<span class="string">'it_z_n'</span>, <span class="string">'fl_nan_replace'</span>, <span class="string">'fl_b_bd'</span>});
[it_z_n, fl_nan_replace, fl_b_bd] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_graph_onebyones'</span>,<span class="string">'bl_display_evf'</span>, <span class="string">'bl_graph_evf'</span>});
[bl_graph_onebyones, bl_display_evf, bl_graph_evf] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_img_save'</span>, <span class="string">'st_img_path'</span>, <span class="string">'st_img_prefix'</span>, <span class="string">'st_img_name_main'</span>, <span class="string">'st_img_suffix'</span>});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {<span class="string">'it_display_summmat_rowmax'</span>, <span class="string">'it_display_summmat_colmax'</span>});
[it_display_summmat_rowmax, it_display_summmat_colmax] = params_group{:};

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_ipwkbz_evf'</span>;
st_img_name_main = [st_func_name st_img_name_main];
</pre><h2 id="5">Integrate <b>E(V(coh(k',b'), z')|z, w)</b></h2><p>Each column for a different state z, each value <b>E(V(coh,z')|z)</b> integrated already Here, each column is a current z, more to right higher EV dim(mt_ev_condi_z): <b>Q by M</b> Note that: mt_ev_condi_z = mt_val*mt_z_trans' is a mistake, that would be what we do in the <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_set_functions.html">ffs_ipwkbz_set_functions</a> code where we loop over current z, and for each current z, grab out a particular row from the mt_z_trans that corresponds to a current shock's transition into all future states.</p><p>here, each column of mt_val corresponds to a state z, think of that as future state z. The input mt_val is <b>V(coh, z)</b>, we need to integrate to get <b>E(V(coh,z')|z)</b>.</p><pre class="codeinput">mt_ev_condi_z = mt_val*mt_z_trans';
<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z: Q by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z));
    disp(head(array2table(mt_ev_condi_z), 20));
    disp(tail(array2table(mt_ev_condi_z), 20));
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z: Q by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
       62250          15

    mt_ev_condi_z1    mt_ev_condi_z2    mt_ev_condi_z3    mt_ev_condi_z4    mt_ev_condi_z5    mt_ev_condi_z6    mt_ev_condi_z7    mt_ev_condi_z8    mt_ev_condi_z9    mt_ev_condi_z10    mt_ev_condi_z11    mt_ev_condi_z12    mt_ev_condi_z13    mt_ev_condi_z14    mt_ev_condi_z15
    ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    _______________    _______________    _______________    _______________    _______________    _______________

        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     
        -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912            -3.912             -3.912             -3.912             -3.912             -3.912             -3.912     

    mt_ev_condi_z1    mt_ev_condi_z2    mt_ev_condi_z3    mt_ev_condi_z4    mt_ev_condi_z5    mt_ev_condi_z6    mt_ev_condi_z7    mt_ev_condi_z8    mt_ev_condi_z9    mt_ev_condi_z10    mt_ev_condi_z11    mt_ev_condi_z12    mt_ev_condi_z13    mt_ev_condi_z14    mt_ev_condi_z15
    ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    _______________    _______________    _______________    _______________    _______________    _______________

        4.1874            4.1907            4.1946            4.1991             4.204            4.2095            4.2157            4.2225            4.2302            4.2386             4.2481             4.2585             4.2699             4.2822             4.2945     
        4.1867              4.19             4.194            4.1984            4.2034            4.2089            4.2151            4.2219            4.2296            4.2381             4.2475             4.2579             4.2694             4.2817              4.294     
         4.186            4.1894            4.1933            4.1977            4.2027            4.2082            4.2144            4.2213             4.229            4.2375             4.2469             4.2574             4.2689             4.2812             4.2935     
        4.1853            4.1887            4.1926             4.197             4.202            4.2076            4.2138            4.2207            4.2284            4.2369             4.2464             4.2568             4.2684             4.2807             4.2931     
        4.1846             4.188            4.1919            4.1964            4.2014            4.2069            4.2131            4.2201            4.2277            4.2363             4.2458             4.2563             4.2678             4.2802             4.2926     
        4.1839            4.1873            4.1912            4.1957            4.2007            4.2063            4.2125            4.2194            4.2271            4.2357             4.2452             4.2558             4.2673             4.2797             4.2921     
        4.1832            4.1866            4.1905             4.195               4.2            4.2056            4.2119            4.2188            4.2265            4.2351             4.2447             4.2552             4.2668             4.2792             4.2916     
        4.1825            4.1859            4.1898            4.1943            4.1994             4.205            4.2112            4.2182            4.2259            4.2345             4.2441             4.2547             4.2663             4.2787             4.2912     
        4.1818            4.1852            4.1892            4.1937            4.1987            4.2043            4.2106            4.2176            4.2253            4.2339             4.2435             4.2541             4.2657             4.2782             4.2907     
        4.1811            4.1845            4.1885             4.193             4.198            4.2037            4.2099            4.2169            4.2247            4.2333             4.2429             4.2536             4.2652             4.2777             4.2902     
        4.1804            4.1838            4.1878            4.1923            4.1974             4.203            4.2093            4.2163            4.2241            4.2328             4.2424              4.253             4.2647             4.2772             4.2897     
        4.1797            4.1831            4.1871            4.1916            4.1967            4.2024            4.2087            4.2157            4.2235            4.2322             4.2418             4.2525             4.2642             4.2767             4.2893     
         4.179            4.1824            4.1864            4.1909             4.196            4.2017             4.208             4.215            4.2229            4.2316             4.2412             4.2519             4.2636             4.2762             4.2888     
        4.1783            4.1817            4.1857            4.1903            4.1954             4.201            4.2074            4.2144            4.2223             4.231             4.2406             4.2514             4.2631             4.2757             4.2883     
        4.1776             4.181             4.185            4.1896            4.1947            4.2004            4.2067            4.2138            4.2216            4.2304             4.2401             4.2508             4.2626             4.2752             4.2878     
        4.1769            4.1803            4.1843            4.1889             4.194            4.1997            4.2061            4.2132             4.221            4.2298             4.2395             4.2502              4.262             4.2747             4.2873     
        4.1762            4.1796            4.1836            4.1882            4.1933            4.1991            4.2054            4.2125            4.2204            4.2292             4.2389             4.2497             4.2615             4.2742             4.2869     
        4.1754            4.1789            4.1829            4.1875            4.1927            4.1984            4.2048            4.2119            4.2198            4.2286             4.2383             4.2491              4.261             4.2736             4.2864     
        4.1747            4.1782            4.1823            4.1869             4.192            4.1977            4.2041            4.2113            4.2192             4.228             4.2378             4.2486             4.2604             4.2731             4.2859     
         4.174            4.1775            4.1816            4.1862            4.1913            4.1971            4.2035            4.2106            4.2186            4.2274             4.2372              4.248             4.2599             4.2726             4.2854     

</pre><h2 id="6">Reshape <b>E(V(coh,z'|z,w))</b> to allow for maxing</h2><p>dim(mt_ev_condi_z): <b>IxJ by M</b></p><pre class="codeinput">[it_mt_bp_rown, it_mt_bp_coln] = size(mt_k);
mt_ev_condi_z_full = reshape(mt_ev_condi_z, [it_mt_bp_rown, it_mt_bp_coln*it_z_n]);
</pre><h2 id="7">Maximize <b>max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</b> optimal value and index</h2><p>Maximization, find optimal k'/b' combination given z and w=k'+b'</p><pre class="codeinput">[ar_ev_condi_z_max, ar_ev_condi_z_max_idx] = max(mt_ev_condi_z_full);
mt_ev_condi_z_max = reshape(ar_ev_condi_z_max, [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_idx = reshape(ar_ev_condi_z_max_idx, [it_mt_bp_coln, it_z_n]);

<span class="keyword">if</span>(bl_display_evf)

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_full: J by IxM'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_full));
<span class="comment">%     disp(head(array2table(mt_ev_condi_z_full), 20));</span>
<span class="comment">%     disp(tail(array2table(mt_ev_condi_z_full), 20));</span>

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_max: I by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_max));
    disp(head(array2table(mt_ev_condi_z_max), 20));
    disp(tail(array2table(mt_ev_condi_z_max), 20));


    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_max_idx: I by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_max_idx));
    disp(head(array2table(mt_ev_condi_z_max_idx), 20));
    disp(tail(array2table(mt_ev_condi_z_max_idx), 20));

<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_full: J by IxM
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
         250        3735

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_max: I by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   249    15

    mt_ev_condi_z_max1    mt_ev_condi_z_max2    mt_ev_condi_z_max3    mt_ev_condi_z_max4    mt_ev_condi_z_max5    mt_ev_condi_z_max6    mt_ev_condi_z_max7    mt_ev_condi_z_max8    mt_ev_condi_z_max9    mt_ev_condi_z_max10    mt_ev_condi_z_max11    mt_ev_condi_z_max12    mt_ev_condi_z_max13    mt_ev_condi_z_max14    mt_ev_condi_z_max15
    __________________    __________________    __________________    __________________    __________________    __________________    __________________    __________________    __________________    ___________________    ___________________    ___________________    ___________________    ___________________    ___________________

           -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                  -3.912                -3.912                 -3.912                 -3.912                 -3.912      
           -3.912                -3.912                -3.912                -3.912                -3.912                -3.912                -3.912               -3.9117               -3.9097               -3.8993                 -3.8587               -3.7381                 -3.465                -2.9937                -2.3746      
           -3.912                -3.912                -3.912               -3.9114               -3.9078               -3.8902                -3.827               -3.6584                 -3.32               -2.8007                 -2.1761               -1.5641                -1.0482               -0.64825               -0.34844      
          -3.9092               -3.8965               -3.8479               -3.7101               -3.4191               -2.9536               -2.3764               -1.7999               -1.3076              -0.91818                -0.60988              -0.35478               -0.13403               0.060946                0.22997      
          -3.1231               -2.6385               -2.1416               -1.7011               -1.3407               -1.0473               -0.8001              -0.58315              -0.38682              -0.20537               -0.035188               0.12606                0.27947                0.42403                0.55498      
          -1.0435              -0.92496              -0.79232              -0.65115              -0.50576              -0.36368              -0.22526             -0.089953              0.042696               0.17306                 0.30145               0.42801                0.55237                0.67264                0.78375      
         -0.40662              -0.34046              -0.26298              -0.17635             -0.081541              0.019466               0.12202               0.22571               0.33045               0.43614                 0.54268               0.64988                0.75713                0.86242                0.96087      
        -0.022754              0.023335              0.078333               0.14119               0.21159                0.2896               0.37322               0.45934                0.5478               0.63846                 0.73116               0.82566                0.92132                 1.0162                 1.1057      
          0.25349               0.28888               0.33157               0.38097               0.43706               0.50011               0.57038               0.64509               0.72268               0.80304                 0.88602                0.9714                 1.0586                 1.1457                 1.2283      
          0.46954               0.49828               0.53318               0.57389               0.62054                0.6735               0.73319               0.79938                0.8691               0.94186                  1.0176                 1.096                 1.1766                 1.2576                 1.3348      
          0.64703               0.67123               0.70076               0.73539               0.77533                 0.821               0.87286               0.93138                0.9951                 1.062                  1.1319                1.2049                 1.2802                 1.3562                  1.429      
          0.79769               0.81859               0.84417               0.87431               0.90924               0.94938               0.99525                1.0473                1.1057                1.1679                  1.2332                1.3016                 1.3725                 1.4444                 1.5135      
          0.92857               0.94696               0.96953               0.99621                1.0272                1.0631                1.1042                1.1511                1.2043                1.2626                  1.3241                1.3887                 1.4559                 1.5243                 1.5901      
           1.0443                1.0607                1.0809                1.1048                1.1328                1.1651                1.2024                1.2451                1.2937                1.3483                  1.4065                1.4679                 1.5319                 1.5973                 1.6603      
            1.148                1.1628                1.1811                1.2028                1.2282                1.2576                1.2917                1.3309                1.3757                1.4266                   1.482                1.5405                 1.6018                 1.6645                 1.7251      
           1.2419                1.2554                1.2721                 1.292                1.3152                1.3423                1.3737                1.4099                1.4514                1.4988                  1.5516                1.6077                 1.6665                 1.7268                 1.7852      
           1.3278                1.3402                1.3555                1.3738                1.3953                1.4204                1.4495                1.4831                1.5218                1.5661                  1.6162                1.6701                 1.7267                 1.7849                 1.8414      
           1.4068                1.4183                1.4325                1.4495                1.4694                1.4927                1.5199                1.5513                1.5875                1.6291                  1.6765                1.7284                 1.7831                 1.8394                  1.894      
           1.4801                1.4908                 1.504                1.5198                1.5384                1.5602                1.5856                1.6151                1.6492                1.6883                  1.7331                1.7831                 1.8361                 1.8906                 1.9436      
           1.5483                1.5583                1.5707                1.5855                 1.603                1.6234                1.6473                1.6751                1.7072                1.7442                  1.7867                1.8347                  1.886                 1.9389                 1.9905      

    mt_ev_condi_z_max1    mt_ev_condi_z_max2    mt_ev_condi_z_max3    mt_ev_condi_z_max4    mt_ev_condi_z_max5    mt_ev_condi_z_max6    mt_ev_condi_z_max7    mt_ev_condi_z_max8    mt_ev_condi_z_max9    mt_ev_condi_z_max10    mt_ev_condi_z_max11    mt_ev_condi_z_max12    mt_ev_condi_z_max13    mt_ev_condi_z_max14    mt_ev_condi_z_max15
    __________________    __________________    __________________    __________________    __________________    __________________    __________________    __________________    __________________    ___________________    ___________________    ___________________    ___________________    ___________________    ___________________

          4.1976                4.1986                4.1998                4.2012                4.2029                 4.205                4.2074                4.2104                4.2139                 4.218                  4.223                 4.2289                 4.2358                 4.2436                 4.2521       
           4.202                4.2029                4.2041                4.2055                4.2073                4.2093                4.2118                4.2147                4.2182                4.2223                 4.2272                 4.2331                 4.2399                 4.2478                 4.2562       
          4.2063                4.2072                4.2084                4.2099                4.2116                4.2136                4.2161                 4.219                4.2224                4.2266                 4.2315                 4.2373                 4.2441                 4.2519                 4.2603       
          4.2106                4.2116                4.2127                4.2142                4.2159                4.2179                4.2203                4.2232                4.2267                4.2308                 4.2357                 4.2415                 4.2483                 4.2561                 4.2644       
          4.2149                4.2159                 4.217                4.2184                4.2201                4.2222                4.2246                4.2275                4.2309                 4.235                 4.2399                 4.2456                 4.2524                 4.2602                 4.2685       
          4.2192                4.2201                4.2213                4.2227                4.2244                4.2264                4.2288                4.2317                4.2351                4.2392                 4.2441                 4.2498                 4.2566                 4.2643                 4.2725       
          4.2235                4.2244                4.2256                 4.227                4.2287                4.2307                4.2331                4.2359                4.2393                4.2434                 4.2482                 4.2539                 4.2607                 4.2683                 4.2766       
          4.2277                4.2286                4.2298                4.2312                4.2329                4.2349                4.2373                4.2401                4.2435                4.2475                 4.2524                 4.2581                 4.2648                 4.2724                 4.2806       
          4.2319                4.2329                 4.234                4.2354                4.2371                4.2391                4.2415                4.2443                4.2477                4.2517                 4.2565                 4.2622                 4.2688                 4.2764                 4.2846       
          4.2362                4.2371                4.2382                4.2396                4.2413                4.2433                4.2456                4.2485                4.2518                4.2558                 4.2606                 4.2662                 4.2729                 4.2805                 4.2886       
          4.2403                4.2413                4.2424                4.2438                4.2454                4.2474                4.2498                4.2526                4.2559                4.2599                 4.2647                 4.2703                 4.2769                 4.2845                 4.2926       
          4.2445                4.2454                4.2466                4.2479                4.2496                4.2516                4.2539                4.2567                4.2601                 4.264                 4.2688                 4.2744                  4.281                 4.2885                 4.2965       
          4.2487                4.2496                4.2507                4.2521                4.2537                4.2557                 4.258                4.2608                4.2641                4.2681                 4.2728                 4.2784                  4.285                 4.2925                 4.3005       
          4.2528                4.2537                4.2548                4.2562                4.2579                4.2598                4.2621                4.2649                4.2682                4.2722                 4.2769                 4.2824                  4.289                 4.2964                 4.3044       
          4.2569                4.2578                 4.259                4.2603                 4.262                4.2639                4.2662                 4.269                4.2723                4.2762                 4.2809                 4.2864                 4.2929                 4.3004                 4.3083       
           4.261                4.2619                4.2631                4.2644                 4.266                 4.268                4.2703                 4.273                4.2763                4.2802                 4.2849                 4.2904                 4.2969                 4.3043                 4.3122       
          4.2651                 4.266                4.2671                4.2685                4.2701                 4.272                4.2743                4.2771                4.2804                4.2843                 4.2889                 4.2944                 4.3008                 4.3082                 4.3161       
          4.2692                4.2701                4.2712                4.2726                4.2742                4.2761                4.2784                4.2811                4.2844                4.2882                 4.2929                 4.2983                 4.3048                 4.3121                   4.32       
          4.2733                4.2741                4.2753                4.2766                4.2782                4.2801                4.2824                4.2851                4.2884                4.2922                 4.2968                 4.3023                 4.3087                  4.316                 4.3239       
          4.2773                4.2782                4.2793                4.2806                4.2822                4.2841                4.2864                4.2891                4.2923                4.2962                 4.3008                 4.3062                 4.3126                 4.3199                 4.3277       

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_max_idx: I by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   249    15

    mt_ev_condi_z_max_idx1    mt_ev_condi_z_max_idx2    mt_ev_condi_z_max_idx3    mt_ev_condi_z_max_idx4    mt_ev_condi_z_max_idx5    mt_ev_condi_z_max_idx6    mt_ev_condi_z_max_idx7    mt_ev_condi_z_max_idx8    mt_ev_condi_z_max_idx9    mt_ev_condi_z_max_idx10    mt_ev_condi_z_max_idx11    mt_ev_condi_z_max_idx12    mt_ev_condi_z_max_idx13    mt_ev_condi_z_max_idx14    mt_ev_condi_z_max_idx15
    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    _______________________    _______________________    _______________________    _______________________    _______________________    _______________________

               1                         1                         1                         1                         1                         1                         1                         1                         1                          1                          1                          1                          1                          1                          1          
             250                       250                       250                       250                       250                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             250                       250                       250                       250                       250                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             250                       250                       250                       250                       250                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             222                       232                       248                       250                       250                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             142                       166                       195                       232                       250                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             122                       142                       168                       200                       237                       250                       250                       250                       250                        250                        250                        250                        250                        250                        250          
             105                       123                       146                       174                       207                       246                       250                       250                       250                        250                        250                        250                        250                        250                        250          
              93                       109                       129                       153                       182                       217                       250                       250                       250                        250                        250                        250                        250                        250                        250          
              83                        97                       115                       137                       163                       194                       231                       250                       250                        250                        250                        250                        250                        250                        250          
              75                        88                       104                       124                       147                       175                       209                       249                       250                        250                        250                        250                        250                        250                        250          
              68                        80                        95                       113                       134                       160                       191                       227                       250                        250                        250                        250                        250                        250                        250          
              63                        74                        87                       104                       124                       147                       175                       209                       248                        250                        250                        250                        250                        250                        250          
              58                        68                        81                        96                       114                       136                       162                       193                       230                        250                        250                        250                        250                        250                        250          
              54                        63                        75                        89                       106                       127                       151                       180                       214                        250                        250                        250                        250                        250                        250          
              50                        59                        70                        84                        99                       119                       141                       168                       200                        238                        250                        250                        250                        250                        250          
              47                        56                        66                        78                        93                       111                       133                       158                       188                        224                        250                        250                        250                        250                        250          
              45                        52                        62                        74                        88                       105                       125                       149                       177                        211                        250                        250                        250                        250                        250          
              42                        49                        59                        70                        83                        99                       118                       141                       168                        200                        238                        250                        250                        250                        250          
              40                        47                        56                        66                        79                        94                       112                       134                       159                        190                        226                        250                        250                        250                        250          

    mt_ev_condi_z_max_idx1    mt_ev_condi_z_max_idx2    mt_ev_condi_z_max_idx3    mt_ev_condi_z_max_idx4    mt_ev_condi_z_max_idx5    mt_ev_condi_z_max_idx6    mt_ev_condi_z_max_idx7    mt_ev_condi_z_max_idx8    mt_ev_condi_z_max_idx9    mt_ev_condi_z_max_idx10    mt_ev_condi_z_max_idx11    mt_ev_condi_z_max_idx12    mt_ev_condi_z_max_idx13    mt_ev_condi_z_max_idx14    mt_ev_condi_z_max_idx15
    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    _______________________    _______________________    _______________________    _______________________    _______________________    _______________________

              8                         9                         11                        13                        15                        18                        22                        26                        31                        36                         43                         52                         61                         73                         85           
              8                         9                         11                        13                        15                        18                        22                        26                        30                        36                         43                         51                         61                         72                         85           
              8                         9                         11                        13                        15                        18                        21                        26                        30                        36                         43                         51                         61                         72                         84           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        36                         43                         51                         61                         72                         84           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        36                         43                         51                         60                         71                         83           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        36                         42                         51                         60                         71                         83           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        35                         42                         50                         60                         71                         83           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        35                         42                         50                         60                         71                         82           
              8                         9                         11                        13                        15                        18                        21                        25                        30                        35                         42                         50                         59                         70                         82           
              8                         9                         11                        13                        15                        18                        21                        25                        29                        35                         42                         50                         59                         70                         82           
              8                         9                         11                        12                        15                        17                        21                        25                        29                        35                         42                         50                         59                         70                         81           
              8                         9                         11                        12                        15                        17                        21                        25                        29                        35                         41                         49                         59                         69                         81           
              8                         9                         10                        12                        15                        17                        21                        24                        29                        35                         41                         49                         58                         69                         81           
              8                         9                         10                        12                        15                        17                        21                        24                        29                        34                         41                         49                         58                         69                         80           
              8                         9                         10                        12                        15                        17                        20                        24                        29                        34                         41                         49                         58                         69                         80           
              8                         9                         10                        12                        14                        17                        20                        24                        29                        34                         41                         49                         58                         68                         80           
              8                         9                         10                        12                        14                        17                        20                        24                        29                        34                         41                         48                         57                         68                         79           
              8                         9                         10                        12                        14                        17                        20                        24                        29                        34                         40                         48                         57                         68                         79           
              8                         9                         10                        12                        14                        17                        20                        24                        28                        34                         40                         48                         57                         67                         79           
              7                         9                         10                        12                        14                        17                        20                        24                        28                        34                         40                         48                         57                         67                         78           

</pre><h2 id="8">Reindex K' and B' Choices for each State at the Optimal <b>w'=k'+b'</b> choice</h2><p>The K' and B' Optimal Choices Associated with EV opti dim(mt_ev_condi_z_max_kp): <b>I by M</b></p><pre class="codeinput">ar_add_grid = linspace(0, it_mt_bp_rown*(it_mt_bp_coln-1), it_mt_bp_coln);
mt_ev_condi_z_max_idx = mt_ev_condi_z_max_idx + ar_add_grid';

<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_max_idx: I by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_max_idx));
    disp(head(array2table(mt_ev_condi_z_max_idx), 20));
    disp(tail(array2table(mt_ev_condi_z_max_idx), 20));
<span class="keyword">end</span>

mt_ev_condi_z_max_kp = reshape(ar_k_mesha(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_bp = reshape(ar_a_meshk(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);

<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_max_kp: I by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_max_kp));
    disp(head(array2table(mt_ev_condi_z_max_kp), 20));
    disp(tail(array2table(mt_ev_condi_z_max_kp), 20));

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'mt_ev_condi_z_max_bp: I by M'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(size(mt_ev_condi_z_max_bp));
    disp(head(array2table(mt_ev_condi_z_max_bp), 20));
    disp(tail(array2table(mt_ev_condi_z_max_bp), 20));
<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_max_idx: I by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   249    15

    mt_ev_condi_z_max_idx1    mt_ev_condi_z_max_idx2    mt_ev_condi_z_max_idx3    mt_ev_condi_z_max_idx4    mt_ev_condi_z_max_idx5    mt_ev_condi_z_max_idx6    mt_ev_condi_z_max_idx7    mt_ev_condi_z_max_idx8    mt_ev_condi_z_max_idx9    mt_ev_condi_z_max_idx10    mt_ev_condi_z_max_idx11    mt_ev_condi_z_max_idx12    mt_ev_condi_z_max_idx13    mt_ev_condi_z_max_idx14    mt_ev_condi_z_max_idx15
    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    _______________________    _______________________    _______________________    _______________________    _______________________    _______________________

                1                         1                         1                         1                         1                         1                         1                         1                         1                         1                          1                          1                          1                          1                          1          
              500                       500                       500                       500                       500                       500                       500                       500                       500                       500                        500                        500                        500                        500                        500          
              750                       750                       750                       750                       750                       750                       750                       750                       750                       750                        750                        750                        750                        750                        750          
             1000                      1000                      1000                      1000                      1000                      1000                      1000                      1000                      1000                      1000                       1000                       1000                       1000                       1000                       1000          
             1222                      1232                      1248                      1250                      1250                      1250                      1250                      1250                      1250                      1250                       1250                       1250                       1250                       1250                       1250          
             1392                      1416                      1445                      1482                      1500                      1500                      1500                      1500                      1500                      1500                       1500                       1500                       1500                       1500                       1500          
             1622                      1642                      1668                      1700                      1737                      1750                      1750                      1750                      1750                      1750                       1750                       1750                       1750                       1750                       1750          
             1855                      1873                      1896                      1924                      1957                      1996                      2000                      2000                      2000                      2000                       2000                       2000                       2000                       2000                       2000          
             2093                      2109                      2129                      2153                      2182                      2217                      2250                      2250                      2250                      2250                       2250                       2250                       2250                       2250                       2250          
             2333                      2347                      2365                      2387                      2413                      2444                      2481                      2500                      2500                      2500                       2500                       2500                       2500                       2500                       2500          
             2575                      2588                      2604                      2624                      2647                      2675                      2709                      2749                      2750                      2750                       2750                       2750                       2750                       2750                       2750          
             2818                      2830                      2845                      2863                      2884                      2910                      2941                      2977                      3000                      3000                       3000                       3000                       3000                       3000                       3000          
             3063                      3074                      3087                      3104                      3124                      3147                      3175                      3209                      3248                      3250                       3250                       3250                       3250                       3250                       3250          
             3308                      3318                      3331                      3346                      3364                      3386                      3412                      3443                      3480                      3500                       3500                       3500                       3500                       3500                       3500          
             3554                      3563                      3575                      3589                      3606                      3627                      3651                      3680                      3714                      3750                       3750                       3750                       3750                       3750                       3750          
             3800                      3809                      3820                      3834                      3849                      3869                      3891                      3918                      3950                      3988                       4000                       4000                       4000                       4000                       4000          
             4047                      4056                      4066                      4078                      4093                      4111                      4133                      4158                      4188                      4224                       4250                       4250                       4250                       4250                       4250          
             4295                      4302                      4312                      4324                      4338                      4355                      4375                      4399                      4427                      4461                       4500                       4500                       4500                       4500                       4500          
             4542                      4549                      4559                      4570                      4583                      4599                      4618                      4641                      4668                      4700                       4738                       4750                       4750                       4750                       4750          
             4790                      4797                      4806                      4816                      4829                      4844                      4862                      4884                      4909                      4940                       4976                       5000                       5000                       5000                       5000          

    mt_ev_condi_z_max_idx1    mt_ev_condi_z_max_idx2    mt_ev_condi_z_max_idx3    mt_ev_condi_z_max_idx4    mt_ev_condi_z_max_idx5    mt_ev_condi_z_max_idx6    mt_ev_condi_z_max_idx7    mt_ev_condi_z_max_idx8    mt_ev_condi_z_max_idx9    mt_ev_condi_z_max_idx10    mt_ev_condi_z_max_idx11    mt_ev_condi_z_max_idx12    mt_ev_condi_z_max_idx13    mt_ev_condi_z_max_idx14    mt_ev_condi_z_max_idx15
    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________    _______________________    _______________________    _______________________    _______________________    _______________________    _______________________

            57258                     57259                     57261                     57263                     57265                     57268                     57272                     57276                     57281                      57286                      57293                      57302                      57311                      57323                      57335         
            57508                     57509                     57511                     57513                     57515                     57518                     57522                     57526                     57530                      57536                      57543                      57551                      57561                      57572                      57585         
            57758                     57759                     57761                     57763                     57765                     57768                     57771                     57776                     57780                      57786                      57793                      57801                      57811                      57822                      57834         
            58008                     58009                     58011                     58013                     58015                     58018                     58021                     58025                     58030                      58036                      58043                      58051                      58061                      58072                      58084         
            58258                     58259                     58261                     58263                     58265                     58268                     58271                     58275                     58280                      58286                      58293                      58301                      58310                      58321                      58333         
            58508                     58509                     58511                     58513                     58515                     58518                     58521                     58525                     58530                      58536                      58542                      58551                      58560                      58571                      58583         
            58758                     58759                     58761                     58763                     58765                     58768                     58771                     58775                     58780                      58785                      58792                      58800                      58810                      58821                      58833         
            59008                     59009                     59011                     59013                     59015                     59018                     59021                     59025                     59030                      59035                      59042                      59050                      59060                      59071                      59082         
            59258                     59259                     59261                     59263                     59265                     59268                     59271                     59275                     59280                      59285                      59292                      59300                      59309                      59320                      59332         
            59508                     59509                     59511                     59513                     59515                     59518                     59521                     59525                     59529                      59535                      59542                      59550                      59559                      59570                      59582         
            59758                     59759                     59761                     59762                     59765                     59767                     59771                     59775                     59779                      59785                      59792                      59800                      59809                      59820                      59831         
            60008                     60009                     60011                     60012                     60015                     60017                     60021                     60025                     60029                      60035                      60041                      60049                      60059                      60069                      60081         
            60258                     60259                     60260                     60262                     60265                     60267                     60271                     60274                     60279                      60285                      60291                      60299                      60308                      60319                      60331         
            60508                     60509                     60510                     60512                     60515                     60517                     60521                     60524                     60529                      60534                      60541                      60549                      60558                      60569                      60580         
            60758                     60759                     60760                     60762                     60765                     60767                     60770                     60774                     60779                      60784                      60791                      60799                      60808                      60819                      60830         
            61008                     61009                     61010                     61012                     61014                     61017                     61020                     61024                     61029                      61034                      61041                      61049                      61058                      61068                      61080         
            61258                     61259                     61260                     61262                     61264                     61267                     61270                     61274                     61279                      61284                      61291                      61298                      61307                      61318                      61329         
            61508                     61509                     61510                     61512                     61514                     61517                     61520                     61524                     61529                      61534                      61540                      61548                      61557                      61568                      61579         
            61758                     61759                     61760                     61762                     61764                     61767                     61770                     61774                     61778                      61784                      61790                      61798                      61807                      61817                      61829         
            62007                     62009                     62010                     62012                     62014                     62017                     62020                     62024                     62028                      62034                      62040                      62048                      62057                      62067                      62078         

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_max_kp: I by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   249    15

    mt_ev_condi_z_max_kp1    mt_ev_condi_z_max_kp2    mt_ev_condi_z_max_kp3    mt_ev_condi_z_max_kp4    mt_ev_condi_z_max_kp5    mt_ev_condi_z_max_kp6    mt_ev_condi_z_max_kp7    mt_ev_condi_z_max_kp8    mt_ev_condi_z_max_kp9    mt_ev_condi_z_max_kp10    mt_ev_condi_z_max_kp11    mt_ev_condi_z_max_kp12    mt_ev_condi_z_max_kp13    mt_ev_condi_z_max_kp14    mt_ev_condi_z_max_kp15
    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________

                 0                        0                        0                        0                        0                        0                        0                        0                        0                        0                         0                         0                         0                         0                         0        
           0.28312                  0.28312                  0.28312                  0.28312                  0.28312                  0.28312                  0.28312                  0.28312                  0.28312                  0.28312                   0.28312                   0.28312                   0.28312                   0.28312                   0.28312        
           0.56623                  0.56623                  0.56623                  0.56623                  0.56623                  0.56623                  0.56623                  0.56623                  0.56623                  0.56623                   0.56623                   0.56623                   0.56623                   0.56623                   0.56623        
           0.84935                  0.84935                  0.84935                  0.84935                  0.84935                  0.84935                  0.84935                  0.84935                  0.84935                  0.84935                   0.84935                   0.84935                   0.84935                   0.84935                   0.84935        
            1.0053                   1.0507                   1.1234                   1.1325                   1.1325                   1.1325                   1.1325                   1.1325                   1.1325                   1.1325                    1.1325                    1.1325                    1.1325                    1.1325                    1.1325        
           0.80221                  0.93852                   1.1032                   1.3134                   1.4156                   1.4156                   1.4156                   1.4156                   1.4156                   1.4156                    1.4156                    1.4156                    1.4156                    1.4156                    1.4156        
           0.82635                  0.96265                   1.1399                   1.3579                   1.6101                   1.6987                   1.6987                   1.6987                   1.6987                   1.6987                    1.6987                    1.6987                    1.6987                    1.6987                    1.6987        
            0.8289                  0.97202                   1.1549                   1.3775                   1.6399                     1.95                   1.9818                   1.9818                   1.9818                   1.9818                    1.9818                    1.9818                    1.9818                    1.9818                    1.9818        
           0.83827                  0.98367                   1.1654                   1.3835                    1.647                   1.9651                   2.2649                   2.2649                   2.2649                   2.2649                    2.2649                    2.2649                    2.2649                    2.2649                    2.2649        
           0.84083                  0.98395                    1.168                   1.3929                   1.6587                   1.9756                   2.3538                   2.5481                   2.5481                   2.5481                    2.5481                    2.5481                    2.5481                    2.5481                    2.5481        
           0.84338                  0.99105                   1.1728                      1.4                   1.6612                   1.9793                   2.3655                   2.8198                   2.8312                   2.8312                    2.8312                    2.8312                    2.8312                    2.8312                    2.8312        
           0.84026                   0.9902                   1.1776                   1.4025                   1.6649                   1.9898                   2.3771                   2.8269                   3.1143                   3.1143                    3.1143                    3.1143                    3.1143                    3.1143                    3.1143        
            0.8485                  0.99843                   1.1756                   1.4073                     1.68                   1.9935                   2.3751                   2.8386                   3.3701                   3.3974                    3.3974                    3.3974                    3.3974                    3.3974                    3.3974        
           0.84537                  0.99304                    1.185                   1.4065                   1.6723                   1.9972                   2.3811                   2.8388                   3.3852                   3.6805                    3.6805                    3.6805                    3.6805                    3.6805                    3.6805        
           0.84679                  0.98991                   1.1807                   1.4034                   1.6737                   2.0077                   2.3893                   2.8505                   3.3912                   3.9636                    3.9636                    3.9636                    3.9636                    3.9636                    3.9636        
           0.83912                  0.99247                   1.1799                   1.4184                    1.674                   2.0148                   2.3896                   2.8496                   3.3949                   4.0423                    4.2468                    4.2468                    4.2468                    4.2468                    4.2468        
           0.84054                   1.0041                   1.1858                   1.4039                   1.6765                   2.0037                   2.4035                   2.8579                   3.4031                   4.0574                    4.5299                    4.5299                    4.5299                    4.5299                    4.5299        
           0.85446                  0.98963                   1.1827                   1.4144                   1.6848                   2.0131                   2.3993                   2.8627                   3.4034                   4.0599                     4.813                     4.813                     4.813                     4.813                     4.813        
           0.84338                   0.9865                    1.191                   1.4159                   1.6817                   2.0088                   2.3973                   2.8675                   3.4196                   4.0738                    4.8508                    5.0961                    5.0961                    5.0961                    5.0961        
           0.84707                  0.99814                   1.1924                   1.4082                   1.6888                   2.0125                    2.401                   2.8758                   3.4153                   4.0843                    4.8613                    5.3792                    5.3792                    5.3792                    5.3792        

    mt_ev_condi_z_max_kp1    mt_ev_condi_z_max_kp2    mt_ev_condi_z_max_kp3    mt_ev_condi_z_max_kp4    mt_ev_condi_z_max_kp5    mt_ev_condi_z_max_kp6    mt_ev_condi_z_max_kp7    mt_ev_condi_z_max_kp8    mt_ev_condi_z_max_kp9    mt_ev_condi_z_max_kp10    mt_ev_condi_z_max_kp11    mt_ev_condi_z_max_kp12    mt_ev_condi_z_max_kp13    mt_ev_condi_z_max_kp14    mt_ev_condi_z_max_kp15
    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________

           1.8775                   2.1365                   2.6544                   3.1724                   3.6903                   4.4673                   5.5032                   6.5391                    7.834                    9.1289                    10.942                    13.273                    15.603                    18.711                    21.819        
           1.8857                   2.1458                   2.6661                   3.1863                   3.7065                   4.4869                   5.5273                   6.5678                   7.6083                     9.169                     10.99                    13.071                    15.672                    18.533                    21.915        
           1.8939                   2.1552                   2.6777                   3.2002                   3.7227                   4.5065                   5.2902                   6.5965                   7.6415                     9.209                    11.038                    13.128                     15.74                    18.614                    21.749        
           1.9022                   2.1646                   2.6893                   3.2141                   3.7389                   4.5261                   5.3132                   6.3628                   7.6747                    9.2491                    11.086                    13.185                    15.809                    18.695                    21.844        
           1.9104                   2.1739                    2.701                    3.228                   3.7551                   4.5457                   5.3362                   6.3903                   7.7079                    9.2891                    11.134                    13.242                    15.614                    18.512                    21.675        
           1.9187                   2.1833                   2.7126                    3.242                   3.7713                   4.5653                   5.3592                   6.4179                   7.7412                    9.3291                    10.917                    13.299                    15.681                    18.592                    21.768        
           1.9269                   2.1927                   2.7243                   3.2559                   3.7875                   4.5848                   5.3822                   6.4454                   7.7744                    9.1034                    10.964                     13.09                    15.748                    18.672                    21.862        
           1.9351                   2.2021                   2.7359                   3.2698                   3.8036                   4.6044                   5.4052                    6.473                   7.8076                    9.1423                    11.011                    13.146                    15.816                    18.752                    21.688        
           1.9434                   2.2114                   2.7476                   3.2837                   3.8198                    4.624                   5.4282                   6.5005                   7.8408                    9.1812                    11.058                    13.202                    15.615                    18.564                     21.78        
           1.9516                   2.2208                   2.7592                   3.2976                    3.836                   4.6436                   5.4512                    6.528                   7.6049                    9.2201                    11.105                    13.258                    15.681                    18.642                    21.873        
           1.9598                   2.2302                   2.7708                   3.0412                   3.8522                   4.3929                   5.4742                   6.5556                    7.637                     9.259                    11.151                    13.314                    15.747                    18.721                    21.695        
           1.9681                   2.2395                   2.7825                    3.054                   3.8684                   4.4113                   5.4972                   6.5831                    7.669                    9.2979                    10.927                    13.099                    15.813                    18.528                    21.786        
           1.9763                   2.2489                   2.5215                   3.0667                   3.8846                   4.4298                   5.5202                   6.3381                   7.7011                    9.3368                    10.972                    13.153                    15.607                    18.606                    21.877        
           1.9845                   2.2583                    2.532                   3.0795                   3.9008                   4.4483                   5.5432                   6.3645                   7.7332                    9.1019                    11.018                    13.208                    15.672                    18.683                    21.694        
           1.9928                   2.2676                   2.5425                   3.0923                   3.9169                   4.4667                   5.2914                   6.3909                   7.7653                    9.1397                    11.064                    13.263                    15.737                    18.761                    21.784        
            2.001                    2.277                    2.553                   3.1051                   3.6571                   4.4852                   5.3132                   6.4173                   7.7974                    9.1775                     11.11                    13.318                    15.802                    18.562                    21.874        
           2.0092                   2.2864                   2.5635                   3.1179                   3.6722                   4.5036                   5.3351                   6.4437                   7.8295                    9.2153                    11.155                    13.095                     15.59                    18.639                    21.687        
           2.0175                   2.2958                    2.574                   3.1306                   3.6872                   4.5221                    5.357                   6.4701                   7.8616                     9.253                    10.923                    13.149                    15.654                    18.715                    21.776        
           2.0257                   2.3051                   2.5846                   3.1434                   3.7023                   4.5405                   5.3788                   6.4965                   7.6142                    9.2908                    10.967                    13.203                    15.718                    18.512                    21.865        
           1.7534                   2.3145                   2.5951                   3.1562                   3.7173                    4.559                   5.4007                   6.5229                   7.6452                    9.3286                    11.012                    13.256                    15.781                    18.587                    21.673        

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
mt_ev_condi_z_max_bp: I by M
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
   249    15

    mt_ev_condi_z_max_bp1    mt_ev_condi_z_max_bp2    mt_ev_condi_z_max_bp3    mt_ev_condi_z_max_bp4    mt_ev_condi_z_max_bp5    mt_ev_condi_z_max_bp6    mt_ev_condi_z_max_bp7    mt_ev_condi_z_max_bp8    mt_ev_condi_z_max_bp9    mt_ev_condi_z_max_bp10    mt_ev_condi_z_max_bp11    mt_ev_condi_z_max_bp12    mt_ev_condi_z_max_bp13    mt_ev_condi_z_max_bp14    mt_ev_condi_z_max_bp15
    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________

               -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                       -20                       -20                       -20                       -20                       -20        
               -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                      -20                       -20                       -20                       -20                       -20                       -20        
           -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                   -19.999                   -19.999                   -19.999                   -19.999                   -19.999        
           -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                   -19.999                   -19.999                   -19.999                   -19.999                   -19.999        
           -19.872                  -19.917                   -19.99                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                   -19.999                   -19.999                   -19.999                   -19.999                   -19.999        
           -19.385                  -19.522                  -19.686                  -19.896                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                  -19.999                   -19.999                   -19.999                   -19.999                   -19.999                   -19.999        
           -19.126                  -19.262                  -19.439                  -19.658                   -19.91                  -19.998                  -19.998                  -19.998                  -19.998                  -19.998                   -19.998                   -19.998                   -19.998                   -19.998                   -19.998        
           -18.845                  -18.988                  -19.171                  -19.394                  -19.656                  -19.966                  -19.998                  -19.998                  -19.998                  -19.998                   -19.998                   -19.998                   -19.998                   -19.998                   -19.998        
           -18.571                  -18.716                  -18.898                  -19.116                   -19.38                  -19.698                  -19.998                  -19.998                  -19.998                  -19.998                   -19.998                   -19.998                   -19.998                   -19.998                   -19.998        
            -18.29                  -18.433                  -18.617                  -18.842                  -19.108                  -19.425                  -19.803                  -19.997                  -19.997                  -19.997                   -19.997                   -19.997                   -19.997                   -19.997                   -19.997        
           -18.009                  -18.157                  -18.339                  -18.566                  -18.827                  -19.145                  -19.531                  -19.986                  -19.997                  -19.997                   -19.997                   -19.997                   -19.997                   -19.997                   -19.997        
           -17.723                  -17.873                   -18.06                  -18.285                  -18.548                  -18.872                   -19.26                   -19.71                  -19.997                  -19.997                   -19.997                   -19.997                   -19.997                   -19.997                   -19.997        
           -17.448                  -17.598                  -17.775                  -18.007                  -18.279                  -18.593                  -18.974                  -19.438                  -19.969                  -19.997                   -19.997                   -19.997                   -19.997                   -19.997                   -19.997        
           -17.161                  -17.309                  -17.501                  -17.722                  -17.988                  -18.313                  -18.697                  -19.155                  -19.701                  -19.996                   -19.996                   -19.996                   -19.996                   -19.996                   -19.996        
           -16.879                  -17.022                  -17.213                  -17.436                  -17.706                   -18.04                  -18.422                  -18.883                  -19.424                  -19.996                   -19.996                   -19.996                   -19.996                   -19.996                   -19.996        
           -16.588                  -16.741                  -16.929                  -17.167                  -17.423                  -17.764                  -18.139                  -18.599                  -19.144                  -19.791                   -19.996                   -19.996                   -19.996                   -19.996                   -19.996        
           -16.306                   -16.47                  -16.651                   -16.87                  -17.142                  -17.469                  -17.869                  -18.323                  -18.869                  -19.523                   -19.995                   -19.995                   -19.995                   -19.995                   -19.995        
           -16.037                  -16.172                  -16.365                  -16.597                  -16.867                  -17.195                  -17.581                  -18.045                  -18.586                  -19.242                   -19.995                   -19.995                   -19.995                   -19.995                   -19.995        
           -15.742                  -15.885                   -16.09                  -16.315                   -16.58                  -16.908                  -17.296                  -17.766                  -18.318                  -18.973                    -19.75                   -19.995                   -19.995                   -19.995                   -19.995        
           -15.462                  -15.614                  -15.808                  -16.024                  -16.304                  -16.628                  -17.016                  -17.491                  -18.031                    -18.7                   -19.477                   -19.995                   -19.995                   -19.995                   -19.995        

    mt_ev_condi_z_max_bp1    mt_ev_condi_z_max_bp2    mt_ev_condi_z_max_bp3    mt_ev_condi_z_max_bp4    mt_ev_condi_z_max_bp5    mt_ev_condi_z_max_bp6    mt_ev_condi_z_max_bp7    mt_ev_condi_z_max_bp8    mt_ev_condi_z_max_bp9    mt_ev_condi_z_max_bp10    mt_ev_condi_z_max_bp11    mt_ev_condi_z_max_bp12    mt_ev_condi_z_max_bp13    mt_ev_condi_z_max_bp14    mt_ev_condi_z_max_bp15
    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    _____________________    ______________________    ______________________    ______________________    ______________________    ______________________    ______________________

           42.738                   42.479                   41.961                   41.443                   40.925                   40.148                   39.112                   38.076                   36.781                    35.486                    33.674                    31.343                    29.012                    25.904                    22.796        
           43.013                   42.753                   42.233                   41.712                   41.192                   40.412                   39.371                   38.331                   37.291                     35.73                    33.909                    31.828                    29.227                    26.366                    22.984        
           43.288                   43.027                   42.504                   41.982                   41.459                   40.676                   39.892                   38.586                   37.541                    35.973                    34.144                    32.054                    29.442                    26.568                    23.433        
           43.563                   43.301                   42.776                   42.251                   41.727                    40.94                   40.152                   39.103                   37.791                    36.217                     34.38                    32.281                    29.657                    26.771                    23.622        
           43.839                   43.575                   43.048                   42.521                   41.994                   41.203                   40.413                   39.359                   38.041                     36.46                    34.615                    32.507                    30.135                    27.237                    24.074        
           44.114                   43.849                    43.32                    42.79                   42.261                   41.467                   40.673                   39.615                   38.291                    36.703                    35.115                    32.733                    30.351                     27.44                    24.264        
           44.389                   44.123                   43.592                    43.06                   42.528                   41.731                   40.934                    39.87                   38.541                    37.212                    35.352                    33.225                    30.568                    27.644                    24.454        
           44.664                   44.397                   43.863                   43.329                   42.796                   41.995                   41.194                   40.126                   38.792                    37.457                    35.588                    33.453                    30.784                    27.847                    24.911        
           44.939                   44.671                   44.135                   43.599                   43.063                   42.259                   41.454                   40.382                   39.042                    37.701                    35.825                     33.68                    31.268                    28.319                    25.102        
           45.214                   44.945                   44.407                   43.868                    43.33                   42.522                   41.715                   40.638                   39.561                    37.946                    36.061                    33.908                    31.485                    28.524                    25.293        
            45.49                   45.219                   44.679                   44.408                   43.597                   43.057                   41.975                   40.894                   39.812                     38.19                    36.298                    34.135                    31.702                    28.729                    25.755        
           45.765                   45.493                    44.95                   44.679                   43.864                   43.321                   42.236                    41.15                   40.064                    38.435                    36.806                    34.634                    31.919                    29.205                    25.947        
            46.04                   45.767                   45.495                   44.949                   44.132                   43.586                   42.496                   41.678                   40.315                    38.679                    37.044                    34.863                    32.409                    29.411                    26.139        
           46.315                   46.041                   45.768                    45.22                   44.399                   43.851                   42.756                   41.935                   40.566                    39.198                    37.281                    35.091                    32.628                    29.617                    26.605        
            46.59                   46.315                    46.04                   45.491                   44.666                   44.116                   43.292                   42.192                   40.818                    39.443                    37.519                     35.32                    32.846                    29.822                    26.799        
           46.865                   46.589                   46.313                   45.761                   45.209                   44.381                   43.553                   42.449                   41.069                    39.689                    37.757                    35.549                    33.064                    30.304                    26.992        
           47.141                   46.863                   46.586                   46.032                   45.478                   44.646                   43.815                   42.706                    41.32                    39.935                    37.994                    36.054                     33.56                    30.511                    27.463        
           47.416                   47.137                   46.859                   46.303                   45.746                   44.911                   44.076                   42.963                   41.572                     40.18                     38.51                    36.284                    33.779                    30.718                    27.657        
           47.691                   47.411                   47.132                   46.573                   46.014                   45.176                   44.338                    43.22                   42.102                    40.426                    38.749                    36.514                    33.999                    31.205                    27.852        
           48.247                   47.686                   47.405                   46.844                   46.283                   45.441                   44.599                   43.477                   42.355                    40.671                    38.988                    36.744                    34.219                    31.413                    28.327        

</pre><h2 id="9">Graph</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_evf)
</pre><h2 id="11">Graph 1, V and EV</h2><pre class="codeinput">    <span class="keyword">if</span> (~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
        hold <span class="string">on</span>;
    <span class="keyword">end</span>


    <span class="keyword">for</span> subplot_j=1:1:2

        <span class="keyword">if</span> (~bl_graph_onebyones)
            hAxis(subplot_j) = subplot(1,2,subplot_j);
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (subplot_j==1)
            chart = plot(mt_val);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (subplot_j==2)
            chart = plot(mt_ev_condi_z);
        <span class="keyword">end</span>

        clr = jet(numel(chart));
        <span class="keyword">for</span> m = 1:numel(chart)
            set(chart(m),<span class="string">'Color'</span>,clr(m,:))
        <span class="keyword">end</span>

        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'southeast'</span>);

        <span class="keyword">if</span> (subplot_j==1)
            title(<span class="string">'V(coh,zp); w(k+b),k,z'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (subplot_j==2)
            title(<span class="string">'E_z(V(coh,zp|z))'</span>);
        <span class="keyword">end</span>

        ylabel(<span class="string">'Next Period Value'</span>);
        xlabel({<span class="string">'Index of Cash-on-Hand Discrete Point'</span><span class="keyword">...</span>
            <span class="string">'Each Segment is a w=k+b; within segment increasing k'</span><span class="keyword">...</span>
            <span class="string">'EV and V identical if shock is fully persistent'</span>});
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
    <span class="keyword">end</span>

    <span class="comment">% Share y axis</span>
    <span class="keyword">if</span> (~bl_graph_onebyones)
        linkaxes(hAxis,<span class="string">'y'</span>);
    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_vev'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_01.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_02.png" alt=""> <h2 id="12">Graph 2, max(EV)</h2><pre class="codeinput">    <span class="keyword">if</span>(~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j=1:1:1

        <span class="keyword">if</span>(sub_j==1)
            mt_outcome = mt_ev_condi_z_max;
            st_y_label = <span class="string">'max_{k''}(E(V(coh(k'',b''=w-k''),z''|z,w))'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span>(~bl_graph_onebyones)
            subplot(1,1,sub_j)
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_x = ar_w_level;
            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, <span class="keyword">...</span>
                <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
        title([<span class="string">'2nd Stage Exp Value at Optimal K given W=K''+B'''</span>])
        ylabel(st_y_label)
        xlabel({<span class="string">'Aggregate Savings'</span>})

        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        legendCell{length(legendCell) + 1} = <span class="string">'max-agg-save'</span>;
        legend(legendCell([ar_it_z_graph length(legendCell)]), <span class="string">'Location'</span>,<span class="string">'southeast'</span>);

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_maxev'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><pre class="codeoutput">Warning: Ignoring extra legend entries. 
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_03.png" alt=""> <h2 id="13">Graph 3, at max(EV) optimal choice category, color regions, borrow save</h2><pre class="codeinput">    <span class="comment">% Borrow Vs Save</span>
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    mt_it_borr_idx = (mt_ev_condi_z_max_bp &lt; 0);
    mt_it_riskyhalf_idx = ((mt_ev_condi_z_max_kp./mt_ev_condi_z_max_bp) &gt; 0.5);
    mt_it_kzero_idx = (mt_ev_condi_z_max_kp == 0);
    mt_it_isnan_idx = (isnan(mt_ev_condi_z_max_kp));

    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    <span class="comment">% States: ar_w, ar_z</span>
    <span class="comment">% Choices: mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp</span>
    hold <span class="string">on</span>;
    it_sca_size = 10;
    chart_br = scatter(ar_w_mz(mt_it_borr_idx),<span class="keyword">...</span>
        ar_z_mw(mt_it_borr_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'blue'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_br], {'Borrow'}, 'Location','northeast');</span>
    chart_khalf = scatter(ar_w_mz(~mt_it_borr_idx &amp; mt_it_riskyhalf_idx),<span class="keyword">...</span>
        ar_z_mw(~mt_it_borr_idx &amp; mt_it_riskyhalf_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'black'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_khalf], {'Save &gt;0.5 K'}, 'Location','northeast');</span>
    chart_sv = scatter(ar_w_mz(~mt_it_borr_idx &amp; ~mt_it_riskyhalf_idx),<span class="keyword">...</span>
        ar_z_mw(~mt_it_borr_idx &amp; ~mt_it_riskyhalf_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'red'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_sv], {'Save &lt;0.5 K'}, 'Location','northeast');</span>
    chart_invalid = scatter(ar_w_mz(mt_it_kzero_idx | mt_it_isnan_idx),<span class="keyword">...</span>
        ar_z_mw(mt_it_kzero_idx | mt_it_isnan_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'yellow'</span>, <span class="string">'filled'</span>);
    legend([chart_br, chart_khalf, chart_sv, chart_invalid], <span class="keyword">...</span>
        {<span class="string">'Borrow'</span>,<span class="string">'Save &gt;0.5 K'</span>,<span class="string">'Save &lt;0.5 K'</span>, <span class="string">'k=0 or k=nan'</span>}, <span class="string">'Location'</span>,<span class="string">'northeast'</span>);
    title(<span class="string">'Borrow and Save Regions'</span>)
    ylabel(<span class="string">'Shocks'</span>)
    xlabel({<span class="string">'Total Savings w=k+b'</span>})
    grid <span class="string">on</span>;

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_maxbrsv'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_04.png" alt=""> <h2 id="14">Graph 4, Optimal K' and B' Levels</h2><pre class="codeinput">    [~, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    <span class="keyword">for</span> sub_j=1:1:4

        <span class="keyword">if</span> (bl_graph_onebyones)
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==1)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
                subplot(1,2,sub_j);
            <span class="keyword">end</span>
            mt_y = mt_ev_condi_z_max_bp;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==2)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                subplot(1,2,sub_j);
            <span class="keyword">end</span>

            mt_y = mt_ev_condi_z_max_kp;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==3)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
                subplot(1,2,sub_j-2);
            <span class="keyword">end</span>
            mt_y = zeros(size(mt_ev_condi_z_max_bp));
            mt_it_borr_idx = (mt_ev_condi_z_max_bp &lt; 0);
            mt_y(mt_it_borr_idx) = -mt_ev_condi_z_max_bp(mt_it_borr_idx)/fl_b_bd;
            mt_y(~mt_it_borr_idx) = mt_ev_condi_z_max_bp(~mt_it_borr_idx)./ar_w_mz(~mt_it_borr_idx);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==4)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                subplot(1,2,sub_j-2);
            <span class="keyword">end</span>
            mt_y = mt_ev_condi_z_max_kp./(ar_w_level'-fl_b_bd);
        <span class="keyword">end</span>

        hold <span class="string">on</span>;
        chart = plot(ar_w_level, mt_y);
        clr = jet(numel(chart));

        <span class="keyword">if</span> (length(ar_w_level) &lt;= 100)
            scatter(ar_w_mz(:), mt_y(:), 3, <span class="string">'filled'</span>, <span class="string">'MarkerEdgeColor'</span>, <span class="string">'b'</span>, <span class="string">'MarkerFaceColor'</span>, <span class="string">'b'</span>);
        <span class="keyword">end</span>

        <span class="keyword">for</span> m = 1:numel(chart)
            set(chart(m),<span class="string">'Color'</span>,clr(m,:))
        <span class="keyword">end</span>
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;
        grid <span class="string">on</span>;
        <span class="keyword">if</span> (sub_j&lt;=2)
            hline = refline([1 0]);
            hline.Color = <span class="string">'k'</span>;
            hline.LineStyle = <span class="string">':'</span>;
            hline.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==1)
            title(<span class="string">'B Choices of W'</span>);
            ylabel(<span class="string">'B Choices'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==2)
            title(<span class="string">'K Choices of W'</span>);
            ylabel(<span class="string">'K Choices'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==3)
            title(<span class="string">'B Fraction of Borrow Max and Save'</span>);
            ylabel(<span class="string">'B/bar(B) if br or B/W if sv'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            <span class="comment">%             set(gca, 'YScale', 'log');</span>
            ylim([-1.1 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==4)
            title(<span class="string">'K Fraction Choices of Total K Possible'</span>);
            ylabel(<span class="string">'K/(W-bar(b)) '</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            <span class="comment">%             set(gca, 'YScale', 'log');</span>
            ylim([0 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northeast'</span>);
        <span class="keyword">end</span>

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_wkbopti'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_05.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_06.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_07.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_08.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><h2 id="16">Display Various Containers</h2><pre class="codeinput"><span class="keyword">if</span> (bl_display_evf)
</pre><h2 id="18">Display 1 support_map</h2><pre class="codeinput">    fft_container_map_display(support_map, it_display_summmat_rowmax, it_display_summmat_colmax);
</pre><pre class="codeoutput">----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: SUPPORT_MAP
----------------------------------------
  Map with properties:

        Count: 42
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = bl_display ; val = false
pos = 2 ; key = bl_display_defparam ; val = true
pos = 3 ; key = bl_display_dist ; val = false
pos = 4 ; key = bl_display_evf ; val = true
pos = 5 ; key = bl_display_final ; val = true
pos = 6 ; key = bl_display_final_dist ; val = false
pos = 7 ; key = bl_display_final_dist_detail ; val = false
pos = 8 ; key = bl_display_funcgrids ; val = false
pos = 9 ; key = bl_graph ; val = true
pos = 10 ; key = bl_graph_coh_t_coh ; val = true
pos = 11 ; key = bl_graph_evf ; val = true
pos = 12 ; key = bl_graph_funcgrids ; val = false
pos = 13 ; key = bl_graph_funcgrids_detail ; val = false
pos = 14 ; key = bl_graph_onebyones ; val = true
pos = 15 ; key = bl_graph_pol_lvl ; val = true
pos = 16 ; key = bl_graph_pol_pct ; val = true
pos = 17 ; key = bl_graph_val ; val = true
pos = 18 ; key = bl_img_save ; val = false
pos = 19 ; key = bl_mat ; val = false
pos = 20 ; key = bl_post ; val = true
pos = 21 ; key = bl_profile ; val = false
pos = 22 ; key = bl_profile_dist ; val = false
pos = 23 ; key = bl_time ; val = false
pos = 24 ; key = it_display_every ; val = 5
pos = 25 ; key = it_display_final_colmax ; val = 12
pos = 26 ; key = it_display_final_rowmax ; val = 100
pos = 27 ; key = it_display_summmat_colmax ; val = 5
pos = 28 ; key = it_display_summmat_rowmax ; val = 5
pos = 29 ; key = st_img_name_main ; val = _default
pos = 30 ; key = st_img_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/img/
pos = 31 ; key = st_img_prefix ; val = 
pos = 32 ; key = st_img_suffix ; val = _p4.png
pos = 33 ; key = st_mat_name_main ; val = _default
pos = 34 ; key = st_mat_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/mat/
pos = 35 ; key = st_mat_prefix ; val = 
pos = 36 ; key = st_mat_suffix ; val = _p4
pos = 37 ; key = st_matimg_path_root ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz/
pos = 38 ; key = st_profile_name_main ; val = _default
pos = 39 ; key = st_profile_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkbz//solve/profile/
pos = 40 ; key = st_profile_prefix ; val = 
pos = 41 ; key = st_profile_suffix ; val = _p4
pos = 42 ; key = st_title_prefix ; val = 
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                                    i     idx    value
                                    __    ___    _____

    bl_display                       1     1        0 
    bl_display_defparam              2     2        1 
    bl_display_dist                  3     3        0 
    bl_display_evf                   4     4        1 
    bl_display_final                 5     5        1 
    bl_display_final_dist            6     6        0 
    bl_display_final_dist_detail     7     7        0 
    bl_display_funcgrids             8     8        0 
    bl_graph                         9     9        1 
    bl_graph_coh_t_coh              10    10        1 
    bl_graph_evf                    11    11        1 
    bl_graph_funcgrids              12    12        0 
    bl_graph_funcgrids_detail       13    13        0 
    bl_graph_onebyones              14    14        1 
    bl_graph_pol_lvl                15    15        1 
    bl_graph_pol_pct                16    16        1 
    bl_graph_val                    17    17        1 
    bl_img_save                     18    18        0 
    bl_mat                          19    19        0 
    bl_post                         20    20        1 
    bl_profile                      21    21        0 
    bl_profile_dist                 22    22        0 
    bl_time                         23    23        0 
    it_display_every                24    24        5 
    it_display_final_colmax         25    25       12 
    it_display_final_rowmax         26    26      100 
    it_display_summmat_colmax       27    27        5 
    it_display_summmat_rowmax       28    28        5 

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Strings in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                            i     idx
                            __    ___

    st_img_name_main         1    29 
    st_img_path              2    30 
    st_img_prefix            3    31 
    st_img_suffix            4    32 
    st_mat_name_main         5    33 
    st_mat_path              6    34 
    st_mat_prefix            7    35 
    st_mat_suffix            8    36 
    st_matimg_path_root      9    37 
    st_profile_name_main    10    38 
    st_profile_path         11    39 
    st_profile_prefix       12    40 
    st_profile_suffix       13    41 
    st_title_prefix         14    42 

</pre><h2 id="19">Display 2 armt_map</h2><pre class="codeinput">    fft_container_map_display(armt_map, it_display_summmat_rowmax, it_display_summmat_colmax);
</pre><pre class="codeoutput">----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: ARMT_MAP
----------------------------------------
  Map with properties:

        Count: 18
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = ar_a_meshk ;rown= 62250 ,coln= 1
ar_a_meshk :mu= -2.5301 ,sd= 15.4675 ,min= -20 ,max= 49.93
                       zi_1_c1
                       _______

    zi_1_R1                -20
    zi_2_R2                -20
    zi_31125_r31125     -2.501
    zi_62249_r62249    -19.649
    zi_62250_r62250     -19.93

pos = 2 ; key = ar_ak_perc ;rown= 1 ,coln= 250
ar_ak_perc :mu= 0.5 ,sd= 0.28983 ,min= 0.001 ,max= 0.999
               zi_1_C1    zi_2_C2     zi_125_c125    zi_249_c249    zi_250_c250
               _______    ________    ___________    ___________    ___________

    zi_1_r1     0.001     0.005008       0.498         0.99499         0.999   

pos = 3 ; key = ar_interp_c_grid ;rown= 1 ,coln= 772572
ar_interp_c_grid :mu= 38.6486 ,sd= 22.3023 ,min= 0.02 ,max= 77.2773
               zi_1_C1    zi_2_C2    zi_386286_c386286    zi_772571_c772571    zi_772572_c772572
               _______    _______    _________________    _________________    _________________

    zi_1_r1     0.02      0.0201          38.649               77.277               77.277      

pos = 4 ; key = ar_interp_coh_grid ;rown= 1 ,coln= 772
ar_interp_coh_grid :mu= 18.6145 ,sd= 22.347 ,min= -20 ,max= 57.2773
               zi_1_C1    zi_2_C2    zi_386_c386    zi_771_c771    zi_772_c772
               _______    _______    ___________    ___________    ___________

    zi_1_r1      -20       -19.9       18.538         57.177         57.277   

pos = 5 ; key = ar_k_mesha ;rown= 62250 ,coln= 1
ar_k_mesha :mu= 17.4699 ,sd= 15.4675 ,min= 0 ,max= 69.93
                       zi_1_c1
                       _______

    zi_1_R1                 0 
    zi_2_R2                 0 
    zi_31125_r31125    17.359 
    zi_62249_r62249    69.649 
    zi_62250_r62250     69.93 

pos = 6 ; key = ar_stationary ;rown= 1 ,coln= 15
ar_stationary :mu= 0.066667 ,sd= 0.060897 ,min= 0.0027089 ,max= 0.16757
                zi_1_C1      zi_2_C2     zi_8_C8    zi_14_c14    zi_15_c15
               _________    _________    _______    _________    _________

    zi_1_r1    0.0027089    0.0069499    0.16757    0.0069499    0.0027089

pos = 7 ; key = ar_w_level ;rown= 1 ,coln= 249
ar_w_level :mu= 14.9398 ,sd= 20.3112 ,min= -20 ,max= 50
               zi_1_C1    zi_2_C2    zi_125_c125    zi_248_c248    zi_249_c249
               _______    _______    ___________    ___________    ___________

    zi_1_r1      -20      -19.717      14.858         49.717           50     

pos = 8 ; key = ar_w_perc ;rown= 1 ,coln= 50
ar_w_perc :mu= 0.5 ,sd= 0.2969 ,min= 0.001 ,max= 0.999
               zi_1_C1    zi_2_C2     zi_25_c25    zi_49_c49    zi_50_c50
               _______    ________    _________    _________    _________

    zi_1_r1     0.001     0.021367     0.48982      0.97863       0.999  

pos = 9 ; key = ar_z ;rown= 1 ,coln= 15
ar_z :mu= 1.1347 ,sd= 0.69878 ,min= 0.34741 ,max= 2.567
               zi_1_C1    zi_2_C2    zi_8_C8    zi_14_c14    zi_15_c15
               _______    _______    _______    _________    _________

    zi_1_r1    0.34741    0.40076    0.94436     2.2253        2.567  

pos = 10 ; key = it_ameshk_n ; val = 62250
pos = 11 ; key = mt_coh_wkb ;rown= 62250 ,coln= 15
mt_coh_wkb :mu= 16.1944 ,sd= 20.8946 ,min= -21.4564 ,max= 57.2773
                       zi_1_C1    zi_2_C2    zi_8_C8    zi_14_c14    zi_15_c15
                       _______    _______    _______    _________    _________

    zi_1_R1            -21.456    -21.456    -21.456     -21.456      -21.456 
    zi_2_R2            -21.456    -21.456    -21.456     -21.456      -21.456 
    zi_31125_r31125     14.646     14.795     16.314      19.893       20.848 
    zi_62249_r62249     44.606     44.851     47.356      53.258       54.832 
    zi_62250_r62250     44.559     44.805     47.313      53.223         54.8 

pos = 12 ; key = mt_interp_coh_grid_mesh_w_perc ;rown= 50 ,coln= 772
mt_interp_coh_grid_mesh_w_perc :mu= 18.6145 ,sd= 22.3329 ,min= -20 ,max= 57.2773
                 zi_1_C1    zi_2_C2    zi_386_c386    zi_771_c771    zi_772_c772
                 _______    _______    ___________    ___________    ___________

    zi_1_R1        -20       -19.9       18.538         57.177         57.277   
    zi_2_R2        -20       -19.9       18.538         57.177         57.277   
    zi_25_r25      -20       -19.9       18.538         57.177         57.277   
    zi_49_r49      -20       -19.9       18.538         57.177         57.277   
    zi_50_r50      -20       -19.9       18.538         57.177         57.277   

pos = 13 ; key = mt_interp_coh_grid_mesh_z ;rown= 772 ,coln= 15
mt_interp_coh_grid_mesh_z :mu= 18.6145 ,sd= 22.3335 ,min= -20 ,max= 57.2773
                   zi_1_C1    zi_2_C2    zi_8_C8    zi_14_c14    zi_15_c15
                   _______    _______    _______    _________    _________

    zi_1_R1           -20        -20        -20         -20          -20  
    zi_2_R2         -19.9      -19.9      -19.9       -19.9        -19.9  
    zi_386_r386    18.538     18.538     18.538      18.538       18.538  
    zi_771_r771    57.177     57.177     57.177      57.177       57.177  
    zi_772_r772    57.277     57.277     57.277      57.277       57.277  

pos = 14 ; key = mt_k ;rown= 250 ,coln= 249
mt_k :mu= 17.4699 ,sd= 15.4675 ,min= 0 ,max= 69.93
                   zi_1_C1     zi_2_C2     zi_125_c125    zi_248_c248    zi_249_c249
                   _______    _________    ___________    ___________    ___________

    zi_1_R1           0       0.0002834     0.034858       0.069717           0.07  
    zi_2_R2           0       0.0014193      0.17457        0.34914        0.35056  
    zi_125_r125       0         0.14113       17.359         34.719          34.86  
    zi_249_r249       0         0.28198       34.684         69.367         69.649  
    zi_250_r250       0         0.28312       34.823         69.647          69.93  

pos = 15 ; key = mt_w_by_interp_coh_interp_grid ;rown= 50 ,coln= 772
mt_w_by_interp_coh_interp_grid :mu= -0.69276 ,sd= 17.2218 ,min= -20 ,max= 57.2
                 zi_1_C1    zi_2_C2    zi_386_c386    zi_771_c771    zi_772_c772
                 _______    _______    ___________    ___________    ___________

    zi_1_R1        -20          -20      -19.961        -19.923        -19.923  
    zi_2_R2        -20      -19.998      -19.177        -18.351        -18.349  
    zi_25_r25      -20      -19.951      -1.1233         17.803         17.852  
    zi_49_r49      -20      -19.902       17.715         55.528         55.626  
    zi_50_r50      -20        -19.9         18.5           57.1           57.2  

pos = 16 ; key = mt_z_mesh_coh_interp_grid ;rown= 772 ,coln= 15
mt_z_mesh_coh_interp_grid :mu= 1.1347 ,sd= 0.67511 ,min= 0.34741 ,max= 2.567
                   zi_1_C1    zi_2_C2    zi_8_C8    zi_14_c14    zi_15_c15
                   _______    _______    _______    _________    _________

    zi_1_R1        0.34741    0.40076    0.94436     2.2253        2.567  
    zi_2_R2        0.34741    0.40076    0.94436     2.2253        2.567  
    zi_386_r386    0.34741    0.40076    0.94436     2.2253        2.567  
    zi_771_r771    0.34741    0.40076    0.94436     2.2253        2.567  
    zi_772_r772    0.34741    0.40076    0.94436     2.2253        2.567  

pos = 17 ; key = mt_z_mesh_coh_wkb ;rown= 62250 ,coln= 15
mt_z_mesh_coh_wkb :mu= 1.1347 ,sd= 0.67508 ,min= 0.34741 ,max= 2.567
                       zi_1_C1    zi_2_C2    zi_8_C8    zi_14_c14    zi_15_c15
                       _______    _______    _______    _________    _________

    zi_1_R1            0.34741    0.40076    0.94436     2.2253        2.567  
    zi_2_R2            0.34741    0.40076    0.94436     2.2253        2.567  
    zi_31125_r31125    0.34741    0.40076    0.94436     2.2253        2.567  
    zi_62249_r62249    0.34741    0.40076    0.94436     2.2253        2.567  
    zi_62250_r62250    0.34741    0.40076    0.94436     2.2253        2.567  

pos = 18 ; key = mt_z_trans ;rown= 15 ,coln= 15
mt_z_trans :mu= 0.066667 ,sd= 0.095337 ,min= 0 ,max= 0.27902
                  zi_1_C1       zi_2_C2       zi_8_C8      zi_14_c14     zi_15_c15 
                 __________    __________    __________    __________    __________

    zi_1_R1         0.26016       0.26831    0.00012823    1.1102e-15             0
    zi_2_R2         0.11232       0.19622    0.00098855    9.3592e-14    3.3307e-16
    zi_8_R8      1.7181e-06    4.1008e-05       0.27902    4.1008e-05    1.7181e-06
    zi_14_r14     3.474e-16    9.3597e-14    0.00098855       0.19622       0.11232
    zi_15_r15    2.7412e-18    1.1057e-15    0.00012823       0.26831       0.26016

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Matrix in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                                      i     idx    rowN        colN         mean        std          min         max  
                                      __    ___    _____    __________    ________    ________    _________    _______

    ar_a_meshk                         1     1     62250             1     -2.5301      15.467          -20      49.93
    ar_ak_perc                         2     2         1           250         0.5     0.28983        0.001      0.999
    ar_interp_c_grid                   3     3         1    7.7257e+05      38.649      22.302         0.02     77.277
    ar_interp_coh_grid                 4     4         1           772      18.614      22.347          -20     57.277
    ar_k_mesha                         5     5     62250             1       17.47      15.467            0      69.93
    ar_stationary                      6     6         1            15    0.066667    0.060897    0.0027089    0.16757
    ar_w_level                         7     7         1           249       14.94      20.311          -20         50
    ar_w_perc                          8     8         1            50         0.5      0.2969        0.001      0.999
    ar_z                               9     9         1            15      1.1347     0.69878      0.34741      2.567
    mt_coh_wkb                        10    11     62250            15      16.194      20.895      -21.456     57.277
    mt_interp_coh_grid_mesh_w_perc    11    12        50           772      18.614      22.333          -20     57.277
    mt_interp_coh_grid_mesh_z         12    13       772            15      18.614      22.334          -20     57.277
    mt_k                              13    14       250           249       17.47      15.467            0      69.93
    mt_w_by_interp_coh_interp_grid    14    15        50           772    -0.69276      17.222          -20       57.2
    mt_z_mesh_coh_interp_grid         15    16       772            15      1.1347     0.67511      0.34741      2.567
    mt_z_mesh_coh_wkb                 16    17     62250            15      1.1347     0.67508      0.34741      2.567
    mt_z_trans                        17    18        15            15    0.066667    0.095337            0    0.27902

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                   i    idx    value
                   _    ___    _____

    it_ameshk_n    1    10     62250

</pre><h2 id="20">Display 3 param_map</h2><pre class="codeinput">    fft_container_map_display(param_map, it_display_summmat_rowmax, it_display_summmat_colmax);
</pre><pre class="codeoutput">----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: PARAM_MAP
----------------------------------------
  Map with properties:

        Count: 34
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = bl_default ; val = true
pos = 2 ; key = fl_Amean ; val = 1
pos = 3 ; key = fl_alpha ; val = 0.36
pos = 4 ; key = fl_b_bd ; val = -20
pos = 5 ; key = fl_beta ; val = 0.94
pos = 6 ; key = fl_c_min ; val = 0.02
pos = 7 ; key = fl_coh_interp_grid_gap ; val = 0.1
pos = 8 ; key = fl_crra ; val = 1.5
pos = 9 ; key = fl_default_wprime ; val = 0
pos = 10 ; key = fl_delta ; val = 0.08
pos = 11 ; key = fl_k_max ; val = 70
pos = 12 ; key = fl_k_min ; val = 0
pos = 13 ; key = fl_nan_replace ; val = -9999
pos = 14 ; key = fl_r_borr ; val = 0.095
pos = 15 ; key = fl_r_save ; val = 0.025
pos = 16 ; key = fl_tol_dist ; val = 1e-05
pos = 17 ; key = fl_tol_pol ; val = 1e-05
pos = 18 ; key = fl_tol_val ; val = 1e-05
pos = 19 ; key = fl_w ; val = 0.44365
pos = 20 ; key = fl_w_interp_grid_gap ; val = 0.28
pos = 21 ; key = fl_w_max ; val = 50
pos = 22 ; key = fl_w_min ; val = -20
pos = 23 ; key = fl_z_mu ; val = 0
pos = 24 ; key = fl_z_rho ; val = 0.8
pos = 25 ; key = fl_z_sig ; val = 0.2
pos = 26 ; key = it_ak_perc_n ; val = 250
pos = 27 ; key = it_c_interp_grid_gap ; val = 0.0001
pos = 28 ; key = it_maxiter_dist ; val = 1000
pos = 29 ; key = it_maxiter_val ; val = 250
pos = 30 ; key = it_tol_pol_nochange ; val = 25
pos = 31 ; key = it_w_perc_n ; val = 50
pos = 32 ; key = it_z_n ; val = 15
pos = 33 ; key = st_analytical_stationary_type ; val = eigenvector
pos = 34 ; key = st_model ; val = ipwkbz
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                              i     idx     value 
                              __    ___    _______

    bl_default                 1     1           1
    fl_Amean                   2     2           1
    fl_alpha                   3     3        0.36
    fl_b_bd                    4     4         -20
    fl_beta                    5     5        0.94
    fl_c_min                   6     6        0.02
    fl_coh_interp_grid_gap     7     7         0.1
    fl_crra                    8     8         1.5
    fl_default_wprime          9     9           0
    fl_delta                  10    10        0.08
    fl_k_max                  11    11          70
    fl_k_min                  12    12           0
    fl_nan_replace            13    13       -9999
    fl_r_borr                 14    14       0.095
    fl_r_save                 15    15       0.025
    fl_tol_dist               16    16       1e-05
    fl_tol_pol                17    17       1e-05
    fl_tol_val                18    18       1e-05
    fl_w                      19    19     0.44365
    fl_w_interp_grid_gap      20    20        0.28
    fl_w_max                  21    21          50
    fl_w_min                  22    22         -20
    fl_z_mu                   23    23           0
    fl_z_rho                  24    24         0.8
    fl_z_sig                  25    25         0.2
    it_ak_perc_n              26    26         250
    it_c_interp_grid_gap      27    27      0.0001
    it_maxiter_dist           28    28        1000
    it_maxiter_val            29    29         250
    it_tol_pol_nochange       30    30          25
    it_w_perc_n               31    31          50
    it_z_n                    32    32          15

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Strings in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                                     i    idx
                                     _    ___

    st_analytical_stationary_type    1    33 
    st_model                         2    34 

</pre><h2 id="21">Display 4 func_map</h2><pre class="codeinput">    fft_container_map_display(func_map, it_display_summmat_rowmax, it_display_summmat_colmax);
</pre><pre class="codeoutput">----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: FUNC_MAP
----------------------------------------
  Map with properties:

        Count: 7
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = f_coh ; val = @(z,b,k)(f_prod(z,k)+k*(1-fl_delta)+fl_w+b.*(1+fl_r_save).*(b&gt;0)+b.*(1+fl_r_borr).*(b&lt;=0))
pos = 2 ; key = f_cons ; val = @(coh,bprime,kprime)(coh-kprime-bprime)
pos = 3 ; key = f_inc ; val = @(z,b,k)(f_prod(z,k)-(fl_delta)*k+fl_w+b.*(fl_r_save).*(b&gt;0)+b.*(fl_r_borr).*(b&lt;=0))
pos = 4 ; key = f_prod ; val = @(z,k)((fl_Amean.*(z)).*(k.^(fl_alpha)))
pos = 5 ; key = f_util_crra ; val = @(c)(((c).^(1-fl_crra)-1)./(1-fl_crra))
pos = 6 ; key = f_util_log ; val = @(c)log(c)
pos = 7 ; key = f_util_standin ; val = @(z,b,k)f_util_log((f_coh(z,b,k)-fl_b_bd).*((f_coh(z,b,k)-fl_b_bd)&gt;fl_c_min)+fl_c_min.*((f_coh(z,b,k)-fl_b_bd)&lt;=fl_c_min))
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                      i    idx    xFunction
                      _    ___    _________

    f_coh             1     1         1    
    f_cons            2     2         2    
    f_inc             3     3         3    
    f_prod            4     4         4    
    f_util_crra       5     5         5    
    f_util_log        6     6         6    
    f_util_standin    7     7         7    

</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 2nd Stage Optimization for Risky + Safe Asset (Save + Borr) Interpolated-Percentage
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function [mt_ev_condi_z_max, mt_ev_condi_z_max_idx, mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp] = ff_ipwkbz_evf(varargin)
%% FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings
% This function follows the structure set up here:
% <https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_wkz_evf.html
% ff_wkz_evf> but now we solve the second stage with percentage choice grid
%
% We solve along a vector of w_n vector, that is an interpolation vector,
% not a vector of actual w choices picked in the first stage. k' choices
% are in terms of percentages. Compared to ff_wkz_evf where we only had an
% upper triangle of choices, now we have a full matrix of percentage
% choices.
%
% @param mt_val matrix state_n I^2 by shock_n. This is the value
% matrix each row is a feasible reachable state given the choice
% vectors/matrix and each column is a shock state.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @return mt_ev_condi_z_max matrix choice_w_n by shock_n
% max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)) conditional on z and w, at the
% optimal k' choice (w=k'+b') what is the expected utility? This is the
% value result from the 2nd stage problem. Note the result integrates over
% z'.
%
% @return mt_ev_condi_z_max_idx matrix choice_w_n by shock_n this is the
% argmax from max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)). Given the vector of k'
% choices, which index maximized conditional on z and w integrating over
% z'/
%
% @return mt_ev_condi_z_max_kp matrix choice_w_level_n by shock_n the k'
% choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))
%
% @return mt_ev_condi_z_max_bp matrix choice_w_n by shock_n the b'=w-k'
% choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m ffs_ipwkbz_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m ffs_ipwkbz_get_funcgrid>
%

%% Default

params_len = length(varargin);
bl_input_override = 0;
if (params_len == 5)
    bl_input_override = varargin{5};
end
if (bl_input_override)
    % override when called from outside
    [mt_val, param_map, support_map, armt_map, ~] = varargin{:};
else
    clear all;
    close all;

    % Not default parameters, but parameters that generate defaults
    [param_map, support_map] = ffs_ipwkbz_set_default_param();

    support_map('bl_graph_evf') = true;
    bl_display_evf = true;    
    support_map('bl_display_evf') = bl_display_evf;

    param_map('it_ak_perc_n') = 250;
    param_map('fl_w_interp_grid_gap') = (param_map('fl_w_max')-param_map('fl_b_bd'))/param_map('it_ak_perc_n');

    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map); % 1 for override

    % Generating Defaults
    params_group = values(armt_map, {'ar_a_meshk', 'ar_k_mesha', 'ar_z'});
    [ar_a_meshk, ar_k_mesha, ar_z] = params_group{:};
    params_group = values(func_map, {'f_util_standin', 'f_coh'});
    [f_util_standin, f_coh] = params_group{:};
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
    mt_coh = f_coh(ar_z, ar_a_meshk, ar_k_mesha);

end

%% Parse Parameters
params_group = values(armt_map, {'mt_z_trans', 'ar_z',...
    'ar_w_level', 'ar_k_mesha', 'ar_a_meshk', 'mt_k'});
[mt_z_trans, ar_z, ar_w_level, ...
    ar_k_mesha, ar_a_meshk, mt_k] = params_group{:};
params_group = values(param_map, {'it_z_n', 'fl_nan_replace', 'fl_b_bd'});
[it_z_n, fl_nan_replace, fl_b_bd] = params_group{:};
params_group = values(support_map, {'bl_graph_onebyones','bl_display_evf', 'bl_graph_evf'});
[bl_graph_onebyones, bl_display_evf, bl_graph_evf] = params_group{:};
params_group = values(support_map, {'bl_img_save', 'st_img_path', 'st_img_prefix', 'st_img_name_main', 'st_img_suffix'});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};
params_group = values(support_map, {'it_display_summmat_rowmax', 'it_display_summmat_colmax'});
[it_display_summmat_rowmax, it_display_summmat_colmax] = params_group{:};

% append function name
st_func_name = 'ff_ipwkbz_evf';
st_img_name_main = [st_func_name st_img_name_main];

%% Integrate *E(V(coh(k',b'), z')|z, w)*
% Each column for a different state z, each value *E(V(coh,z')|z)* integrated already
% Here, each column is a current z, more to right higher EV
% dim(mt_ev_condi_z): *Q by M*
% Note that: mt_ev_condi_z = mt_val*mt_z_trans' is a mistake, that would be
% what we do in the
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_set_functions.html
% ffs_ipwkbz_set_functions> code where we loop over current z, and for each
% current z, grab out a particular row from the mt_z_trans that corresponds
% to a current shock's transition into all future states.
%
% here, each column of mt_val corresponds to a state z, think of that as
% future state z. The input mt_val is *V(coh, z)*, we need to integrate to
% get *E(V(coh,z')|z)*.
%

mt_ev_condi_z = mt_val*mt_z_trans';
if(bl_display_evf)
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z: Q by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z));
    disp(head(array2table(mt_ev_condi_z), 20));
    disp(tail(array2table(mt_ev_condi_z), 20));
end

%% Reshape *E(V(coh,z'|z,w))* to allow for maxing
% dim(mt_ev_condi_z): *IxJ by M*

[it_mt_bp_rown, it_mt_bp_coln] = size(mt_k);
mt_ev_condi_z_full = reshape(mt_ev_condi_z, [it_mt_bp_rown, it_mt_bp_coln*it_z_n]);

%% Maximize *max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))* optimal value and index
% Maximization, find optimal k'/b' combination given z and w=k'+b'

[ar_ev_condi_z_max, ar_ev_condi_z_max_idx] = max(mt_ev_condi_z_full);
mt_ev_condi_z_max = reshape(ar_ev_condi_z_max, [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_idx = reshape(ar_ev_condi_z_max_idx, [it_mt_bp_coln, it_z_n]);

if(bl_display_evf)

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_full: J by IxM');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_full));
%     disp(head(array2table(mt_ev_condi_z_full), 20));
%     disp(tail(array2table(mt_ev_condi_z_full), 20));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_max: I by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_max));
    disp(head(array2table(mt_ev_condi_z_max), 20));
    disp(tail(array2table(mt_ev_condi_z_max), 20));


    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_max_idx: I by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_max_idx));
    disp(head(array2table(mt_ev_condi_z_max_idx), 20));
    disp(tail(array2table(mt_ev_condi_z_max_idx), 20));

end

%% Reindex K' and B' Choices for each State at the Optimal *w'=k'+b'* choice
% The K' and B' Optimal Choices Associated with EV opti
% dim(mt_ev_condi_z_max_kp): *I by M*
ar_add_grid = linspace(0, it_mt_bp_rown*(it_mt_bp_coln-1), it_mt_bp_coln);
mt_ev_condi_z_max_idx = mt_ev_condi_z_max_idx + ar_add_grid';

if(bl_display_evf)
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_max_idx: I by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_max_idx));
    disp(head(array2table(mt_ev_condi_z_max_idx), 20));
    disp(tail(array2table(mt_ev_condi_z_max_idx), 20));
end

mt_ev_condi_z_max_kp = reshape(ar_k_mesha(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_bp = reshape(ar_a_meshk(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);

if(bl_display_evf)
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_max_kp: I by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_max_kp));
    disp(head(array2table(mt_ev_condi_z_max_kp), 20));
    disp(tail(array2table(mt_ev_condi_z_max_kp), 20));

    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('mt_ev_condi_z_max_bp: I by M');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp(size(mt_ev_condi_z_max_bp));
    disp(head(array2table(mt_ev_condi_z_max_bp), 20));
    disp(tail(array2table(mt_ev_condi_z_max_bp), 20));
end

%% Graph

if (bl_graph_evf)

    %% Graph 1, V and EV
    if (~bl_graph_onebyones)
        figure('PaperPosition', [0 0 14 4]);
        hold on;
    end


    for subplot_j=1:1:2

        if (~bl_graph_onebyones)
            hAxis(subplot_j) = subplot(1,2,subplot_j);
        else
            figure('PaperPosition', [0 0 7 4]);
        end

        if (subplot_j==1)
            chart = plot(mt_val);
        end
        if (subplot_j==2)
            chart = plot(mt_ev_condi_z);
        end

        clr = jet(numel(chart));
        for m = 1:numel(chart)
            set(chart(m),'Color',clr(m,:))
        end

        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        legend(chart(legend2plot), legendCell(legend2plot), 'Location','southeast');

        if (subplot_j==1)
            title('V(coh,zp); w(k+b),k,z');
        end
        if (subplot_j==2)
            title('E_z(V(coh,zp|z))');
        end

        ylabel('Next Period Value');
        xlabel({'Index of Cash-on-Hand Discrete Point'...
            'Each Segment is a w=k+b; within segment increasing k'...
            'EV and V identical if shock is fully persistent'});
        grid on;
        grid minor;
    end

    % Share y axis
    if (~bl_graph_onebyones)
        linkaxes(hAxis,'y');
    end

    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_vev' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

    %% Graph 2, max(EV)

    if(~bl_graph_onebyones)
        figure('PaperPosition', [0 0 7 4]);
    end

    for sub_j=1:1:1

        if(sub_j==1)
            mt_outcome = mt_ev_condi_z_max;
            st_y_label = 'max_{k''}(E(V(coh(k'',b''=w-k''),z''|z,w))';
        end

        if(~bl_graph_onebyones)
            subplot(1,1,sub_j)
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        hold on;

        ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        for i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_x = ar_w_level;
            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, ...
                'MarkerEdgeColor', clr(i_ctr,:), ...
                'MarkerFaceColor', clr(i_ctr,:));
        end

        grid on;
        grid minor;
        title(['2nd Stage Exp Value at Optimal K given W=K''+B'''])
        ylabel(st_y_label)
        xlabel({'Aggregate Savings'})

        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        legendCell{length(legendCell) + 1} = 'max-agg-save';
        legend(legendCell([ar_it_z_graph length(legendCell)]), 'Location','southeast');

        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';

    end

    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_maxev' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

    %% Graph 3, at max(EV) optimal choice category, color regions, borrow save

    % Borrow Vs Save
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    mt_it_borr_idx = (mt_ev_condi_z_max_bp < 0);
    mt_it_riskyhalf_idx = ((mt_ev_condi_z_max_kp./mt_ev_condi_z_max_bp) > 0.5);
    mt_it_kzero_idx = (mt_ev_condi_z_max_kp == 0);
    mt_it_isnan_idx = (isnan(mt_ev_condi_z_max_kp));

    figure('PaperPosition', [0 0 7 4]);
    % States: ar_w, ar_z
    % Choices: mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp
    hold on;
    it_sca_size = 10;
    chart_br = scatter(ar_w_mz(mt_it_borr_idx),...
        ar_z_mw(mt_it_borr_idx),...
        it_sca_size, 'blue', 'filled');
    %     legend([chart_br], {'Borrow'}, 'Location','northeast');
    chart_khalf = scatter(ar_w_mz(~mt_it_borr_idx & mt_it_riskyhalf_idx),...
        ar_z_mw(~mt_it_borr_idx & mt_it_riskyhalf_idx),...
        it_sca_size, 'black', 'filled');
    %     legend([chart_khalf], {'Save >0.5 K'}, 'Location','northeast');
    chart_sv = scatter(ar_w_mz(~mt_it_borr_idx & ~mt_it_riskyhalf_idx),...
        ar_z_mw(~mt_it_borr_idx & ~mt_it_riskyhalf_idx),...
        it_sca_size, 'red', 'filled');
    %     legend([chart_sv], {'Save <0.5 K'}, 'Location','northeast');
    chart_invalid = scatter(ar_w_mz(mt_it_kzero_idx | mt_it_isnan_idx),...
        ar_z_mw(mt_it_kzero_idx | mt_it_isnan_idx),...
        it_sca_size, 'yellow', 'filled');
    legend([chart_br, chart_khalf, chart_sv, chart_invalid], ...
        {'Borrow','Save >0.5 K','Save <0.5 K', 'k=0 or k=nan'}, 'Location','northeast');
    title('Borrow and Save Regions')
    ylabel('Shocks')
    xlabel({'Total Savings w=k+b'})
    grid on;

    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_maxbrsv' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

    %% Graph 4, Optimal K' and B' Levels

    [~, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    for sub_j=1:1:4

        if (bl_graph_onebyones)
            figure('PaperPosition', [0 0 7 4]);
        end

        if (sub_j==1)
            if(~bl_graph_onebyones)
                figure('PaperPosition', [0 0 14 4]);
                subplot(1,2,sub_j);
            end
            mt_y = mt_ev_condi_z_max_bp;
        end
        if (sub_j==2)
            if(~bl_graph_onebyones)
                subplot(1,2,sub_j);
            end

            mt_y = mt_ev_condi_z_max_kp;
        end
        if (sub_j==3)
            if(~bl_graph_onebyones)
                figure('PaperPosition', [0 0 14 4]);
                subplot(1,2,sub_j-2);
            end
            mt_y = zeros(size(mt_ev_condi_z_max_bp));
            mt_it_borr_idx = (mt_ev_condi_z_max_bp < 0);
            mt_y(mt_it_borr_idx) = -mt_ev_condi_z_max_bp(mt_it_borr_idx)/fl_b_bd;
            mt_y(~mt_it_borr_idx) = mt_ev_condi_z_max_bp(~mt_it_borr_idx)./ar_w_mz(~mt_it_borr_idx);
        end
        if (sub_j==4)
            if(~bl_graph_onebyones)
                subplot(1,2,sub_j-2);
            end
            mt_y = mt_ev_condi_z_max_kp./(ar_w_level'-fl_b_bd);
        end

        hold on;
        chart = plot(ar_w_level, mt_y);
        clr = jet(numel(chart));

        if (length(ar_w_level) <= 100)
            scatter(ar_w_mz(:), mt_y(:), 3, 'filled', 'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');
        end

        for m = 1:numel(chart)
            set(chart(m),'Color',clr(m,:))
        end
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));

        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';
        grid on;
        if (sub_j<=2)
            hline = refline([1 0]);
            hline.Color = 'k';
            hline.LineStyle = ':';
            hline.HandleVisibility = 'off';
        end

        if (sub_j==1)
            title('B Choices of W');
            ylabel('B Choices');
            xlabel({'Total Savings w=k+b'});
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end
        if (sub_j==2)
            title('K Choices of W');
            ylabel('K Choices');
            xlabel({'Total Savings w=k+b'});
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end

        if (sub_j==3)
            title('B Fraction of Borrow Max and Save');
            ylabel('B/bar(B) if br or B/W if sv');
            xlabel({'Total Savings w=k+b'});
            %             set(gca, 'YScale', 'log');
            ylim([-1.1 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end
        if (sub_j==4)
            title('K Fraction Choices of Total K Possible');
            ylabel('K/(W-bar(b)) ');
            xlabel({'Total Savings w=k+b'});
            %             set(gca, 'YScale', 'log');
            ylim([0 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northeast');
        end

    end

    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_wkbopti' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end

end

%% Display Various Containers

if (bl_display_evf)

    %% Display 1 support_map
    fft_container_map_display(support_map, it_display_summmat_rowmax, it_display_summmat_colmax);
        
    %% Display 2 armt_map
    fft_container_map_display(armt_map, it_display_summmat_rowmax, it_display_summmat_colmax);

    %% Display 3 param_map
    fft_container_map_display(param_map, it_display_summmat_rowmax, it_display_summmat_colmax);
    
    %% Display 4 func_map
    fft_container_map_display(func_map, it_display_summmat_rowmax, it_display_summmat_colmax);
end

end

##### SOURCE END #####
--></body></html>