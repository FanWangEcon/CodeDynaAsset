
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ff_ipwkbz_evf</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-06-11"><meta name="DC.source" content="ff_ipwkbz_evf.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters</a></li><li><a href="#5">Integrate <b>E(V(coh(k',b'), z')|z, w)</b></a></li><li><a href="#6">Reshape <b>E(V(coh,z'|z,w))</b> to allow for maxing</a></li><li><a href="#7">Maximize <b>max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</b> optimal value and index</a></li><li><a href="#8">Reindex K' and B' Choices for each State at the Optimal <b>w'=k'+b'</b> choice</a></li><li><a href="#9">Graph</a></li><li><a href="#11">Graph 1, V and EV</a></li><li><a href="#12">Graph 2, max(EV)</a></li><li><a href="#13">Graph 3, at max(EV) optimal choice category, color regions, borrow save</a></li><li><a href="#14">Graph 4, Optimal K' and B' Levels</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> [mt_ev_condi_z_max, mt_ev_condi_z_max_idx, mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp] = ff_ipwkbz_evf(varargin)
</pre><h2 id="2">FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings</h2><p>This function follows the structure set up here: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_wkz_evf.html">ff_wkz_evf</a> but now we solve the second stage with percentage choice grid</p><p>We solve along a vector of w_n vector, that is an interpolation vector, not a vector of actual w choices picked in the first stage. k' choices are in terms of percentages. Compared to ff_wkz_evf where we only had an upper triangle of choices, now we have a full matrix of percentage choices.</p><p>@param mt_val matrix state_n I^2 by shock_n. This is the value matrix each row is a feasible reachable state given the choice vectors/matrix and each column is a shock state.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@return mt_ev_condi_z_max matrix choice_w_n by shock_n max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)) conditional on z and w, at the optimal k' choice (w=k'+b') what is the expected utility? This is the value result from the 2nd stage problem. Note the result integrates over z'.</p><p>@return mt_ev_condi_z_max_idx matrix choice_w_n by shock_n this is the argmax from max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)). Given the vector of k' choices, which index maximized conditional on z and w integrating over z'/</p><p>@return mt_ev_condi_z_max_kp matrix choice_w_level_n by shock_n the k' choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</p><p>@return mt_ev_condi_z_max_bp matrix choice_w_n by shock_n the b'=w-k' choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</p><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m">ffs_ipwkbz_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m">ffs_ipwkbz_get_funcgrid</a></li></ul></div><h2 id="3">Default</h2><pre class="codeinput">params_len = length(varargin);
bl_input_override = 0;
<span class="keyword">if</span> (params_len == 5)
    bl_input_override = varargin{5};
<span class="keyword">end</span>
<span class="keyword">if</span> (bl_input_override)
    <span class="comment">% override when called from outside</span>
    [mt_val, param_map, support_map, armt_map, ~] = varargin{:};
<span class="keyword">else</span>
    clear <span class="string">all</span>;
    close <span class="string">all</span>;

    <span class="comment">% Not default parameters, but parameters that generate defaults</span>
    it_param_set = 4;
    bl_input_override = true;
    [param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);

    support_map(<span class="string">'bl_graph_evf'</span>) = true;
    support_map(<span class="string">'bl_display_evf'</span>) = true;

<span class="comment">%     param_map('it_z_n') = 10;</span>

    param_map(<span class="string">'it_ak_perc_n'</span>) = 250;
    param_map(<span class="string">'fl_w_interp_grid_gap'</span>) = (param_map(<span class="string">'fl_w_max'</span>)-param_map(<span class="string">'fl_b_bd'</span>))/param_map(<span class="string">'it_ak_perc_n'</span>);

    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>

    <span class="comment">% Generating Defaults</span>
    params_group = values(armt_map, {<span class="string">'ar_a_meshk'</span>, <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_z'</span>});
    [ar_a_meshk, ar_k_mesha, ar_z] = params_group{:};
    params_group = values(func_map, {<span class="string">'f_util_standin'</span>});
    [f_util_standin] = params_group{:};
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
<span class="keyword">end</span>
</pre><pre class="codeoutput">param_map
  Map with properties:

        Count: 30
      KeyType: char
    ValueType: any

pos = 1 ; key = bl_default ; val = 1
pos = 2 ; key = fl_Amean ; val = 1
pos = 3 ; key = fl_alpha ; val = 0.36
pos = 4 ; key = fl_b_bd ; val = -20
pos = 5 ; key = fl_beta ; val = 0.94
pos = 6 ; key = fl_c_min ; val = 0.001
pos = 7 ; key = fl_coh_interp_grid_gap ; val = 0.1
pos = 8 ; key = fl_crra ; val = 1.5
pos = 9 ; key = fl_default_aprime ; val = 0
pos = 10 ; key = fl_delta ; val = 0.08
pos = 11 ; key = fl_k_max ; val = 70
pos = 12 ; key = fl_k_min ; val = 0
pos = 13 ; key = fl_nan_replace ; val = -9999
pos = 14 ; key = fl_r_borr ; val = 0.025
pos = 15 ; key = fl_r_save ; val = 0.025
pos = 16 ; key = fl_tol_pol ; val = 1e-05
pos = 17 ; key = fl_tol_val ; val = 1e-05
pos = 18 ; key = fl_w ; val = 0.44365
pos = 19 ; key = fl_w_interp_grid_gap ; val = 0.1
pos = 20 ; key = fl_w_max ; val = 50
pos = 21 ; key = fl_w_min ; val = -20
pos = 22 ; key = fl_z_mu ; val = 0
pos = 23 ; key = fl_z_rho ; val = 0.8
pos = 24 ; key = fl_z_sig ; val = 0.2
pos = 25 ; key = it_ak_perc_n ; val = 50
pos = 26 ; key = it_c_interp_grid_gap ; val = 0.0001
pos = 27 ; key = it_maxiter_val ; val = 250
pos = 28 ; key = it_tol_pol_nochange ; val = 25
pos = 29 ; key = it_w_perc_n ; val = 50
pos = 30 ; key = it_z_n ; val = 15
support_map
  Map with properties:

        Count: 34
      KeyType: char
    ValueType: any

pos = 1 ; key = bl_display ; val = true
pos = 2 ; key = bl_display_evf ; val = false
pos = 3 ; key = bl_display_final ; val = true
pos = 4 ; key = bl_display_funcgrids ; val = false
pos = 5 ; key = bl_graph ; val = true
pos = 6 ; key = bl_graph_evf ; val = false
pos = 7 ; key = bl_graph_funcgrids ; val = false
pos = 8 ; key = bl_graph_funcgrids_detail ; val = false
pos = 9 ; key = bl_graph_onebyones ; val = true
pos = 10 ; key = bl_graph_pol_lvl ; val = true
pos = 11 ; key = bl_graph_pol_pct ; val = true
pos = 12 ; key = bl_graph_val ; val = true
pos = 13 ; key = bl_img_save ; val = false
pos = 14 ; key = bl_mat ; val = true
pos = 15 ; key = bl_post ; val = true
pos = 16 ; key = bl_profile ; val = false
pos = 17 ; key = bl_time ; val = true
pos = 18 ; key = it_display_every ; val = 5
pos = 19 ; key = it_display_final_colmax ; val = 12
pos = 20 ; key = it_display_final_rowmax ; val = 100
pos = 21 ; key = st_img_name_main ; val = _default
pos = 22 ; key = st_img_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkz//solve/img/
pos = 23 ; key = st_img_prefix ; val = 
pos = 24 ; key = st_img_suffix ; val = _p4.png
pos = 25 ; key = st_mat_name_main ; val = _default
pos = 26 ; key = st_mat_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkz//solve/mat/
pos = 27 ; key = st_mat_prefix ; val = 
pos = 28 ; key = st_mat_suffix ; val = _p4
pos = 29 ; key = st_matimg_path_root ; val = C:/Users/fan/CodeDynaAsset//m_ipwkz/
pos = 30 ; key = st_profile_name_main ; val = _default
pos = 31 ; key = st_profile_path ; val = C:/Users/fan/CodeDynaAsset//m_ipwkz//solve/profile/
pos = 32 ; key = st_profile_prefix ; val = 
pos = 33 ; key = st_profile_suffix ; val = _p4
pos = 34 ; key = st_title_prefix ; val = 
</pre><h2 id="4">Parse Parameters</h2><pre class="codeinput">params_group = values(armt_map, {<span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>,<span class="keyword">...</span>
    <span class="string">'ar_w_level'</span>, <span class="string">'ar_k_mesha'</span>, <span class="string">'ar_a_meshk'</span>, <span class="string">'mt_k'</span>});
[mt_z_trans, ar_z, ar_w_level, <span class="keyword">...</span>
    ar_k_mesha, ar_a_meshk, mt_k] = params_group{:};
params_group = values(param_map, {<span class="string">'it_z_n'</span>, <span class="string">'fl_nan_replace'</span>, <span class="string">'fl_b_bd'</span>});
[it_z_n, fl_nan_replace, fl_b_bd] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_graph_onebyones'</span>,<span class="string">'bl_display_evf'</span>, <span class="string">'bl_graph_evf'</span>});
[bl_graph_onebyones, bl_display_evf, bl_graph_evf] = params_group{:};
params_group = values(support_map, {<span class="string">'bl_img_save'</span>, <span class="string">'st_img_path'</span>, <span class="string">'st_img_prefix'</span>, <span class="string">'st_img_name_main'</span>, <span class="string">'st_img_suffix'</span>});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_ipwkbz_evf'</span>;
st_img_name_main = [st_func_name st_img_name_main];
</pre><h2 id="5">Integrate <b>E(V(coh(k',b'), z')|z, w)</b></h2><p>Each column for a different state z, each value <b>E(V(coh,z')|z)</b> integrated already Here, each column is a current z, more to right higher EV dim(mt_ev_condi_z): <b>Q by M</b> Note that: mt_ev_condi_z = mt_val*mt_z_trans' is a mistake, that would be what we do in the <a href="https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_set_functions.html">ffs_ipwkbz_set_functions</a> code where we loop over current z, and for each current z, grab out a particular row from the mt_z_trans that corresponds to a current shock's transition into all future states.</p><p>here, each column of mt_val corresponds to a state z, think of that as future state z. The input mt_val is <b>V(coh, z)</b>, we need to integrate to get <b>E(V(coh,z')|z)</b>.</p><pre class="codeinput">mt_ev_condi_z = mt_val*mt_z_trans';
<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'mt_ev_condi_z: Q by M'</span>);
    disp(size(mt_ev_condi_z));
    summary(array2table(mt_ev_condi_z));
<span class="keyword">end</span>
</pre><pre class="codeoutput">mt_ev_condi_z: Q by M
       62250          15


Variables:

    mt_ev_condi_z1: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5587     
            Max            4.2773     

    mt_ev_condi_z2: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5626     
            Max            4.2782     

    mt_ev_condi_z3: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5669     
            Max            4.2793     

    mt_ev_condi_z4: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5712     
            Max            4.2806     

    mt_ev_condi_z5: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5772     
            Max            4.2822     

    mt_ev_condi_z6: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5836     
            Max            4.2841     

    mt_ev_condi_z7: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5901     
            Max            4.2864     

    mt_ev_condi_z8: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.5975     
            Max            4.2891     

    mt_ev_condi_z9: 62250&times;1 double

        Values:

            Min           -6.9078     
            Median         3.6065     
            Max            4.2923     

    mt_ev_condi_z10: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6159     
            Max             4.2962     

    mt_ev_condi_z11: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6261     
            Max             4.3008     

    mt_ev_condi_z12: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6371     
            Max             4.3062     

    mt_ev_condi_z13: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6496     
            Max             4.3126     

    mt_ev_condi_z14: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6634     
            Max             4.3199     

    mt_ev_condi_z15: 62250&times;1 double

        Values:

            Min            -6.9078     
            Median          3.6774     
            Max             4.3277     

</pre><h2 id="6">Reshape <b>E(V(coh,z'|z,w))</b> to allow for maxing</h2><p>dim(mt_ev_condi_z): <b>IxJ by M</b></p><pre class="codeinput">[it_mt_bp_rown, it_mt_bp_coln] = size(mt_k);
mt_ev_condi_z_full = reshape(mt_ev_condi_z, [it_mt_bp_rown, it_mt_bp_coln*it_z_n]);
</pre><h2 id="7">Maximize <b>max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))</b> optimal value and index</h2><p>Maximization, find optimal k'/b' combination given z and w=k'+b'</p><pre class="codeinput">[ar_ev_condi_z_max, ar_ev_condi_z_max_idx] = max(mt_ev_condi_z_full);
mt_ev_condi_z_max = reshape(ar_ev_condi_z_max, [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_idx = reshape(ar_ev_condi_z_max_idx, [it_mt_bp_coln, it_z_n]);
<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'mt_ev_condi_z_full: J by IxM'</span>);
    disp(size(mt_ev_condi_z_full));
    <span class="comment">%     disp(mt_ev_condi_z_full);</span>
    disp(<span class="string">'mt_ev_condi_z_max: I by M'</span>);
    disp(size(mt_ev_condi_z_max));
    summary(array2table(mt_ev_condi_z_max));
    disp(<span class="string">'mt_ev_condi_z_max_idx: I by M'</span>);
    disp(size(mt_ev_condi_z_max_idx));
    <span class="comment">%     disp(mt_ev_condi_z_max_idx);</span>
<span class="keyword">end</span>
</pre><pre class="codeoutput">mt_ev_condi_z_full: J by IxM
         250        3735

mt_ev_condi_z_max: I by M
   249    15


Variables:

    mt_ev_condi_z_max1: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.5883       
            Max              4.2773       

    mt_ev_condi_z_max2: 249&times;1 double

        Values:

            Min             -6.9078       
            Median             3.59       
            Max              4.2782       

    mt_ev_condi_z_max3: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.5922       
            Max              4.2793       

    mt_ev_condi_z_max4: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.5948       
            Max              4.2806       

    mt_ev_condi_z_max5: 249&times;1 double

        Values:

            Min             -6.9078       
            Median            3.598       
            Max              4.2822       

    mt_ev_condi_z_max6: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.6018       
            Max              4.2841       

    mt_ev_condi_z_max7: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.6063       
            Max              4.2864       

    mt_ev_condi_z_max8: 249&times;1 double

        Values:

            Min             -6.9078       
            Median           3.6116       
            Max              4.2891       

    mt_ev_condi_z_max9: 249&times;1 double

        Values:

            Min             -6.9078       
            Median            3.618       
            Max              4.2923       

    mt_ev_condi_z_max10: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6255       
            Max               4.2962       

    mt_ev_condi_z_max11: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6344       
            Max               4.3008       

    mt_ev_condi_z_max12: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6449       
            Max               4.3062       

    mt_ev_condi_z_max13: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6572       
            Max               4.3126       

    mt_ev_condi_z_max14: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6712       
            Max               4.3199       

    mt_ev_condi_z_max15: 249&times;1 double

        Values:

            Min              -6.9078       
            Median            3.6861       
            Max               4.3277       

mt_ev_condi_z_max_idx: I by M
   249    15

</pre><h2 id="8">Reindex K' and B' Choices for each State at the Optimal <b>w'=k'+b'</b> choice</h2><p>The K' and B' Optimal Choices Associated with EV opti dim(mt_ev_condi_z_max_kp): <b>I by M</b></p><pre class="codeinput">ar_add_grid = linspace(0, it_mt_bp_rown*(it_mt_bp_coln-1), it_mt_bp_coln);
mt_ev_condi_z_max_idx = mt_ev_condi_z_max_idx + ar_add_grid';

<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'mt_ev_condi_z_max_idx: I by M'</span>);
    disp(size(mt_ev_condi_z_max_idx));
    <span class="comment">%     disp(mt_ev_condi_z_max_idx(1:it_mt_bp_coln,:));</span>
<span class="keyword">end</span>
mt_ev_condi_z_max_kp = reshape(ar_k_mesha(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_bp = reshape(ar_a_meshk(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
<span class="keyword">if</span>(bl_display_evf)
    disp(<span class="string">'mt_ev_condi_z_max_kp: I by M'</span>);
    disp(size(mt_ev_condi_z_max_kp));
    summary(array2table(mt_ev_condi_z_max_kp));
    disp(<span class="string">'mt_ev_condi_z_max_bp: I by M'</span>);
    disp(size(mt_ev_condi_z_max_bp));
    summary(array2table(mt_ev_condi_z_max_bp));
<span class="keyword">end</span>
</pre><pre class="codeoutput">mt_ev_condi_z_max_idx: I by M
   249    15

mt_ev_condi_z_max_kp: I by M
   249    15


Variables:

    mt_ev_condi_z_max_kp1: 249&times;1 double

        Values:

            Min                    0         
            Median            1.8808         
            Max               2.0257         

    mt_ev_condi_z_max_kp2: 249&times;1 double

        Values:

            Min                    0         
            Median            2.2184         
            Max               2.3544         

    mt_ev_condi_z_max_kp3: 249&times;1 double

        Values:

            Min                    0         
            Median            2.6404         
            Max               2.7829         

    mt_ev_condi_z_max_kp4: 249&times;1 double

        Values:

            Min                    0         
            Median            3.1548         
            Max               3.2982         

    mt_ev_condi_z_max_kp5: 249&times;1 double

        Values:

            Min                    0         
            Median            3.7711         
            Max               3.9173         

    mt_ev_condi_z_max_kp6: 249&times;1 double

        Values:

            Min                    0         
            Median            4.5038         
            Max               4.6453         

    mt_ev_condi_z_max_kp7: 249&times;1 double

        Values:

            Min                    0         
            Median            5.3866         
            Max               5.5438         

    mt_ev_condi_z_max_kp8: 249&times;1 double

        Values:

            Min                    0         
            Median            6.4379         
            Max                6.584         

    mt_ev_condi_z_max_kp9: 249&times;1 double

        Values:

            Min                    0         
            Median            7.6925         
            Max               7.8618         

    mt_ev_condi_z_max_kp10: 249&times;1 double

        Values:

            Min                     0         
            Median             9.1881         
            Max                9.3552         

    mt_ev_condi_z_max_kp11: 249&times;1 double

        Values:

            Min                     0         
            Median             10.974         
            Max                11.156         

    mt_ev_condi_z_max_kp12: 249&times;1 double

        Values:

            Min                     0         
            Median             13.102         
            Max                13.302         

    mt_ev_condi_z_max_kp13: 249&times;1 double

        Values:

            Min                     0         
            Median             15.627         
            Max                15.819         

    mt_ev_condi_z_max_kp14: 249&times;1 double

        Values:

            Min                     0         
            Median             18.543         
            Max                18.762         

    mt_ev_condi_z_max_kp15: 249&times;1 double

        Values:

            Min                     0         
            Median             21.688         
            Max                21.892         

mt_ev_condi_z_max_bp: I by M
   249    15


Variables:

    mt_ev_condi_z_max_bp1: 249&times;1 double

        Values:

            Min                  -20         
            Median            13.141         
            Max               48.247         

    mt_ev_condi_z_max_bp2: 249&times;1 double

        Values:

            Min                  -20         
            Median            12.721         
            Max               47.686         

    mt_ev_condi_z_max_bp3: 249&times;1 double

        Values:

            Min                  -20         
            Median              12.3         
            Max               47.405         

    mt_ev_condi_z_max_bp4: 249&times;1 double

        Values:

            Min                  -20         
            Median            11.879         
            Max               46.844         

    mt_ev_condi_z_max_bp5: 249&times;1 double

        Values:

            Min                  -20         
            Median            11.177         
            Max               46.283         

    mt_ev_condi_z_max_bp6: 249&times;1 double

        Values:

            Min                  -20         
            Median            10.476         
            Max               45.441         

    mt_ev_condi_z_max_bp7: 249&times;1 double

        Values:

            Min                  -20         
            Median            9.6343         
            Max               44.599         

    mt_ev_condi_z_max_bp8: 249&times;1 double

        Values:

            Min                  -20         
            Median            8.5121         
            Max               43.477         

    mt_ev_condi_z_max_bp9: 249&times;1 double

        Values:

            Min                  -20         
            Median            7.2495         
            Max               42.355         

    mt_ev_condi_z_max_bp10: 249&times;1 double

        Values:

            Min                   -20         
            Median             5.8467         
            Max                40.671         

    mt_ev_condi_z_max_bp11: 249&times;1 double

        Values:

            Min                   -20         
            Median             4.0231         
            Max                38.988         

    mt_ev_condi_z_max_bp12: 249&times;1 double

        Values:

            Min                   -20         
            Median             1.9189         
            Max                36.744         

    mt_ev_condi_z_max_bp13: 249&times;1 double

        Values:

            Min                   -20         
            Median            -0.6062         
            Max                34.219         

    mt_ev_condi_z_max_bp14: 249&times;1 double

        Values:

            Min                   -20         
            Median            -3.5521         
            Max                31.413         

    mt_ev_condi_z_max_bp15: 249&times;1 double

        Values:

            Min                   -20         
            Median            -6.7786         
            Max                28.327         

</pre><h2 id="9">Graph</h2><pre class="codeinput"><span class="keyword">if</span> (bl_graph_evf)
</pre><h2 id="11">Graph 1, V and EV</h2><pre class="codeinput">    <span class="keyword">if</span> (~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
        hold <span class="string">on</span>;
    <span class="keyword">end</span>


    <span class="keyword">for</span> subplot_j=1:1:2

        <span class="keyword">if</span> (~bl_graph_onebyones)
            hAxis(subplot_j) = subplot(1,2,subplot_j);
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (subplot_j==1)
            chart = plot(mt_val);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (subplot_j==2)
            chart = plot(mt_ev_condi_z);
        <span class="keyword">end</span>

        clr = jet(numel(chart));
        <span class="keyword">for</span> m = 1:numel(chart)
            set(chart(m),<span class="string">'Color'</span>,clr(m,:))
        <span class="keyword">end</span>

        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'southeast'</span>);

        <span class="keyword">if</span> (subplot_j==1)
            title(<span class="string">'V(coh,zp); w(k+b),k,z'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (subplot_j==2)
            title(<span class="string">'E_z(V(coh,zp|z))'</span>);
        <span class="keyword">end</span>

        ylabel(<span class="string">'Next Period Value'</span>);
        xlabel({<span class="string">'Index of Cash-on-Hand Discrete Point'</span><span class="keyword">...</span>
            <span class="string">'Each Segment is a w=k+b; within segment increasing k'</span><span class="keyword">...</span>
            <span class="string">'EV and V identical if shock is fully persistent'</span>});
        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
    <span class="keyword">end</span>

    <span class="comment">% Share y axis</span>
    <span class="keyword">if</span> (~bl_graph_onebyones)
        linkaxes(hAxis,<span class="string">'y'</span>);
    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_vev'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_01.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_02.png" alt=""> <h2 id="12">Graph 2, max(EV)</h2><pre class="codeinput">    <span class="keyword">if</span>(~bl_graph_onebyones)
        figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    <span class="keyword">end</span>

    <span class="keyword">for</span> sub_j=1:1:1

        <span class="keyword">if</span>(sub_j==1)
            mt_outcome = mt_ev_condi_z_max;
            st_y_label = <span class="string">'max_{k''}(E(V(coh(k'',b''=w-k''),z''|z,w))'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span>(~bl_graph_onebyones)
            subplot(1,1,sub_j)
        <span class="keyword">else</span>
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>
        hold <span class="string">on</span>;

        ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        <span class="keyword">for</span> i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_x = ar_w_level;
            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, <span class="keyword">...</span>
                <span class="string">'MarkerEdgeColor'</span>, clr(i_ctr,:), <span class="keyword">...</span>
                <span class="string">'MarkerFaceColor'</span>, clr(i_ctr,:));
        <span class="keyword">end</span>

        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;
        title([<span class="string">'2nd Stage Exp Value at Optimal K given W=K''+B'''</span>])
        ylabel(st_y_label)
        xlabel({<span class="string">'Aggregate Savings'</span>})

        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));
        legendCell{length(legendCell) + 1} = <span class="string">'max-agg-save'</span>;
        legend(legendCell([ar_it_z_graph length(legendCell)]), <span class="string">'Location'</span>,<span class="string">'southeast'</span>);

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_maxev'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><pre class="codeoutput">Warning: Ignoring extra legend entries. 
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_03.png" alt=""> <h2 id="13">Graph 3, at max(EV) optimal choice category, color regions, borrow save</h2><pre class="codeinput">    <span class="comment">% Borrow Vs Save</span>
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    mt_it_borr_idx = (mt_ev_condi_z_max_bp &lt; 0);
    mt_it_riskyhalf_idx = ((mt_ev_condi_z_max_kp./mt_ev_condi_z_max_bp) &gt; 0.5);
    mt_it_kzero_idx = (mt_ev_condi_z_max_kp == 0);
    mt_it_isnan_idx = (isnan(mt_ev_condi_z_max_kp));

    figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
    <span class="comment">% States: ar_w, ar_z</span>
    <span class="comment">% Choices: mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp</span>
    hold <span class="string">on</span>;
    it_sca_size = 10;
    chart_br = scatter(ar_w_mz(mt_it_borr_idx),<span class="keyword">...</span>
        ar_z_mw(mt_it_borr_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'blue'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_br], {'Borrow'}, 'Location','northeast');</span>
    chart_khalf = scatter(ar_w_mz(~mt_it_borr_idx &amp; mt_it_riskyhalf_idx),<span class="keyword">...</span>
        ar_z_mw(~mt_it_borr_idx &amp; mt_it_riskyhalf_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'black'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_khalf], {'Save &gt;0.5 K'}, 'Location','northeast');</span>
    chart_sv = scatter(ar_w_mz(~mt_it_borr_idx &amp; ~mt_it_riskyhalf_idx),<span class="keyword">...</span>
        ar_z_mw(~mt_it_borr_idx &amp; ~mt_it_riskyhalf_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'red'</span>, <span class="string">'filled'</span>);
    <span class="comment">%     legend([chart_sv], {'Save &lt;0.5 K'}, 'Location','northeast');</span>
    chart_invalid = scatter(ar_w_mz(mt_it_kzero_idx | mt_it_isnan_idx),<span class="keyword">...</span>
        ar_z_mw(mt_it_kzero_idx | mt_it_isnan_idx),<span class="keyword">...</span>
        it_sca_size, <span class="string">'yellow'</span>, <span class="string">'filled'</span>);
    legend([chart_br, chart_khalf, chart_sv, chart_invalid], <span class="keyword">...</span>
        {<span class="string">'Borrow'</span>,<span class="string">'Save &gt;0.5 K'</span>,<span class="string">'Save &lt;0.5 K'</span>, <span class="string">'k=0 or k=nan'</span>}, <span class="string">'Location'</span>,<span class="string">'northeast'</span>);
    title(<span class="string">'Borrow and Save Regions'</span>)
    ylabel(<span class="string">'Shocks'</span>)
    xlabel({<span class="string">'Total Savings w=k+b'</span>})
    grid <span class="string">on</span>;

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_maxbrsv'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_04.png" alt=""> <h2 id="14">Graph 4, Optimal K' and B' Levels</h2><pre class="codeinput">    [~, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    <span class="keyword">for</span> sub_j=1:1:4

        <span class="keyword">if</span> (bl_graph_onebyones)
            figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==1)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
                subplot(1,2,sub_j);
            <span class="keyword">end</span>
            mt_y = mt_ev_condi_z_max_bp;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==2)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                subplot(1,2,sub_j);
            <span class="keyword">end</span>

            mt_y = mt_ev_condi_z_max_kp;
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==3)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                figure(<span class="string">'PaperPosition'</span>, [0 0 14 4]);
                subplot(1,2,sub_j-2);
            <span class="keyword">end</span>
            mt_y = zeros(size(mt_ev_condi_z_max_bp));
            mt_it_borr_idx = (mt_ev_condi_z_max_bp &lt; 0);
            mt_y(mt_it_borr_idx) = -mt_ev_condi_z_max_bp(mt_it_borr_idx)/fl_b_bd;
            mt_y(~mt_it_borr_idx) = mt_ev_condi_z_max_bp(~mt_it_borr_idx)./ar_w_mz(~mt_it_borr_idx);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==4)
            <span class="keyword">if</span>(~bl_graph_onebyones)
                subplot(1,2,sub_j-2);
            <span class="keyword">end</span>
            mt_y = mt_ev_condi_z_max_kp./(ar_w_level'-fl_b_bd);
        <span class="keyword">end</span>

        hold <span class="string">on</span>;
        chart = plot(ar_w_level, mt_y);
        clr = jet(numel(chart));

        <span class="keyword">if</span> (length(ar_w_level) &lt;= 100)
            scatter(ar_w_mz(:), mt_y(:), 3, <span class="string">'filled'</span>, <span class="string">'MarkerEdgeColor'</span>, <span class="string">'b'</span>, <span class="string">'MarkerFaceColor'</span>, <span class="string">'b'</span>);
        <span class="keyword">end</span>

        <span class="keyword">for</span> m = 1:numel(chart)
            set(chart(m),<span class="string">'Color'</span>,clr(m,:))
        <span class="keyword">end</span>
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', <span class="string">'shock=%3.2f'</span>));

        xline0 = xline(0);
        xline0.HandleVisibility = <span class="string">'off'</span>;
        yline0 = yline(0);
        yline0.HandleVisibility = <span class="string">'off'</span>;
        grid <span class="string">on</span>;
        <span class="keyword">if</span> (sub_j&lt;=2)
            hline = refline([1 0]);
            hline.Color = <span class="string">'k'</span>;
            hline.LineStyle = <span class="string">':'</span>;
            hline.HandleVisibility = <span class="string">'off'</span>;
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==1)
            title(<span class="string">'B Choices of W'</span>);
            ylabel(<span class="string">'B Choices'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==2)
            title(<span class="string">'K Choices of W'</span>);
            ylabel(<span class="string">'K Choices'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>

        <span class="keyword">if</span> (sub_j==3)
            title(<span class="string">'B Fraction of Borrow Max and Save'</span>);
            ylabel(<span class="string">'B/bar(B) if br or B/W if sv'</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            <span class="comment">%             set(gca, 'YScale', 'log');</span>
            ylim([-1.1 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northwest'</span>);
        <span class="keyword">end</span>
        <span class="keyword">if</span> (sub_j==4)
            title(<span class="string">'K Fraction Choices of Total K Possible'</span>);
            ylabel(<span class="string">'K/(W-bar(b)) '</span>);
            xlabel({<span class="string">'Total Savings w=k+b'</span>});
            <span class="comment">%             set(gca, 'YScale', 'log');</span>
            ylim([0 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), <span class="string">'Location'</span>,<span class="string">'northeast'</span>);
        <span class="keyword">end</span>

    <span class="keyword">end</span>

    <span class="comment">% save file</span>
    <span class="keyword">if</span> (bl_img_save)
        mkdir(support_map(<span class="string">'st_img_path'</span>));
        st_file_name = [st_img_prefix st_img_name_main <span class="string">'_wkbopti'</span> st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    <span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ff_ipwkbz_evf_05.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_06.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_07.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_evf_08.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans =

  Columns 1 through 7

   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078
   -0.7372   -0.6761   -0.6081   -0.5358   -0.4602   -0.3817   -0.3005
   -0.2022   -0.1556   -0.1032   -0.0466    0.0135    0.0769    0.1434
    0.1247    0.1638    0.2082    0.2564    0.3081    0.3630    0.4212
    0.3629    0.3973    0.4364    0.4792    0.5253    0.5745    0.6269
    0.5514    0.5823    0.6176    0.6564    0.6984    0.7434    0.7915
    0.7075    0.7359    0.7683    0.8041    0.8428    0.8845    0.9292
    0.8412    0.8674    0.8975    0.9308    0.9669    1.0059    1.0478
    0.9589    0.9825    1.0107    1.0419    1.0759    1.1126    1.1523
    1.0641    1.0854    1.1115    1.1410    1.1731    1.2080    1.2456
    1.1593    1.1787    1.2026    1.2304    1.2610    1.2942    1.3301
    1.2462    1.2641    1.2860    1.3119    1.3411    1.3729    1.4073
    1.3262    1.3427    1.3630    1.3870    1.4148    1.4453    1.4783
    1.4002    1.4156    1.4345    1.4569    1.4831    1.5124    1.5442
    1.4691    1.4835    1.5012    1.5222    1.5468    1.5749    1.6057
    1.5336    1.5471    1.5637    1.5834    1.6066    1.6335    1.6633
    1.5942    1.6068    1.6225    1.6412    1.6631    1.6886    1.7174
    1.6513    1.6633    1.6781    1.6957    1.7165    1.7408    1.7686
    1.7053    1.7167    1.7307    1.7475    1.7672    1.7903    1.8171
    1.7565    1.7673    1.7807    1.7967    1.8155    1.8375    1.8631
    1.8053    1.8156    1.8283    1.8436    1.8615    1.8826    1.9071
    1.8518    1.8616    1.8738    1.8884    1.9056    1.9257    1.9492
    1.8962    1.9056    1.9173    1.9312    1.9477    1.9670    1.9896
    1.9387    1.9477    1.9589    1.9723    1.9882    2.0067    2.0285
    1.9795    1.9882    1.9989    2.0118    2.0270    2.0449    2.0659
    2.0187    2.0270    2.0374    2.0498    2.0644    2.0817    2.1019
    2.0564    2.0644    2.0744    2.0864    2.1005    2.1172    2.1367
    2.0927    2.1005    2.1101    2.1217    2.1353    2.1514    2.1703
    2.1278    2.1353    2.1446    2.1558    2.1690    2.1845    2.2028
    2.1617    2.1689    2.1779    2.1887    2.2015    2.2166    2.2343
    2.1945    2.2015    2.2102    2.2206    2.2330    2.2476    2.2648
    2.2262    2.2330    2.2414    2.2516    2.2636    2.2777    2.2944
    2.2569    2.2635    2.2717    2.2816    2.2932    2.3070    2.3232
    2.2868    2.2932    2.3011    2.3107    2.3220    2.3354    2.3511
    2.3157    2.3220    2.3297    2.3390    2.3500    2.3630    2.3783
    2.3439    2.3499    2.3575    2.3665    2.3772    2.3899    2.4048
    2.3713    2.3772    2.3845    2.3933    2.4037    2.4161    2.4306
    2.3979    2.4037    2.4108    2.4194    2.4295    2.4416    2.4558
    2.4239    2.4295    2.4364    2.4448    2.4547    2.4664    2.4803
    2.4492    2.4546    2.4614    2.4696    2.4793    2.4907    2.5042
    2.4739    2.4792    2.4858    2.4938    2.5032    2.5144    2.5276
    2.4980    2.5031    2.5096    2.5174    2.5266    2.5375    2.5504
    2.5215    2.5265    2.5329    2.5405    2.5495    2.5602    2.5728
    2.5445    2.5494    2.5556    2.5630    2.5718    2.5823    2.5946
    2.5669    2.5718    2.5778    2.5851    2.5937    2.6039    2.6160
    2.5889    2.5936    2.5995    2.6066    2.6151    2.6251    2.6369
    2.6104    2.6150    2.6208    2.6278    2.6360    2.6459    2.6574
    2.6314    2.6360    2.6416    2.6485    2.6566    2.6662    2.6775
    2.6520    2.6565    2.6620    2.6687    2.6767    2.6861    2.6972
    2.6722    2.6766    2.6820    2.6886    2.6964    2.7056    2.7165
    2.6920    2.6963    2.7016    2.7081    2.7157    2.7248    2.7355
    2.7114    2.7156    2.7209    2.7272    2.7347    2.7436    2.7541
    2.7305    2.7346    2.7397    2.7459    2.7533    2.7620    2.7723
    2.7492    2.7532    2.7582    2.7643    2.7715    2.7801    2.7903
    2.7675    2.7715    2.7764    2.7824    2.7895    2.7979    2.8079
    2.7855    2.7894    2.7943    2.8001    2.8071    2.8154    2.8252
    2.8032    2.8070    2.8118    2.8176    2.8244    2.8326    2.8422
    2.8206    2.8244    2.8291    2.8347    2.8415    2.8495    2.8589
    2.8377    2.8414    2.8460    2.8516    2.8582    2.8661    2.8754
    2.8545    2.8581    2.8627    2.8681    2.8747    2.8824    2.8916
    2.8710    2.8746    2.8791    2.8844    2.8909    2.8985    2.9075
    2.8873    2.8908    2.8952    2.9005    2.9068    2.9143    2.9232
    2.9033    2.9067    2.9110    2.9163    2.9225    2.9299    2.9386
    2.9190    2.9224    2.9267    2.9318    2.9379    2.9452    2.9538
    2.9345    2.9379    2.9421    2.9471    2.9531    2.9603    2.9688
    2.9498    2.9531    2.9572    2.9622    2.9681    2.9752    2.9836
    2.9648    2.9681    2.9721    2.9770    2.9829    2.9898    2.9981
    2.9796    2.9828    2.9868    2.9917    2.9974    3.0043    3.0124
    2.9942    2.9974    3.0013    3.0061    3.0118    3.0185    3.0265
    3.0086    3.0117    3.0156    3.0203    3.0259    3.0326    3.0405
    3.0228    3.0258    3.0297    3.0343    3.0398    3.0464    3.0542
    3.0367    3.0398    3.0436    3.0481    3.0536    3.0601    3.0678
    3.0505    3.0535    3.0573    3.0618    3.0672    3.0736    3.0811
    3.0641    3.0671    3.0708    3.0752    3.0805    3.0868    3.0943
    3.0776    3.0805    3.0841    3.0885    3.0937    3.1000    3.1074
    3.0908    3.0937    3.0973    3.1016    3.1068    3.1129    3.1202
    3.1039    3.1067    3.1102    3.1145    3.1196    3.1257    3.1329
    3.1168    3.1196    3.1231    3.1273    3.1323    3.1383    3.1454
    3.1295    3.1323    3.1357    3.1399    3.1449    3.1508    3.1578
    3.1421    3.1448    3.1482    3.1523    3.1573    3.1631    3.1701
    3.1545    3.1572    3.1606    3.1646    3.1695    3.1753    3.1821
    3.1668    3.1694    3.1728    3.1768    3.1816    3.1873    3.1941
    3.1789    3.1815    3.1848    3.1888    3.1935    3.1992    3.2059
    3.1909    3.1935    3.1967    3.2006    3.2053    3.2109    3.2175
    3.2027    3.2053    3.2085    3.2123    3.2170    3.2225    3.2290
    3.2144    3.2169    3.2201    3.2239    3.2285    3.2340    3.2404
    3.2259    3.2284    3.2316    3.2354    3.2399    3.2453    3.2517
    3.2374    3.2398    3.2429    3.2467    3.2512    3.2565    3.2628
    3.2487    3.2511    3.2542    3.2579    3.2623    3.2676    3.2738
    3.2598    3.2623    3.2653    3.2690    3.2733    3.2785    3.2847
    3.2709    3.2733    3.2763    3.2799    3.2842    3.2894    3.2955
    3.2818    3.2842    3.2871    3.2907    3.2950    3.3001    3.3062
    3.2926    3.2950    3.2979    3.3014    3.3057    3.3107    3.3167
    3.3033    3.3056    3.3085    3.3120    3.3162    3.3212    3.3272
    3.3139    3.3162    3.3191    3.3225    3.3267    3.3316    3.3375
    3.3243    3.3266    3.3295    3.3329    3.3370    3.3419    3.3477
    3.3347    3.3370    3.3398    3.3432    3.3473    3.3521    3.3579
    3.3450    3.3472    3.3500    3.3534    3.3574    3.3622    3.3679
    3.3551    3.3573    3.3601    3.3634    3.3674    3.3722    3.3778
    3.3652    3.3673    3.3701    3.3734    3.3773    3.3820    3.3876
    3.3751    3.3773    3.3800    3.3833    3.3872    3.3918    3.3973
    3.3850    3.3871    3.3898    3.3930    3.3969    3.4015    3.4070
    3.3947    3.3968    3.3995    3.4027    3.4065    3.4111    3.4165
    3.4044    3.4065    3.4091    3.4123    3.4161    3.4206    3.4260
    3.4139    3.4160    3.4186    3.4218    3.4255    3.4300    3.4353
    3.4234    3.4255    3.4281    3.4312    3.4349    3.4393    3.4446
    3.4328    3.4348    3.4374    3.4405    3.4442    3.4486    3.4538
    3.4421    3.4441    3.4467    3.4497    3.4534    3.4577    3.4629
    3.4513    3.4533    3.4558    3.4589    3.4625    3.4668    3.4719
    3.4605    3.4624    3.4649    3.4679    3.4715    3.4758    3.4809
    3.4695    3.4715    3.4739    3.4769    3.4805    3.4847    3.4898
    3.4785    3.4804    3.4829    3.4858    3.4893    3.4935    3.4985
    3.4874    3.4893    3.4917    3.4946    3.4981    3.5023    3.5073
    3.4962    3.4981    3.5005    3.5034    3.5068    3.5110    3.5159
    3.5049    3.5068    3.5092    3.5121    3.5155    3.5196    3.5245
    3.5135    3.5154    3.5178    3.5206    3.5241    3.5281    3.5329
    3.5221    3.5240    3.5263    3.5292    3.5325    3.5366    3.5414
    3.5306    3.5325    3.5348    3.5376    3.5410    3.5450    3.5497
    3.5391    3.5409    3.5432    3.5460    3.5493    3.5533    3.5580
    3.5474    3.5493    3.5515    3.5543    3.5576    3.5615    3.5662
    3.5557    3.5576    3.5598    3.5625    3.5658    3.5697    3.5743
    3.5640    3.5658    3.5680    3.5707    3.5740    3.5778    3.5824
    3.5721    3.5739    3.5761    3.5788    3.5820    3.5859    3.5904
    3.5802    3.5820    3.5842    3.5869    3.5901    3.5939    3.5984
    3.5883    3.5900    3.5922    3.5948    3.5980    3.6018    3.6063
    3.5962    3.5980    3.6001    3.6028    3.6059    3.6096    3.6141
    3.6041    3.6059    3.6080    3.6106    3.6137    3.6174    3.6219
    3.6120    3.6137    3.6158    3.6184    3.6215    3.6252    3.6296
    3.6198    3.6214    3.6236    3.6261    3.6292    3.6329    3.6372
    3.6275    3.6292    3.6313    3.6338    3.6369    3.6405    3.6448
    3.6351    3.6368    3.6389    3.6414    3.6444    3.6480    3.6523
    3.6427    3.6444    3.6465    3.6490    3.6520    3.6556    3.6598
    3.6503    3.6519    3.6540    3.6565    3.6595    3.6630    3.6672
    3.6578    3.6594    3.6614    3.6639    3.6669    3.6704    3.6746
    3.6652    3.6668    3.6689    3.6713    3.6742    3.6777    3.6819
    3.6726    3.6742    3.6762    3.6786    3.6816    3.6850    3.6892
    3.6799    3.6815    3.6835    3.6859    3.6888    3.6923    3.6964
    3.6872    3.6888    3.6908    3.6932    3.6960    3.6994    3.7035
    3.6944    3.6960    3.6979    3.7003    3.7032    3.7066    3.7106
    3.7016    3.7031    3.7051    3.7075    3.7103    3.7137    3.7177
    3.7087    3.7102    3.7122    3.7145    3.7173    3.7207    3.7247
    3.7157    3.7173    3.7192    3.7216    3.7243    3.7277    3.7316
    3.7228    3.7243    3.7262    3.7285    3.7313    3.7346    3.7385
    3.7297    3.7313    3.7332    3.7355    3.7382    3.7415    3.7454
    3.7367    3.7382    3.7401    3.7423    3.7451    3.7483    3.7522
    3.7435    3.7450    3.7469    3.7492    3.7519    3.7551    3.7590
    3.7504    3.7518    3.7537    3.7560    3.7587    3.7619    3.7657
    3.7571    3.7586    3.7605    3.7627    3.7654    3.7686    3.7724
    3.7639    3.7653    3.7672    3.7694    3.7721    3.7752    3.7790
    3.7706    3.7720    3.7738    3.7760    3.7787    3.7818    3.7856
    3.7772    3.7786    3.7805    3.7827    3.7853    3.7884    3.7921
    3.7838    3.7852    3.7870    3.7892    3.7918    3.7949    3.7986
    3.7903    3.7918    3.7936    3.7957    3.7983    3.8014    3.8051
    3.7969    3.7983    3.8001    3.8022    3.8048    3.8079    3.8115
    3.8033    3.8047    3.8065    3.8087    3.8112    3.8143    3.8179
    3.8098    3.8112    3.8129    3.8150    3.8176    3.8206    3.8242
    3.8162    3.8175    3.8193    3.8214    3.8239    3.8269    3.8305
    3.8225    3.8239    3.8256    3.8277    3.8302    3.8332    3.8368
    3.8288    3.8302    3.8319    3.8340    3.8365    3.8395    3.8430
    3.8351    3.8364    3.8382    3.8402    3.8427    3.8457    3.8492
    3.8413    3.8427    3.8444    3.8464    3.8489    3.8518    3.8553
    3.8475    3.8489    3.8505    3.8526    3.8550    3.8580    3.8614
    3.8537    3.8550    3.8567    3.8587    3.8611    3.8640    3.8675
    3.8598    3.8611    3.8628    3.8648    3.8672    3.8701    3.8735
    3.8658    3.8672    3.8688    3.8708    3.8732    3.8761    3.8795
    3.8719    3.8732    3.8749    3.8769    3.8792    3.8821    3.8855
    3.8779    3.8792    3.8808    3.8828    3.8852    3.8880    3.8914
    3.8839    3.8852    3.8868    3.8888    3.8911    3.8939    3.8973
    3.8898    3.8911    3.8927    3.8947    3.8970    3.8998    3.9032
    3.8957    3.8970    3.8986    3.9005    3.9029    3.9057    3.9090
    3.9016    3.9028    3.9044    3.9064    3.9087    3.9115    3.9148
    3.9074    3.9087    3.9103    3.9122    3.9145    3.9172    3.9205
    3.9132    3.9145    3.9160    3.9180    3.9202    3.9230    3.9262
    3.9189    3.9202    3.9218    3.9237    3.9260    3.9287    3.9319
    3.9247    3.9259    3.9275    3.9294    3.9317    3.9344    3.9376
    3.9304    3.9316    3.9332    3.9351    3.9373    3.9400    3.9432
    3.9360    3.9373    3.9388    3.9407    3.9429    3.9456    3.9488
    3.9417    3.9429    3.9444    3.9463    3.9485    3.9512    3.9544
    3.9473    3.9485    3.9500    3.9519    3.9541    3.9567    3.9599
    3.9528    3.9541    3.9556    3.9574    3.9596    3.9623    3.9654
    3.9584    3.9596    3.9611    3.9629    3.9651    3.9678    3.9709
    3.9639    3.9651    3.9666    3.9684    3.9706    3.9732    3.9763
    3.9694    3.9706    3.9721    3.9739    3.9761    3.9786    3.9817
    3.9748    3.9760    3.9775    3.9793    3.9815    3.9840    3.9871
    3.9802    3.9814    3.9829    3.9847    3.9868    3.9894    3.9925
    3.9856    3.9868    3.9883    3.9901    3.9922    3.9947    3.9978
    3.9910    3.9922    3.9936    3.9954    3.9975    4.0001    4.0031
    3.9963    3.9975    3.9989    4.0007    4.0028    4.0053    4.0083
    4.0016    4.0028    4.0042    4.0060    4.0081    4.0106    4.0136
    4.0069    4.0081    4.0095    4.0112    4.0133    4.0158    4.0188
    4.0122    4.0133    4.0147    4.0165    4.0186    4.0210    4.0240
    4.0174    4.0185    4.0199    4.0217    4.0237    4.0262    4.0292
    4.0226    4.0237    4.0251    4.0268    4.0289    4.0314    4.0343
    4.0277    4.0289    4.0303    4.0320    4.0340    4.0365    4.0394
    4.0329    4.0340    4.0354    4.0371    4.0391    4.0416    4.0445
    4.0380    4.0391    4.0405    4.0422    4.0442    4.0466    4.0495
    4.0431    4.0442    4.0456    4.0473    4.0493    4.0517    4.0546
    4.0481    4.0493    4.0506    4.0523    4.0543    4.0567    4.0596
    4.0532    4.0543    4.0557    4.0573    4.0593    4.0617    4.0645
    4.0582    4.0593    4.0607    4.0623    4.0643    4.0667    4.0695
    4.0632    4.0643    4.0656    4.0673    4.0693    4.0716    4.0744
    4.0681    4.0692    4.0706    4.0722    4.0742    4.0765    4.0793
    4.0731    4.0742    4.0755    4.0771    4.0791    4.0814    4.0842
    4.0780    4.0791    4.0804    4.0820    4.0840    4.0863    4.0891
    4.0829    4.0840    4.0853    4.0869    4.0888    4.0912    4.0939
    4.0877    4.0888    4.0901    4.0918    4.0937    4.0960    4.0987
    4.0926    4.0936    4.0950    4.0966    4.0985    4.1008    4.1035
    4.0974    4.0985    4.0998    4.1014    4.1033    4.1056    4.1083
    4.1022    4.1033    4.1046    4.1062    4.1081    4.1103    4.1130
    4.1070    4.1080    4.1093    4.1109    4.1128    4.1151    4.1177
    4.1117    4.1128    4.1141    4.1156    4.1175    4.1198    4.1224
    4.1165    4.1175    4.1188    4.1203    4.1222    4.1245    4.1271
    4.1212    4.1222    4.1235    4.1250    4.1269    4.1291    4.1318
    4.1258    4.1269    4.1281    4.1297    4.1316    4.1338    4.1364
    4.1305    4.1315    4.1328    4.1343    4.1362    4.1384    4.1410
    4.1351    4.1362    4.1374    4.1390    4.1408    4.1430    4.1456
    4.1398    4.1408    4.1420    4.1436    4.1454    4.1476    4.1502
    4.1444    4.1454    4.1466    4.1481    4.1500    4.1521    4.1547
    4.1489    4.1499    4.1512    4.1527    4.1545    4.1567    4.1593
    4.1535    4.1545    4.1557    4.1572    4.1591    4.1612    4.1638
    4.1580    4.1590    4.1603    4.1618    4.1636    4.1657    4.1683
    4.1625    4.1635    4.1648    4.1663    4.1681    4.1702    4.1727
    4.1670    4.1680    4.1692    4.1707    4.1725    4.1746    4.1772
    4.1715    4.1725    4.1737    4.1752    4.1770    4.1791    4.1816
    4.1760    4.1769    4.1782    4.1796    4.1814    4.1835    4.1860
    4.1804    4.1814    4.1826    4.1840    4.1858    4.1879    4.1904
    4.1848    4.1858    4.1870    4.1884    4.1902    4.1923    4.1948
    4.1892    4.1902    4.1914    4.1928    4.1946    4.1967    4.1991
    4.1936    4.1945    4.1957    4.1972    4.1989    4.2010    4.2035
    4.1979    4.1989    4.2001    4.2015    4.2033    4.2053    4.2078
    4.2023    4.2032    4.2044    4.2059    4.2076    4.2096    4.2121
    4.2066    4.2075    4.2087    4.2102    4.2119    4.2139    4.2164
    4.2109    4.2118    4.2130    4.2144    4.2161    4.2182    4.2206
    4.2152    4.2161    4.2173    4.2187    4.2204    4.2224    4.2249
    4.2194    4.2204    4.2215    4.2230    4.2246    4.2267    4.2291
    4.2237    4.2246    4.2258    4.2272    4.2289    4.2309    4.2333
    4.2279    4.2288    4.2300    4.2314    4.2331    4.2351    4.2375
    4.2321    4.2330    4.2342    4.2356    4.2373    4.2393    4.2416
    4.2363    4.2372    4.2384    4.2398    4.2414    4.2434    4.2458
    4.2405    4.2414    4.2425    4.2439    4.2456    4.2476    4.2499
    4.2447    4.2456    4.2467    4.2481    4.2497    4.2517    4.2540
    4.2488    4.2497    4.2508    4.2522    4.2538    4.2558    4.2581
    4.2529    4.2538    4.2549    4.2563    4.2579    4.2599    4.2622
    4.2570    4.2579    4.2590    4.2604    4.2620    4.2640    4.2663
    4.2611    4.2620    4.2631    4.2645    4.2661    4.2680    4.2704
    4.2652    4.2661    4.2672    4.2685    4.2702    4.2721    4.2744
    4.2692    4.2701    4.2712    4.2726    4.2742    4.2761    4.2784
    4.2733    4.2742    4.2753    4.2766    4.2782    4.2801    4.2824
    4.2773    4.2782    4.2793    4.2806    4.2822    4.2841    4.2864

  Columns 8 through 14

   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078   -6.9078
   -0.2166   -0.1303   -0.0417    0.0491    0.1418    0.2359    0.3292
    0.2131    0.2857    0.3614    0.4398    0.5209    0.6040    0.6874
    0.4826    0.5471    0.6149    0.6857    0.7594    0.8354    0.9122
    0.6825    0.7414    0.8035    0.8687    0.9370    1.0079    1.0797
    0.8428    0.8973    0.9550    1.0160    1.0800    1.1467    1.2146
    0.9770    1.0280    1.0823    1.1397    1.2003    1.2636    1.3282
    1.0929    1.1410    1.1923    1.2468    1.3044    1.3649    1.4267
    1.1949    1.2406    1.2894    1.3414    1.3965    1.4544    1.5138
    1.2862    1.3297    1.3764    1.4262    1.4791    1.5348    1.5921
    1.3688    1.4106    1.4553    1.5032    1.5541    1.6079    1.6632
    1.4444    1.4845    1.5276    1.5737    1.6229    1.6749    1.7285
    1.5141    1.5527    1.5943    1.6389    1.6865    1.7369    1.7889
    1.5787    1.6160    1.6562    1.6994    1.7456    1.7945    1.8451
    1.6390    1.6751    1.7141    1.7560    1.8008    1.8484    1.8977
    1.6956    1.7306    1.7684    1.8091    1.8527    1.8991    1.9471
    1.7488    1.7828    1.8195    1.8591    1.9017    1.9469    1.9938
    1.7991    1.8321    1.8679    1.9065    1.9480    1.9922    2.0380
    1.8467    1.8789    1.9138    1.9515    1.9920    2.0351    2.0800
    1.8920    1.9234    1.9574    1.9942    2.0339    2.0761    2.1200
    1.9352    1.9658    1.9991    2.0351    2.0738    2.1152    2.1582
    1.9764    2.0064    2.0389    2.0741    2.1121    2.1526    2.1948
    2.0159    2.0452    2.0770    2.1115    2.1487    2.1885    2.2299
    2.0538    2.0825    2.1136    2.1474    2.1839    2.2229    2.2636
    2.0903    2.1183    2.1488    2.1820    2.2178    2.2561    2.2961
    2.1255    2.1527    2.1827    2.2152    2.2504    2.2881    2.3274
    2.1595    2.1859    2.2154    2.2473    2.2819    2.3189    2.3576
    2.1923    2.2180    2.2469    2.2783    2.3123    2.3487    2.3868
    2.2241    2.2491    2.2774    2.3083    2.3417    2.3775    2.4151
    2.2550    2.2792    2.3069    2.3373    2.3702    2.4055    2.4424
    2.2849    2.3084    2.3355    2.3654    2.3978    2.4326    2.4690
    2.3139    2.3368    2.3633    2.3927    2.4246    2.4589    2.4948
    2.3422    2.3644    2.3902    2.4192    2.4506    2.4844    2.5198
    2.3696    2.3912    2.4164    2.4449    2.4759    2.5093    2.5442
    2.3963    2.4174    2.4419    2.4700    2.5006    2.5334    2.5679
    2.4223    2.4429    2.4668    2.4944    2.5245    2.5570    2.5910
    2.4477    2.4677    2.4911    2.5182    2.5479    2.5799    2.6135
    2.4724    2.4920    2.5148    2.5413    2.5707    2.6023    2.6355
    2.4966    2.5156    2.5380    2.5639    2.5929    2.6242    2.6570
    2.5201    2.5388    2.5606    2.5860    2.6146    2.6455    2.6779
    2.5431    2.5614    2.5827    2.6076    2.6358    2.6663    2.6984
    2.5656    2.5835    2.6044    2.6287    2.6566    2.6867    2.7184
    2.5876    2.6051    2.6255    2.6494    2.6768    2.7066    2.7380
    2.6092    2.6263    2.6463    2.6697    2.6967    2.7261    2.7572
    2.6302    2.6470    2.6666    2.6895    2.7161    2.7452    2.7759
    2.6509    2.6673    2.6865    2.7090    2.7351    2.7640    2.7943
    2.6711    2.6872    2.7061    2.7281    2.7538    2.7823    2.8123
    2.6909    2.7067    2.7252    2.7468    2.7720    2.8003    2.8300
    2.7104    2.7258    2.7440    2.7652    2.7900    2.8179    2.8474
    2.7294    2.7446    2.7624    2.7833    2.8076    2.8352    2.8644
    2.7481    2.7631    2.7806    2.8011    2.8249    2.8522    2.8811
    2.7665    2.7812    2.7984    2.8185    2.8420    2.8689    2.8975
    2.7845    2.7989    2.8158    2.8356    2.8587    2.8853    2.9136
    2.8023    2.8164    2.8330    2.8525    2.8752    2.9014    2.9295
    2.8197    2.8336    2.8499    2.8690    2.8914    2.9172    2.9450
    2.8368    2.8504    2.8665    2.8853    2.9073    2.9327    2.9603
    2.8536    2.8670    2.8828    2.9014    2.9230    2.9480    2.9754
    2.8701    2.8834    2.8989    2.9172    2.9385    2.9631    2.9902
    2.8864    2.8994    2.9147    2.9327    2.9537    2.9780    3.0048
    2.9024    2.9152    2.9303    2.9480    2.9687    2.9926    3.0192
    2.9182    2.9308    2.9456    2.9631    2.9834    3.0070    3.0333
    2.9337    2.9461    2.9607    2.9779    2.9980    3.0212    3.0472
    2.9490    2.9612    2.9756    2.9925    3.0123    3.0353    3.0609
    2.9640    2.9761    2.9903    3.0069    3.0265    3.0491    3.0745
    2.9788    2.9907    3.0047    3.0212    3.0404    3.0627    3.0878
    2.9935    3.0052    3.0189    3.0352    3.0542    3.0762    3.1009
    3.0079    3.0194    3.0330    3.0490    3.0677    3.0894    3.1139
    3.0220    3.0334    3.0468    3.0626    3.0811    3.1025    3.1267
    3.0360    3.0473    3.0605    3.0761    3.0943    3.1155    3.1393
    3.0498    3.0609    3.0740    3.0893    3.1073    3.1282    3.1517
    3.0635    3.0744    3.0873    3.1024    3.1202    3.1408    3.1641
    3.0769    3.0877    3.1004    3.1153    3.1329    3.1533    3.1762
    3.0901    3.1008    3.1133    3.1281    3.1454    3.1656    3.1882
    3.1032    3.1137    3.1261    3.1407    3.1578    3.1777    3.2001
    3.1161    3.1265    3.1387    3.1531    3.1701    3.1897    3.2118
    3.1289    3.1391    3.1512    3.1654    3.1821    3.2015    3.2234
    3.1415    3.1516    3.1635    3.1776    3.1941    3.2133    3.2349
    3.1539    3.1639    3.1757    3.1896    3.2059    3.2248    3.2462
    3.1662    3.1760    3.1877    3.2014    3.2175    3.2363    3.2574
    3.1783    3.1880    3.1995    3.2131    3.2291    3.2476    3.2685
    3.1903    3.1999    3.2113    3.2247    3.2405    3.2588    3.2795
    3.2021    3.2116    3.2229    3.2361    3.2517    3.2698    3.2903
    3.2138    3.2232    3.2343    3.2475    3.2629    3.2808    3.3011
    3.2254    3.2347    3.2457    3.2586    3.2739    3.2916    3.3117
    3.2368    3.2460    3.2569    3.2697    3.2848    3.3023    3.3222
    3.2481    3.2572    3.2680    3.2807    3.2956    3.3129    3.3326
    3.2593    3.2683    3.2789    3.2915    3.3062    3.3234    3.3428
    3.2703    3.2792    3.2898    3.3022    3.3168    3.3338    3.3530
    3.2813    3.2901    3.3005    3.3128    3.3272    3.3441    3.3631
    3.2921    3.3008    3.3111    3.3233    3.3376    3.3542    3.3731
    3.3028    3.3114    3.3216    3.3336    3.3478    3.3643    3.3829
    3.3134    3.3219    3.3320    3.3439    3.3579    3.3742    3.3927
    3.3238    3.3323    3.3423    3.3541    3.3679    3.3841    3.4024
    3.3342    3.3426    3.3525    3.3641    3.3779    3.3939    3.4120
    3.3445    3.3527    3.3625    3.3741    3.3877    3.4035    3.4215
    3.3546    3.3628    3.3725    3.3839    3.3974    3.4131    3.4309
    3.3647    3.3728    3.3824    3.3937    3.4071    3.4226    3.4402
    3.3746    3.3827    3.3922    3.4034    3.4166    3.4320    3.4495
    3.3845    3.3924    3.4018    3.4130    3.4261    3.4413    3.4586
    3.3943    3.4021    3.4114    3.4225    3.4354    3.4505    3.4677
    3.4039    3.4117    3.4209    3.4319    3.4447    3.4597    3.4767
    3.4135    3.4212    3.4304    3.4412    3.4539    3.4687    3.4856
    3.4230    3.4306    3.4397    3.4504    3.4630    3.4777    3.4944
    3.4324    3.4399    3.4489    3.4595    3.4720    3.4866    3.5032
    3.4417    3.4492    3.4581    3.4686    3.4810    3.4954    3.5118
    3.4509    3.4583    3.4671    3.4776    3.4898    3.5042    3.5204
    3.4600    3.4674    3.4761    3.4865    3.4986    3.5128    3.5290
    3.4691    3.4764    3.4850    3.4953    3.5074    3.5214    3.5374
    3.4780    3.4853    3.4939    3.5040    3.5160    3.5300    3.5458
    3.4869    3.4941    3.5026    3.5127    3.5246    3.5384    3.5541
    3.4958    3.5029    3.5113    3.5213    3.5330    3.5468    3.5624
    3.5045    3.5115    3.5199    3.5298    3.5415    3.5551    3.5705
    3.5131    3.5201    3.5284    3.5382    3.5498    3.5633    3.5787
    3.5217    3.5287    3.5369    3.5466    3.5581    3.5715    3.5867
    3.5302    3.5371    3.5453    3.5549    3.5663    3.5796    3.5947
    3.5387    3.5455    3.5536    3.5632    3.5744    3.5876    3.6026
    3.5471    3.5538    3.5618    3.5713    3.5825    3.5956    3.6105
    3.5554    3.5621    3.5700    3.5794    3.5905    3.6035    3.6183
    3.5636    3.5702    3.5781    3.5875    3.5985    3.6114    3.6260
    3.5718    3.5784    3.5862    3.5954    3.6064    3.6192    3.6337
    3.5799    3.5864    3.5942    3.6034    3.6142    3.6269    3.6413
    3.5879    3.5944    3.6021    3.6112    3.6220    3.6346    3.6488
    3.5959    3.6023    3.6099    3.6190    3.6297    3.6422    3.6563
    3.6038    3.6102    3.6177    3.6267    3.6373    3.6497    3.6638
    3.6116    3.6180    3.6255    3.6344    3.6449    3.6572    3.6712
    3.6194    3.6257    3.6332    3.6420    3.6524    3.6646    3.6785
    3.6271    3.6334    3.6408    3.6496    3.6599    3.6720    3.6858
    3.6348    3.6410    3.6483    3.6570    3.6673    3.6794    3.6930
    3.6424    3.6485    3.6558    3.6645    3.6747    3.6866    3.7002
    3.6499    3.6560    3.6633    3.6719    3.6820    3.6939    3.7073
    3.6574    3.6635    3.6707    3.6792    3.6893    3.7010    3.7144
    3.6649    3.6709    3.6780    3.6865    3.6965    3.7082    3.7215
    3.6723    3.6782    3.6853    3.6937    3.7036    3.7152    3.7284
    3.6796    3.6855    3.6925    3.7009    3.7107    3.7223    3.7354
    3.6869    3.6927    3.6997    3.7080    3.7178    3.7292    3.7422
    3.6941    3.6999    3.7069    3.7151    3.7248    3.7362    3.7491
    3.7012    3.7070    3.7139    3.7221    3.7317    3.7430    3.7559
    3.7084    3.7141    3.7210    3.7291    3.7386    3.7499    3.7626
    3.7154    3.7212    3.7279    3.7360    3.7455    3.7566    3.7693
    3.7225    3.7281    3.7349    3.7429    3.7523    3.7634    3.7760
    3.7294    3.7351    3.7418    3.7497    3.7591    3.7701    3.7826
    3.7363    3.7419    3.7486    3.7565    3.7658    3.7767    3.7891
    3.7432    3.7488    3.7554    3.7632    3.7725    3.7833    3.7957
    3.7500    3.7556    3.7621    3.7699    3.7791    3.7899    3.8021
    3.7568    3.7623    3.7688    3.7766    3.7857    3.7964    3.8086
    3.7636    3.7690    3.7755    3.7832    3.7922    3.8029    3.8150
    3.7703    3.7757    3.7821    3.7897    3.7988    3.8093    3.8213
    3.7769    3.7823    3.7887    3.7962    3.8052    3.8157    3.8277
    3.7835    3.7888    3.7952    3.8027    3.8116    3.8221    3.8339
    3.7901    3.7954    3.8017    3.8092    3.8180    3.8284    3.8402
    3.7966    3.8018    3.8081    3.8156    3.8243    3.8346    3.8464
    3.8030    3.8083    3.8145    3.8219    3.8306    3.8409    3.8525
    3.8095    3.8147    3.8209    3.8282    3.8369    3.8471    3.8587
    3.8159    3.8210    3.8272    3.8345    3.8431    3.8532    3.8647
    3.8222    3.8274    3.8335    3.8407    3.8493    3.8593    3.8708
    3.8285    3.8336    3.8397    3.8469    3.8554    3.8654    3.8768
    3.8348    3.8399    3.8459    3.8531    3.8615    3.8715    3.8828
    3.8410    3.8461    3.8521    3.8592    3.8676    3.8775    3.8887
    3.8472    3.8522    3.8582    3.8653    3.8736    3.8835    3.8946
    3.8534    3.8584    3.8643    3.8713    3.8796    3.8894    3.9005
    3.8595    3.8645    3.8703    3.8773    3.8856    3.8953    3.9063
    3.8656    3.8705    3.8764    3.8833    3.8915    3.9012    3.9121
    3.8716    3.8765    3.8823    3.8892    3.8974    3.9070    3.9179
    3.8776    3.8825    3.8883    3.8951    3.9033    3.9128    3.9237
    3.8836    3.8884    3.8942    3.9010    3.9091    3.9186    3.9294
    3.8895    3.8943    3.9001    3.9068    3.9149    3.9243    3.9350
    3.8954    3.9002    3.9059    3.9126    3.9206    3.9300    3.9407
    3.9013    3.9061    3.9117    3.9184    3.9264    3.9357    3.9463
    3.9071    3.9119    3.9175    3.9241    3.9320    3.9413    3.9519
    3.9129    3.9176    3.9232    3.9299    3.9377    3.9469    3.9574
    3.9187    3.9234    3.9289    3.9355    3.9433    3.9525    3.9629
    3.9244    3.9291    3.9346    3.9412    3.9489    3.9580    3.9684
    3.9301    3.9347    3.9402    3.9468    3.9545    3.9635    3.9739
    3.9358    3.9404    3.9458    3.9523    3.9600    3.9690    3.9793
    3.9414    3.9460    3.9514    3.9579    3.9655    3.9745    3.9847
    3.9470    3.9516    3.9570    3.9634    3.9710    3.9799    3.9900
    3.9526    3.9571    3.9625    3.9689    3.9764    3.9853    3.9954
    3.9581    3.9626    3.9680    3.9743    3.9818    3.9906    4.0007
    3.9637    3.9681    3.9734    3.9797    3.9872    3.9960    4.0060
    3.9691    3.9736    3.9789    3.9851    3.9926    4.0013    4.0112
    3.9746    3.9790    3.9843    3.9905    3.9979    4.0066    4.0165
    3.9800    3.9844    3.9896    3.9958    4.0032    4.0118    4.0217
    3.9854    3.9898    3.9950    4.0011    4.0085    4.0170    4.0268
    3.9908    3.9951    4.0003    4.0064    4.0137    4.0222    4.0320
    3.9961    4.0004    4.0056    4.0117    4.0189    4.0274    4.0371
    4.0014    4.0057    4.0108    4.0169    4.0241    4.0326    4.0422
    4.0067    4.0110    4.0160    4.0221    4.0293    4.0377    4.0473
    4.0119    4.0162    4.0213    4.0273    4.0344    4.0428    4.0523
    4.0171    4.0214    4.0264    4.0324    4.0395    4.0478    4.0573
    4.0223    4.0266    4.0316    4.0375    4.0446    4.0529    4.0623
    4.0275    4.0317    4.0367    4.0426    4.0496    4.0579    4.0673
    4.0327    4.0368    4.0418    4.0477    4.0547    4.0629    4.0722
    4.0378    4.0419    4.0469    4.0527    4.0597    4.0678    4.0771
    4.0429    4.0470    4.0519    4.0577    4.0647    4.0728    4.0820
    4.0479    4.0520    4.0569    4.0627    4.0696    4.0777    4.0869
    4.0530    4.0571    4.0619    4.0677    4.0745    4.0826    4.0918
    4.0580    4.0620    4.0669    4.0726    4.0794    4.0874    4.0966
    4.0630    4.0670    4.0718    4.0776    4.0843    4.0923    4.1014
    4.0679    4.0720    4.0767    4.0824    4.0892    4.0971    4.1062
    4.0729    4.0769    4.0816    4.0873    4.0940    4.1019    4.1109
    4.0778    4.0818    4.0865    4.0922    4.0988    4.1067    4.1156
    4.0827    4.0866    4.0914    4.0970    4.1036    4.1114    4.1203
    4.0875    4.0915    4.0962    4.1018    4.1084    4.1162    4.1250
    4.0924    4.0963    4.1010    4.1065    4.1131    4.1209    4.1297
    4.0972    4.1011    4.1058    4.1113    4.1179    4.1256    4.1343
    4.1020    4.1059    4.1105    4.1160    4.1226    4.1302    4.1390
    4.1068    4.1106    4.1153    4.1207    4.1272    4.1349    4.1436
    4.1115    4.1154    4.1200    4.1254    4.1319    4.1395    4.1482
    4.1163    4.1201    4.1247    4.1301    4.1365    4.1441    4.1527
    4.1210    4.1248    4.1293    4.1347    4.1411    4.1487    4.1572
    4.1256    4.1294    4.1340    4.1394    4.1457    4.1532    4.1618
    4.1303    4.1341    4.1386    4.1440    4.1503    4.1578    4.1663
    4.1349    4.1387    4.1432    4.1485    4.1548    4.1623    4.1707
    4.1396    4.1433    4.1478    4.1531    4.1594    4.1668    4.1752
    4.1442    4.1479    4.1523    4.1576    4.1639    4.1712    4.1796
    4.1487    4.1525    4.1569    4.1621    4.1684    4.1757    4.1841
    4.1533    4.1570    4.1614    4.1666    4.1728    4.1801    4.1885
    4.1578    4.1615    4.1659    4.1711    4.1773    4.1845    4.1928
    4.1623    4.1660    4.1704    4.1756    4.1817    4.1889    4.1972
    4.1668    4.1705    4.1748    4.1800    4.1861    4.1933    4.2015
    4.1713    4.1750    4.1793    4.1844    4.1905    4.1977    4.2059
    4.1758    4.1794    4.1837    4.1888    4.1949    4.2020    4.2102
    4.1802    4.1838    4.1881    4.1932    4.1992    4.2063    4.2145
    4.1846    4.1882    4.1925    4.1976    4.2036    4.2106    4.2187
    4.1890    4.1926    4.1968    4.2019    4.2079    4.2149    4.2230
    4.1934    4.1970    4.2012    4.2062    4.2122    4.2192    4.2272
    4.1978    4.2013    4.2055    4.2105    4.2165    4.2234    4.2314
    4.2021    4.2056    4.2098    4.2148    4.2207    4.2277    4.2356
    4.2064    4.2099    4.2141    4.2191    4.2250    4.2319    4.2398
    4.2107    4.2142    4.2184    4.2233    4.2292    4.2361    4.2439
    4.2150    4.2185    4.2226    4.2275    4.2334    4.2402    4.2481
    4.2193    4.2227    4.2269    4.2318    4.2376    4.2444    4.2522
    4.2235    4.2270    4.2311    4.2360    4.2417    4.2486    4.2563
    4.2277    4.2312    4.2353    4.2401    4.2459    4.2527    4.2604
    4.2319    4.2354    4.2394    4.2443    4.2500    4.2568    4.2645
    4.2361    4.2395    4.2436    4.2484    4.2541    4.2609    4.2686
    4.2403    4.2437    4.2477    4.2526    4.2583    4.2649    4.2726
    4.2445    4.2479    4.2519    4.2567    4.2623    4.2690    4.2766
    4.2486    4.2520    4.2560    4.2608    4.2664    4.2730    4.2806
    4.2527    4.2561    4.2601    4.2648    4.2705    4.2771    4.2846
    4.2568    4.2602    4.2642    4.2689    4.2745    4.2811    4.2886
    4.2609    4.2643    4.2682    4.2729    4.2785    4.2851    4.2926
    4.2650    4.2683    4.2723    4.2770    4.2825    4.2891    4.2965
    4.2691    4.2724    4.2763    4.2810    4.2865    4.2930    4.3005
    4.2731    4.2764    4.2803    4.2850    4.2905    4.2970    4.3044
    4.2771    4.2804    4.2843    4.2889    4.2944    4.3009    4.3083
    4.2811    4.2844    4.2883    4.2929    4.2984    4.3048    4.3122
    4.2851    4.2884    4.2922    4.2968    4.3023    4.3087    4.3160
    4.2891    4.2923    4.2962    4.3008    4.3062    4.3126    4.3199

  Column 15

   -6.9078
    0.4174
    0.7666
    0.9856
    1.1487
    1.2800
    1.3906
    1.4865
    1.5714
    1.6476
    1.7170
    1.7807
    1.8396
    1.8945
    1.9458
    1.9941
    2.0397
    2.0829
    2.1240
    2.1631
    2.2005
    2.2363
    2.2707
    2.3037
    2.3355
    2.3661
    2.3957
    2.4243
    2.4520
    2.4789
    2.5049
    2.5302
    2.5548
    2.5787
    2.6020
    2.6247
    2.6468
    2.6684
    2.6894
    2.7100
    2.7301
    2.7498
    2.7690
    2.7879
    2.8063
    2.8244
    2.8421
    2.8595
    2.8766
    2.8933
    2.9098
    2.9259
    2.9418
    2.9574
    2.9727
    2.9878
    3.0026
    3.0172
    3.0316
    3.0457
    3.0596
    3.0734
    3.0869
    3.1002
    3.1133
    3.1263
    3.1390
    3.1516
    3.1640
    3.1763
    3.1884
    3.2003
    3.2121
    3.2237
    3.2352
    3.2466
    3.2578
    3.2689
    3.2798
    3.2907
    3.3014
    3.3120
    3.3225
    3.3329
    3.3432
    3.3534
    3.3634
    3.3734
    3.3833
    3.3930
    3.4027
    3.4123
    3.4218
    3.4312
    3.4405
    3.4498
    3.4589
    3.4680
    3.4770
    3.4859
    3.4947
    3.5035
    3.5121
    3.5207
    3.5293
    3.5377
    3.5461
    3.5544
    3.5627
    3.5708
    3.5789
    3.5870
    3.5950
    3.6029
    3.6107
    3.6185
    3.6263
    3.6339
    3.6416
    3.6491
    3.6566
    3.6641
    3.6714
    3.6788
    3.6861
    3.6933
    3.7005
    3.7076
    3.7147
    3.7217
    3.7287
    3.7356
    3.7425
    3.7493
    3.7561
    3.7629
    3.7695
    3.7762
    3.7828
    3.7894
    3.7959
    3.8024
    3.8088
    3.8152
    3.8216
    3.8279
    3.8342
    3.8404
    3.8466
    3.8528
    3.8589
    3.8650
    3.8710
    3.8770
    3.8830
    3.8889
    3.8948
    3.9007
    3.9066
    3.9124
    3.9181
    3.9239
    3.9296
    3.9352
    3.9409
    3.9465
    3.9521
    3.9576
    3.9631
    3.9686
    3.9741
    3.9795
    3.9849
    3.9902
    3.9956
    4.0009
    4.0062
    4.0114
    4.0166
    4.0218
    4.0270
    4.0322
    4.0373
    4.0424
    4.0474
    4.0525
    4.0575
    4.0625
    4.0675
    4.0724
    4.0773
    4.0822
    4.0871
    4.0919
    4.0968
    4.1016
    4.1063
    4.1111
    4.1158
    4.1205
    4.1252
    4.1299
    4.1345
    4.1391
    4.1437
    4.1483
    4.1529
    4.1574
    4.1619
    4.1664
    4.1709
    4.1754
    4.1798
    4.1842
    4.1886
    4.1930
    4.1974
    4.2017
    4.2060
    4.2103
    4.2146
    4.2189
    4.2231
    4.2274
    4.2316
    4.2358
    4.2399
    4.2441
    4.2482
    4.2524
    4.2565
    4.2606
    4.2647
    4.2687
    4.2728
    4.2768
    4.2808
    4.2848
    4.2888
    4.2927
    4.2967
    4.3006
    4.3045
    4.3084
    4.3123
    4.3162
    4.3200
    4.3239
    4.3277

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%%
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

function [mt_ev_condi_z_max, mt_ev_condi_z_max_idx, mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp] = ff_ipwkbz_evf(varargin)
%% FF_IPWKBZ_EVF solves the k' vs b' problem given aggregate savings
% This function follows the structure set up here:
% <https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_wkz_evf.html
% ff_wkz_evf> but now we solve the second stage with percentage choice grid
%
% We solve along a vector of w_n vector, that is an interpolation vector,
% not a vector of actual w choices picked in the first stage. k' choices
% are in terms of percentages. Compared to ff_wkz_evf where we only had an
% upper triangle of choices, now we have a full matrix of percentage
% choices.
%
% @param mt_val matrix state_n I^2 by shock_n. This is the value
% matrix each row is a feasible reachable state given the choice
% vectors/matrix and each column is a shock state.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @return mt_ev_condi_z_max matrix choice_w_n by shock_n
% max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)) conditional on z and w, at the
% optimal k' choice (w=k'+b') what is the expected utility? This is the
% value result from the 2nd stage problem. Note the result integrates over
% z'.
%
% @return mt_ev_condi_z_max_idx matrix choice_w_n by shock_n this is the
% argmax from max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w)). Given the vector of k'
% choices, which index maximized conditional on z and w integrating over
% z'/
%
% @return mt_ev_condi_z_max_kp matrix choice_w_level_n by shock_n the k'
% choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))
%
% @return mt_ev_condi_z_max_bp matrix choice_w_n by shock_n the b'=w-k'
% choice at max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m ffs_ipwkbz_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m ffs_ipwkbz_get_funcgrid>
%

%% Default

params_len = length(varargin);
bl_input_override = 0;
if (params_len == 5)
    bl_input_override = varargin{5};
end
if (bl_input_override)
    % override when called from outside
    [mt_val, param_map, support_map, armt_map, ~] = varargin{:};
else
    clear all;
    close all;
    
    % Not default parameters, but parameters that generate defaults
    it_param_set = 4;
    bl_input_override = true;
    [param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);
    
    support_map('bl_graph_evf') = true;
    support_map('bl_display_evf') = true;
    
%     param_map('it_z_n') = 10;
    
    param_map('it_ak_perc_n') = 250;
    param_map('fl_w_interp_grid_gap') = (param_map('fl_w_max')-param_map('fl_b_bd'))/param_map('it_ak_perc_n');
    
    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
    
    % Generating Defaults
    params_group = values(armt_map, {'ar_a_meshk', 'ar_k_mesha', 'ar_z'});
    [ar_a_meshk, ar_k_mesha, ar_z] = params_group{:};
    params_group = values(func_map, {'f_util_standin'});
    [f_util_standin] = params_group{:};
    mt_val = f_util_standin(ar_z, ar_a_meshk, ar_k_mesha);
end

%% Parse Parameters
params_group = values(armt_map, {'mt_z_trans', 'ar_z',...
    'ar_w_level', 'ar_k_mesha', 'ar_a_meshk', 'mt_k'});
[mt_z_trans, ar_z, ar_w_level, ...
    ar_k_mesha, ar_a_meshk, mt_k] = params_group{:};
params_group = values(param_map, {'it_z_n', 'fl_nan_replace', 'fl_b_bd'});
[it_z_n, fl_nan_replace, fl_b_bd] = params_group{:};
params_group = values(support_map, {'bl_graph_onebyones','bl_display_evf', 'bl_graph_evf'});
[bl_graph_onebyones, bl_display_evf, bl_graph_evf] = params_group{:};
params_group = values(support_map, {'bl_img_save', 'st_img_path', 'st_img_prefix', 'st_img_name_main', 'st_img_suffix'});
[bl_img_save, st_img_path, st_img_prefix, st_img_name_main, st_img_suffix] = params_group{:};

% append function name
st_func_name = 'ff_ipwkbz_evf';
st_img_name_main = [st_func_name st_img_name_main];

%% Integrate *E(V(coh(k',b'), z')|z, w)*
% Each column for a different state z, each value *E(V(coh,z')|z)* integrated already
% Here, each column is a current z, more to right higher EV
% dim(mt_ev_condi_z): *Q by M*
% Note that: mt_ev_condi_z = mt_val*mt_z_trans' is a mistake, that would be
% what we do in the
% <https://fanwangecon.github.io/CodeDynaAsset/m_ipwkbz/paramfunc/html/ffs_ipwkbz_set_functions.html
% ffs_ipwkbz_set_functions> code where we loop over current z, and for each
% current z, grab out a particular row from the mt_z_trans that corresponds
% to a current shock's transition into all future states.
%
% here, each column of mt_val corresponds to a state z, think of that as
% future state z. The input mt_val is *V(coh, z)*, we need to integrate to
% get *E(V(coh,z')|z)*.
%

mt_ev_condi_z = mt_val*mt_z_trans';
if(bl_display_evf)
    disp('mt_ev_condi_z: Q by M');
    disp(size(mt_ev_condi_z));
    summary(array2table(mt_ev_condi_z));
end

%% Reshape *E(V(coh,z'|z,w))* to allow for maxing
% dim(mt_ev_condi_z): *IxJ by M*

[it_mt_bp_rown, it_mt_bp_coln] = size(mt_k);
mt_ev_condi_z_full = reshape(mt_ev_condi_z, [it_mt_bp_rown, it_mt_bp_coln*it_z_n]);

%% Maximize *max_{k'}(E(V(coh(k',b'=w-k'),z'|z,w))* optimal value and index
% Maximization, find optimal k'/b' combination given z and w=k'+b'

[ar_ev_condi_z_max, ar_ev_condi_z_max_idx] = max(mt_ev_condi_z_full);
mt_ev_condi_z_max = reshape(ar_ev_condi_z_max, [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_idx = reshape(ar_ev_condi_z_max_idx, [it_mt_bp_coln, it_z_n]);
if(bl_display_evf)
    disp('mt_ev_condi_z_full: J by IxM');
    disp(size(mt_ev_condi_z_full));
    %     disp(mt_ev_condi_z_full);
    disp('mt_ev_condi_z_max: I by M');
    disp(size(mt_ev_condi_z_max));
    summary(array2table(mt_ev_condi_z_max));
    disp('mt_ev_condi_z_max_idx: I by M');
    disp(size(mt_ev_condi_z_max_idx));
    %     disp(mt_ev_condi_z_max_idx);
end

%% Reindex K' and B' Choices for each State at the Optimal *w'=k'+b'* choice
% The K' and B' Optimal Choices Associated with EV opti
% dim(mt_ev_condi_z_max_kp): *I by M*
ar_add_grid = linspace(0, it_mt_bp_rown*(it_mt_bp_coln-1), it_mt_bp_coln);
mt_ev_condi_z_max_idx = mt_ev_condi_z_max_idx + ar_add_grid';

if(bl_display_evf)
    disp('mt_ev_condi_z_max_idx: I by M');
    disp(size(mt_ev_condi_z_max_idx));
    %     disp(mt_ev_condi_z_max_idx(1:it_mt_bp_coln,:));
end
mt_ev_condi_z_max_kp = reshape(ar_k_mesha(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
mt_ev_condi_z_max_bp = reshape(ar_a_meshk(mt_ev_condi_z_max_idx), [it_mt_bp_coln, it_z_n]);
if(bl_display_evf)
    disp('mt_ev_condi_z_max_kp: I by M');
    disp(size(mt_ev_condi_z_max_kp));
    summary(array2table(mt_ev_condi_z_max_kp));
    disp('mt_ev_condi_z_max_bp: I by M');
    disp(size(mt_ev_condi_z_max_bp));
    summary(array2table(mt_ev_condi_z_max_bp));
end

%% Graph

if (bl_graph_evf)
    
    %% Graph 1, V and EV
    if (~bl_graph_onebyones)
        figure('PaperPosition', [0 0 14 4]);
        hold on;
    end
    
    
    for subplot_j=1:1:2
        
        if (~bl_graph_onebyones)
            hAxis(subplot_j) = subplot(1,2,subplot_j);
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        
        if (subplot_j==1)
            chart = plot(mt_val);
        end
        if (subplot_j==2)
            chart = plot(mt_ev_condi_z);
        end
        
        clr = jet(numel(chart));
        for m = 1:numel(chart)
            set(chart(m),'Color',clr(m,:))
        end
        
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        legend(chart(legend2plot), legendCell(legend2plot), 'Location','southeast');
        
        if (subplot_j==1)
            title('V(coh,zp); w(k+b),k,z');
        end
        if (subplot_j==2)
            title('E_z(V(coh,zp|z))');
        end
        
        ylabel('Next Period Value');
        xlabel({'Index of Cash-on-Hand Discrete Point'...
            'Each Segment is a w=k+b; within segment increasing k'...
            'EV and V identical if shock is fully persistent'});
        grid on;
        grid minor;
    end
    
    % Share y axis
    if (~bl_graph_onebyones)
        linkaxes(hAxis,'y');
    end
    
    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_vev' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    
    %% Graph 2, max(EV)
    
    if(~bl_graph_onebyones)
        figure('PaperPosition', [0 0 7 4]);
    end
    
    for sub_j=1:1:1
        
        if(sub_j==1)
            mt_outcome = mt_ev_condi_z_max;
            st_y_label = 'max_{k''}(E(V(coh(k'',b''=w-k''),z''|z,w))';
        end
        
        if(~bl_graph_onebyones)
            subplot(1,1,sub_j)
        else
            figure('PaperPosition', [0 0 7 4]);
        end
        hold on;
        
        ar_it_z_graph = ([1 round((it_z_n)/4) round(2*((it_z_n)/4)) round(3*((it_z_n)/4)) (it_z_n)]);
        clr = jet(length(ar_it_z_graph));
        i_ctr = 0;
        for i = ar_it_z_graph
            i_ctr = i_ctr + 1;
            ar_x = ar_w_level;
            ar_y = mt_outcome(:, i);
            scatter(ar_x, ar_y, 5, ...
                'MarkerEdgeColor', clr(i_ctr,:), ...
                'MarkerFaceColor', clr(i_ctr,:));
        end
        
        grid on;
        grid minor;
        title(['2nd Stage Exp Value at Optimal K given W=K''+B'''])
        ylabel(st_y_label)
        xlabel({'Aggregate Savings'})
        
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        legendCell{length(legendCell) + 1} = 'max-agg-save';
        legend(legendCell([ar_it_z_graph length(legendCell)]), 'Location','southeast');
        
        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';
        
    end
    
    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_maxev' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    
    %% Graph 3, at max(EV) optimal choice category, color regions, borrow save
    
    % Borrow Vs Save
    [ar_z_mw, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    mt_it_borr_idx = (mt_ev_condi_z_max_bp < 0);
    mt_it_riskyhalf_idx = ((mt_ev_condi_z_max_kp./mt_ev_condi_z_max_bp) > 0.5);
    mt_it_kzero_idx = (mt_ev_condi_z_max_kp == 0);
    mt_it_isnan_idx = (isnan(mt_ev_condi_z_max_kp));
    
    figure('PaperPosition', [0 0 7 4]);
    % States: ar_w, ar_z
    % Choices: mt_ev_condi_z_max_kp, mt_ev_condi_z_max_bp
    hold on;
    it_sca_size = 10;
    chart_br = scatter(ar_w_mz(mt_it_borr_idx),...
        ar_z_mw(mt_it_borr_idx),...
        it_sca_size, 'blue', 'filled');
    %     legend([chart_br], {'Borrow'}, 'Location','northeast');
    chart_khalf = scatter(ar_w_mz(~mt_it_borr_idx & mt_it_riskyhalf_idx),...
        ar_z_mw(~mt_it_borr_idx & mt_it_riskyhalf_idx),...
        it_sca_size, 'black', 'filled');
    %     legend([chart_khalf], {'Save >0.5 K'}, 'Location','northeast');
    chart_sv = scatter(ar_w_mz(~mt_it_borr_idx & ~mt_it_riskyhalf_idx),...
        ar_z_mw(~mt_it_borr_idx & ~mt_it_riskyhalf_idx),...
        it_sca_size, 'red', 'filled');
    %     legend([chart_sv], {'Save <0.5 K'}, 'Location','northeast');
    chart_invalid = scatter(ar_w_mz(mt_it_kzero_idx | mt_it_isnan_idx),...
        ar_z_mw(mt_it_kzero_idx | mt_it_isnan_idx),...
        it_sca_size, 'yellow', 'filled');
    legend([chart_br, chart_khalf, chart_sv, chart_invalid], ...
        {'Borrow','Save >0.5 K','Save <0.5 K', 'k=0 or k=nan'}, 'Location','northeast');
    title('Borrow and Save Regions')
    ylabel('Shocks')
    xlabel({'Total Savings w=k+b'})
    grid on;
    
    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_maxbrsv' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    
    %% Graph 4, Optimal K' and B' Levels
    
    [~, ar_w_mz] = meshgrid(ar_z, ar_w_level);
    for sub_j=1:1:4
        
        if (bl_graph_onebyones)
            figure('PaperPosition', [0 0 7 4]);
        end
        
        if (sub_j==1)
            if(~bl_graph_onebyones)
                figure('PaperPosition', [0 0 14 4]);
                subplot(1,2,sub_j);
            end
            mt_y = mt_ev_condi_z_max_bp;
        end
        if (sub_j==2)
            if(~bl_graph_onebyones)
                subplot(1,2,sub_j);
            end
            
            mt_y = mt_ev_condi_z_max_kp;
        end
        if (sub_j==3)
            if(~bl_graph_onebyones)
                figure('PaperPosition', [0 0 14 4]);
                subplot(1,2,sub_j-2);
            end
            mt_y = zeros(size(mt_ev_condi_z_max_bp));
            mt_it_borr_idx = (mt_ev_condi_z_max_bp < 0);
            mt_y(mt_it_borr_idx) = -mt_ev_condi_z_max_bp(mt_it_borr_idx)/fl_b_bd;
            mt_y(~mt_it_borr_idx) = mt_ev_condi_z_max_bp(~mt_it_borr_idx)./ar_w_mz(~mt_it_borr_idx);
        end
        if (sub_j==4)
            if(~bl_graph_onebyones)
                subplot(1,2,sub_j-2);
            end
            mt_y = mt_ev_condi_z_max_kp./(ar_w_level'-fl_b_bd);
        end
        
        hold on;
        chart = plot(ar_w_level, mt_y);
        clr = jet(numel(chart));
        
        if (length(ar_w_level) <= 100)
            scatter(ar_w_mz(:), mt_y(:), 3, 'filled', 'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');
        end
        
        for m = 1:numel(chart)
            set(chart(m),'Color',clr(m,:))
        end
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/3)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z', 'shock=%3.2f'));
        
        xline0 = xline(0);
        xline0.HandleVisibility = 'off';
        yline0 = yline(0);
        yline0.HandleVisibility = 'off';
        grid on;
        if (sub_j<=2)
            hline = refline([1 0]);
            hline.Color = 'k';
            hline.LineStyle = ':';
            hline.HandleVisibility = 'off';
        end
        
        if (sub_j==1)
            title('B Choices of W');
            ylabel('B Choices');
            xlabel({'Total Savings w=k+b'});
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end
        if (sub_j==2)
            title('K Choices of W');
            ylabel('K Choices');
            xlabel({'Total Savings w=k+b'});
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end
        
        if (sub_j==3)
            title('B Fraction of Borrow Max and Save');
            ylabel('B/bar(B) if br or B/W if sv');
            xlabel({'Total Savings w=k+b'});
            %             set(gca, 'YScale', 'log');
            ylim([-1.1 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northwest');
        end
        if (sub_j==4)
            title('K Fraction Choices of Total K Possible');
            ylabel('K/(W-bar(b)) ');
            xlabel({'Total Savings w=k+b'});
            %             set(gca, 'YScale', 'log');
            ylim([0 1.1]);
            legend(chart(legend2plot), legendCell(legend2plot), 'Location','northeast');
        end
        
    end
    
    % save file
    if (bl_img_save)
        mkdir(support_map('st_img_path'));
        st_file_name = [st_img_prefix st_img_name_main '_wkbopti' st_img_suffix];
        saveas(gcf, strcat(st_img_path, st_file_name));
    end
    
end

end

##### SOURCE END #####
--></body></html>