
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-07-06"><meta name="DC.source" content="ff_ipwkbz_vf_vecsv.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Pre-calculate u(c)</a></li><li><a href="#9">Iterate Value Function</a></li><li><a href="#11">Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)</a></li><li><a href="#12">Solve Second Stage Problem k*(w,z)</a></li><li><a href="#13">Solve First Stage Problem w*(z) given k*(w,z)</a></li><li><a href="#15">A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)</a></li><li><a href="#16">B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp</a></li><li><a href="#17">C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))</a></li><li><a href="#18">D. Compute FULL U(coh_level, w_perc, z) over all w_perc</a></li><li><a href="#19">E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)</a></li><li><a href="#20">F. Store Results</a></li><li><a href="#22">Check Tolerance and Continuation</a></li><li><a href="#24">Process Optimal Choices</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> result_map = ff_ipwkbz_vf_vecsv(varargin)
</pre><h2 id="2">FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic savings and risky capital asset problem with some ar1 shock. This is the two step solution with interpolation and with percentage asset grids version of <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_iwkz_vf_vecsv.html">ff_iwkz_vf_vecsv</a>. See that file for more descriptions.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>keys included in result_map:</p><div><ul><li>mt_val matrix states_n by shock_n matrix of converged value function grid</li><li>mt_pol_a matrix states_n by shock_n matrix of converged policy function grid</li><li>ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function difference between iteration</li><li>ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy function difference between iterations</li><li>mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the proportion of grid points at which policy function changed between current and last iteration for each element of shock</li></ul></div><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ff_ipwkbz_evf.m">ff_ipwkbz_evf</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m">ffs_ipwkbz_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m">ffs_ipwkbz_get_funcgrid</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post.m">ff_akz_vf_post</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);

<span class="comment">% parameters can be set inside ffs_ipwkbz_set_default_param or updated here</span>
<span class="comment">% param_map('it_w_perc_n') = 50;</span>
<span class="comment">% param_map('it_ak_perc_n') = param_map('it_w_perc_n');</span>
<span class="comment">% param_map('it_z_n') = 15;</span>
<span class="comment">% param_map('fl_coh_interp_grid_gap') = 0.025;</span>
<span class="comment">% param_map('it_c_interp_grid_gap') = 0.001;</span>
<span class="comment">% param_map('fl_w_interp_grid_gap') = 0.25;</span>
<span class="comment">% param_map('it_w_perc_n') = 100;</span>
<span class="comment">% param_map('it_ak_perc_n') = param_map('it_w_perc_n');</span>
<span class="comment">% param_map('it_z_n') = 11;</span>
<span class="comment">% param_map('fl_coh_interp_grid_gap') = 0.1;</span>
<span class="comment">% param_map('it_c_interp_grid_gap') = 10^-4;</span>
<span class="comment">% param_map('fl_w_interp_grid_gap') = 0.1;</span>

<span class="comment">% get armt and func map</span>
[armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_ipwkbz_vf_vecsv'</span>;
support_map(<span class="string">'st_profile_name_main'</span>) = [st_func_name support_map(<span class="string">'st_profile_name_main'</span>)];
support_map(<span class="string">'st_mat_name_main'</span>) = [st_func_name support_map(<span class="string">'st_mat_name_main'</span>)];
support_map(<span class="string">'st_img_name_main'</span>) = [st_func_name support_map(<span class="string">'st_img_name_main'</span>)];
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_w_perc'</span>, <span class="string">'ar_w_level'</span>, <span class="string">'ar_z'</span>});
[ar_w_perc, ar_w_level, ar_z] = params_group{:};
params_group = values(armt_map, {<span class="string">'ar_interp_c_grid'</span>, <span class="string">'ar_interp_coh_grid'</span>, <span class="keyword">...</span>
    <span class="string">'ar_a_meshk'</span>, <span class="string">'ar_k_mesha'</span>, <span class="keyword">...</span>
    <span class="string">'mt_interp_coh_grid_mesh_z'</span>, <span class="string">'mt_z_mesh_coh_interp_grid'</span>,<span class="keyword">...</span>
    <span class="string">'mt_interp_coh_grid_mesh_w_perc'</span>,<span class="keyword">...</span>
    <span class="string">'mt_w_by_interp_coh_interp_grid'</span>});
[ar_interp_c_grid, ar_interp_coh_grid, ar_a_meshk, ar_k_mesha, <span class="keyword">...</span>
    mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid, <span class="keyword">...</span>
    mt_interp_coh_grid_mesh_w_perc,<span class="keyword">...</span>
    mt_w_by_interp_coh_interp_grid] = params_group{:};
params_group = values(armt_map, {<span class="string">'mt_coh_wkb'</span>, <span class="string">'mt_z_mesh_coh_wkb'</span>});
[mt_coh_wkb, mt_z_mesh_coh_wkb] = params_group{:};

<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_cons'</span>});
[f_util_log, f_util_crra, f_cons] = params_group{:};

<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="keyword">...</span>
    <span class="string">'fl_nan_replace'</span>, <span class="string">'fl_c_min'</span>, <span class="string">'bl_default'</span>, <span class="string">'fl_default_wprime'</span>});
[it_z_n, fl_crra, fl_beta, fl_nan_replace, fl_c_min, bl_default, fl_default_wprime] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_graph_evf'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_time, bl_graph_evf, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><pre class="codeinput">mt_val_cur = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_k = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_k_cur = mt_pol_k - 1;
mt_pol_idx = zeros(length(ar_interp_coh_grid),length(ar_z));

<span class="comment">% We did not need these in ff_oz_vf or ff_oz_vf_vec</span>
<span class="comment">% see</span>
<span class="comment">% &lt;https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html</span>
<span class="comment">% fs_u_c_partrepeat_main&gt; for why store using cells.</span>
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
cl_w_kstar_interp_z = cell([it_z_n, 1]);
<span class="keyword">for</span> it_z_i = 1:length(ar_z)
    cl_w_kstar_interp_z{it_z_i} = zeros([length(ar_w_perc), length(ar_interp_coh_grid)]) - 1;
<span class="keyword">end</span>
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Pre-calculate u(c)</h2><p>Interpolation, see <a href="https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html">fs_u_c_partrepeat_main</a> for why interpolate over u(c)</p><pre class="codeinput"><span class="comment">% Evaluate</span>
<span class="keyword">if</span> (fl_crra == 1)
    ar_interp_u_of_c_grid = f_util_log(ar_interp_c_grid);
    fl_u_cmin = f_util_log(fl_c_min);
<span class="keyword">else</span>
    ar_interp_u_of_c_grid = f_util_crra(ar_interp_c_grid);
    fl_u_cmin = f_util_crra(fl_c_min);
<span class="keyword">end</span>
ar_interp_u_of_c_grid(ar_interp_c_grid &lt;= fl_c_min) = fl_u_cmin;

<span class="comment">% Get Interpolant</span>
f_grid_interpolant_spln = griddedInterpolant(ar_interp_c_grid, ar_interp_u_of_c_grid, <span class="string">'spline'</span>, <span class="string">'nearest'</span>);
</pre><h2 id="9">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="11">Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)</h2><p>v(coh,z) solved on ar_interp_coh_grid, ar_z grids, see ffs_ipwkbz_get_funcgrid.m. Generate interpolant based on that, Then interpolate for the coh reachable levels given the k(w,z) percentage choice grids in the second stage of the problem</p><pre class="codeinput">    <span class="comment">% Generate Interpolant for v(coh,z)</span>
    f_grid_interpolant_value = griddedInterpolant(<span class="keyword">...</span>
        mt_z_mesh_coh_interp_grid', mt_interp_coh_grid_mesh_z', mt_val_cur', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);

    <span class="comment">% Interpolate for v(coh(k(w,z),b(w,z),z),z)</span>
    mt_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb, mt_coh_wkb);
<span class="comment">%     ar_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb(:), mt_coh_wkb(:));</span>
<span class="comment">%     mt_val_wkb_interpolated = reshape(ar_val_wkb_interpolated, size(mt_z_mesh_coh_wkb));</span>
</pre><h2 id="12">Solve Second Stage Problem k*(w,z)</h2><p>This is the key difference between this function and <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html">ffs_akz_set_functions</a> which solves the two stages jointly Interpolation first, because solution coh grid is not the same as all points reachable by k and b choices given w.</p><pre class="codeinput">    support_map(<span class="string">'bl_graph_evf'</span>) = false;
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        support_map(<span class="string">'bl_graph_evf'</span>) = bl_graph_evf;
    <span class="keyword">end</span>
    bl_input_override = true;
    [mt_ev_condi_z_max, ~, mt_ev_condi_z_max_kp, ~] = <span class="keyword">...</span>
        ff_ipwkbz_evf(mt_val_wkb_interpolated, param_map, support_map, armt_map, bl_input_override);
</pre><h2 id="13">Solve First Stage Problem w*(z) given k*(w,z)</h2><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)
</pre><h2 id="15">A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)</h2><p>Generate interpolant for (2) k*(ar_w_perc) from k*(ar_w_level,z) There are two w=k'+b' arrays. ar_w_level is the level even grid based on which we solve the 2nd stage problem in ff_ipwkbz_evf.m. Here for each coh level, we have a different vector of w levels, but the same vector of percentage ws. So we need to interpolate to get the optimal k* and b* choices at each percentage level of w.</p><pre class="codeinput">        f_interpolante_w_level_kstar_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max_kp(:, it_z_i)', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);

        <span class="comment">% Interpolate (2), shift from w_level to w_perc</span>
        mt_w_kstar_interp_z = f_interpolante_w_level_kstar_z(mt_w_by_interp_coh_interp_grid);
        mt_w_astar_interp_z = mt_w_by_interp_coh_interp_grid - mt_w_kstar_interp_z;

        <span class="comment">% changes in w_perc kstar choices</span>
        mt_w_kstar_diff_idx = (cl_w_kstar_interp_z{it_z_i} ~= mt_w_kstar_interp_z);
</pre><h2 id="16">B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp</h2><p>Note that compared to <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html">ffs_akz_set_functions</a> the mt_c here is much smaller the same number of columns (states) as in the ffs_akz_set_functions file, but the number of rows equal to ar_w length.</p><pre class="codeinput">        ar_c = f_cons(mt_interp_coh_grid_mesh_w_perc(mt_w_kstar_diff_idx), <span class="keyword">...</span>
                      mt_w_astar_interp_z(mt_w_kstar_diff_idx), <span class="keyword">...</span>
                      mt_w_kstar_interp_z(mt_w_kstar_diff_idx));

        ar_it_c_valid_idx = (ar_c &lt;= fl_c_min);
        <span class="comment">% EVAL current utility: N by N, f_util defined earlier</span>
        ar_utility_update = f_grid_interpolant_spln(ar_c);

        <span class="comment">% Update Storage</span>
        <span class="keyword">if</span> (it_iter == 1)
            cl_u_c_store{it_z_i} = reshape(ar_utility_update, [length(ar_w_perc), length(ar_interp_coh_grid)]);
            cl_c_valid_idx{it_z_i} = reshape(ar_it_c_valid_idx, [length(ar_w_perc), length(ar_interp_coh_grid)]);
        <span class="keyword">else</span>
            cl_u_c_store{it_z_i}(mt_w_kstar_diff_idx) = ar_utility_update;
            cl_c_valid_idx{it_z_i}(mt_w_kstar_diff_idx) = ar_it_c_valid_idx;
        <span class="keyword">end</span>
        cl_w_kstar_interp_z{it_z_i} = mt_w_kstar_interp_z;
</pre><h2 id="17">C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))</h2><p>Generate Interpolant for (3) EV(k*(ar_w_perc),Z)</p><pre class="codeinput">        f_interpolante_ev_condi_z_max_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max(:, it_z_i)', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);
        <span class="comment">% Interpolate (3), EVAL add on future utility, N by N + N by N</span>
        mt_ev_condi_z_max_interp_z = f_interpolante_ev_condi_z_max_z(mt_w_by_interp_coh_interp_grid);
</pre><h2 id="18">D. Compute FULL U(coh_level, w_perc, z) over all w_perc</h2><pre class="codeinput">        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_ev_condi_z_max_interp_z;

        <span class="comment">% Index update</span>
        <span class="comment">% using the method below is much faster than index replace</span>
        <span class="comment">% see &lt;https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript&gt;</span>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        <span class="comment">% Default or Not Utility Handling</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if default: only today u(cmin), transition out next period, debt wiped out</span>
            fl_v_default = fl_u_cmin + fl_beta*f_interpolante_ev_condi_z_max_z(fl_default_wprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed: v = u(cmin)</span>
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        <span class="keyword">end</span>

        <span class="comment">% percentage algorithm does not have invalid (check to make sure</span>
        <span class="comment">% min percent is not 0 in ffs_ipwkbz_get_funcgrid.m)</span>
        <span class="comment">% mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_u_neg_c*(mt_it_c_valid_idx);</span>
</pre><h2 id="19">E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)</h2><p>Optimization: remember matlab is column major, rows must be choices, columns must be states <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">COLUMN-MAJOR</a></p><pre class="codeinput">        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);

        <span class="comment">% Generate Linear Opti Index</span>
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;

        ar_opti_aprime_z = mt_w_astar_interp_z(ar_opti_linear_idx_z);
        ar_opti_kprime_z = mt_w_kstar_interp_z(ar_opti_linear_idx_z);
        ar_opti_c_z = f_cons(ar_interp_coh_grid, ar_opti_aprime_z, ar_opti_kprime_z);

        <span class="comment">% Handle Default is optimal or not</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if defaulting is optimal choice, at these states, not required</span>
            <span class="comment">% to default, non-default possible, but default could be optimal</span>
            fl_default_opti_kprime = f_interpolante_w_level_kstar_z(fl_default_wprime);
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_wprime - fl_default_opti_kprime;
            ar_opti_kprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_opti_kprime;
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed, then next period same state as now</span>
            <span class="comment">% this is absorbing state, this is the limiting case, single</span>
            <span class="comment">% state space point, lowest a and lowest shock has this.</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = min(ar_a_meshk);
            ar_opti_kprime_z(ar_opti_c_z &lt;= fl_c_min) = min(ar_k_mesha);
        <span class="keyword">end</span>
</pre><h2 id="20">F. Store Results</h2><pre class="codeinput">        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_k(:,it_z_i) = ar_opti_kprime_z;
        <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_linear_idx_z;
        <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">end</span>
</pre><h2 id="22">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur) + norm(mt_pol_k - mt_pol_k_cur);
    ar_pol_a_perc_change = sum((mt_pol_a ~= mt_pol_a_cur))/(length(ar_interp_coh_grid));
    ar_pol_k_perc_change = sum((mt_pol_k ~= mt_pol_k_cur))/(length(ar_interp_coh_grid));
    mt_pol_perc_change(it_iter, :) = mean([ar_pol_a_perc_change;ar_pol_k_perc_change]);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    mt_pol_k_cur = mt_pol_k;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1);<span class="keyword">...</span>
                                      mean(mt_pol_a_cur,1); <span class="keyword">...</span>
                                      mean(mt_pol_k_cur,1); <span class="keyword">...</span>
                                      mt_val_cur(length(ar_interp_coh_grid),:); <span class="keyword">...</span>
                                      mt_pol_a_cur(length(ar_interp_coh_grid),:); <span class="keyword">...</span>
                                      mt_pol_k_cur(length(ar_interp_coh_grid),:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'mak'</span>, <span class="string">'Hval'</span>, <span class="string">'Hap'</span>, <span class="string">'Hak'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'mkp  = mean(mt_pol_k_cur,1), average choice over k'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_ameshk_n,:), highest a state val'</span>)
        disp(<span class="string">'Hap = mt_pol_a_cur(it_ameshk_n,:), highest a state choice'</span>)
        disp(<span class="string">'mak = mt_pol_k_cur(it_ameshk_n,:), highest k state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><h2 id="24">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_idx'</span>) = mt_pol_idx;

result_map(<span class="string">'cl_mt_coh'</span>) = {mt_interp_coh_grid_mesh_z, zeros(1)};
result_map(<span class="string">'cl_mt_pol_a'</span>) = {mt_pol_a, zeros(1)};
result_map(<span class="string">'cl_mt_pol_k'</span>) = {mt_pol_k, zeros(1)};
result_map(<span class="string">'cl_mt_pol_c'</span>) = {f_cons(mt_interp_coh_grid_mesh_z, mt_pol_a, mt_pol_k), zeros(1)};
result_map(<span class="string">'ar_st_pol_names'</span>) = [<span class="string">"cl_mt_coh"</span>, <span class="string">"cl_mt_pol_a"</span>, <span class="string">"cl_mt_pol_k"</span>, <span class="string">"cl_mt_pol_c"</span>];


<span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);

    <span class="comment">% graphing based on coh_wkb, but that does not match optimal choice</span>
    <span class="comment">% matrixes for graphs.</span>
    armt_map(<span class="string">'mt_coh_wkb'</span>) = mt_interp_coh_grid_mesh_z;
    armt_map(<span class="string">'it_ameshk_n'</span>) = length(ar_interp_coh_grid);
    armt_map(<span class="string">'ar_a_meshk'</span>) = mt_interp_coh_grid_mesh_z(:,1);
    armt_map(<span class="string">'ar_k_mesha'</span>) = zeros(size(mt_interp_coh_grid_mesh_z(:,1)) + 0);

    result_map = ff_akz_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">valgap = norm(mt_val - mt_val_cur): value function difference across iterations
polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations
z1 = z1 perc change: (sum((mt_pol_a ~= mt_pol_a_cur))+sum((mt_pol_k ~= mt_pol_k_cur)))/(2*it_ameshk_n):percentage of state space points conditional on shock where the policy function is changing across iterations
                 valgap      polgap        z1           z2           z3           z4           z5           z6           z7           z8           z9           z10          z11          z12          z13          z14          z15   
                _________    _______    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________

    iter=1         293.83     2146.7            1            1            1            1            1            1            1            1            1            1            1            1            1            1            1
    iter=2         174.54     2523.8            1            1            1            1            1            1            1            1            1            1            1            1            1            1            1
    iter=3         121.43     809.63       0.9987       0.9987       0.9987      0.99806       0.9987      0.99806      0.99741      0.99806      0.99547      0.99482      0.99288      0.99158      0.99158      0.98899      0.99482
    iter=4         101.53     403.48      0.99611      0.99741       0.9987      0.99611      0.99611            1      0.99741      0.99741      0.99547      0.99352      0.99611      0.99352      0.99093      0.98964      0.99093
    iter=5         86.902     251.38      0.99611      0.99611      0.99741      0.99482      0.99611      0.99482      0.99611      0.99547      0.99417      0.99417      0.99288      0.99611      0.99223      0.99093      0.99028
    iter=6          75.39     155.08      0.99223      0.99223      0.99352      0.99482      0.99352      0.99093      0.99482      0.99352      0.99352      0.99158      0.99158      0.98769      0.99482      0.99093      0.99093
    iter=7         65.958     126.25      0.98575      0.97409      0.98575      0.97927      0.98316      0.98575      0.98575      0.99093      0.98575      0.99028      0.98575      0.98575      0.98381       0.9864      0.98446
    iter=8          58.06     90.369      0.51684      0.59715      0.70855       0.8329      0.90415      0.88666      0.87953      0.85039      0.82966      0.83161      0.82513      0.81736      0.80959      0.82383      0.91192
    iter=9         51.324     88.673      0.84585      0.82772      0.80829      0.76425      0.73057      0.69171      0.64637      0.62306      0.60557      0.56218      0.52655      0.59003      0.67876      0.73705      0.71114
    iter=10        45.514     55.565      0.33808      0.29275      0.21762      0.23057      0.28497      0.32772       0.3899      0.44819      0.48446       0.5544      0.61788      0.59715      0.55181      0.53692      0.51166
    iter=11        40.492     67.218      0.53238      0.56736      0.60751      0.60751      0.56088      0.51295      0.46114      0.40285      0.36399      0.31606      0.32189       0.3737      0.40091      0.45078      0.50518
    iter=12        36.109     43.206      0.12824      0.15933      0.20207      0.22668      0.27591      0.29016      0.32772      0.36528      0.39767      0.44301      0.43782      0.38472      0.34456       0.3044      0.34974
    iter=13        32.236     43.091      0.25648      0.20596      0.14378     0.091969      0.11399       0.1399      0.17617      0.21114      0.22798      0.26166      0.27979      0.31865      0.36075      0.39508       0.3465
    iter=14        28.838     48.988      0.33549      0.35622      0.38472      0.40155      0.34845      0.29534      0.23446      0.17098      0.14378      0.17098      0.20725       0.2079      0.23899      0.26684      0.28886
    iter=15        25.842     36.403       0.1671      0.18912      0.19689      0.20725      0.23057      0.25648      0.27073      0.29663      0.30181      0.24352       0.1807      0.16192      0.18782      0.21114       0.2228
    iter=16        23.182     29.485     0.089378      0.10881      0.12047      0.13083      0.14119      0.16451       0.1671      0.18394      0.20984      0.22927      0.25648      0.25907      0.19301      0.16321      0.18264
    iter=17         20.81     26.495     0.047927     0.051813     0.069948     0.086788      0.09456      0.11269      0.13472      0.13212      0.14119      0.15674      0.17746      0.20337      0.23057      0.22798      0.17293
    iter=18         18.69     21.698     0.028497     0.040155     0.040155     0.047927     0.073834      0.07772     0.095855     0.099741      0.10622      0.12565       0.1399      0.16192      0.17098      0.19689      0.20855
    iter=19        16.787     24.683      0.15933      0.11528     0.071244     0.032383     0.041451     0.041451     0.072539     0.072539     0.089378     0.089378      0.10881      0.11528      0.13795      0.13472      0.15026
    iter=20        15.088     28.789      0.16321      0.16969      0.18264      0.17098      0.12435     0.072539     0.045337     0.063472     0.073834     0.085492     0.088083      0.10104      0.10751      0.12435       0.1386
    iter=21        13.569     23.794      0.11399      0.11528      0.12176      0.13731      0.14767      0.14637      0.14249     0.071244     0.044041     0.079016     0.082902     0.083549     0.080311     0.099741      0.11917
    iter=22        12.209     21.457     0.084197      0.09456     0.088083     0.098446      0.10492      0.11269      0.11269      0.13342      0.11269     0.068653     0.056995      0.07772     0.088083     0.086788     0.090674
    iter=23        10.988     17.396     0.059585     0.063472     0.069948     0.069948     0.081606     0.085492     0.090674      0.10233      0.10751      0.12565      0.07772     0.062176     0.073834     0.081606      0.07772
    iter=24        9.8924     17.713     0.046632     0.054404     0.046632     0.059585     0.067358     0.073834     0.068653     0.082902     0.093264      0.09456      0.11269     0.089378     0.055699      0.05829     0.066062
    iter=25        8.9074     11.831     0.040155     0.041451     0.044041     0.049223     0.046632     0.051813     0.060881     0.062176     0.072539     0.081606      0.08614     0.098446     0.085492     0.053109     0.054404
    iter=26        8.0225     16.033     0.031088     0.028497     0.037565      0.03886     0.042746     0.040155     0.053109     0.054404     0.054404     0.073834     0.064767     0.079016     0.084197     0.073834     0.043394
    iter=27        7.2275     15.697     0.023316     0.028497     0.027202     0.034974     0.032383     0.042746     0.044041     0.042746     0.047927     0.053109      0.05829     0.066062     0.069948     0.084197     0.067358
    iter=28         6.513     14.078     0.018135     0.020725     0.020725     0.027202     0.037565     0.042746     0.037565     0.034974     0.041451     0.045337     0.059585     0.056995     0.062176      0.07513     0.084197
    iter=29        5.8694     13.724     0.012953     0.018135     0.020725     0.022021     0.029793     0.023316     0.031088     0.033679     0.034974     0.044041     0.045337     0.062176     0.054404      0.07513     0.071244
    iter=30        5.2886     12.819     0.015544     0.012953     0.015544      0.01943     0.025907     0.024611     0.024611     0.028497     0.032383     0.029793     0.047927     0.044041     0.053109     0.065415      0.07513
    iter=31        4.7642     10.217     0.012953     0.011658     0.012953     0.012953     0.022021     0.022021     0.018135     0.036269     0.028497     0.037565     0.037565     0.033679     0.041451     0.048575     0.056995
    iter=32        4.2904     10.393     0.010363     0.010363     0.012953     0.018135     0.015544     0.014249     0.024611     0.016839     0.027202     0.023316     0.033679     0.032383     0.036269     0.044041     0.044041
    iter=33        3.8626     8.2208    0.0090674     0.007772     0.011658     0.010363     0.012953     0.014249     0.022021     0.023316     0.025907     0.022021     0.031088     0.031088      0.03886      0.03886     0.047927
    iter=34        3.4764     9.4126     0.012953     0.007772    0.0090674     0.010363     0.010363     0.014249      0.01943      0.01943      0.01943      0.01943     0.022021     0.022021     0.024611     0.027202     0.053109
    iter=35        3.1279     6.8834    0.0064767    0.0051813    0.0090674    0.0090674     0.007772     0.007772     0.012953     0.022021      0.01943     0.023316     0.036269     0.027202     0.028497     0.044041     0.033679
    iter=36        2.8135     6.5088    0.0064767     0.007772    0.0064767     0.011658    0.0090674     0.015544     0.007772     0.010363     0.015544     0.015544     0.018135      0.01943     0.023316     0.020725     0.031088
    iter=37        2.5302      7.462     0.003886    0.0051813     0.003886    0.0051813     0.007772     0.010363     0.010363     0.010363     0.018135     0.014896     0.020725     0.023316     0.020725      0.01943     0.033679
    iter=38        2.2751     4.9618     0.003886    0.0064767    0.0051813    0.0064767     0.007772     0.007772    0.0090674    0.0090674     0.015544     0.016839     0.014249     0.016839     0.020725      0.01943     0.022021
    iter=39        2.0455     5.8753    0.0012953    0.0051813     0.003886    0.0051813    0.0064767     0.007772    0.0064767     0.016839     0.007772     0.011658     0.016839      0.01943     0.027202      0.01943     0.023316
    iter=40         1.839     6.1711    0.0025907    0.0012953     0.003886    0.0025907     0.007772    0.0090674     0.007772    0.0064767     0.011658     0.010363     0.011658     0.016839     0.015544     0.016839     0.020725
    iter=41        1.6537     5.5262    0.0025907     0.003886    0.0064767     0.003886    0.0064767     0.007772     0.003886     0.007772    0.0064767    0.0090674     0.012953     0.014249     0.010363     0.018135     0.015544
    iter=42        1.4874     4.4832    0.0025907    0.0012953    0.0012953    0.0064767    0.0025907    0.0090674     0.007772    0.0051813     0.010363     0.012953     0.012953     0.007772     0.015544     0.014249     0.014249
    iter=43        1.3385     4.3822    0.0012953    0.0012953    0.0012953    0.0012953     0.007772     0.003886     0.003886    0.0064767    0.0051813    0.0064767     0.014249     0.011658    0.0090674     0.014249     0.007772
    iter=44        1.2054     6.1089     0.014249            0    0.0025907    0.0012953    0.0012953     0.003886     0.003886    0.0064767     0.003886    0.0090674     0.011658     0.011658    0.0084197    0.0090674     0.014249
    iter=45        1.0866     5.8496     0.012953    0.0025907    0.0012953     0.003886    0.0025907     0.003886    0.0064767    0.0090674     0.012953    0.0051813     0.007772    0.0064767     0.012953    0.0090674     0.011658
    iter=46       0.98083     5.5442     0.014249     0.010363     0.003886    0.0051813     0.003886    0.0012953    0.0051813    0.0025907    0.0051813    0.0051813    0.0051813    0.0064767    0.0084197     0.010363     0.010363
    iter=47       0.88681      6.029     0.012953     0.011658    0.0012953    0.0012953    0.0012953     0.003886    0.0025907    0.0051813     0.007772    0.0051813    0.0025907    0.0025907     0.007772    0.0090674     0.015544
    iter=48        0.8034      5.385    0.0090674     0.011658            0    0.0012953    0.0012953    0.0012953    0.0012953     0.003886     0.007772     0.003886    0.0051813     0.007772    0.0064767     0.007772    0.0090674
    iter=49       0.72955     5.4584     0.010363    0.0090674     0.012953    0.0012953    0.0012953     0.003886    0.0025907    0.0012953     0.003886    0.0025907    0.0012953    0.0051813    0.0051813     0.007772    0.0064767
    iter=50       0.66426     4.7877    0.0090674     0.010363    0.0090674    0.0025907     0.003886    0.0051813    0.0025907    0.0025907    0.0025907    0.0051813    0.0051813     0.003886    0.0051813     0.007772    0.0064767
    iter=87      0.082918     1.4676            0            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0            0
    iter=88      0.078655     1.4145            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0            0            0
    iter=89      0.074582      1.432    0.0012953            0    0.0012953            0            0            0    0.0012953            0            0            0            0            0            0            0            0
    iter=90      0.070691     1.5187            0            0            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0
    iter=91      0.066978          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=92      0.063436          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=93      0.060061     1.6809            0            0            0            0            0            0            0            0            0            0    0.0012953            0            0            0            0
    iter=94      0.056845     1.3286            0    0.0012953            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=95      0.053784     1.4656            0            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0            0
    iter=96      0.050871     1.5864            0            0            0            0            0            0            0            0            0            0    0.0012953            0    0.0012953            0            0
    iter=97      0.048102    0.63707            0            0            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0
    iter=98       0.04547     1.7545            0            0            0            0            0            0            0            0            0            0            0            0            0            0    0.0012953
    iter=99       0.04297          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=100     0.040597          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=101     0.038345          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=102      0.03621     1.7032            0            0            0    0.0012953            0            0            0            0            0            0            0            0    0.0012953            0            0
    iter=103     0.034185          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=104     0.032266          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=105     0.030449          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=106     0.028728          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=107     0.027099     1.5167            0            0            0            0            0    0.0012953            0            0            0            0            0            0            0            0            0
    iter=108     0.025558          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=109     0.024101          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=110     0.022723     1.4595            0            0    0.0012953            0            0            0            0            0    0.0012953            0            0            0            0            0            0
    iter=111      0.02142          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=112     0.020189          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=113     0.019026          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=114     0.017928          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=115     0.016891          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=116     0.015912          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=117     0.014988          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=118     0.014116          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=119     0.013293          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=120     0.012518          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=121     0.011786          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=122     0.011096          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=123     0.010446          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=124    0.0098328          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=125    0.0092551          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=126    0.0087107          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=127    0.0081978          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=128    0.0077146          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=129    0.0072595          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=130    0.0068308          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=131    0.0064271          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=132    0.0060469          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=133     0.005689          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=134     0.005352          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=135    0.0050347          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=136     0.004736          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0

tb_val: V(a,z) value at each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0           -55.057       -54.911       -54.745      -54.561      -54.363       -54.151        -53.139       -52.841       -52.522       -52.187       -51.843       -51.509
    coh2:k=-19.8996,b=0      -55.057       -54.911       -54.745      -54.561      -53.565       -50.314        -34.401       -31.738       -29.569       -27.778       -26.268       -24.989
    coh3:k=-19.7993,b=0      -53.991       -53.872       -51.884      -47.802       -42.78       -37.427        -19.514       -16.406       -13.819       -11.688       -9.9009       -8.4219
    coh4:k=-19.6989,b=0       -51.75       -48.048       -43.391      -38.277      -33.213       -28.509        -15.154       -12.995       -11.092       -9.3561       -7.7891       -6.4287
    coh5:k=-19.5986,b=0      -45.336       -40.874       -36.119      -31.491      -27.233       -23.459        -12.979       -11.023       -9.2444       -7.6274       -6.1878       -4.9567
    coh6:k=-19.4982,b=0        -39.2       -35.045       -30.848      -26.946       -23.47       -20.468         -11.32       -9.5467       -7.9476       -6.4932       -5.1842       -4.0313
    coh7:k=-19.3978,b=0      -34.172       -30.614       -27.093       -23.88      -20.966       -18.337        -10.098       -8.4946       -7.0129       -5.6332       -4.3675       -3.2524
    coh8:k=-19.2975,b=0      -30.291       -27.326       -24.379      -21.578      -18.998       -16.642        -9.1598       -7.6411       -6.2223       -4.8988       -3.6928       -2.6394
    coh9:k=-19.1971,b=0      -27.405       -24.848       -22.239      -19.739      -17.407       -15.266        -8.3576       -6.9089       -5.5617       -4.3078       -3.1556       -2.1324
    coh10:k=-19.0968,b=0      -25.11       -22.832       -20.486      -18.221      -16.104       -14.159        -7.6616       -6.2936       -5.0082       -3.7981       -2.6761       -1.6802
    coh11:k=-18.9964,b=0     -23.233       -21.161       -19.025      -16.962      -15.028       -13.229        -7.0719       -5.7614       -4.5162       -3.3406       -2.2538       -1.2889
    coh12:k=-18.896,b=0       -21.65       -19.754       -17.791      -15.899      -14.104       -12.408        -6.5511       -5.2822        -4.076        -2.937       -1.8841       -0.9435
    coh13:k=-18.7957,b=0     -20.292       -18.547       -16.748      -14.979      -13.285       -11.675        -6.0776       -4.8471       -3.6821       -2.5788       -1.5477      -0.62559
    coh14:k=-18.6953,b=0     -19.137       -17.513       -15.825      -14.156      -12.549        -11.02        -5.6457       -4.4591        -3.327       -2.2477       -1.2385      -0.33656
    coh15:k=-18.595,b=0       -18.12       -16.597       -15.001      -13.417      -11.893       -10.437        -5.2564       -4.1036       -2.9979       -1.9428      -0.95701     -0.075882
    coh16:k=-18.4946,b=0     -17.214       -15.777       -14.259      -12.755      -11.298       -9.9082        -4.8998       -3.7739       -2.6919       -1.6631      -0.69848       0.16853
    coh17:k=-18.3942,b=0     -16.399       -15.036       -13.587      -12.157      -10.763       -9.4214         -4.567       -3.4667       -2.4126        -1.404      -0.45561        0.3976
    coh18:k=-18.2939,b=0     -15.658       -14.359       -12.981      -11.609      -10.268       -8.9709        -4.2555       -3.1835       -2.1502       -1.1603      -0.22693       0.60955
    coh19:k=-18.1935,b=0     -14.981       -13.739       -12.424      -11.104      -9.8076       -8.5534        -3.9663       -2.9165       -1.9038       -0.9303     -0.015273       0.80876
    coh20:k=-18.0932,b=0     -14.363       -13.172       -11.906      -10.633      -9.3784       -8.1683        -3.6939       -2.6659       -1.6707      -0.71617       0.18434       0.99739
    coh21:k=-17.9928,b=0     -13.791       -12.646       -11.424      -10.193      -8.9784       -7.8038        -3.4375       -2.4283       -1.4517       -0.5132       0.37444        1.1766
    coh22:k=-17.8924,b=0     -13.257       -12.156       -10.973      -9.7797      -8.6056       -7.4616         -3.194       -2.2026       -1.2446      -0.32006       0.55571        1.3447
    coh23:k=-17.7921,b=0     -12.758       -11.696        -10.55      -9.3923      -8.2533       -7.1378        -2.9624       -1.9914       -1.0474      -0.13575       0.72692        1.5064
    coh24:k=-17.6917,b=0     -12.288       -11.263       -10.156      -9.0293      -7.9196       -6.8307        -2.7434       -1.7888      -0.85906      0.039907       0.88987        1.6606
    coh25:k=-17.5914,b=0     -11.845       -10.853       -9.7826      -8.6855      -7.6027       -6.5387        -2.5358       -1.5951      -0.67879        0.2056        1.0462        1.8085
    coh26:k=-17.491,b=0      -11.429       -10.468        -9.429      -8.3592      -7.3034       -6.2624        -2.3361       -1.4094      -0.50704       0.36549        1.1964        1.9493
    coh27:k=-17.3906,b=0     -11.035       -10.103       -9.0933      -8.0491      -7.0196       -6.0005        -2.1445       -1.2311      -0.34304       0.51955        1.3409        2.0838
    coh28:k=-17.2903,b=0      -10.66       -9.7552       -8.7735      -7.7535       -6.746       -5.7499        -1.9603       -1.0611      -0.18476       0.66798        1.4785        2.2143
    coh29:k=-17.1899,b=0     -10.302       -9.4229       -8.4671      -7.4726      -6.4856       -5.5096        -1.7831      -0.89807     -0.031894        0.8111        1.6112        2.3402
    coh30:k=-17.0896,b=0     -9.9612       -9.1052       -8.1738      -7.2041      -6.2365       -5.2788        -1.6133       -0.7408       0.11562       0.94754        1.7401        2.4622
    coh31:k=-16.9892,b=0      -9.635       -8.8011       -7.8926      -6.9467      -5.9974       -5.0583        -1.4505      -0.58896       0.25809        1.0795        1.8649        2.5794
    coh32:k=-16.8888,b=0     -9.3225         -8.51        -7.623      -6.6995      -5.7677       -4.8469        -1.2931      -0.44169       0.39458        1.2073        1.9857        2.6924
    coh33:k=-16.7885,b=0     -9.0213        -8.231       -7.3645      -6.4616      -5.5464        -4.643        -1.1408      -0.29901       0.52655        1.3312        2.1021        2.8023
    coh34:k=-16.6881,b=0     -8.7317       -7.9622       -7.1151      -6.2327      -5.3336        -4.446       -0.99368      -0.16104       0.65457        1.4518        2.2144        2.9092
    coh35:k=-16.5878,b=0      -8.453       -7.7031       -6.8745      -6.0125      -5.1291       -4.2552       -0.85108     -0.027982       0.77885        1.5689        2.3234         3.013
    coh36:k=-16.4874,b=0     -8.1845       -7.4531       -6.6421      -5.7989      -4.9313       -4.0706       -0.71172       0.10121       0.89954        1.6818        2.4295         3.114
    coh37:k=-16.387,b=0      -7.9266       -7.2118       -6.4177      -5.5908      -4.7399       -3.8918       -0.57685       0.22672        1.0178        1.7918         2.533        3.2115
    coh38:k=-16.2867,b=0      -7.677       -6.9787       -6.2007      -5.3894      -4.5546       -3.7185       -0.44629       0.34849        1.1325        1.8989        2.6345        3.3065
    coh39:k=-16.1863,b=0     -7.4353       -6.7537        -5.991      -5.1946      -4.3749       -3.5505       -0.31929       0.46636        1.2436         2.003        2.7333        3.3993
    coh40:k=-16.086,b=0      -7.2011       -6.5347       -5.7872      -5.0053      -4.2013       -3.3882       -0.19569       0.58153        1.3519         2.104        2.8291        3.4899
    coh41:k=-15.9856,b=0     -6.9742       -6.3211       -5.5893      -4.8213      -4.0324       -3.2305      -0.075335       0.69485        1.4574        2.2039        2.9226        3.5791
    coh42:k=-15.8852,b=0     -6.7543       -6.1139       -5.3971      -4.6425       -3.868       -3.0771        0.04143       0.80485        1.5603        2.3012        3.0138        3.6661
    coh43:k=-15.7849,b=0     -6.5409       -5.9126       -5.2102      -4.4684      -3.7078       -2.9277        0.15527       0.91212        1.6602        2.3956        3.1025        3.7507
    coh44:k=-15.6845,b=0     -6.3341       -5.7175       -5.0285       -4.299      -3.5513       -2.7822        0.26639        1.0168        1.7578        2.4879        3.1889        3.8332
    coh45:k=-15.5842,b=0     -6.1327       -5.5273        -4.852      -4.1344      -3.3981       -2.6406        0.37493        1.1191        1.8532        2.5782        3.2739        3.9139
    coh46:k=-15.4838,b=0     -5.9365       -5.3419       -4.6798      -3.9738      -3.2485       -2.5029        0.48082         1.219        1.9474        2.6663        3.3577        3.9929
    coh47:k=-15.3834,b=0     -5.7454       -5.1612       -4.5118      -3.8169      -3.1023       -2.3685        0.58517        1.3164        2.0394        2.7523        3.4393        4.0698
    coh48:k=-15.2831,b=0     -5.5592       -4.9851       -4.3477      -3.6636      -2.9594       -2.2369        0.68733        1.4117        2.1296        2.8365        3.5193        4.1451
    coh49:k=-15.1827,b=0     -5.3778       -4.8133       -4.1864      -3.5138      -2.8197       -2.1082        0.78734        1.5051         2.218        2.9191        3.5977        4.2192
    coh50:k=-15.0824,b=0     -5.2009       -4.6457       -4.0286      -3.3674       -2.683       -1.9821        0.88533        1.5966        2.3047        3.0002        3.6748        4.2928
    coh723:k=52.3596,b=0      15.238        15.281        15.331       15.386       15.447        15.514         15.848        15.951        16.062        16.181        16.306        16.429
    coh724:k=52.46,b=0        15.247         15.29         15.34       15.395       15.455        15.522         15.856        15.958        16.069        16.188        16.313        16.436
    coh725:k=52.5603,b=0      15.256        15.298        15.348       15.403       15.464        15.531         15.864        15.966        16.077        16.196         16.32        16.443
    coh726:k=52.6607,b=0      15.265        15.307        15.357       15.412       15.472        15.539         15.872        15.974        16.084        16.203        16.327         16.45
    coh727:k=52.7611,b=0      15.273        15.316        15.366       15.421       15.481        15.547          15.88        15.981        16.092         16.21        16.335        16.457
    coh728:k=52.8614,b=0      15.282        15.325        15.374       15.429       15.489        15.556         15.887        15.989        16.099        16.218        16.342        16.464
    coh729:k=52.9618,b=0      15.291        15.333        15.383       15.438       15.498        15.564         15.895        15.997        16.107        16.225        16.349        16.471
    coh730:k=53.0621,b=0        15.3        15.342        15.392       15.446       15.506        15.572         15.903        16.005        16.114        16.233        16.356        16.478
    coh731:k=53.1625,b=0      15.309        15.351          15.4       15.455       15.515        15.581         15.911        16.012        16.122         16.24        16.363        16.485
    coh732:k=53.2629,b=0      15.318         15.36        15.409       15.463       15.523        15.589         15.919         16.02        16.129        16.247         16.37        16.492
    coh733:k=53.3632,b=0      15.326        15.368        15.418       15.472       15.531        15.597         15.926        16.027        16.137        16.255        16.378        16.499
    coh734:k=53.4636,b=0      15.335        15.377        15.426        15.48        15.54        15.605         15.934        16.035        16.144        16.262        16.385        16.506
    coh735:k=53.5639,b=0      15.344        15.386        15.435       15.489       15.548        15.614         15.942        16.043        16.152        16.269        16.392        16.513
    coh736:k=53.6643,b=0      15.353        15.394        15.443       15.497       15.557        15.622          15.95         16.05        16.159        16.277        16.399         16.52
    coh737:k=53.7647,b=0      15.361        15.403        15.452       15.506       15.565         15.63         15.957        16.058        16.167        16.284        16.406        16.527
    coh738:k=53.865,b=0        15.37        15.412         15.46       15.514       15.573        15.638         15.965        16.066        16.174        16.291        16.413        16.533
    coh739:k=53.9654,b=0      15.379         15.42        15.469       15.523       15.582        15.646         15.973        16.073        16.182        16.298         16.42         16.54
    coh740:k=54.0657,b=0      15.387        15.429        15.477       15.531        15.59        15.655         15.981        16.081        16.189        16.306        16.427        16.547
    coh741:k=54.1661,b=0      15.396        15.437        15.486        15.54       15.598        15.663         15.988        16.088        16.196        16.313        16.434        16.554
    coh742:k=54.2665,b=0      15.405        15.446        15.494       15.548       15.606        15.671         15.996        16.096        16.204         16.32        16.442        16.561
    coh743:k=54.3668,b=0      15.413        15.454        15.503       15.556       15.615        15.679         16.004        16.103        16.211        16.327        16.449        16.568
    coh744:k=54.4672,b=0      15.422        15.463        15.511       15.565       15.623        15.687         16.011        16.111        16.219        16.335        16.456        16.575
    coh745:k=54.5675,b=0      15.431        15.472         15.52       15.573       15.631        15.695         16.019        16.118        16.226        16.342        16.463        16.581
    coh746:k=54.6679,b=0      15.437        15.478        15.526       15.579       15.638        15.703         16.026        16.126        16.233        16.349        16.469        16.588
    coh747:k=54.7683,b=0       15.44        15.482        15.532       15.586       15.646        15.711         16.034        16.133        16.241        16.356        16.476        16.594
    coh748:k=54.8686,b=0      15.449        15.491         15.54       15.595       15.654        15.719         16.042        16.141        16.248        16.363        16.483        16.601
    coh749:k=54.969,b=0       15.457        15.499        15.548       15.603       15.662        15.727         16.049        16.148        16.255         16.37         16.49        16.608
    coh750:k=55.0693,b=0      15.466        15.508        15.557       15.611        15.67        15.735         16.057        16.156        16.263        16.377        16.497        16.615
    coh751:k=55.1697,b=0      15.474        15.516        15.565       15.619       15.679        15.743         16.064        16.163         16.27        16.384        16.504        16.622
    coh752:k=55.2701,b=0      15.483        15.524        15.573       15.627       15.687        15.751         16.072         16.17        16.277        16.392        16.511        16.628
    coh753:k=55.3704,b=0      15.491        15.533        15.582       15.636       15.695        15.759         16.079        16.178        16.284        16.399        16.518        16.635
    coh754:k=55.4708,b=0        15.5        15.541         15.59       15.644       15.703        15.767         16.087        16.185        16.292        16.406        16.525         16.64
    coh755:k=55.5711,b=0      15.508        15.549        15.598       15.652       15.711        15.775         16.095        16.193        16.299        16.413        16.531        16.646
    coh756:k=55.6715,b=0      15.516        15.558        15.606        15.66       15.719        15.783         16.102          16.2        16.306         16.42        16.537        16.651
    coh757:k=55.7719,b=0      15.525        15.566        15.615       15.668       15.727        15.791          16.11        16.207        16.313        16.427        16.544        16.658
    coh758:k=55.8722,b=0      15.533        15.574        15.623       15.676       15.735        15.799         16.117        16.215         16.32        16.433         16.55        16.664
    coh759:k=55.9726,b=0      15.542        15.583        15.631       15.685       15.743        15.807         16.125        16.222        16.328         16.44        16.557        16.671
    coh760:k=56.0729,b=0       15.55        15.591        15.639       15.693       15.751        15.815         16.132        16.229        16.335        16.447        16.564        16.678
    coh761:k=56.1733,b=0      15.558        15.599        15.648       15.701       15.759        15.823         16.139        16.237        16.342        16.454        16.571        16.684
    coh762:k=56.2737,b=0      15.567        15.607        15.656       15.709       15.767        15.831         16.147        16.244        16.349        16.461        16.578        16.691
    coh763:k=56.374,b=0       15.569        15.609        15.658       15.711       15.769        15.833         16.149        16.246        16.351        16.463        16.579        16.692
    coh764:k=56.4744,b=0      15.569         15.61        15.658       15.711       15.769        15.833         16.149        16.246        16.351        16.464         16.58        16.693
    coh765:k=56.5747,b=0       15.57         15.61        15.659       15.712        15.77        15.834          16.15        16.247        16.352        16.464         16.58        16.694
    coh766:k=56.6751,b=0       15.57        15.611        15.659       15.712       15.771        15.834          16.15        16.247        16.352        16.465        16.583          16.7
    coh767:k=56.7755,b=0      15.571        15.611         15.66       15.713       15.771        15.835         16.151        16.248        16.355        16.469        16.589        16.707
    coh768:k=56.8758,b=0      15.571        15.612         15.66       15.713       15.772        15.835         16.156        16.255        16.362        16.476        16.596        16.713
    coh769:k=56.9762,b=0      15.574        15.616        15.665       15.719       15.778        15.843         16.164        16.262        16.369        16.483        16.603         16.72
    coh770:k=57.0765,b=0      15.583        15.624        15.673       15.727       15.786        15.851         16.171        16.269        16.376         16.49        16.609        16.726
    coh771:k=57.1769,b=0      15.591        15.632        15.681       15.735       15.794        15.859         16.178        16.276        16.383        16.497        16.616        16.732
    coh772:k=57.2773,b=0      15.599         15.64        15.689       15.743       15.802        15.866         16.186        16.284         16.39        16.504        16.622        16.737

tb_pol_a: optimal safe savings choice for each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0           -1.6494       -2.0567       -2.4641      -2.8714      -3.2788       -3.6861       -7.7596        -9.389       -11.018       -13.462       -15.907       -18.351 
    coh2:k=-19.8996,b=0      -1.6494       -2.0567       -2.4641      -2.8714          -20           -20           -20           -20           -20           -20           -20           -20 
    coh3:k=-19.7993,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh4:k=-19.6989,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh5:k=-19.5986,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh6:k=-19.4982,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh7:k=-19.3978,b=0      -19.999       -19.999       -19.999          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh8:k=-19.2975,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999           -20           -20           -20           -20           -20           -20 
    coh9:k=-19.1971,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999           -20           -20           -20 
    coh10:k=-19.0968,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh11:k=-18.9964,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh12:k=-18.896,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh13:k=-18.7957,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh14:k=-18.6953,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh15:k=-18.595,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh16:k=-18.4946,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh17:k=-18.3942,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh18:k=-18.2939,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh19:k=-18.1935,b=0     -19.995       -19.998       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh20:k=-18.0932,b=0      -19.94       -19.998       -19.998      -19.998      -19.998       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh21:k=-17.9928,b=0     -19.879       -19.998       -19.998      -19.998      -19.998       -19.998       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh22:k=-17.8924,b=0     -19.792       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.999       -19.999       -19.999 
    coh23:k=-17.7921,b=0     -19.703       -19.967       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.999       -19.999 
    coh24:k=-17.6917,b=0     -19.624         -19.9       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh25:k=-17.5914,b=0     -19.543       -19.827       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh26:k=-17.491,b=0      -19.489       -19.748       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh27:k=-17.3906,b=0     -19.397       -19.663       -19.988      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh28:k=-17.2903,b=0     -19.296       -19.573       -19.949      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh29:k=-17.1899,b=0     -19.211       -19.498       -19.812      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh30:k=-17.0896,b=0     -19.142       -19.425       -19.736      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh31:k=-16.9892,b=0     -19.069       -19.326       -19.679      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh32:k=-16.8888,b=0     -18.935       -19.259        -19.58      -19.997      -19.997       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh33:k=-16.7885,b=0     -18.853       -19.146       -19.517      -19.984      -19.997       -19.997       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh34:k=-16.6881,b=0     -18.767        -19.06        -19.42      -19.894      -19.997       -19.997       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh35:k=-16.5878,b=0     -18.679       -18.983       -19.332      -19.798      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.998       -19.998 
    coh36:k=-16.4874,b=0     -18.588       -18.903       -19.262      -19.663      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh37:k=-16.387,b=0      -18.493        -18.82        -19.19      -19.559      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh38:k=-16.2867,b=0     -18.396       -18.735       -19.114      -19.494      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh39:k=-16.1863,b=0     -18.295       -18.646       -19.036      -19.425      -19.996       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh40:k=-16.086,b=0      -18.222       -18.495       -18.954      -19.354      -19.942       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh41:k=-15.9856,b=0     -18.156       -18.436        -18.87      -19.281      -19.842       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh42:k=-15.8852,b=0     -18.048       -18.335       -18.784      -19.204      -19.759       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh43:k=-15.7849,b=0     -17.938       -18.232       -18.694      -19.125      -19.696       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh44:k=-15.6845,b=0     -17.889       -18.125       -18.602      -19.043      -19.557       -19.996       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh45:k=-15.5842,b=0     -17.784       -18.071       -18.506      -18.957      -19.422       -19.996       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh46:k=-15.4838,b=0     -17.712       -17.981       -18.408      -18.869      -19.331       -19.996       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh47:k=-15.3834,b=0     -17.626       -17.902       -18.345      -18.778       -19.25       -19.954       -19.996       -19.996       -19.996       -19.997       -19.997       -19.997 
    coh48:k=-15.2831,b=0     -17.528       -17.833       -18.283      -18.684      -19.166       -19.889       -19.996       -19.996       -19.996       -19.996       -19.996       -19.997 
    coh49:k=-15.1827,b=0     -17.463       -17.727       -18.063      -18.588       -19.08       -19.821       -19.996       -19.996       -19.996       -19.996       -19.996       -19.996 
    coh50:k=-15.0824,b=0     -17.337        -17.68       -18.023      -18.489      -18.991       -19.751       -19.996       -19.996       -19.996       -19.996       -19.996       -19.996 
    coh723:k=52.3596,b=0      46.416        45.034        45.034       45.034       43.651        42.269         36.86        35.508        32.803        31.451        27.395         24.69 
    coh724:k=52.46,b=0        46.508        45.124        45.124       45.124        43.74        42.355        36.939        35.585        32.877        31.523         27.46        24.752 
    coh725:k=52.5603,b=0        46.6        45.214        45.214       45.214       43.828        42.442        37.018        35.662         32.95        31.594        27.526        24.814 
    coh726:k=52.6607,b=0      46.692        45.304        45.304       45.304       43.916        42.528        37.097        35.739        33.023        31.665        27.592        24.876 
    coh727:k=52.7611,b=0      46.784        45.394        45.394       45.394       44.004        42.615        37.176        35.816        33.096        31.737        27.657        24.938 
    coh728:k=52.8614,b=0      46.876        45.485        45.485       45.485       44.093        42.701        37.254        35.893         33.17        31.808        27.723            25 
    coh729:k=52.9618,b=0      46.969        45.575        45.575       45.575       44.181        42.787        37.333         35.97        33.243        31.879        28.517        25.062 
    coh730:k=53.0621,b=0      47.061        45.665        45.665       45.665       44.269        42.874        37.412        36.047        33.316        31.951         29.22        25.124 
    coh731:k=53.1625,b=0      47.153        45.755        45.755       45.755       44.358         42.96        37.491        36.124        33.896        32.022        29.288        25.186 
    coh732:k=53.2629,b=0      47.245        45.845        45.845       45.845       44.446        43.046         37.57        36.201        34.832        32.093        29.355        25.248 
    coh733:k=53.3632,b=0      47.337        45.936        45.936       45.936       44.534        43.133        37.649        36.278        34.907        32.165        29.423         25.31 
    coh734:k=53.4636,b=0      47.429        46.026        46.026       46.026       44.622        43.219        37.728        36.355        34.982        32.236         29.49        25.372 
    coh735:k=53.5639,b=0      47.521        46.116        46.116       46.116       44.711        43.305        37.807        36.432        35.057        32.308        29.558        25.434 
    coh736:k=53.6643,b=0      47.613        46.206        46.206       46.206       44.799        43.392        37.885        36.509        35.132        32.379        29.626        25.496 
    coh737:k=53.7647,b=0      47.705        46.296        46.296       46.296       44.887        43.478        37.964        36.586        35.207         32.45        29.693        25.558 
    coh738:k=53.865,b=0       47.798        46.387        46.387       46.387       44.976        43.565        38.043        36.663        35.282        32.522        29.761         25.62 
    coh739:k=53.9654,b=0       47.89        46.477        46.477       46.477       45.064        43.651        38.122         36.74        35.357        32.593        29.829        25.682 
    coh740:k=54.0657,b=0      47.982        46.567        46.567       46.567       45.152        43.737        38.201        36.817        35.433        32.664        29.896        25.744 
    coh741:k=54.1661,b=0      48.074        46.657        46.657       46.657        45.24        43.824         38.28        36.894        35.508        32.736        29.964        25.806 
    coh742:k=54.2665,b=0      48.166        46.747        46.747       46.747       45.329         43.91        38.359        36.971        35.583        32.807        30.031        26.521 
    coh743:k=54.3668,b=0      48.258        46.838        46.838       46.838       45.417        43.996        38.437        37.048        35.658        32.878        30.099        27.319 
    coh744:k=54.4672,b=0       48.35        46.928        46.928       46.928       45.505        45.505        38.516        37.125        35.733         32.95        30.167        27.383 
    coh745:k=54.5675,b=0      48.442        47.018        47.018       47.018       45.594        45.594        38.595        37.202        35.808        33.021        30.234        27.447 
    coh746:k=54.6679,b=0      48.535        47.109        47.109       47.109       44.255        44.255        38.674        37.279        35.883        33.093        30.302        27.511 
    coh747:k=54.7683,b=0      47.136        45.739        45.739       45.739       44.342        44.342        38.753        37.356        35.958        33.164        30.369        27.575 
    coh748:k=54.8686,b=0      47.226        45.827        45.827       45.827       44.428        44.428        38.832        37.433        36.033        33.235        30.437        27.639 
    coh749:k=54.969,b=0       47.317        45.916        45.916       45.916       44.515        44.515        40.169         37.51        36.109        33.307        30.505        27.703 
    coh750:k=55.0693,b=0      47.407        46.004        46.004       46.004       44.601        44.601        40.392        37.587        36.184        33.378        30.572        27.766 
    coh751:k=55.1697,b=0      47.497        46.092        46.092       46.092       44.687        44.687        40.473        37.664        36.259        33.449         30.64         27.83 
    coh752:k=55.2701,b=0      47.587         46.18         46.18        46.18       44.774        44.774        40.554        37.741        36.334        33.521        30.707        27.894 
    coh753:k=55.3704,b=0      47.677        46.269        46.269       46.269        44.86         44.86        40.635        37.818        36.409        33.592        30.775        28.763 
    coh754:k=55.4708,b=0      47.767        46.357        46.357       46.357       44.946        44.946        40.715        37.895        36.484        33.663        31.533        29.432 
    coh755:k=55.5711,b=0      47.857        46.445        46.445       46.445       45.033        45.033        40.796        37.972        36.559        33.735        32.323        29.498 
    coh756:k=55.6715,b=0      47.947        46.533        46.533       46.533       45.119        45.119        40.877        38.048        36.634        33.806        32.392        29.103 
    coh757:k=55.7719,b=0      48.037        46.621        46.621       46.621       45.205        45.205        40.957        38.125        36.709        33.877        32.116        28.213 
    coh758:k=55.8722,b=0      48.128         46.71         46.71        46.71       45.292        45.292        41.038        38.202        36.785        33.949        31.113        28.277 
    coh759:k=55.9726,b=0      48.218        46.798        46.798       46.798       45.378        45.378        41.119        38.279         36.86         34.02        31.181        28.341 
    coh760:k=56.0729,b=0      48.308        46.886        46.886       46.886       45.465        45.465          41.2        38.356        36.935        34.092        31.248        28.405 
    coh761:k=56.1733,b=0      48.398        46.974        46.974       46.974       45.551        45.551         41.28        38.433         37.01        34.163        31.316        28.469 
    coh762:k=56.2737,b=0      48.488        47.063        47.063       47.063       45.637        45.637        41.361         38.51        37.085        34.234        31.384        28.533 
    coh763:k=56.374,b=0        48.58        47.154        47.154       47.154       45.728        45.728        41.451          38.6        37.174        34.323        31.471         28.62 
    coh764:k=56.4744,b=0      48.672        47.246        47.246       47.246        45.82         45.82        41.543        38.692        37.266        34.415        31.563        28.712 
    coh765:k=56.5747,b=0      48.764        47.338        47.338       47.338       45.913        45.913        41.635        38.784        37.358        34.507        31.655        27.643 
    coh766:k=56.6751,b=0      48.856         47.43         47.43        47.43       46.005        46.005        41.727        38.876         37.45        34.599        30.507        27.705 
    coh767:k=56.7755,b=0      48.948        47.522        47.522       47.522       46.097        46.097         41.82        38.968        36.185        33.379        30.573        27.768 
    coh768:k=56.8758,b=0       49.04        47.614        47.614       47.614       46.189        44.687        40.473        37.663        36.259        33.449         30.64         27.83 
    coh769:k=56.9762,b=0      47.585        46.178        46.178       46.178       44.771        44.771        40.552        37.739        36.332        33.519        30.706        27.893 
    coh770:k=57.0765,b=0      47.673        46.264        46.264       46.264       44.856        44.856        40.631        37.814        36.405        33.589        30.772        28.697 
    coh771:k=57.1769,b=0      47.761        46.351        46.351       46.351        44.94         44.94         40.71        37.889        36.479        33.658        31.437        29.428 
    coh772:k=57.2773,b=0      47.849        46.437        46.437       46.437       45.025        45.025        40.789        37.964        36.552        33.728        32.316        29.492 

tb_pol_k: optimal risky investment choice for each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0              1.6494        2.0567      2.4641       2.8714        3.2788        3.6861        7.7596         9.389        11.018        13.462        15.907       18.351 
    coh2:k=-19.8996,b=0         1.6494        2.0567      2.4641       2.8714      0.049109      0.063403      0.079739      0.081781      0.081781      0.081781      0.083823     0.083823 
    coh3:k=-19.7993,b=0     0.00020052    0.00020052     0.15131      0.15948       0.15948       0.15948       0.12272       0.10639        0.1023        0.1023        0.1023       0.1023 
    coh4:k=-19.6989,b=0        0.23922       0.24534     0.24534      0.24534       0.23922       0.23309       0.20246       0.19634       0.19021       0.17183       0.15958       0.1412 
    coh5:k=-19.5986,b=0        0.33529       0.33529     0.33529      0.32712       0.31079       0.30262       0.26178       0.24544       0.22094        0.2046        0.2046       0.2046 
    coh6:k=-19.4982,b=0        0.42933       0.41912     0.40891      0.40891        0.3987        0.3987       0.31702        0.3068       0.29659       0.29659       0.28638      0.26596 
    coh7:k=-19.3978,b=0        0.51519       0.50294     0.50294      0.49069       0.47844       0.46618       0.40492       0.39267       0.36817       0.34366       0.31916      0.30691 
    coh8:k=-19.2975,b=0        0.60106       0.60106     0.58676      0.57247       0.55817       0.52959       0.47241       0.44382       0.41523       0.40094       0.40094      0.40094 
    coh9:k=-19.1971,b=0        0.68692       0.68692     0.67059      0.63791       0.62158       0.60524        0.5399       0.50722       0.50722       0.49089       0.47455      0.44188 
    coh10:k=-19.0968,b=0       0.77279       0.75441     0.73603      0.71765       0.69927       0.69927       0.60738       0.58901       0.57063       0.55225       0.51549      0.51549 
    coh11:k=-18.9964,b=0       0.85865       0.83823     0.81781      0.79739       0.79739       0.77697       0.69529       0.67487       0.63403       0.61361       0.59319      0.59319 
    coh12:k=-18.896,b=0        0.92206       0.92206     0.89959      0.89959       0.87713       0.85467       0.76482       0.74236       0.69743       0.69743       0.67497      0.65251 
    coh13:k=-18.7957,b=0        1.0059        1.0059     0.98137      0.98137       0.95687       0.90786       0.83435       0.80984       0.78534       0.76084       0.73633      0.71183 
    coh14:k=-18.6953,b=0        1.0897        1.0897      1.0632       1.0366        1.0101        1.0101       0.90388       0.90388       0.87733       0.82424       0.79769      0.79769 
    coh15:k=-18.595,b=0         1.2021        1.1735      1.1449       1.1163        1.1163        1.0878         1.002       0.97341       0.94482       0.91623       0.88764      0.85905 
    coh16:k=-18.4946,b=0        1.2573        1.2573      1.2267       1.1961        1.1961        1.1655        1.0736        1.0429        1.0123       0.98168       0.95105      0.92041 
    coh17:k=-18.3942,b=0        1.3412        1.3412      1.3085       1.3085        1.2758        1.2432        1.1451        1.1125        1.0798        1.0798        1.0144       1.0144 
    coh18:k=-18.2939,b=0         1.425         1.425      1.3903       1.3903        1.3556        1.3209        1.2167         1.182         1.182        1.1473        1.1126       1.0779 
    coh19:k=-18.1935,b=0        1.5049        1.5088      1.4721       1.4721        1.4353        1.3985        1.2883        1.2883        1.2515        1.2148         1.178        1.178 
    coh20:k=-18.0932,b=0         1.534        1.5926      1.5538       1.5538         1.515        1.4762        1.3986        1.3599        1.3211        1.2823        1.2823       1.2435 
    coh21:k=-17.9928,b=0        1.5572        1.6765      1.6356       1.6356        1.5948        1.5948        1.4723        1.4314        1.3906        1.3906        1.3497       1.3089 
    coh22:k=-17.8924,b=0        1.5538        1.7603      1.7174       1.7174        1.6745        1.6745        1.5459         1.503         1.503        1.4601        1.4172       1.3743 
    coh23:k=-17.7921,b=0        1.5494        1.8125      1.7992       1.7992        1.7543        1.7543        1.6195        1.5746        1.5746        1.5296        1.4847       1.4847 
    coh24:k=-17.6917,b=0        1.5543        1.8294       1.881        1.881         1.834         1.834        1.6931        1.6931        1.6461        1.5992        1.5992       1.5522 
    coh25:k=-17.5914,b=0        1.5572        1.8408      1.9627       1.9627        1.9137        1.9137        1.7667        1.7667        1.7177        1.6687        1.6687       1.6197 
    coh26:k=-17.491,b=0         1.5863         1.846      2.0445       2.0445        1.9935        1.9935        1.8914        1.8403        1.7893        1.7893        1.7382       1.6872 
    coh27:k=-17.3906,b=0        1.5785        1.8451      2.1163       2.1263        2.1263        2.0732         1.967        1.9139        1.8608        1.8608        1.8078       1.8078 
    coh28:k=-17.2903,b=0        1.5618        1.8386      2.1593       2.2081        2.2081         2.153        2.0427        1.9876        1.9876        1.9324        1.8773       1.8773 
    coh29:k=-17.1899,b=0        1.5605        1.8476      2.1616       2.2899        2.2899        2.2327        2.1183        2.0612        2.0612         2.004        1.9468       1.9468 
    coh30:k=-17.0896,b=0        1.5749        1.8588      2.1696       2.3717        2.3717        2.3124         2.194        2.1348        2.1348        2.0756        2.0756       2.0163 
    coh31:k=-16.9892,b=0        1.5865        1.8429      2.1964       2.4534        2.4534        2.3922        2.2697        2.2084        2.2084        2.1471        2.1471       2.0859 
    coh32:k=-16.8888,b=0        1.5994        1.8601      2.1811       2.5352        2.5352        2.4719        2.3453        2.3453         2.282        2.2187        2.2187       2.1554 
    coh33:k=-16.7885,b=0         1.603        1.8314      2.2022       2.6036         2.617        2.5517         2.421         2.421        2.3556        2.3556        2.2903       2.2903 
    coh34:k=-16.6881,b=0        1.6036        1.8289      2.1888       2.5954        2.6988        2.6988        2.4966        2.4966        2.4292        2.4292        2.3618       2.3618 
    coh35:k=-16.5878,b=0        1.6014        1.8357      2.1844       2.5809        2.7806        2.7806        2.6417        2.5723        2.5028        2.5028        2.4334       2.4334 
    coh36:k=-16.4874,b=0        1.5962        1.8398      2.1987          2.6        2.8623        2.8623        2.7194        2.6479        2.6479        2.5765         2.505        2.505 
    coh37:k=-16.387,b=0         1.5876        1.8411      2.2102       2.5794        2.9441        2.9441        2.7971        2.7236        2.7236        2.6501        2.6501       2.5766 
    coh38:k=-16.2867,b=0         1.576        1.8395      2.2189       2.5982        3.0259        3.0259        2.8748        2.7992        2.7992        2.7237        2.7237       2.6481 
    coh39:k=-16.1863,b=0        1.5615        1.8346      2.2242       2.6139        3.1064        3.1077        2.9525        2.8749        2.8749        2.7973        2.7973       2.7197 
    coh40:k=-16.086,b=0         1.5736        1.8467      2.2269       2.6268        3.1349        3.1895        3.0302        3.0302        2.9506        2.9506        2.8709       2.8709 
    coh41:k=-15.9856,b=0        1.5938        1.8739      2.2268       2.6369        3.1167        3.2712        3.1079        3.1079        3.0262        3.0262        2.9445       2.9445 
    coh42:k=-15.8852,b=0        1.5723        1.8594      2.2239       2.6443        3.1154         3.353        3.1856        3.1856        3.1019        3.1019        3.0181       3.0181 
    coh43:k=-15.7849,b=0        1.5479         1.842      2.2183       2.6489        3.1344        3.4348        3.2633        3.2633        3.1775        3.1775        3.0918       3.0918 
    coh44:k=-15.6845,b=0        1.5845        1.8211      2.2098       2.6507        3.1651        3.5166         3.341         3.341        3.2532        3.2532        3.1654       3.1654 
    coh45:k=-15.5842,b=0        1.5662        1.8524       2.198       2.6492        3.1141        3.5984        3.4187        3.4187        3.3288        3.3288        3.3288        3.239 
    coh46:k=-15.4838,b=0        1.5794        1.8493      2.1835       2.6449        3.1063        3.6802        3.4964        3.4964        3.4964        3.4045        3.4045       3.3126 
    coh47:k=-15.3834,b=0        1.5798        1.8561       2.205       2.6379        3.1096        3.7193         3.668        3.5741        3.5741        3.4801        3.4801       3.3862 
    coh48:k=-15.2831,b=0        1.5673        1.8728      2.2265       2.6281          3.11        3.7362        3.7477        3.6518        3.6518        3.5558        3.5558       3.4598 
    coh49:k=-15.1827,b=0        1.5888        1.8528      2.1889       2.6156        3.1078        3.7506        3.8275        3.7295        3.7295        3.6314        3.6314       3.6314 
    coh50:k=-15.0824,b=0        1.5486        1.8914      2.2345       2.6003        3.1027        3.7623        3.9072        3.8072        3.8072        3.7071        3.7071       3.7071 
    coh723:k=52.3596,b=0        1.4501        2.8324      2.8324       2.8324        4.2146        4.1231         9.532        10.884        13.589        14.941        18.998       21.702 
    coh724:k=52.46,b=0          1.4521        2.8363      2.8363       2.8363        4.2205        4.1288        9.5452        10.899        13.608        14.962        19.024       21.732 
    coh725:k=52.5603,b=0        1.4541        2.8402      2.8402       2.8402        4.2263        4.1345        9.5585        10.914        13.626        14.982         19.05       21.762 
    coh726:k=52.6607,b=0        1.4561        2.8441      2.8441       2.8441        4.2321        4.1402        9.5717         10.93        13.645        15.003        19.077       21.792 
    coh727:k=52.7611,b=0        1.4582        2.8481      2.8481       2.8481         4.238         4.146        9.5849        10.945        13.664        15.024        19.103       21.823 
    coh728:k=52.8614,b=0        1.4602         2.852       2.852        2.852        4.2438        4.1517        9.5981         10.96        13.683        15.045        19.129       21.853 
    coh729:k=52.9618,b=0        1.4622        2.8559      2.8559       2.8559        4.2497        4.1574        9.6113        10.975        13.702        15.065        18.427       21.883 
    coh730:k=53.0621,b=0        1.4642        2.8599      2.8599       2.8599        4.2555        4.1631        9.6246         10.99        13.721        15.086        17.817       21.913 
    coh731:k=53.1625,b=0        1.4662        2.8638      2.8638       2.8638        4.2614        4.1688        9.6378        11.005        13.233        15.107        17.841       21.943 
    coh732:k=53.2629,b=0        1.4682        2.8677      2.8677       2.8677        4.2672        4.1746         9.651         11.02        12.389        15.127        17.866       21.973 
    coh733:k=53.3632,b=0        1.4702        2.8716      2.8716       2.8716        4.2731        4.1803        9.6642        11.035        12.406        15.148         17.89       22.003 
    coh734:k=53.4636,b=0        1.4722        2.8756      2.8756       2.8756        4.2789         4.186        9.6774         11.05        12.423        15.169        17.915       22.033 
    coh735:k=53.5639,b=0        1.4743        2.8795      2.8795       2.8795        4.2848        4.1917        9.6907        11.065         12.44         15.19        17.939       22.063 
    coh736:k=53.6643,b=0        1.4763        2.8834      2.8834       2.8834        4.2906        4.1974        9.7039         11.08        12.457         15.21        17.964       22.093 
    coh737:k=53.7647,b=0        1.4783        2.8874      2.8874       2.8874        4.2965        4.2031        9.7171        11.096        12.474        15.231        17.988       22.124 
    coh738:k=53.865,b=0         1.4803        2.8913      2.8913       2.8913        4.3023        4.2089        9.7303        11.111        12.491        15.252        18.013       22.154 
    coh739:k=53.9654,b=0        1.4823        2.8952      2.8952       2.8952        4.3081        4.2146        9.7435        11.126        12.508        15.273        18.037       22.184 
    coh740:k=54.0657,b=0        1.4843        2.8991      2.8991       2.8991         4.314        4.2203        9.7568        11.141        12.525        15.293        18.061       22.214 
    coh741:k=54.1661,b=0        1.4863        2.9031      2.9031       2.9031        4.3198         4.226          9.77        11.156        12.542        15.314        18.086       22.244 
    coh742:k=54.2665,b=0        1.4883         2.907       2.907        2.907        4.3257        4.2317        9.7832        11.171        12.559        15.335         18.11        21.62 
    coh743:k=54.3668,b=0        1.4903        2.9109      2.9109       2.9109        4.3315        4.2375        9.7964        11.186        12.576        15.355        18.135       20.914 
    coh744:k=54.4672,b=0        1.4924        2.9149      2.9149       2.9149        4.3374        4.3374        9.8096        11.201        12.593        15.376        18.159       20.943 
    coh745:k=54.5675,b=0        1.4944        2.9188      2.9188       2.9188        4.3432        4.3432        9.8229        11.216         12.61        15.397        18.184       20.971 
    coh746:k=54.6679,b=0        1.4957        2.9214      2.9214       2.9214        4.2546        4.2546        9.8361        11.231        12.627        15.418        18.208       20.999 
    coh747:k=54.7683,b=0        1.4658        2.8631      2.8631       2.8631        4.2603        4.2603        9.8493        11.247        12.644        15.438        18.233       21.027 
    coh748:k=54.8686,b=0        1.4678        2.8669      2.8669       2.8669        4.2661        4.2661        9.8625        11.262        12.661        15.459        18.257       21.055 
    coh749:k=54.969,b=0         1.4698        2.8708      2.8708       2.8708        4.2718        4.2718        8.6175        11.277        12.678         15.48        18.282       21.084 
    coh750:k=55.0693,b=0        1.4717        2.8746      2.8746       2.8746        4.2775        4.2775        8.4861        11.292        12.695          15.5        18.306       21.112 
    coh751:k=55.1697,b=0        1.4737        2.8785      2.8785       2.8785        4.2832        4.2832        8.4974        11.307        12.712        15.521        18.331        21.14 
    coh752:k=55.2701,b=0        1.4757        2.8823      2.8823       2.8823        4.2889        4.2889        8.5088        11.322        12.729        15.542        18.355       21.168 
    coh753:k=55.3704,b=0        1.4777        2.8861      2.8861       2.8861        4.2946        4.2946        8.5201        11.337        12.746        15.563         18.38       20.392 
    coh754:k=55.4708,b=0        1.4796          2.89        2.89         2.89        4.3004        4.3004        8.5315        11.352        12.763        15.583        17.714       19.814 
    coh755:k=55.5711,b=0        1.4816        2.8938      2.8938       2.8938        4.3061        4.3061        8.5428        11.367         12.78        15.604        17.016       19.841 
    coh756:k=55.6715,b=0        1.4836        2.8977      2.8977       2.8977        4.3118        4.3118        8.5542        11.382        12.797        15.625        17.039       20.328 
    coh757:k=55.7719,b=0        1.4855        2.9015      2.9015       2.9015        4.3175        4.3175        8.5655        11.398        12.814        15.646        17.407        21.31 
    coh758:k=55.8722,b=0        1.4875        2.9054      2.9054       2.9054        4.3232        4.3232        8.5769        11.413         12.83        15.666        18.502       21.338 
    coh759:k=55.9726,b=0        1.4895        2.9092      2.9092       2.9092         4.329         4.329        8.5882        11.428        12.847        15.687        18.526       21.366 
    coh760:k=56.0729,b=0        1.4914        2.9131      2.9131       2.9131        4.3347        4.3347        8.5996        11.443        12.864        15.708        18.551       21.394 
    coh761:k=56.1733,b=0        1.4934        2.9169      2.9169       2.9169        4.3404        4.3404        8.6109        11.458        12.881        15.728        18.575       21.422 
    coh762:k=56.2737,b=0        1.4954        2.9207      2.9207       2.9207        4.3461        4.3461        8.6222        11.473        12.898        15.749          18.6       21.451 
    coh763:k=56.374,b=0         1.4957        2.9214      2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.456 
    coh764:k=56.4744,b=0        1.4957        2.9214      2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.456 
    coh765:k=56.5747,b=0        1.4957        2.9214      2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.057 
    coh766:k=56.6751,b=0        1.4957        2.9214      2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.283       21.085 
    coh767:k=56.7755,b=0        1.4957        2.9214      2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.695        15.501        18.307       21.112 
    coh768:k=56.8758,b=0        1.4957        2.9214      2.9214       2.9214        4.3471        4.2832        8.4974        11.307        12.712        15.521        18.331        21.14 
    coh769:k=56.9762,b=0        1.4756        2.8822      2.8822       2.8822        4.2888        4.2888        8.5085        11.322        12.728        15.541        18.355       21.168 
    coh770:k=57.0765,b=0        1.4776         2.886       2.886        2.886        4.2944        4.2944        8.5196        11.336        12.745        15.562        18.378       20.453 
    coh771:k=57.1769,b=0        1.4795        2.8897      2.8897       2.8897           4.3           4.3        8.5307        11.351        12.761        15.582        17.803       19.813 
    coh772:k=57.2773,b=0        1.4814        2.8935      2.8935       2.8935        4.3056        4.3056        8.5418        11.366        12.778        15.602        17.014       19.838 

tb_pol_w: risky + safe investment choices (first stage choice, choose within risky vs safe)
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0                 0             0             0            0            0             0             0             0             0             0             0             0 
    coh2:k=-19.8996,b=0            0             0             0            0      -19.951       -19.937        -19.92       -19.918       -19.918       -19.918       -19.916       -19.916 
    coh3:k=-19.7993,b=0          -20           -20       -19.849       -19.84       -19.84        -19.84       -19.877       -19.894       -19.898       -19.898       -19.898       -19.898 
    coh4:k=-19.6989,b=0      -19.761       -19.754       -19.754      -19.754      -19.761       -19.767       -19.797       -19.803        -19.81       -19.828        -19.84       -19.859 
    coh5:k=-19.5986,b=0      -19.664       -19.664       -19.664      -19.673      -19.689       -19.697       -19.738       -19.754       -19.779       -19.795       -19.795       -19.795 
    coh6:k=-19.4982,b=0       -19.57        -19.58       -19.591      -19.591      -19.601       -19.601       -19.683       -19.693       -19.703       -19.703       -19.713       -19.734 
    coh7:k=-19.3978,b=0      -19.484       -19.497       -19.497      -19.509      -19.521       -19.533       -19.595       -19.607       -19.631       -19.656       -19.681       -19.693 
    coh8:k=-19.2975,b=0      -19.398       -19.398       -19.413      -19.427      -19.441        -19.47       -19.527       -19.556       -19.584       -19.599       -19.599       -19.599 
    coh9:k=-19.1971,b=0      -19.312       -19.312       -19.329      -19.361      -19.378       -19.394        -19.46       -19.492       -19.492       -19.509       -19.525       -19.558 
    coh10:k=-19.0968,b=0     -19.226       -19.245       -19.263      -19.282        -19.3         -19.3       -19.392        -19.41       -19.429       -19.447       -19.484       -19.484 
    coh11:k=-18.9964,b=0      -19.14       -19.161       -19.181      -19.202      -19.202       -19.222       -19.304       -19.324       -19.365       -19.386       -19.406       -19.406 
    coh12:k=-18.896,b=0      -19.077       -19.077         -19.1        -19.1      -19.122       -19.144       -19.234       -19.257       -19.302       -19.302       -19.324       -19.347 
    coh13:k=-18.7957,b=0     -18.993       -18.993       -19.018      -19.018      -19.042       -19.091       -19.165       -19.189       -19.214       -19.238       -19.263       -19.287 
    coh14:k=-18.6953,b=0     -18.909       -18.909       -18.936      -18.962      -18.989       -18.989       -19.095       -19.095       -19.122       -19.175       -19.202       -19.202 
    coh15:k=-18.595,b=0      -18.797       -18.825       -18.854      -18.883      -18.883       -18.911       -18.997       -19.026       -19.054       -19.083       -19.111        -19.14 
    coh16:k=-18.4946,b=0     -18.741       -18.741       -18.772      -18.803      -18.803       -18.833       -18.925       -18.956       -18.987       -19.017       -19.048       -19.079 
    coh17:k=-18.3942,b=0     -18.657       -18.657        -18.69       -18.69      -18.723       -18.756       -18.854       -18.886       -18.919       -18.919       -18.985       -18.985 
    coh18:k=-18.2939,b=0     -18.574       -18.574       -18.608      -18.608      -18.643       -18.678       -18.782       -18.817       -18.817       -18.852       -18.886       -18.921 
    coh19:k=-18.1935,b=0      -18.49        -18.49       -18.526      -18.526      -18.563         -18.6        -18.71        -18.71       -18.747       -18.784       -18.821       -18.821 
    coh20:k=-18.0932,b=0     -18.406       -18.406       -18.445      -18.445      -18.483       -18.522         -18.6       -18.639       -18.678       -18.716       -18.716       -18.755 
    coh21:k=-17.9928,b=0     -18.322       -18.322       -18.363      -18.363      -18.404       -18.404       -18.526       -18.567       -18.608       -18.608       -18.649        -18.69 
    coh22:k=-17.8924,b=0     -18.238       -18.238       -18.281      -18.281      -18.324       -18.324       -18.453       -18.496       -18.496       -18.538       -18.581       -18.624 
    coh23:k=-17.7921,b=0     -18.154       -18.154       -18.199      -18.199      -18.244       -18.244       -18.379       -18.424       -18.424       -18.469       -18.514       -18.514 
    coh24:k=-17.6917,b=0      -18.07        -18.07       -18.117      -18.117      -18.164       -18.164       -18.305       -18.305       -18.352       -18.399       -18.399       -18.446 
    coh25:k=-17.5914,b=0     -17.986       -17.986       -18.035      -18.035      -18.084       -18.084       -18.232       -18.232       -18.281        -18.33        -18.33       -18.379 
    coh26:k=-17.491,b=0      -17.902       -17.902       -17.953      -17.953      -18.005       -18.005       -18.107       -18.158       -18.209       -18.209        -18.26       -18.311 
    coh27:k=-17.3906,b=0     -17.818       -17.818       -17.872      -17.872      -17.872       -17.925       -18.031       -18.084       -18.137       -18.137        -18.19        -18.19 
    coh28:k=-17.2903,b=0     -17.735       -17.735        -17.79       -17.79       -17.79       -17.845       -17.955        -18.01        -18.01       -18.066       -18.121       -18.121 
    coh29:k=-17.1899,b=0     -17.651       -17.651       -17.651      -17.708      -17.708       -17.765        -17.88       -17.937       -17.937       -17.994       -18.051       -18.051 
    coh30:k=-17.0896,b=0     -17.567       -17.567       -17.567      -17.626      -17.626       -17.685       -17.804       -17.863       -17.863       -17.922       -17.922       -17.982 
    coh31:k=-16.9892,b=0     -17.483       -17.483       -17.483      -17.544      -17.544       -17.605       -17.728       -17.789       -17.789       -17.851       -17.851       -17.912 
    coh32:k=-16.8888,b=0     -17.336       -17.399       -17.399      -17.462      -17.462       -17.526       -17.652       -17.652       -17.716       -17.779       -17.779       -17.842 
    coh33:k=-16.7885,b=0      -17.25       -17.315       -17.315       -17.38       -17.38       -17.446       -17.577       -17.577       -17.642       -17.642       -17.707       -17.707 
    coh34:k=-16.6881,b=0     -17.164       -17.231       -17.231      -17.299      -17.299       -17.299       -17.501       -17.501       -17.568       -17.568       -17.636       -17.636 
    coh35:k=-16.5878,b=0     -17.078       -17.147       -17.147      -17.217      -17.217       -17.217       -17.356       -17.425       -17.495       -17.495       -17.564       -17.564 
    coh36:k=-16.4874,b=0     -16.992       -17.063       -17.063      -17.063      -17.135       -17.135       -17.278       -17.349       -17.349       -17.421       -17.493       -17.493 
    coh37:k=-16.387,b=0      -16.906       -16.979       -16.979      -16.979      -17.053       -17.053         -17.2       -17.274       -17.274       -17.347       -17.347       -17.421 
    coh38:k=-16.2867,b=0      -16.82       -16.895       -16.895      -16.895      -16.971       -16.971       -17.122       -17.198       -17.198       -17.274       -17.274       -17.349 
    coh39:k=-16.1863,b=0     -16.734       -16.812       -16.812      -16.812      -16.889       -16.889       -17.045       -17.122       -17.122         -17.2         -17.2       -17.278 
    coh40:k=-16.086,b=0      -16.648       -16.648       -16.728      -16.728      -16.807       -16.807       -16.967       -16.967       -17.046       -17.046       -17.126       -17.126 
    coh41:k=-15.9856,b=0     -16.562       -16.562       -16.644      -16.644      -16.725       -16.725       -16.889       -16.889       -16.971       -16.971       -17.053       -17.053 
    coh42:k=-15.8852,b=0     -16.476       -16.476        -16.56       -16.56      -16.644       -16.644       -16.811       -16.811       -16.895       -16.895       -16.979       -16.979 
    coh43:k=-15.7849,b=0      -16.39        -16.39       -16.476      -16.476      -16.562       -16.562       -16.733       -16.733       -16.819       -16.819       -16.905       -16.905 
    coh44:k=-15.6845,b=0     -16.304       -16.304       -16.392      -16.392      -16.392        -16.48       -16.656       -16.656       -16.744       -16.744       -16.831       -16.831 
    coh45:k=-15.5842,b=0     -16.218       -16.218       -16.308      -16.308      -16.308       -16.398       -16.578       -16.578       -16.668       -16.668       -16.668       -16.758 
    coh46:k=-15.4838,b=0     -16.132       -16.132       -16.224      -16.224      -16.224       -16.316         -16.5         -16.5         -16.5       -16.592       -16.592       -16.684 
    coh47:k=-15.3834,b=0     -16.046       -16.046        -16.14       -16.14       -16.14       -16.234       -16.328       -16.422       -16.422       -16.516       -16.516        -16.61 
    coh48:k=-15.2831,b=0      -15.96        -15.96       -16.056      -16.056      -16.056       -16.152       -16.249       -16.345       -16.345       -16.441       -16.441       -16.537 
    coh49:k=-15.1827,b=0     -15.874       -15.874       -15.874      -15.972      -15.972       -16.071       -16.169       -16.267       -16.267       -16.365       -16.365       -16.365 
    coh50:k=-15.0824,b=0     -15.788       -15.788       -15.788      -15.889      -15.889       -15.989       -16.089       -16.189       -16.189       -16.289       -16.289       -16.289 
    coh723:k=52.3596,b=0      47.866        47.866        47.866       47.866       47.866        46.392        46.392        46.392        46.392        46.392        46.392        46.392 
    coh724:k=52.46,b=0         47.96         47.96         47.96        47.96        47.96        46.484        46.484        46.484        46.484        46.484        46.484        46.484 
    coh725:k=52.5603,b=0      48.054        48.054        48.054       48.054       48.054        46.576        46.576        46.576        46.576        46.576        46.576        46.576 
    coh726:k=52.6607,b=0      48.148        48.148        48.148       48.148       48.148        46.668        46.668        46.668        46.668        46.668        46.668        46.668 
    coh727:k=52.7611,b=0      48.242        48.242        48.242       48.242       48.242         46.76         46.76         46.76         46.76         46.76         46.76         46.76 
    coh728:k=52.8614,b=0      48.337        48.337        48.337       48.337       48.337        46.853        46.853        46.853        46.853        46.853        46.853        46.853 
    coh729:k=52.9618,b=0      48.431        48.431        48.431       48.431       48.431        46.945        46.945        46.945        46.945        46.945        46.945        46.945 
    coh730:k=53.0621,b=0      48.525        48.525        48.525       48.525       48.525        47.037        47.037        47.037        47.037        47.037        47.037        47.037 
    coh731:k=53.1625,b=0      48.619        48.619        48.619       48.619       48.619        47.129        47.129        47.129        47.129        47.129        47.129        47.129 
    coh732:k=53.2629,b=0      48.713        48.713        48.713       48.713       48.713        47.221        47.221        47.221        47.221        47.221        47.221        47.221 
    coh733:k=53.3632,b=0      48.807        48.807        48.807       48.807       48.807        47.313        47.313        47.313        47.313        47.313        47.313        47.313 
    coh734:k=53.4636,b=0      48.901        48.901        48.901       48.901       48.901        47.405        47.405        47.405        47.405        47.405        47.405        47.405 
    coh735:k=53.5639,b=0      48.995        48.995        48.995       48.995       48.995        47.497        47.497        47.497        47.497        47.497        47.497        47.497 
    coh736:k=53.6643,b=0       49.09         49.09         49.09        49.09        49.09        47.589        47.589        47.589        47.589        47.589        47.589        47.589 
    coh737:k=53.7647,b=0      49.184        49.184        49.184       49.184       49.184        47.681        47.681        47.681        47.681        47.681        47.681        47.681 
    coh738:k=53.865,b=0       49.278        49.278        49.278       49.278       49.278        47.773        47.773        47.773        47.773        47.773        47.773        47.773 
    coh739:k=53.9654,b=0      49.372        49.372        49.372       49.372       49.372        47.865        47.865        47.865        47.865        47.865        47.865        47.865 
    coh740:k=54.0657,b=0      49.466        49.466        49.466       49.466       49.466        47.958        47.958        47.958        47.958        47.958        47.958        47.958 
    coh741:k=54.1661,b=0       49.56         49.56         49.56        49.56        49.56         48.05         48.05         48.05         48.05         48.05         48.05         48.05 
    coh742:k=54.2665,b=0      49.654        49.654        49.654       49.654       49.654        48.142        48.142        48.142        48.142        48.142        48.142        48.142 
    coh743:k=54.3668,b=0      49.748        49.748        49.748       49.748       49.748        48.234        48.234        48.234        48.234        48.234        48.234        48.234 
    coh744:k=54.4672,b=0      49.843        49.843        49.843       49.843       49.843        49.843        48.326        48.326        48.326        48.326        48.326        48.326 
    coh745:k=54.5675,b=0      49.937        49.937        49.937       49.937       49.937        49.937        48.418        48.418        48.418        48.418        48.418        48.418 
    coh746:k=54.6679,b=0      50.031        50.031        50.031       50.031        48.51         48.51         48.51         48.51         48.51         48.51         48.51         48.51 
    coh747:k=54.7683,b=0      48.602        48.602        48.602       48.602       48.602        48.602        48.602        48.602        48.602        48.602        48.602        48.602 
    coh748:k=54.8686,b=0      48.694        48.694        48.694       48.694       48.694        48.694        48.694        48.694        48.694        48.694        48.694        48.694 
    coh749:k=54.969,b=0       48.786        48.786        48.786       48.786       48.786        48.786        48.786        48.786        48.786        48.786        48.786        48.786 
    coh750:k=55.0693,b=0      48.878        48.878        48.878       48.878       48.878        48.878        48.878        48.878        48.878        48.878        48.878        48.878 
    coh751:k=55.1697,b=0       48.97         48.97         48.97        48.97        48.97         48.97         48.97         48.97         48.97         48.97         48.97         48.97 
    coh752:k=55.2701,b=0      49.063        49.063        49.063       49.063       49.063        49.063        49.063        49.063        49.063        49.063        49.063        49.063 
    coh753:k=55.3704,b=0      49.155        49.155        49.155       49.155       49.155        49.155        49.155        49.155        49.155        49.155        49.155        49.155 
    coh754:k=55.4708,b=0      49.247        49.247        49.247       49.247       49.247        49.247        49.247        49.247        49.247        49.247        49.247        49.247 
    coh755:k=55.5711,b=0      49.339        49.339        49.339       49.339       49.339        49.339        49.339        49.339        49.339        49.339        49.339        49.339 
    coh756:k=55.6715,b=0      49.431        49.431        49.431       49.431       49.431        49.431        49.431        49.431        49.431        49.431        49.431        49.431 
    coh757:k=55.7719,b=0      49.523        49.523        49.523       49.523       49.523        49.523        49.523        49.523        49.523        49.523        49.523        49.523 
    coh758:k=55.8722,b=0      49.615        49.615        49.615       49.615       49.615        49.615        49.615        49.615        49.615        49.615        49.615        49.615 
    coh759:k=55.9726,b=0      49.707        49.707        49.707       49.707       49.707        49.707        49.707        49.707        49.707        49.707        49.707        49.707 
    coh760:k=56.0729,b=0      49.799        49.799        49.799       49.799       49.799        49.799        49.799        49.799        49.799        49.799        49.799        49.799 
    coh761:k=56.1733,b=0      49.891        49.891        49.891       49.891       49.891        49.891        49.891        49.891        49.891        49.891        49.891        49.891 
    coh762:k=56.2737,b=0      49.983        49.983        49.983       49.983       49.983        49.983        49.983        49.983        49.983        49.983        49.983        49.983 
    coh763:k=56.374,b=0       50.076        50.076        50.076       50.076       50.076        50.076        50.076        50.076        50.076        50.076        50.076        50.076 
    coh764:k=56.4744,b=0      50.168        50.168        50.168       50.168       50.168        50.168        50.168        50.168        50.168        50.168        50.168        50.168 
    coh765:k=56.5747,b=0       50.26         50.26         50.26        50.26        50.26         50.26         50.26         50.26         50.26         50.26         50.26          48.7 
    coh766:k=56.6751,b=0      50.352        50.352        50.352       50.352       50.352        50.352        50.352        50.352        50.352        50.352         48.79         48.79 
    coh767:k=56.7755,b=0      50.444        50.444        50.444       50.444       50.444        50.444        50.444        50.444         48.88         48.88         48.88         48.88 
    coh768:k=56.8758,b=0      50.536        50.536        50.536       50.536       50.536         48.97         48.97         48.97         48.97         48.97         48.97         48.97 
    coh769:k=56.9762,b=0       49.06         49.06         49.06        49.06        49.06         49.06         49.06         49.06         49.06         49.06         49.06         49.06 
    coh770:k=57.0765,b=0       49.15         49.15         49.15        49.15        49.15         49.15         49.15         49.15         49.15         49.15         49.15         49.15 
    coh771:k=57.1769,b=0       49.24         49.24         49.24        49.24        49.24         49.24         49.24         49.24         49.24         49.24         49.24         49.24 
    coh772:k=57.2773,b=0       49.33         49.33         49.33        49.33        49.33         49.33         49.33         49.33         49.33         49.33         49.33         49.33 

</pre><img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_01.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_02.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_03.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_04.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_05.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_06.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_07.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_08.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_09.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_10.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_11.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_12.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_13.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_14.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_15.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_16.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_17.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_18.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 14
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function result_map = ff_ipwkbz_vf_vecsv(varargin)
%% FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic savings and risky
% capital asset problem with some ar1 shock. This is the two step solution
% with interpolation and with percentage asset grids version of
% <https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_iwkz_vf_vecsv.html
% ff_iwkz_vf_vecsv>. See that file for more descriptions.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables.
%
% keys included in result_map:
%
% * mt_val matrix states_n by shock_n matrix of converged value function grid
% * mt_pol_a matrix states_n by shock_n matrix of converged policy function grid
% * ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function
% difference between iteration
% * ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy
% function difference between iterations
% * mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the
% proportion of grid points at which policy function changed between
% current and last iteration for each element of shock
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ff_ipwkbz_evf.m ff_ipwkbz_evf>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m ffs_ipwkbz_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m ffs_ipwkbz_get_funcgrid>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post.m ff_akz_vf_post>
%


%% Default
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);

% parameters can be set inside ffs_ipwkbz_set_default_param or updated here
% param_map('it_w_perc_n') = 50;
% param_map('it_ak_perc_n') = param_map('it_w_perc_n');
% param_map('it_z_n') = 15;
% param_map('fl_coh_interp_grid_gap') = 0.025;
% param_map('it_c_interp_grid_gap') = 0.001;
% param_map('fl_w_interp_grid_gap') = 0.25;
% param_map('it_w_perc_n') = 100;
% param_map('it_ak_perc_n') = param_map('it_w_perc_n');
% param_map('it_z_n') = 11;
% param_map('fl_coh_interp_grid_gap') = 0.1;
% param_map('it_c_interp_grid_gap') = 10^-4;
% param_map('fl_w_interp_grid_gap') = 0.1;

% get armt and func map
[armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

% append function name
st_func_name = 'ff_ipwkbz_vf_vecsv';
support_map('st_profile_name_main') = [st_func_name support_map('st_profile_name_main')];
support_map('st_mat_name_main') = [st_func_name support_map('st_mat_name_main')];
support_map('st_img_name_main') = [st_func_name support_map('st_img_name_main')];

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_w_perc', 'ar_w_level', 'ar_z'});
[ar_w_perc, ar_w_level, ar_z] = params_group{:};
params_group = values(armt_map, {'ar_interp_c_grid', 'ar_interp_coh_grid', ...
    'ar_a_meshk', 'ar_k_mesha', ...
    'mt_interp_coh_grid_mesh_z', 'mt_z_mesh_coh_interp_grid',...
    'mt_interp_coh_grid_mesh_w_perc',...
    'mt_w_by_interp_coh_interp_grid'});
[ar_interp_c_grid, ar_interp_coh_grid, ar_a_meshk, ar_k_mesha, ...
    mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid, ...
    mt_interp_coh_grid_mesh_w_perc,...
    mt_w_by_interp_coh_interp_grid] = params_group{:};
params_group = values(armt_map, {'mt_coh_wkb', 'mt_z_mesh_coh_wkb'});
[mt_coh_wkb, mt_z_mesh_coh_wkb] = params_group{:};

% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_cons'});
[f_util_log, f_util_crra, f_cons] = params_group{:};

% param_map
params_group = values(param_map, {'it_z_n', 'fl_crra', 'fl_beta', ...
    'fl_nan_replace', 'fl_c_min', 'bl_default', 'fl_default_wprime'});
[it_z_n, fl_crra, fl_beta, fl_nan_replace, fl_c_min, bl_default, fl_default_wprime] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_time', 'bl_graph_evf', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_time, bl_graph_evf, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes

mt_val_cur = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_k = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_k_cur = mt_pol_k - 1;
mt_pol_idx = zeros(length(ar_interp_coh_grid),length(ar_z));

% We did not need these in ff_oz_vf or ff_oz_vf_vec
% see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why store using cells.
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
cl_w_kstar_interp_z = cell([it_z_n, 1]);
for it_z_i = 1:length(ar_z)
    cl_w_kstar_interp_z{it_z_i} = zeros([length(ar_w_perc), length(ar_interp_coh_grid)]) - 1;
end

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Pre-calculate u(c)
% Interpolation, see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why interpolate over u(c)

% Evaluate
if (fl_crra == 1)
    ar_interp_u_of_c_grid = f_util_log(ar_interp_c_grid);
    fl_u_cmin = f_util_log(fl_c_min);
else
    ar_interp_u_of_c_grid = f_util_crra(ar_interp_c_grid);
    fl_u_cmin = f_util_crra(fl_c_min);
end
ar_interp_u_of_c_grid(ar_interp_c_grid <= fl_c_min) = fl_u_cmin;

% Get Interpolant
f_grid_interpolant_spln = griddedInterpolant(ar_interp_c_grid, ar_interp_u_of_c_grid, 'spline', 'nearest');

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;

    %% Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)
    % v(coh,z) solved on ar_interp_coh_grid, ar_z grids, see
    % ffs_ipwkbz_get_funcgrid.m. Generate interpolant based on that, Then
    % interpolate for the coh reachable levels given the k(w,z) percentage
    % choice grids in the second stage of the problem

    % Generate Interpolant for v(coh,z)
    f_grid_interpolant_value = griddedInterpolant(...
        mt_z_mesh_coh_interp_grid', mt_interp_coh_grid_mesh_z', mt_val_cur', 'linear', 'nearest');

    % Interpolate for v(coh(k(w,z),b(w,z),z),z)
    mt_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb, mt_coh_wkb);
%     ar_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb(:), mt_coh_wkb(:));
%     mt_val_wkb_interpolated = reshape(ar_val_wkb_interpolated, size(mt_z_mesh_coh_wkb));
    
    %% Solve Second Stage Problem k*(w,z)
    % This is the key difference between this function and
    % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html
    % ffs_akz_set_functions> which solves the two stages jointly
    % Interpolation first, because solution coh grid is not the same as all
    % points reachable by k and b choices given w.
    support_map('bl_graph_evf') = false;
    if (it_iter == (it_maxiter_val + 1))
        support_map('bl_graph_evf') = bl_graph_evf;
    end
    bl_input_override = true;
    [mt_ev_condi_z_max, ~, mt_ev_condi_z_max_kp, ~] = ...
        ff_ipwkbz_evf(mt_val_wkb_interpolated, param_map, support_map, armt_map, bl_input_override);

    %% Solve First Stage Problem w*(z) given k*(w,z)

    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)

        %% A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)
        % Generate interpolant for (2) k*(ar_w_perc) from k*(ar_w_level,z)
        % There are two w=k'+b' arrays. ar_w_level is the level even grid based
        % on which we solve the 2nd stage problem in ff_ipwkbz_evf.m. Here for
        % each coh level, we have a different vector of w levels, but the same
        % vector of percentage ws. So we need to interpolate to get the optimal
        % k* and b* choices at each percentage level of w.
        f_interpolante_w_level_kstar_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max_kp(:, it_z_i)', 'linear', 'nearest');

        % Interpolate (2), shift from w_level to w_perc
        mt_w_kstar_interp_z = f_interpolante_w_level_kstar_z(mt_w_by_interp_coh_interp_grid);
        mt_w_astar_interp_z = mt_w_by_interp_coh_interp_grid - mt_w_kstar_interp_z;

        % changes in w_perc kstar choices
        mt_w_kstar_diff_idx = (cl_w_kstar_interp_z{it_z_i} ~= mt_w_kstar_interp_z);

        %% B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp
        % Note that compared to
        % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html
        % ffs_akz_set_functions> the mt_c here is much smaller the same
        % number of columns (states) as in the ffs_akz_set_functions file,
        % but the number of rows equal to ar_w length.
        ar_c = f_cons(mt_interp_coh_grid_mesh_w_perc(mt_w_kstar_diff_idx), ...
                      mt_w_astar_interp_z(mt_w_kstar_diff_idx), ...
                      mt_w_kstar_interp_z(mt_w_kstar_diff_idx));

        ar_it_c_valid_idx = (ar_c <= fl_c_min);
        % EVAL current utility: N by N, f_util defined earlier
        ar_utility_update = f_grid_interpolant_spln(ar_c);

        % Update Storage
        if (it_iter == 1)
            cl_u_c_store{it_z_i} = reshape(ar_utility_update, [length(ar_w_perc), length(ar_interp_coh_grid)]);
            cl_c_valid_idx{it_z_i} = reshape(ar_it_c_valid_idx, [length(ar_w_perc), length(ar_interp_coh_grid)]);
        else
            cl_u_c_store{it_z_i}(mt_w_kstar_diff_idx) = ar_utility_update;
            cl_c_valid_idx{it_z_i}(mt_w_kstar_diff_idx) = ar_it_c_valid_idx;
        end
        cl_w_kstar_interp_z{it_z_i} = mt_w_kstar_interp_z;

        %% C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))
        % Generate Interpolant for (3) EV(k*(ar_w_perc),Z)
        f_interpolante_ev_condi_z_max_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max(:, it_z_i)', 'linear', 'nearest');
        % Interpolate (3), EVAL add on future utility, N by N + N by N
        mt_ev_condi_z_max_interp_z = f_interpolante_ev_condi_z_max_z(mt_w_by_interp_coh_interp_grid);
        
        %% D. Compute FULL U(coh_level, w_perc, z) over all w_perc
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_ev_condi_z_max_interp_z;

        % Index update
        % using the method below is much faster than index replace
        % see <https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        % Default or Not Utility Handling
        if (bl_default)
            % if default: only today u(cmin), transition out next period, debt wiped out
            fl_v_default = fl_u_cmin + fl_beta*f_interpolante_ev_condi_z_max_z(fl_default_wprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        else
            % if default is not allowed: v = u(cmin)
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        end

        % percentage algorithm does not have invalid (check to make sure
        % min percent is not 0 in ffs_ipwkbz_get_funcgrid.m)
        % mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_u_neg_c*(mt_it_c_valid_idx);

        %% E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)        
        % Optimization: remember matlab is column major, rows must be
        % choices, columns must be states
        % <https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR>
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);

        % Generate Linear Opti Index
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;

        ar_opti_aprime_z = mt_w_astar_interp_z(ar_opti_linear_idx_z);
        ar_opti_kprime_z = mt_w_kstar_interp_z(ar_opti_linear_idx_z);
        ar_opti_c_z = f_cons(ar_interp_coh_grid, ar_opti_aprime_z, ar_opti_kprime_z);

        % Handle Default is optimal or not
        if (bl_default)
            % if defaulting is optimal choice, at these states, not required
            % to default, non-default possible, but default could be optimal
            fl_default_opti_kprime = f_interpolante_w_level_kstar_z(fl_default_wprime);
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = fl_default_wprime - fl_default_opti_kprime;
            ar_opti_kprime_z(ar_opti_c_z <= fl_c_min) = fl_default_opti_kprime;
        else
            % if default is not allowed, then next period same state as now
            % this is absorbing state, this is the limiting case, single
            % state space point, lowest a and lowest shock has this.
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = min(ar_a_meshk);
            ar_opti_kprime_z(ar_opti_c_z <= fl_c_min) = min(ar_k_mesha);
        end

        %% F. Store Results        
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_k(:,it_z_i) = ar_opti_kprime_z;
        if (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_linear_idx_z;
        end

    end

    %% Check Tolerance and Continuation

    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur) + norm(mt_pol_k - mt_pol_k_cur);
    ar_pol_a_perc_change = sum((mt_pol_a ~= mt_pol_a_cur))/(length(ar_interp_coh_grid));
    ar_pol_k_perc_change = sum((mt_pol_k ~= mt_pol_k_cur))/(length(ar_interp_coh_grid));
    mt_pol_perc_change(it_iter, :) = mean([ar_pol_a_perc_change;ar_pol_k_perc_change]);

    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    mt_pol_k_cur = mt_pol_k;

    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1);...
                                      mean(mt_pol_a_cur,1); ...
                                      mean(mt_pol_k_cur,1); ...
                                      mt_val_cur(length(ar_interp_coh_grid),:); ...
                                      mt_pol_a_cur(length(ar_interp_coh_grid),:); ...
                                      mt_pol_k_cur(length(ar_interp_coh_grid),:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'mak', 'Hval', 'Hap', 'Hak'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('mkp  = mean(mt_pol_k_cur,1), average choice over k')
        disp('Hval = mt_val_cur(it_ameshk_n,:), highest a state val')
        disp('Hap = mt_pol_a_cur(it_ameshk_n,:), highest a state choice')
        disp('mak = mt_pol_k_cur(it_ameshk_n,:), highest k state choice')
        disp(tb_valpol_iter);
    end

    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    end

end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_idx') = mt_pol_idx;

result_map('cl_mt_coh') = {mt_interp_coh_grid_mesh_z, zeros(1)};
result_map('cl_mt_pol_a') = {mt_pol_a, zeros(1)};
result_map('cl_mt_pol_k') = {mt_pol_k, zeros(1)};
result_map('cl_mt_pol_c') = {f_cons(mt_interp_coh_grid_mesh_z, mt_pol_a, mt_pol_k), zeros(1)};
result_map('ar_st_pol_names') = ["cl_mt_coh", "cl_mt_pol_a", "cl_mt_pol_k", "cl_mt_pol_c"];


if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);

    % graphing based on coh_wkb, but that does not match optimal choice
    % matrixes for graphs.
    armt_map('mt_coh_wkb') = mt_interp_coh_grid_mesh_z;
    armt_map('it_ameshk_n') = length(ar_interp_coh_grid);
    armt_map('ar_a_meshk') = mt_interp_coh_grid_mesh_z(:,1);
    armt_map('ar_k_mesha') = zeros(size(mt_interp_coh_grid_mesh_z(:,1)) + 0);

    result_map = ff_akz_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end

##### SOURCE END #####
--></body></html>