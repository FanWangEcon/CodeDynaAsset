
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-07-02"><meta name="DC.source" content="ff_ipwkbz_vf_vecsv.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Pre-calculate u(c)</a></li><li><a href="#9">Iterate Value Function</a></li><li><a href="#11">Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)</a></li><li><a href="#12">Solve Second Stage Problem k*(w,z)</a></li><li><a href="#13">Solve First Stage Problem w*(z) given k*(w,z)</a></li><li><a href="#15">A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)</a></li><li><a href="#16">B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp</a></li><li><a href="#17">C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))</a></li><li><a href="#18">D. Compute FULL U(coh_level, w_perc, z) over all w_perc</a></li><li><a href="#19">E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)</a></li><li><a href="#20">F. Store Results</a></li><li><a href="#22">Check Tolerance and Continuation</a></li><li><a href="#24">Process Optimal Choices</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> result_map = ff_ipwkbz_vf_vecsv(varargin)
</pre><h2 id="2">FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic savings and risky capital asset problem with some ar1 shock. This is the two step solution with interpolation and with percentage asset grids version of <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_iwkz_vf_vecsv.html">ff_iwkz_vf_vecsv</a>. See that file for more descriptions.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>keys included in result_map:</p><div><ul><li>mt_val matrix states_n by shock_n matrix of converged value function grid</li><li>mt_pol_a matrix states_n by shock_n matrix of converged policy function grid</li><li>ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function difference between iteration</li><li>ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy function difference between iterations</li><li>mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the proportion of grid points at which policy function changed between current and last iteration for each element of shock</li></ul></div><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ff_ipwkbz_evf.m">ff_ipwkbz_evf</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m">ffs_ipwkbz_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m">ffs_ipwkbz_get_funcgrid</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post.m">ff_akz_vf_post</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);

<span class="comment">% parameters can be set inside ffs_ipwkbz_set_default_param or updated here</span>
<span class="comment">% param_map('it_w_perc_n') = 50;</span>
<span class="comment">% param_map('it_ak_perc_n') = param_map('it_w_perc_n');</span>
<span class="comment">% param_map('it_z_n') = 15;</span>
<span class="comment">% param_map('fl_coh_interp_grid_gap') = 0.025;</span>
<span class="comment">% param_map('it_c_interp_grid_gap') = 0.001;</span>
<span class="comment">% param_map('fl_w_interp_grid_gap') = 0.25;</span>
<span class="comment">% param_map('it_w_perc_n') = 100;</span>
<span class="comment">% param_map('it_ak_perc_n') = param_map('it_w_perc_n');</span>
<span class="comment">% param_map('it_z_n') = 11;</span>
<span class="comment">% param_map('fl_coh_interp_grid_gap') = 0.1;</span>
<span class="comment">% param_map('it_c_interp_grid_gap') = 10^-4;</span>
<span class="comment">% param_map('fl_w_interp_grid_gap') = 0.1;</span>
<span class="comment">%</span>
<span class="comment">% get armt and func map</span>
[armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_ipwkbz_vf_vecsv'</span>;
support_map(<span class="string">'st_profile_name_main'</span>) = [st_func_name support_map(<span class="string">'st_profile_name_main'</span>)];
support_map(<span class="string">'st_mat_name_main'</span>) = [st_func_name support_map(<span class="string">'st_mat_name_main'</span>)];
support_map(<span class="string">'st_img_name_main'</span>) = [st_func_name support_map(<span class="string">'st_img_name_main'</span>)];
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_w_perc'</span>, <span class="string">'ar_w_level'</span>, <span class="string">'ar_z'</span>});
[ar_w_perc, ar_w_level, ar_z] = params_group{:};
params_group = values(armt_map, {<span class="string">'ar_interp_c_grid'</span>, <span class="string">'ar_interp_coh_grid'</span>, <span class="keyword">...</span>
    <span class="string">'ar_a_meshk'</span>, <span class="string">'ar_k_mesha'</span>, <span class="keyword">...</span>
    <span class="string">'mt_interp_coh_grid_mesh_z'</span>, <span class="string">'mt_z_mesh_coh_interp_grid'</span>,<span class="keyword">...</span>
    <span class="string">'mt_interp_coh_grid_mesh_w_perc'</span>,<span class="keyword">...</span>
    <span class="string">'mt_w_by_interp_coh_interp_grid'</span>});
[ar_interp_c_grid, ar_interp_coh_grid, ar_a_meshk, ar_k_mesha, <span class="keyword">...</span>
    mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid, <span class="keyword">...</span>
    mt_interp_coh_grid_mesh_w_perc,<span class="keyword">...</span>
    mt_w_by_interp_coh_interp_grid] = params_group{:};
params_group = values(armt_map, {<span class="string">'mt_coh_wkb'</span>, <span class="string">'mt_z_mesh_coh_wkb'</span>});
[mt_coh_wkb, mt_z_mesh_coh_wkb] = params_group{:};

<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_cons'</span>});
[f_util_log, f_util_crra, f_cons] = params_group{:};

<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="keyword">...</span>
    <span class="string">'fl_nan_replace'</span>, <span class="string">'fl_c_min'</span>, <span class="string">'bl_default'</span>, <span class="string">'fl_default_wprime'</span>});
[it_z_n, fl_crra, fl_beta, fl_nan_replace, fl_c_min, bl_default, fl_default_wprime] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_graph_evf'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_time, bl_graph_evf, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><pre class="codeinput">mt_val_cur = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_k = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_k_cur = mt_pol_k - 1;
mt_pol_idx = zeros(length(ar_interp_coh_grid),length(ar_z));

<span class="comment">% We did not need these in ff_oz_vf or ff_oz_vf_vec</span>
<span class="comment">% see</span>
<span class="comment">% &lt;https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html</span>
<span class="comment">% fs_u_c_partrepeat_main&gt; for why store using cells.</span>
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
cl_w_kstar_interp_z = cell([it_z_n, 1]);
<span class="keyword">for</span> it_z_i = 1:length(ar_z)
    cl_w_kstar_interp_z{it_z_i} = zeros([length(ar_w_perc), length(ar_interp_coh_grid)]) - 1;
<span class="keyword">end</span>
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Pre-calculate u(c)</h2><p>Interpolation, see <a href="https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html">fs_u_c_partrepeat_main</a> for why interpolate over u(c)</p><pre class="codeinput"><span class="comment">% Evaluate</span>
<span class="keyword">if</span> (fl_crra == 1)
    ar_interp_u_of_c_grid = f_util_log(ar_interp_c_grid);
    fl_u_cmin = f_util_log(fl_c_min);
<span class="keyword">else</span>
    ar_interp_u_of_c_grid = f_util_crra(ar_interp_c_grid);
    fl_u_cmin = f_util_crra(fl_c_min);
<span class="keyword">end</span>
ar_interp_u_of_c_grid(ar_interp_c_grid &lt;= fl_c_min) = fl_u_cmin;

<span class="comment">% Get Interpolant</span>
f_grid_interpolant_spln = griddedInterpolant(ar_interp_c_grid, ar_interp_u_of_c_grid, <span class="string">'spline'</span>, <span class="string">'nearest'</span>);
</pre><h2 id="9">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="11">Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)</h2><p>v(coh,z) solved on ar_interp_coh_grid, ar_z grids, see ffs_ipwkbz_get_funcgrid.m. Generate interpolant based on that, Then interpolate for the coh reachable levels given the k(w,z) percentage choice grids in the second stage of the problem</p><pre class="codeinput">    <span class="comment">% Generate Interpolant for v(coh,z)</span>
    f_grid_interpolant_value = griddedInterpolant(<span class="keyword">...</span>
        mt_z_mesh_coh_interp_grid', mt_interp_coh_grid_mesh_z', mt_val_cur', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);

    <span class="comment">% Interpolate for v(coh(k(w,z),b(w,z),z),z)</span>
    mt_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb, mt_coh_wkb);
<span class="comment">%     ar_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb(:), mt_coh_wkb(:));</span>
<span class="comment">%     mt_val_wkb_interpolated = reshape(ar_val_wkb_interpolated, size(mt_z_mesh_coh_wkb));</span>
</pre><h2 id="12">Solve Second Stage Problem k*(w,z)</h2><p>This is the key difference between this function and <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html">ffs_akz_set_functions</a> which solves the two stages jointly Interpolation first, because solution coh grid is not the same as all points reachable by k and b choices given w.</p><pre class="codeinput">    support_map(<span class="string">'bl_graph_evf'</span>) = false;
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        support_map(<span class="string">'bl_graph_evf'</span>) = bl_graph_evf;
    <span class="keyword">end</span>
    bl_input_override = true;
    [mt_ev_condi_z_max, ~, mt_ev_condi_z_max_kp, ~] = <span class="keyword">...</span>
        ff_ipwkbz_evf(mt_val_wkb_interpolated, param_map, support_map, armt_map, bl_input_override);
</pre><h2 id="13">Solve First Stage Problem w*(z) given k*(w,z)</h2><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)
</pre><h2 id="15">A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)</h2><p>Generate interpolant for (2) k*(ar_w_perc) from k*(ar_w_level,z) There are two w=k'+b' arrays. ar_w_level is the level even grid based on which we solve the 2nd stage problem in ff_ipwkbz_evf.m. Here for each coh level, we have a different vector of w levels, but the same vector of percentage ws. So we need to interpolate to get the optimal k* and b* choices at each percentage level of w.</p><pre class="codeinput">        f_interpolante_w_level_kstar_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max_kp(:, it_z_i)', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);

        <span class="comment">% Interpolate (2), shift from w_level to w_perc</span>
        mt_w_kstar_interp_z = f_interpolante_w_level_kstar_z(mt_w_by_interp_coh_interp_grid);
        mt_w_astar_interp_z = mt_w_by_interp_coh_interp_grid - mt_w_kstar_interp_z;

        <span class="comment">% changes in w_perc kstar choices</span>
        mt_w_kstar_diff_idx = (cl_w_kstar_interp_z{it_z_i} ~= mt_w_kstar_interp_z);
</pre><h2 id="16">B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp</h2><p>Note that compared to <a href="https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html">ffs_akz_set_functions</a> the mt_c here is much smaller the same number of columns (states) as in the ffs_akz_set_functions file, but the number of rows equal to ar_w length.</p><pre class="codeinput">        ar_c = f_cons(mt_interp_coh_grid_mesh_w_perc(mt_w_kstar_diff_idx), <span class="keyword">...</span>
                      mt_w_astar_interp_z(mt_w_kstar_diff_idx), <span class="keyword">...</span>
                      mt_w_kstar_interp_z(mt_w_kstar_diff_idx));

        ar_it_c_valid_idx = (ar_c &lt;= fl_c_min);
        <span class="comment">% EVAL current utility: N by N, f_util defined earlier</span>
        ar_utility_update = f_grid_interpolant_spln(ar_c);

        <span class="comment">% Update Storage</span>
        <span class="keyword">if</span> (it_iter == 1)
            cl_u_c_store{it_z_i} = reshape(ar_utility_update, [length(ar_w_perc), length(ar_interp_coh_grid)]);
            cl_c_valid_idx{it_z_i} = reshape(ar_it_c_valid_idx, [length(ar_w_perc), length(ar_interp_coh_grid)]);
        <span class="keyword">else</span>
            cl_u_c_store{it_z_i}(mt_w_kstar_diff_idx) = ar_utility_update;
            cl_c_valid_idx{it_z_i}(mt_w_kstar_diff_idx) = ar_it_c_valid_idx;
        <span class="keyword">end</span>
        cl_w_kstar_interp_z{it_z_i} = mt_w_kstar_interp_z;
</pre><h2 id="17">C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))</h2><p>Generate Interpolant for (3) EV(k*(ar_w_perc),Z)</p><pre class="codeinput">        f_interpolante_ev_condi_z_max_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max(:, it_z_i)', <span class="string">'linear'</span>, <span class="string">'nearest'</span>);
        <span class="comment">% Interpolate (3), EVAL add on future utility, N by N + N by N</span>
        mt_ev_condi_z_max_interp_z = f_interpolante_ev_condi_z_max_z(mt_w_by_interp_coh_interp_grid);
</pre><h2 id="18">D. Compute FULL U(coh_level, w_perc, z) over all w_perc</h2><pre class="codeinput">        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_ev_condi_z_max_interp_z;

        <span class="comment">% Index update</span>
        <span class="comment">% using the method below is much faster than index replace</span>
        <span class="comment">% see &lt;https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript&gt;</span>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        <span class="comment">% Default or Not Utility Handling</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if default: only today u(cmin), transition out next period, debt wiped out</span>
            fl_v_default = fl_u_cmin + fl_beta*f_interpolante_ev_condi_z_max_z(fl_default_wprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed: v = u(cmin)</span>
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        <span class="keyword">end</span>

        <span class="comment">% percentage algorithm does not have invalid (check to make sure</span>
        <span class="comment">% min percent is not 0 in ffs_ipwkbz_get_funcgrid.m)</span>
        <span class="comment">% mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_u_neg_c*(mt_it_c_valid_idx);</span>
</pre><h2 id="19">E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)</h2><p>Optimization: remember matlab is column major, rows must be choices, columns must be states <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">COLUMN-MAJOR</a></p><pre class="codeinput">        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);

        <span class="comment">% Generate Linear Opti Index</span>
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;

        ar_opti_aprime_z = mt_w_astar_interp_z(ar_opti_linear_idx_z);
        ar_opti_kprime_z = mt_w_kstar_interp_z(ar_opti_linear_idx_z);
        ar_opti_c_z = f_cons(ar_interp_coh_grid, ar_opti_aprime_z, ar_opti_kprime_z);

        <span class="comment">% Handle Default is optimal or not</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if defaulting is optimal choice, at these states, not required</span>
            <span class="comment">% to default, non-default possible, but default could be optimal</span>
            fl_default_opti_kprime = f_interpolante_w_level_kstar_z(fl_default_wprime);
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_wprime - fl_default_opti_kprime;
            ar_opti_kprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_opti_kprime;
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed, then next period same state as now</span>
            <span class="comment">% this is absorbing state, this is the limiting case, single</span>
            <span class="comment">% state space point, lowest a and lowest shock has this.</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = min(ar_a_meshk);
            ar_opti_kprime_z(ar_opti_c_z &lt;= fl_c_min) = min(ar_k_mesha);
        <span class="keyword">end</span>
</pre><h2 id="20">F. Store Results</h2><pre class="codeinput">        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_k(:,it_z_i) = ar_opti_kprime_z;
        <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_linear_idx_z;
        <span class="keyword">end</span>
</pre><pre class="codeinput">    <span class="keyword">end</span>
</pre><h2 id="22">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur) + norm(mt_pol_k - mt_pol_k_cur);
    ar_pol_a_perc_change = sum((mt_pol_a ~= mt_pol_a_cur))/(length(ar_interp_coh_grid));
    ar_pol_k_perc_change = sum((mt_pol_k ~= mt_pol_k_cur))/(length(ar_interp_coh_grid));
    mt_pol_perc_change(it_iter, :) = mean([ar_pol_a_perc_change;ar_pol_k_perc_change]);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    mt_pol_k_cur = mt_pol_k;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1);<span class="keyword">...</span>
                                      mean(mt_pol_a_cur,1); <span class="keyword">...</span>
                                      mean(mt_pol_k_cur,1); <span class="keyword">...</span>
                                      mt_val_cur(length(ar_interp_coh_grid),:); <span class="keyword">...</span>
                                      mt_pol_a_cur(length(ar_interp_coh_grid),:); <span class="keyword">...</span>
                                      mt_pol_k_cur(length(ar_interp_coh_grid),:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'mak'</span>, <span class="string">'Hval'</span>, <span class="string">'Hap'</span>, <span class="string">'Hak'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'mkp  = mean(mt_pol_k_cur,1), average choice over k'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_ameshk_n,:), highest a state val'</span>)
        disp(<span class="string">'Hap = mt_pol_a_cur(it_ameshk_n,:), highest a state choice'</span>)
        disp(<span class="string">'mak = mt_pol_k_cur(it_ameshk_n,:), highest k state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><h2 id="24">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_idx'</span>) = mt_pol_idx;

result_map(<span class="string">'cl_mt_pol_coh'</span>) = {mt_interp_coh_grid_mesh_z, zeros(1)};
result_map(<span class="string">'cl_mt_pol_a'</span>) = {mt_pol_a, zeros(1)};
result_map(<span class="string">'cl_mt_pol_k'</span>) = {mt_pol_k, zeros(1)};
result_map(<span class="string">'cl_mt_pol_c'</span>) = {f_cons(mt_interp_coh_grid_mesh_z, mt_pol_a, mt_pol_k), zeros(1)};
result_map(<span class="string">'ar_st_pol_names'</span>) = [<span class="string">"cl_mt_pol_coh"</span>, <span class="string">"cl_mt_pol_a"</span>, <span class="string">"cl_mt_pol_k"</span>, <span class="string">"cl_mt_pol_c"</span>];


<span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);

    <span class="comment">% graphing based on coh_wkb, but that does not match optimal choice</span>
    <span class="comment">% matrixes for graphs.</span>
    armt_map(<span class="string">'mt_coh_wkb'</span>) = mt_interp_coh_grid_mesh_z;
    armt_map(<span class="string">'it_ameshk_n'</span>) = length(ar_interp_coh_grid);
    armt_map(<span class="string">'ar_a_meshk'</span>) = mt_interp_coh_grid_mesh_z(:,1);
    armt_map(<span class="string">'ar_k_mesha'</span>) = zeros(size(mt_interp_coh_grid_mesh_z(:,1)) + 0);

    result_map = ff_akz_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">valgap = norm(mt_val - mt_val_cur): value function difference across iterations
polgap = norm(mt_pol_a - mt_pol_a_cur): policy function difference across iterations
z1 = z1 perc change: (sum((mt_pol_a ~= mt_pol_a_cur))+sum((mt_pol_k ~= mt_pol_k_cur)))/(2*it_ameshk_n):percentage of state space points conditional on shock where the policy function is changing across iterations
                 valgap      polgap        z1           z2           z3           z4           z5           z6           z7           z8           z9           z10          z11          z12          z13          z14          z15   
                _________    _______    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________

    iter=1         293.83     2146.7            1            1            1            1            1            1            1            1            1            1            1            1            1            1            1
    iter=2         156.06     2562.9            1            1            1            1            1            1            1            1            1            1            1            1            1            1            1
    iter=3         114.55     833.66      0.99741      0.99741      0.99741      0.99741      0.99611      0.99417      0.99223      0.99352      0.99223      0.99417      0.99223      0.98834      0.98899      0.98446       0.9851
    iter=4         98.145     408.82      0.99611      0.99482      0.99482      0.99611      0.99741      0.99611      0.99676      0.99417      0.99158      0.99028      0.99158      0.98964      0.99093      0.99028      0.99093
    iter=5         85.116     255.42      0.99352      0.99482      0.99352      0.99352      0.99417      0.99288      0.99288      0.99288      0.99352      0.99223      0.99093      0.99417      0.99417      0.99028      0.99028
    iter=6         74.425     154.18      0.99223      0.99352      0.99352      0.99352      0.99223      0.99223      0.99158      0.98899      0.99223      0.99093      0.98834      0.98964      0.98899      0.98964      0.98446
    iter=7         65.472     125.79       0.9715       0.9728      0.97927      0.97668      0.97668      0.97798      0.97539      0.98446      0.98122      0.98316      0.97992      0.97992      0.98446       0.9864       0.9864
    iter=8         57.872     93.663       0.6114      0.67098      0.74741      0.84845      0.85492      0.85363      0.83549      0.83808      0.82578      0.81153      0.80959      0.79858      0.78886       0.8329      0.88536
    iter=9          51.33     85.562      0.75389      0.74611      0.72927      0.70207      0.68005      0.64896      0.62953      0.60622      0.56347      0.53238      0.52267      0.59521      0.67163      0.72085      0.70984
    iter=10         45.66     52.997      0.30311      0.25648      0.23964      0.27591      0.31606      0.35233      0.39767      0.43912      0.50259      0.56412      0.61399      0.57254      0.54922      0.50972      0.47733
    iter=11        40.725     68.215      0.51425      0.55829      0.56995      0.53368       0.4987      0.46114      0.41451      0.37176      0.32254       0.2772      0.30699      0.35816      0.40933      0.46891      0.52332
    iter=12        36.404     41.994      0.18653      0.20078      0.22798      0.24223      0.27202      0.29922      0.33679      0.36917       0.4158      0.46114      0.41321      0.37306      0.30959      0.28497      0.33938
    iter=13        32.579     37.265      0.18523      0.14378      0.11917      0.13083      0.14249      0.16321      0.18394      0.21244      0.22409      0.25842      0.29663      0.32513      0.36917      0.38536      0.32707
    iter=14        29.204     49.152       0.3342      0.36917      0.35751      0.31606      0.29016      0.24352      0.18394      0.14378      0.15285      0.16839      0.19301      0.23057      0.25712      0.28109      0.31347
    iter=15        26.218     35.017      0.16969      0.18135      0.19689      0.21891      0.23316      0.26166      0.28238      0.30959      0.26425      0.20466      0.13472      0.15997      0.16969      0.19948      0.23834
    iter=16        23.561     28.629     0.098446      0.11269      0.12176      0.13472      0.14249      0.17228      0.17746      0.18847      0.21762      0.23964       0.2785      0.23057      0.17746      0.15674      0.17746
    iter=17        21.189     27.421     0.068653     0.069948     0.080311     0.088083     0.095855      0.10622      0.11788      0.12824      0.15155       0.1671      0.19819      0.21503      0.22539      0.21891      0.13731
    iter=18        19.067     22.909     0.047927     0.051813     0.060881     0.067358     0.073834     0.081606     0.093264      0.10363      0.11788      0.12435      0.14119      0.15285      0.17098      0.19819      0.21891
    iter=19        17.162      17.45     0.076425     0.037565     0.044041     0.047927     0.049223     0.064767     0.066062     0.072539     0.084197     0.091969      0.11528      0.11658      0.14378      0.16062       0.1658
    iter=20        15.454     27.872      0.15674      0.16839      0.13212     0.091969     0.050518     0.044041      0.05829     0.054404     0.064767      0.07772     0.095855     0.098446      0.11658      0.12565      0.13601
    iter=21        13.922     24.094      0.11399      0.11917      0.12435      0.13212       0.1399      0.11269     0.067358     0.045337     0.053109     0.061528     0.072539     0.085492     0.093264       0.1114      0.10881
    iter=22        12.546     20.723     0.079016     0.082902     0.084197     0.098446       0.1101      0.10881      0.12435      0.10363     0.069948     0.045337     0.066062     0.060881     0.086788     0.079016     0.091969
    iter=23        11.309     19.037     0.064767     0.063472     0.069948     0.073834     0.081606     0.091969     0.088083      0.10363       0.1114     0.089378     0.050518     0.062176     0.063472     0.073834     0.073834
    iter=24        10.196     14.857     0.049223     0.046632     0.055699     0.060881     0.066062     0.064767     0.073834      0.07772     0.085492      0.10233     0.084197     0.046632     0.047927     0.062176     0.066062
    iter=25        9.1942     17.563     0.037565     0.036269      0.03886     0.045337     0.047927      0.05829     0.060881     0.064767     0.072539     0.084197     0.093264     0.088083     0.042746     0.054404     0.056995
    iter=26        8.2918      11.44     0.025907     0.033679     0.033679     0.036269      0.03886     0.041451     0.050518     0.055699     0.064767     0.073834     0.079016     0.079016     0.082902     0.050518     0.046632
    iter=27        7.4793     14.993     0.024611     0.023316     0.025907     0.027202     0.033679     0.040155     0.041451     0.044041     0.046632     0.063472     0.055699     0.071244      0.07772     0.060881     0.042746
    iter=28        6.7477     15.559     0.018135     0.020725     0.022021     0.025907     0.025907     0.036269     0.032383     0.033679     0.042746     0.053109     0.049223      0.05829      0.07513     0.071244     0.045337
    iter=29        6.0887     13.339     0.016839      0.01943      0.01943      0.01943     0.025907     0.024611     0.028497     0.033679     0.031088     0.042746     0.050518     0.062176     0.062176     0.064767     0.065415
    iter=30         5.494      13.03     0.014249     0.016839     0.016839      0.01943     0.016839      0.01943     0.024611     0.024611     0.029793     0.034974     0.045337     0.044041     0.056995     0.055699     0.059585
    iter=31        4.9566     10.808     0.011658     0.012953     0.016839     0.016839     0.015544     0.020725     0.018135     0.025907     0.032383     0.028497     0.031088     0.033679     0.054404     0.049223     0.071244
    iter=32        4.4707      11.98     0.010363    0.0090674     0.014249     0.015544      0.01943     0.014249     0.016839     0.020725     0.027202     0.029793     0.024611     0.032383     0.034974     0.044041     0.036269
    iter=33        4.0312     8.3888     0.007772     0.010363    0.0090674     0.011658    0.0090674     0.014249     0.018135     0.016839     0.025907     0.025907     0.024611     0.029793      0.03886     0.040155     0.045337
    iter=34        3.6336     7.6644    0.0064767     0.007772     0.007772     0.010363     0.011658     0.016839     0.012953     0.023316     0.015544     0.024611     0.025907     0.027202     0.029793     0.025907     0.034974
    iter=35         3.274     9.3189    0.0064767    0.0051813     0.007772    0.0090674    0.0064767    0.0090674     0.010363     0.012953     0.016839     0.018135     0.020725     0.022021     0.022021      0.03886     0.027202
    iter=36        2.9488      7.184    0.0051813    0.0064767     0.007772    0.0064767    0.0064767     0.012953     0.010363     0.015544     0.015544     0.023316     0.027202     0.034974     0.031088     0.022021     0.031088
    iter=37        2.6548     7.2451     0.003886    0.0051813    0.0064767     0.003886     0.012953    0.0051813     0.007772     0.011658     0.011658     0.016839     0.011658     0.014249     0.031088     0.027202      0.01943
    iter=38        2.3891     6.7145     0.003886     0.003886     0.007772    0.0051813     0.003886    0.0051813    0.0064767    0.0090674     0.012953     0.012953     0.015544      0.01943     0.022021     0.018135     0.027202
    iter=39        2.1492     6.8551    0.0025907     0.003886    0.0025907    0.0051813     0.011658     0.010363     0.011658    0.0051813     0.007772     0.011658    0.0090674     0.012953      0.01943     0.020725     0.027202
    iter=40        1.9325     5.5173     0.003886    0.0025907     0.003886    0.0051813     0.007772    0.0051813    0.0064767    0.0051813    0.0064767     0.007772     0.010363     0.007772     0.010363     0.020725     0.015544
    iter=41        1.7369     5.7287    0.0051813    0.0025907    0.0025907     0.003886    0.0051813    0.0064767    0.0064767    0.0090674    0.0090674    0.0051813     0.015544     0.015544     0.014249     0.014249     0.015544
    iter=42        1.5605     5.6133     0.003886    0.0025907    0.0012953    0.0025907    0.0025907    0.0025907     0.003886    0.0051813    0.0090674    0.0064767    0.0051813     0.007772     0.010363    0.0090674     0.014249
    iter=43        1.4015     4.6364    0.0012953    0.0012953    0.0025907     0.003886    0.0090674    0.0051813    0.0025907    0.0051813    0.0025907    0.0051813    0.0090674     0.010363     0.011658     0.011658     0.012953
    iter=44        1.2582     4.8295    0.0012953    0.0012953    0.0012953    0.0051813    0.0012953    0.0025907    0.0025907     0.003886    0.0051813    0.0064767    0.0051813     0.010363    0.0090674     0.010363     0.016839
    iter=45        1.1292     5.0225    0.0012953    0.0012953    0.0064767    0.0025907    0.0012953    0.0012953    0.0051813     0.007772     0.003886     0.003886     0.003886    0.0064767     0.011658     0.016839     0.016839
    iter=46        1.0131     3.6311    0.0012953    0.0012953    0.0012953     0.003886    0.0012953    0.0051813    0.0025907    0.0012953    0.0025907    0.0051813     0.007772    0.0064767    0.0051813     0.003886     0.012953
    iter=47       0.90865     3.6185    0.0012953            0    0.0012953    0.0012953    0.0025907    0.0025907    0.0025907    0.0025907    0.0025907    0.0051813    0.0025907     0.007772    0.0090674    0.0090674    0.0051813
    iter=48       0.81478     4.4957    0.0012953    0.0025907     0.003886            0    0.0012953     0.003886    0.0051813    0.0025907     0.003886    0.0012953    0.0090674    0.0064767     0.007772    0.0064767    0.0090674
    iter=49       0.73046     3.3117    0.0012953            0            0    0.0012953            0     0.003886    0.0012953    0.0012953    0.0012953    0.0012953    0.0012953     0.003886     0.003886    0.0064767    0.0025907
    iter=50       0.65475     3.3226            0            0    0.0012953            0    0.0012953    0.0012953            0    0.0064767    0.0012953    0.0051813    0.0025907    0.0064767     0.003886     0.003886     0.003886
    iter=72      0.064458      2.605    0.0012953            0            0            0            0            0            0    0.0012953     0.003886            0     0.003886            0            0            0            0
    iter=73      0.058633     1.7352            0            0            0            0            0            0    0.0012953            0    0.0012953            0    0.0025907            0            0            0            0
    iter=74      0.053408    0.62394            0            0            0            0            0            0            0            0            0            0     0.003886            0            0            0            0
    iter=75      0.048715     1.0261            0            0            0            0            0            0            0            0            0            0            0            0            0    0.0012953            0
    iter=76      0.044497     1.5065    0.0012953            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=77        0.0407    0.59193            0            0            0            0            0            0            0            0            0            0     0.003886            0            0            0            0
    iter=78      0.037279    0.60913            0            0            0            0            0            0            0            0            0            0            0    0.0012953            0            0            0
    iter=79      0.034192          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=80      0.031403          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=81      0.028878          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=82      0.026591     1.6609            0            0            0            0            0            0            0     0.003886            0            0            0            0            0            0            0
    iter=83      0.024515          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=84      0.022627     1.9134            0            0            0    0.0025907            0            0            0            0            0            0            0            0            0            0            0
    iter=85      0.020909     1.5044    0.0012953            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=86      0.019342          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=87      0.017912          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=88      0.016603    0.99751            0            0            0            0            0            0            0            0            0            0            0            0    0.0012953            0            0
    iter=89      0.015405          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=90      0.014306          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=91      0.013296          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=92      0.012367          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=93      0.011512          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=94      0.010724          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=95     0.0099956     2.0193            0            0            0            0            0            0            0            0            0            0            0            0            0            0    0.0012953
    iter=96     0.0093226          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=97        0.0087          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=98     0.0081232          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=99     0.0075884          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=100    0.0070921          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=101    0.0066311          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=102    0.0062025          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=103    0.0058038          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=104    0.0054326          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=105    0.0050867          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=106    0.0047643          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=107    0.0044635          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=108    0.0041827          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=109    0.0039206          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=110    0.0036757          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=111    0.0034467          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=112    0.0032326          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=113    0.0030324          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=114     0.002845          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=115    0.0026695          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=116    0.0025053          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=117    0.0023514          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=118    0.0022072          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=119    0.0020721          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=120    0.0019455          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=121    0.0018267          0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0

tb_val: V(a,z) value at each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0            -53.847       -53.722       -53.578      -53.419       -53.248      -53.064       -52.191       -51.934        -51.66       -51.371       -51.074      -50.787 
    coh2:k=-19.8996,b=0       -36.993       -35.481       -33.994      -32.583       -31.231      -29.958        -25.53       -24.545       -23.608       -22.718       -21.888      -21.147 
    coh3:k=-19.7993,b=0       -22.766       -20.956       -19.132      -17.405       -15.785      -14.264       -9.0252        -7.888        -6.808       -5.7862       -4.8353      -3.9887 
    coh4:k=-19.6989,b=0       -18.808       -17.493       -16.098      -14.706       -13.335      -12.003       -7.1031       -5.9879       -4.9162       -3.8963       -2.9471      -2.1018 
    coh5:k=-19.5986,b=0       -16.616       -15.411       -14.124      -12.825       -11.546      -10.302        -5.773       -4.7464       -3.7626       -2.8247       -1.9412      -1.1436 
    coh6:k=-19.4982,b=0       -14.921       -13.808        -12.62      -11.429       -10.261      -9.1207       -4.8824        -3.892       -2.9308        -2.006        -1.133     -0.35124 
    coh7:k=-19.3978,b=0       -13.596       -12.583       -11.496      -10.395       -9.3004      -8.2208       -4.1281       -3.1755       -2.2556       -1.3701      -0.53756      0.21193 
    coh8:k=-19.2975,b=0       -12.574       -11.619       -10.589      -9.5351       -8.4845      -7.4472       -3.5324       -2.6186       -1.7268       -0.8637     -0.045085      0.69545 
    coh9:k=-19.1971,b=0       -11.699       -10.786       -9.7998      -8.7904       -7.7833       -6.796       -3.0274       -2.1319       -1.2581      -0.41578       0.38018          1.1 
    coh10:k=-19.0968,b=0      -10.929       -10.055       -9.1092      -8.1478       -7.1871      -6.2393       -2.5776       -1.7056      -0.85815     -0.040467       0.73777       1.4438 
    coh11:k=-18.9964,b=0      -10.251       -9.4136       -8.5116      -7.5892       -6.6627      -5.7416       -2.1835       -1.3381      -0.50974        0.2955        1.0624       1.7564 
    coh12:k=-18.896,b=0       -9.6505       -8.8492       -7.9805      -7.0861       -6.1868      -5.2908       -1.8343       -1.0038      -0.18936        0.6007        1.3494       2.0298 
    coh13:k=-18.7957,b=0      -9.1145       -8.3373       -7.4948      -6.6269       -5.7521      -4.8864       -1.5123       -0.6985      0.096853       0.87041        1.6075       2.2781 
    coh14:k=-18.6953,b=0       -8.622       -7.8674       -7.0489      -6.2043       -5.3592      -4.5167       -1.2169      -0.42175       0.35834        1.1194        1.8468       2.5066 
    coh15:k=-18.595,b=0       -8.1675       -7.4342       -6.6386      -5.8224       -4.9986      -4.1758      -0.94899      -0.16768       0.60137        1.3522        2.0675       2.7159 
    coh16:k=-18.4946,b=0      -7.7458        -7.036       -6.2657      -5.4679       -4.6628      -3.8579      -0.69838      0.070747       0.82606        1.5646        2.2682       2.9098 
    coh17:k=-18.3942,b=0      -7.3618       -6.6689       -5.9173      -5.1367       -4.3488      -3.5616      -0.46275       0.29246        1.0363        1.7622        2.4579       3.0925 
    coh18:k=-18.2939,b=0      -6.9999       -6.3249       -5.5898      -4.8261       -4.0573      -3.2865      -0.24359       0.49998        1.2323        1.9493        2.6368       3.2611 
    coh19:k=-18.1935,b=0      -6.6612       -6.0013       -5.2813      -4.5368       -3.7823      -3.0286     -0.037057        0.6949         1.418        2.1266        2.8028       3.4209 
    coh20:k=-18.0932,b=0      -6.3413        -5.697        -4.991      -4.2625       -3.5243      -2.7841       0.15781       0.88007        1.5943         2.291        2.9606       3.5724 
    coh21:k=-17.9928,b=0      -6.0383       -5.4079       -4.7195      -4.0039       -3.2793      -2.5509       0.34337        1.0563        1.7586         2.448        3.1108       3.7151 
    coh22:k=-17.8924,b=0       -5.754       -5.1351       -4.4613       -3.758       -3.0461       -2.329       0.52009        1.2222        1.9162        2.5982        3.2527       3.8509 
    coh23:k=-17.7921,b=0      -5.4846       -4.8767       -4.2144      -3.5237       -2.8244       -2.121       0.68796        1.3804        2.0673        2.7416        3.3885       3.9803 
    coh24:k=-17.6917,b=0      -5.2262         -4.63       -3.9785      -3.3011       -2.6123      -1.9218       0.84755        1.5323        2.2121        2.8774        3.5181       4.1047 
    coh25:k=-17.5914,b=0      -4.9797       -4.3941        -3.753      -3.0888       -2.4109      -1.7302        1.0008        1.6784        2.3485        3.0078        3.6428       4.2229 
    coh26:k=-17.491,b=0       -4.7433       -4.1698       -3.5384      -2.8837       -2.2175      -1.5459        1.1483        1.8177        2.4801        3.1333        3.7614       4.3369 
    coh27:k=-17.3906,b=0      -4.5161       -3.9533       -3.3333      -2.6879       -2.0316      -1.3687         1.291         1.951        2.6074         3.254        3.8757       4.4459 
    coh28:k=-17.2903,b=0       -4.298       -3.7447       -3.1361      -2.4995       -1.8539      -1.1995        1.4268        2.0801        2.7304         3.369        3.9858       4.5512 
    coh29:k=-17.1899,b=0      -4.0898       -3.5457       -2.9462      -2.3182        -1.681      -1.0372        1.5577         2.205        2.8485        3.4815        4.0925        4.652 
    coh30:k=-17.0896,b=0      -3.8885       -3.3534       -2.7629      -2.1441       -1.5148     -0.88047        1.6843        2.3257        2.9617        3.5897        4.1956       4.7512 
    coh31:k=-16.9892,b=0      -3.6939       -3.1675       -2.5852      -1.9769       -1.3552     -0.72901        1.8066        2.4416        3.0715        3.6945        4.2941        4.846 
    coh32:k=-16.8888,b=0      -3.5053       -2.9876       -2.4137      -1.8151       -1.2008     -0.58208        1.9259        2.5534        3.1782        3.7955        4.3907        4.938 
    coh33:k=-16.7885,b=0      -3.3222       -2.8149       -2.2491      -1.6576       -1.0513     -0.43939        2.0409        2.6619        3.2818        3.8928        4.4839       5.0269 
    coh34:k=-16.6881,b=0      -3.1447       -2.6475       -2.0897      -1.5051      -0.90682     -0.30138        2.1522        2.7674         3.382        3.9874        4.5745       5.1125 
    coh35:k=-16.5878,b=0      -2.9723       -2.4833        -1.935      -1.3571      -0.76738     -0.16815        2.2603        2.8707        3.4789        4.0801        4.6621       5.1967 
    coh36:k=-16.4874,b=0      -2.8059        -2.324       -1.7845      -1.2135      -0.63124    -0.038716        2.3654        2.9711        3.5734        4.1704         4.747       5.2783 
    coh37:k=-16.387,b=0       -2.6446       -2.1695       -1.6388      -1.0745       -0.4983     0.087095        2.4668        3.0679        3.6653        4.2584        4.8304       5.3579 
    coh38:k=-16.2867,b=0      -2.4876       -2.0191       -1.4975     -0.93997      -0.36958       0.2092        2.5668        3.1622        3.7554        4.3432        4.9117       5.4356 
    coh39:k=-16.1863,b=0      -2.3346       -1.8725       -1.3583     -0.80893      -0.24426      0.32734        2.6642         3.254        3.8433         4.426        4.9911       5.5107 
    coh40:k=-16.086,b=0       -2.1853       -1.7296       -1.2222     -0.68128      -0.12222      0.44317        2.7586        3.3432        3.9284        4.5068        5.0685       5.5843 
    coh41:k=-15.9856,b=0      -2.0408       -1.5912       -1.0902     -0.55692    -0.0033749      0.55677        2.8508          3.43        4.0112        4.5853        5.1434       5.6564 
    coh42:k=-15.8852,b=0      -1.9001       -1.4564      -0.96165     -0.43622       0.11192      0.66701        2.9409         3.516         4.092        4.6626        5.2165       5.7267 
    coh43:k=-15.7849,b=0       -1.761       -1.3246      -0.83597     -0.31755       0.22437      0.77454        3.0285        3.5998        4.1712        4.7383        5.2879       5.7954 
    coh44:k=-15.6845,b=0      -1.6248       -1.1957      -0.71305      -0.2007       0.33421      0.87957         3.114        3.6814         4.248        4.8117        5.3575       5.8624 
    coh45:k=-15.5842,b=0      -1.4922       -1.0696       -0.5929    -0.086481       0.44158      0.98226        3.1976        3.7614        4.3237        4.8837        5.4261       5.9277 
    coh46:k=-15.4838,b=0      -1.3631      -0.94717      -0.47613     0.024603       0.54628       1.0824        3.2796        3.8396        4.3987        4.9542        5.4937       5.9917 
    coh47:k=-15.3834,b=0      -1.2368      -0.82598      -0.36181      0.13339       0.64832       1.1801        3.3602        3.9158        4.4716        5.0233          5.56       6.0543 
    coh48:k=-15.2831,b=0       -1.113      -0.70708      -0.24976      0.24002       0.74958       1.2758        3.4392        3.9904         4.543        5.0908        5.6248       6.1165 
    coh49:k=-15.1827,b=0     -0.99168      -0.59062      -0.13992      0.34453       0.84885       1.3696        3.5166        4.0634        4.6129        5.1573        5.6882       6.1776 
    coh50:k=-15.0824,b=0     -0.87278      -0.47657     -0.032279      0.44693       0.94611       1.4614        3.5925         4.135        4.6815         5.223        5.7504       6.2375 
    coh723:k=52.3596,b=0       15.415        15.456        15.505       15.559        15.617       15.681        15.998        16.096        16.202        16.317        16.436       16.555 
    coh724:k=52.46,b=0         15.423        15.465        15.513       15.567        15.626       15.689        16.006        16.104         16.21        16.324        16.443       16.562 
    coh725:k=52.5603,b=0       15.431        15.473        15.522       15.575        15.634       15.697        16.013        16.111        16.217        16.331         16.45       16.568 
    coh726:k=52.6607,b=0        15.44        15.481         15.53       15.583        15.642       15.705        16.021        16.118        16.224        16.338        16.457       16.575 
    coh727:k=52.7611,b=0       15.448         15.49        15.538       15.591         15.65       15.713        16.029        16.126        16.232        16.345        16.464       16.582 
    coh728:k=52.8614,b=0       15.456        15.498        15.546         15.6        15.658       15.721        16.036        16.133        16.239        16.352        16.471       16.589 
    coh729:k=52.9618,b=0       15.465        15.506        15.555       15.608        15.666       15.729        16.044        16.141        16.246         16.36        16.478       16.596 
    coh730:k=53.0621,b=0       15.473        15.514        15.563       15.616        15.674       15.737        16.051        16.148        16.253        16.367        16.485       16.603 
    coh731:k=53.1625,b=0       15.481        15.523        15.571       15.624        15.682       15.745        16.059        16.156        16.261        16.374        16.492        16.61 
    coh732:k=53.2629,b=0        15.49        15.531        15.579       15.632         15.69       15.753        16.066        16.163        16.268        16.381        16.499       16.616 
    coh733:k=53.3632,b=0       15.498        15.539        15.587        15.64        15.698       15.761        16.074         16.17        16.275        16.388        16.506       16.623 
    coh734:k=53.4636,b=0       15.506        15.547        15.595       15.648        15.706       15.769        16.081        16.178        16.282        16.395        16.513        16.63 
    coh735:k=53.5639,b=0       15.514        15.556        15.604       15.656        15.714       15.777        16.089        16.185         16.29        16.402         16.52       16.637 
    coh736:k=53.6643,b=0       15.523        15.564        15.612       15.664        15.722       15.785        16.096        16.193        16.297        16.409        16.527       16.643 
    coh737:k=53.7647,b=0       15.531        15.572         15.62       15.672         15.73       15.793        16.104          16.2        16.304        16.416        16.534        16.65 
    coh738:k=53.865,b=0        15.539         15.58        15.628        15.68        15.738       15.801        16.111        16.207        16.311        16.423        16.541       16.657 
    coh739:k=53.9654,b=0       15.547        15.588        15.636       15.688        15.746       15.808        16.119        16.215        16.319        16.431        16.548       16.663 
    coh740:k=54.0657,b=0       15.556        15.596        15.644       15.696        15.754       15.816        16.126        16.222        16.326        16.438        16.555        16.67 
    coh741:k=54.1661,b=0       15.564        15.604        15.652       15.704        15.762       15.824        16.134        16.229        16.333        16.445        16.562       16.677 
    coh742:k=54.2665,b=0       15.572        15.612         15.66       15.712         15.77       15.832        16.141        16.236         16.34        16.452        16.568       16.684 
    coh743:k=54.3668,b=0        15.58        15.621        15.668        15.72        15.777        15.84        16.148        16.244        16.347        16.459        16.575        16.69 
    coh744:k=54.4672,b=0       15.588        15.629        15.676       15.728        15.785       15.847        16.156        16.251        16.354        16.466        16.582       16.697 
    coh745:k=54.5675,b=0       15.597        15.637        15.684       15.736        15.793       15.855        16.163        16.258        16.361        16.473        16.589       16.703 
    coh746:k=54.6679,b=0       15.604        15.645        15.692       15.744        15.801       15.863         16.17        16.265        16.369         16.48        16.595        16.71 
    coh747:k=54.7683,b=0       15.612        15.653          15.7       15.752        15.809       15.871        16.178        16.273        16.376        16.486        16.602       16.716 
    coh748:k=54.8686,b=0        15.62        15.661        15.708        15.76        15.817       15.879        16.185         16.28        16.383        16.493        16.609       16.723 
    coh749:k=54.969,b=0        15.629        15.669        15.716       15.768        15.824       15.886        16.193        16.287         16.39          16.5        16.616       16.729 
    coh750:k=55.0693,b=0       15.637        15.677        15.724       15.776        15.832       15.894          16.2        16.294        16.397        16.507        16.622       16.736 
    coh751:k=55.1697,b=0       15.645        15.685        15.732       15.784         15.84       15.902        16.207        16.302        16.404        16.514        16.629       16.743 
    coh752:k=55.2701,b=0       15.653        15.693         15.74       15.791        15.848       15.909        16.214        16.309        16.411        16.521        16.636       16.749 
    coh753:k=55.3704,b=0       15.661        15.701        15.748       15.799        15.856       15.917        16.222        16.316        16.418        16.528        16.643       16.755 
    coh754:k=55.4708,b=0       15.669        15.709        15.756       15.807        15.863       15.925        16.229        16.323        16.425        16.535        16.649       16.761 
    coh755:k=55.5711,b=0       15.677        15.717        15.763       15.815        15.871       15.932        16.236         16.33        16.432        16.542        16.656       16.766 
    coh756:k=55.6715,b=0       15.685        15.725        15.771       15.823        15.879        15.94        16.244        16.337        16.439        16.548        16.662       16.772 
    coh757:k=55.7719,b=0       15.693        15.732        15.779       15.831        15.887       15.948        16.251        16.344        16.446        16.555        16.668       16.778 
    coh758:k=55.8722,b=0       15.701         15.74        15.787       15.838        15.894       15.955        16.258        16.352        16.453        16.562        16.675       16.785 
    coh759:k=55.9726,b=0       15.709        15.748        15.795       15.846        15.902       15.963        16.265        16.359         16.46        16.568        16.681       16.791 
    coh760:k=56.0729,b=0       15.716        15.756        15.803       15.854         15.91       15.971        16.273        16.366        16.467        16.575        16.688       16.798 
    coh761:k=56.1733,b=0       15.724        15.764         15.81       15.862        15.917       15.978         16.28        16.373        16.474        16.582        16.695       16.804 
    coh762:k=56.2737,b=0       15.732        15.772        15.818       15.869        15.925       15.986        16.287         16.38        16.481        16.589        16.701        16.81 
    coh763:k=56.374,b=0        15.734        15.774         15.82       15.871        15.927       15.988        16.289        16.382        16.482        16.591        16.703       16.812 
    coh764:k=56.4744,b=0       15.735        15.774        15.821       15.872        15.927       15.988        16.289        16.382        16.483        16.591        16.703       16.812 
    coh765:k=56.5747,b=0       15.735        15.775        15.821       15.872        15.928       15.989         16.29        16.383        16.484        16.592        16.704       16.815 
    coh766:k=56.6751,b=0       15.736        15.775        15.822       15.873        15.928       15.989         16.29        16.383        16.484        16.593        16.708       16.822 
    coh767:k=56.7755,b=0       15.736        15.776        15.822       15.873        15.929        15.99        16.292        16.387        16.489        16.599        16.715       16.828 
    coh768:k=56.8758,b=0       15.737        15.777        15.824       15.876        15.932       15.994        16.299        16.393        16.496        16.606        16.721       16.835 
    coh769:k=56.9762,b=0       15.744        15.784        15.831       15.883         15.94       16.001        16.306          16.4        16.503        16.613        16.728       16.841 
    coh770:k=57.0765,b=0       15.752        15.792        15.839       15.891        15.947       16.009        16.313        16.407         16.51        16.619        16.734       16.847 
    coh771:k=57.1769,b=0        15.76          15.8        15.847       15.898        15.955       16.016         16.32        16.414        16.516        16.626        16.741       16.852 
    coh772:k=57.2773,b=0       15.768        15.808        15.854       15.906        15.962       16.023        16.327        16.421        16.523        16.633        16.747       16.857 

tb_pol_a: optimal safe savings choice for each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0           -2.0567       -2.0567       -2.4641      -3.2788      -3.6861       -4.5008       -8.9816       -10.611       -13.055       -15.499       -18.351        -19.98 
    coh2:k=-19.8996,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh3:k=-19.7993,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh4:k=-19.6989,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh5:k=-19.5986,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh6:k=-19.4982,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh7:k=-19.3978,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh8:k=-19.2975,b=0          -20           -20           -20          -20          -20           -20           -20           -20           -20           -20           -20           -20 
    coh9:k=-19.1971,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999           -20           -20           -20           -20           -20           -20 
    coh10:k=-19.0968,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999           -20           -20           -20           -20           -20 
    coh11:k=-18.9964,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh12:k=-18.896,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh13:k=-18.7957,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh14:k=-18.6953,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh15:k=-18.595,b=0      -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh16:k=-18.4946,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh17:k=-18.3942,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh18:k=-18.2939,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh19:k=-18.1935,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh20:k=-18.0932,b=0     -19.999       -19.999       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh21:k=-17.9928,b=0     -19.998       -19.998       -19.999      -19.999      -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh22:k=-17.8924,b=0     -19.998       -19.998       -19.998      -19.998      -19.998       -19.998       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh23:k=-17.7921,b=0     -19.998       -19.998       -19.998      -19.998      -19.998       -19.998       -19.999       -19.999       -19.999       -19.999       -19.999       -19.999 
    coh24:k=-17.6917,b=0     -19.998       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.999       -19.999 
    coh25:k=-17.5914,b=0     -19.951       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh26:k=-17.491,b=0      -19.887       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh27:k=-17.3906,b=0     -19.819       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh28:k=-17.2903,b=0     -19.746       -19.998       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh29:k=-17.1899,b=0     -19.667       -19.966       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh30:k=-17.0896,b=0     -19.584       -19.906       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh31:k=-16.9892,b=0     -19.496       -19.829       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh32:k=-16.8888,b=0     -19.358       -19.748       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh33:k=-16.7885,b=0     -19.296       -19.661       -19.998      -19.998      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh34:k=-16.6881,b=0     -19.217         -19.6       -19.966      -19.997      -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh35:k=-16.5878,b=0     -19.109       -19.441       -19.903      -19.997      -19.997       -19.997       -19.998       -19.998       -19.998       -19.998       -19.998       -19.998 
    coh36:k=-16.4874,b=0     -19.038       -19.379       -19.823      -19.997      -19.997       -19.997       -19.997       -19.997       -19.998       -19.998       -19.998       -19.998 
    coh37:k=-16.387,b=0      -18.964       -19.276       -19.774      -19.997      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.998 
    coh38:k=-16.2867,b=0     -18.887       -19.188        -19.68      -19.997      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.998 
    coh39:k=-16.1863,b=0     -18.808       -19.117       -19.534      -19.997      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh40:k=-16.086,b=0      -18.726       -19.043       -19.424      -19.981      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh41:k=-15.9856,b=0     -18.642       -18.967       -19.357      -19.932      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh42:k=-15.8852,b=0     -18.554       -18.888       -19.288       -19.88      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh43:k=-15.7849,b=0     -18.386       -18.806       -19.216      -19.694      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh44:k=-15.6845,b=0      -18.34       -18.722       -19.142      -19.631      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh45:k=-15.5842,b=0     -18.242       -18.636       -19.065      -19.566      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh46:k=-15.4838,b=0      -18.14       -18.546       -18.985      -19.497      -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh47:k=-15.3834,b=0     -18.079        -18.42       -18.903       -19.38      -19.996       -19.996       -19.997       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh48:k=-15.2831,b=0     -18.008       -18.321       -18.818      -19.277      -19.888       -19.996       -19.996       -19.997       -19.997       -19.997       -19.997       -19.997 
    coh49:k=-15.1827,b=0       -17.9        -18.22       -18.731        -19.2      -19.824       -19.996       -19.996       -19.996       -19.996       -19.996       -19.997       -19.997 
    coh50:k=-15.0824,b=0      -17.79       -18.117       -18.642       -19.12      -19.757       -19.996       -19.996       -19.996       -19.996       -19.996       -19.996       -19.996 
    coh723:k=52.3596,b=0      44.974        43.621        43.621       43.621       42.269        42.269         36.86        35.508        32.803        31.451        27.395         24.69 
    coh724:k=52.46,b=0        45.064         43.71         43.71        43.71       42.355        42.355        36.939        35.585        32.877        31.523         27.46        24.752 
    coh725:k=52.5603,b=0      45.154        43.798        43.798       43.798       42.442        42.442        37.018        35.662         32.95        31.594        27.526        24.814 
    coh726:k=52.6607,b=0      45.244        43.886        43.886       43.886       42.528        42.528        37.097        35.739        33.023        31.665        27.592        24.876 
    coh727:k=52.7611,b=0      45.334        43.974        43.974       43.974       42.615        42.615        37.176        35.816        33.096        31.737        27.657        24.938 
    coh728:k=52.8614,b=0      45.424        44.063        44.063       44.063       42.701        42.701        37.254        35.893         33.17        31.808        27.723            25 
    coh729:k=52.9618,b=0      45.514        44.151        44.151       44.151       42.787        42.787        37.333         35.97        33.243        31.879        28.517        25.062 
    coh730:k=53.0621,b=0      45.604        44.239        44.239       44.239       42.874        42.874        37.412        36.047        33.316        31.951         29.22        25.124 
    coh731:k=53.1625,b=0      45.694        44.327        44.327       44.327        42.96         42.96        37.491        36.124        33.389        32.022        29.288        25.186 
    coh732:k=53.2629,b=0      45.785        44.415        44.415       44.415       43.046        43.046         37.57        36.201        33.858        32.093        29.355        25.248 
    coh733:k=53.3632,b=0      45.875        44.504        44.504       44.504       43.133        43.133        37.649        36.278        34.907        32.165        29.423         25.31 
    coh734:k=53.4636,b=0      45.965        44.592        44.592       44.592       43.219        43.219        37.728        36.355        34.982        32.236         29.49        25.372 
    coh735:k=53.5639,b=0      46.055         44.68         44.68        44.68       43.305        43.305        37.807        36.432        35.057        32.308        29.558        25.434 
    coh736:k=53.6643,b=0      46.145        44.768        44.768       44.768       43.392        43.392        37.885        36.509        35.132        32.379        29.626        25.496 
    coh737:k=53.7647,b=0      46.235        44.857        44.857       44.857       43.478        43.478        37.964        36.586        35.207         32.45        29.693        25.558 
    coh738:k=53.865,b=0       47.798        44.945        44.945       44.945       43.565        43.565        38.043        36.663        35.282        32.522        29.761         25.62 
    coh739:k=53.9654,b=0       47.89        45.033        45.033       45.033       43.651        43.651        38.122         36.74        35.357        32.593        29.829        25.682 
    coh740:k=54.0657,b=0      47.982        45.121        45.121       45.121       43.737        43.737        38.201        36.817        35.433        32.664        29.896        25.744 
    coh741:k=54.1661,b=0      48.074         45.21         45.21        45.21       43.824        43.824         38.28        36.894        35.508        32.736        29.964        25.806 
    coh742:k=54.2665,b=0      48.166        45.298        45.298       45.298        43.91         43.91        38.359        36.971        35.583        32.807        30.031        26.521 
    coh743:k=54.3668,b=0      48.258        45.386        45.386       45.386       43.996        43.996        38.437        37.048        35.658        32.878        30.099        27.319 
    coh744:k=54.4672,b=0       48.35        45.474        45.474       45.474       44.083        44.083        38.516        37.125        35.733         32.95        30.167        27.383 
    coh745:k=54.5675,b=0      48.442        45.563        45.563       45.563       44.169        44.169        38.595        37.202        35.808        33.021        30.234        27.447 
    coh746:k=54.6679,b=0      47.046        45.651        45.651       45.651       44.255        44.255        38.674        37.279        35.883        33.093        30.302        27.511 
    coh747:k=54.7683,b=0      47.136        45.739        45.739       45.739       44.342        44.342        38.753        37.356        35.958        33.164        30.369        27.575 
    coh748:k=54.8686,b=0      47.226        45.827        45.827       45.827       44.428        44.428        38.832        37.433        36.033        33.235        30.437        27.639 
    coh749:k=54.969,b=0       47.317        45.916        45.916       45.916       44.515        44.515        38.911         37.51        36.109        33.307        30.505        27.703 
    coh750:k=55.0693,b=0      47.407        46.004        46.004       46.004       44.601        44.601        40.135        37.587        36.184        33.378        30.572        27.766 
    coh751:k=55.1697,b=0      47.497        46.092        46.092       46.092       44.687        44.687        40.473        37.664        36.259        33.449         30.64         27.83 
    coh752:k=55.2701,b=0      47.587         46.18         46.18        46.18       44.774        44.774        40.554        37.741        36.334        33.521        30.707        27.894 
    coh753:k=55.3704,b=0      47.677        46.269        46.269       46.269        44.86         44.86        40.635        37.818        36.409        33.592        30.775        28.763 
    coh754:k=55.4708,b=0      47.767        46.357        46.357       46.357       44.946        44.946        40.715        37.895        36.484        33.663        31.533        29.432 
    coh755:k=55.5711,b=0      47.857        46.445        46.445       46.445       45.033        45.033        40.796        37.972        36.559        33.735        32.323        29.498 
    coh756:k=55.6715,b=0      47.947        46.533        46.533       46.533       45.119        45.119        40.877        38.048        36.634        33.806        32.392        29.103 
    coh757:k=55.7719,b=0      48.037        46.621        46.621       46.621       45.205        45.205        40.957        38.125        36.709        33.877        32.116        28.213 
    coh758:k=55.8722,b=0      48.128         46.71         46.71        46.71       45.292        45.292        41.038        38.202        36.785        33.949        31.113        28.277 
    coh759:k=55.9726,b=0      48.218        46.798        46.798       46.798       45.378        45.378        41.119        38.279         36.86         34.02        31.181        28.341 
    coh760:k=56.0729,b=0      48.308        46.886        46.886       46.886       45.465        45.465          41.2        38.356        36.935        34.092        31.248        28.405 
    coh761:k=56.1733,b=0      48.398        46.974        46.974       46.974       45.551        45.551         41.28        38.433         37.01        34.163        31.316        28.469 
    coh762:k=56.2737,b=0      48.488        47.063        47.063       47.063       45.637        45.637        41.361         38.51        37.085        34.234        31.384        28.533 
    coh763:k=56.374,b=0        48.58        47.154        47.154       47.154       45.728        45.728        41.451          38.6        37.174        34.323        31.471         28.62 
    coh764:k=56.4744,b=0      48.672        47.246        47.246       47.246        45.82         45.82        41.543        38.692        37.266        34.415        31.563        28.712 
    coh765:k=56.5747,b=0      48.764        47.338        47.338       47.338       45.913        45.913        41.635        38.784        37.358        34.507        31.655        27.643 
    coh766:k=56.6751,b=0      48.856         47.43         47.43        47.43       46.005        46.005        41.727        38.876         37.45         33.31        30.507        27.705 
    coh767:k=56.7755,b=0      48.948        47.522        47.522       47.522       46.097        46.097         40.16        37.588        36.185        33.379        30.573        27.768 
    coh768:k=56.8758,b=0       49.04        46.092        46.092       46.092       44.687        44.687        40.473        37.663        36.259        33.449         30.64         27.83 
    coh769:k=56.9762,b=0      47.585        46.178        46.178       46.178       44.771        44.771        40.552        37.739        36.332        33.519        30.706        27.893 
    coh770:k=57.0765,b=0      47.673        46.264        46.264       46.264       44.856        44.856        40.631        37.814        36.405        33.589        30.772        28.697 
    coh771:k=57.1769,b=0      47.761        46.351        46.351       46.351        44.94         44.94         40.71        37.889        36.479        33.658        31.437        29.428 
    coh772:k=57.2773,b=0      47.849        46.437        46.437       46.437       45.025        45.025        40.789        37.964        36.552        33.728        32.316        29.492 

tb_pol_k: optimal risky investment choice for each state space point
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0             2.0567        2.0567       2.4641       3.2788        3.6861        4.5008        8.9816        10.611        13.055        15.499        18.351        19.98 
    coh2:k=-19.8996,b=0      0.079739      0.079739     0.079739     0.081781      0.081781      0.081781      0.083823      0.083823      0.083823      0.083823      0.083823     0.083823 
    coh3:k=-19.7993,b=0       0.11455       0.10639       0.1023       0.1023        0.1023        0.1023        0.1023        0.1023        0.1023        0.1023        0.1023       0.1023 
    coh4:k=-19.6989,b=0       0.20246       0.19634      0.19634      0.19021       0.17796        0.1657       0.12895        0.1167       0.10444       0.10444       0.10444      0.10444 
    coh5:k=-19.5986,b=0       0.26178       0.25361      0.24544      0.23728       0.22094        0.2046       0.19644       0.19644       0.19644       0.19644        0.1801      0.17193 
    coh6:k=-19.4982,b=0       0.32723       0.31702       0.3068       0.3068       0.29659       0.29659       0.25575       0.23533       0.22512       0.21491        0.2047       0.2047 
    coh7:k=-19.3978,b=0       0.40492       0.40492      0.39267      0.39267       0.38042       0.35591       0.30691       0.30691       0.29465       0.29465       0.29465       0.2824 
    coh8:k=-19.2975,b=0        0.4867       0.47241      0.45812      0.44382       0.42953       0.41523       0.40094       0.37235       0.35806       0.34376       0.32947      0.31517 
    coh9:k=-19.1971,b=0       0.55623        0.5399      0.52356      0.50722       0.50722       0.50722       0.44188       0.42554       0.40921       0.40921       0.39287      0.39287 
    coh10:k=-19.0968,b=0      0.62576       0.60738      0.60738      0.60738       0.58901       0.58901       0.51549       0.49711       0.49711       0.47874       0.46036      0.44198 
    coh11:k=-18.9964,b=0      0.71571       0.69529      0.69529      0.67487       0.65445       0.63403       0.59319       0.57277       0.55235       0.53193       0.51151      0.51151 
    coh12:k=-18.896,b=0       0.78728       0.78728      0.76482      0.74236        0.7199        0.7199       0.65251       0.63005       0.60758       0.60758       0.58512      0.58512 
    coh13:k=-18.7957,b=0      0.85885       0.85885      0.83435      0.80984       0.80984       0.80984       0.71183       0.71183       0.68732       0.68732       0.66282      0.63831 
    coh14:k=-18.6953,b=0      0.95697       0.93042      0.90388      0.90388       0.90388       0.87733       0.79769       0.79769       0.77115        0.7446       0.71805      0.71805 
    coh15:k=-18.595,b=0        1.0306         1.002        1.002        1.002       0.97341       0.94482       0.88764       0.85905       0.83047       0.80188       0.80188      0.77329 
    coh16:k=-18.4946,b=0       1.1042        1.1042       1.0736       1.0736        1.0429        1.0123       0.95105       0.92041       0.88978       0.88978       0.85915      0.82852 
    coh17:k=-18.3942,b=0       1.1778        1.1778       1.1451       1.1451        1.1125        1.1125        1.0144        1.0144       0.98178        0.9491       0.91643      0.91643 
    coh18:k=-18.2939,b=0       1.2861        1.2514       1.2514       1.2167        1.2167         1.182        1.1126        1.0779        1.0431        1.0084        1.0084       1.0084 
    coh19:k=-18.1935,b=0       1.3618         1.325        1.325       1.2883        1.2883        1.2515         1.178        1.1413        1.1045        1.1045        1.1045       1.0677 
    coh20:k=-18.0932,b=0       1.4374        1.3986       1.3986       1.3986        1.3599        1.3599        1.2435        1.2047        1.2047        1.1659        1.1659       1.1271 
    coh21:k=-17.9928,b=0       1.5131        1.5131       1.4723       1.4723        1.4314        1.4314        1.3089        1.3089        1.2681        1.2681        1.2272       1.1864 
    coh22:k=-17.8924,b=0       1.5888        1.5888       1.5888       1.5459         1.503         1.503        1.4172        1.3743        1.3743        1.3315        1.2886       1.2886 
    coh23:k=-17.7921,b=0       1.6644        1.6644       1.6644       1.6195        1.6195        1.5746        1.4847        1.4398        1.4398        1.3949        1.3949       1.3499 
    coh24:k=-17.6917,b=0        1.787        1.7401       1.7401       1.6931        1.6931        1.6461        1.5522        1.5522        1.5052        1.5052        1.4583       1.4113 
    coh25:k=-17.5914,b=0       1.8172        1.8157       1.8157       1.8157        1.7667        1.7667        1.6197        1.6197        1.5707        1.5707        1.5217       1.5217 
    coh26:k=-17.491,b=0        1.8315        1.8914       1.8914       1.8914        1.8403        1.8403        1.7382        1.6872        1.6872        1.6361        1.5851       1.5851 
    coh27:k=-17.3906,b=0       1.8413        2.0201        1.967        1.967        1.9139        1.9139        1.8078        1.7547        1.7547        1.7016        1.7016       1.6485 
    coh28:k=-17.2903,b=0       1.8462        2.0978       2.0427       2.0427        2.0427        1.9876        1.8773        1.8773        1.8222         1.767         1.767       1.7119 
    coh29:k=-17.1899,b=0       1.8452        2.1434       2.1183       2.1183        2.1183        2.0612        1.9468        1.9468        1.8896        1.8896        1.8325       1.8325 
    coh30:k=-17.0896,b=0       1.8396        2.1612       2.2532        2.194         2.194        2.1348        2.0163        2.0163        1.9571        1.9571        1.8979       1.8979 
    coh31:k=-16.9892,b=0       1.8296        2.1623       2.3309       2.2697        2.2697        2.2084        2.1471        2.0859        2.0859        2.0246        1.9634       1.9634 
    coh32:k=-16.8888,b=0       1.8328        2.1589       2.4086       2.4086        2.3453        2.3453        2.2187        2.1554        2.1554        2.0921        2.0921       2.0288 
    coh33:k=-16.7885,b=0       1.8504        2.1494       2.4863       2.4863         2.421         2.421        2.2903        2.2249        2.2249        2.1596        2.1596       2.0942 
    coh34:k=-16.6881,b=0       1.8511        2.1666       2.5325        2.564        2.4966        2.4966        2.3618        2.3618        2.2945        2.2945        2.2271       2.1597 
    coh35:k=-16.5878,b=0       1.8233        2.1549       2.5473       2.6417        2.5723        2.5723        2.4334        2.4334         2.364         2.364        2.2946       2.2946 
    coh36:k=-16.4874,b=0       1.8315        2.1729       2.5449       2.7194        2.7194        2.6479         2.505         2.505        2.4335        2.4335         2.362        2.362 
    coh37:k=-16.387,b=0         1.837        2.1495       2.5735       2.7971        2.7971        2.7236        2.5766        2.5766         2.503         2.503         2.503       2.4295 
    coh38:k=-16.2867,b=0       1.8401        2.1409       2.5581       2.8748        2.8748        2.7992        2.7237        2.6481        2.6481        2.5726        2.5726        2.497 
    coh39:k=-16.1863,b=0       1.8408        2.1497       2.5667       2.9525        2.9525        2.8749        2.7973        2.7197        2.7197        2.6421        2.6421       2.5645 
    coh40:k=-16.086,b=0        1.8391        2.1561       2.5366       3.0146        3.0302        3.0302        2.8709        2.7913        2.7913        2.7116        2.7116       2.7116 
    coh41:k=-15.9856,b=0       1.8343        2.1595       2.5496       3.0431        3.1079        3.1079        2.9445        2.9445        2.8628        2.8628        2.7812       2.7812 
    coh42:k=-15.8852,b=0        1.827        2.1602       2.5601       3.0686        3.1856        3.1856        3.0181        3.0181        2.9344        2.9344        2.8507       2.8507 
    coh43:k=-15.7849,b=0       1.8242        2.1586       2.5682       3.0462        3.2633        3.2633        3.0918        3.0918         3.006         3.006        2.9202       2.9202 
    coh44:k=-15.6845,b=0       1.8602        2.1545       2.5739       3.0632         3.341         3.341        3.1654        3.1654        3.0776        3.0776        2.9898       2.9898 
    coh45:k=-15.5842,b=0       1.8436         2.148       2.5772       3.0779        3.4187        3.4187         3.239         3.239         3.239        3.1491        3.1491       3.0593 
    coh46:k=-15.4838,b=0        1.824        2.1383       2.5772       3.0893        3.4964        3.4964        3.4045        3.3126        3.3126        3.2207        3.2207       3.1288 
    coh47:k=-15.3834,b=0       1.8445        2.1853       2.5748        3.052        3.5741        3.5741        3.4801        3.3862        3.3862        3.2923        3.2923       3.1983 
    coh48:k=-15.2831,b=0       1.8555        2.1689         2.57       3.0284        3.6397        3.6518        3.5558        3.4598        3.4598        3.3638        3.3638       3.3638 
    coh49:k=-15.1827,b=0       1.8298        2.1499       2.5627       3.0309        3.6552        3.7295        3.6314        3.5334        3.5334        3.5334        3.4354       3.4354 
    coh50:k=-15.0824,b=0       1.8015        2.1283        2.553        3.031        3.6683        3.8072        3.7071         3.607         3.607         3.607         3.507        3.507 
    coh723:k=52.3596,b=0       1.4186        2.7709       2.7709       2.7709        4.1231        4.1231         9.532        10.884        13.589        14.941        18.998       21.702 
    coh724:k=52.46,b=0         1.4206        2.7747       2.7747       2.7747        4.1288        4.1288        9.5452        10.899        13.608        14.962        19.024       21.732 
    coh725:k=52.5603,b=0       1.4226        2.7785       2.7785       2.7785        4.1345        4.1345        9.5585        10.914        13.626        14.982         19.05       21.762 
    coh726:k=52.6607,b=0       1.4245        2.7824       2.7824       2.7824        4.1402        4.1402        9.5717         10.93        13.645        15.003        19.077       21.792 
    coh727:k=52.7611,b=0       1.4265        2.7862       2.7862       2.7862         4.146         4.146        9.5849        10.945        13.664        15.024        19.103       21.823 
    coh728:k=52.8614,b=0       1.4285        2.7901       2.7901       2.7901        4.1517        4.1517        9.5981         10.96        13.683        15.045        19.129       21.853 
    coh729:k=52.9618,b=0       1.4304        2.7939       2.7939       2.7939        4.1574        4.1574        9.6113        10.975        13.702        15.065        18.427       21.883 
    coh730:k=53.0621,b=0       1.4324        2.7978       2.7978       2.7978        4.1631        4.1631        9.6246         10.99        13.721        15.086        17.817       21.913 
    coh731:k=53.1625,b=0       1.4344        2.8016       2.8016       2.8016        4.1688        4.1688        9.6378        11.005        13.739        15.107        17.841       21.943 
    coh732:k=53.2629,b=0       1.4363        2.8054       2.8054       2.8054        4.1746        4.1746         9.651         11.02        13.363        15.127        17.866       21.973 
    coh733:k=53.3632,b=0       1.4383        2.8093       2.8093       2.8093        4.1803        4.1803        9.6642        11.035        12.406        15.148         17.89       22.003 
    coh734:k=53.4636,b=0       1.4403        2.8131       2.8131       2.8131         4.186         4.186        9.6774         11.05        12.423        15.169        17.915       22.033 
    coh735:k=53.5639,b=0       1.4422         2.817        2.817        2.817        4.1917        4.1917        9.6907        11.065         12.44         15.19        17.939       22.063 
    coh736:k=53.6643,b=0       1.4442        2.8208       2.8208       2.8208        4.1974        4.1974        9.7039         11.08        12.457         15.21        17.964       22.093 
    coh737:k=53.7647,b=0       1.4462        2.8247       2.8247       2.8247        4.2031        4.2031        9.7171        11.096        12.474        15.231        17.988       22.124 
    coh738:k=53.865,b=0        1.4803        2.8285       2.8285       2.8285        4.2089        4.2089        9.7303        11.111        12.491        15.252        18.013       22.154 
    coh739:k=53.9654,b=0       1.4823        2.8323       2.8323       2.8323        4.2146        4.2146        9.7435        11.126        12.508        15.273        18.037       22.184 
    coh740:k=54.0657,b=0       1.4843        2.8362       2.8362       2.8362        4.2203        4.2203        9.7568        11.141        12.525        15.293        18.061       22.214 
    coh741:k=54.1661,b=0       1.4863          2.84         2.84         2.84         4.226         4.226          9.77        11.156        12.542        15.314        18.086       22.244 
    coh742:k=54.2665,b=0       1.4883        2.8439       2.8439       2.8439        4.2317        4.2317        9.7832        11.171        12.559        15.335         18.11        21.62 
    coh743:k=54.3668,b=0       1.4903        2.8477       2.8477       2.8477        4.2375        4.2375        9.7964        11.186        12.576        15.355        18.135       20.914 
    coh744:k=54.4672,b=0       1.4924        2.8516       2.8516       2.8516        4.2432        4.2432        9.8096        11.201        12.593        15.376        18.159       20.943 
    coh745:k=54.5675,b=0       1.4944        2.8554       2.8554       2.8554        4.2489        4.2489        9.8229        11.216         12.61        15.397        18.184       20.971 
    coh746:k=54.6679,b=0       1.4639        2.8592       2.8592       2.8592        4.2546        4.2546        9.8361        11.231        12.627        15.418        18.208       20.999 
    coh747:k=54.7683,b=0       1.4658        2.8631       2.8631       2.8631        4.2603        4.2603        9.8493        11.247        12.644        15.438        18.233       21.027 
    coh748:k=54.8686,b=0       1.4678        2.8669       2.8669       2.8669        4.2661        4.2661        9.8625        11.262        12.661        15.459        18.257       21.055 
    coh749:k=54.969,b=0        1.4698        2.8708       2.8708       2.8708        4.2718        4.2718        9.8758        11.277        12.678         15.48        18.282       21.084 
    coh750:k=55.0693,b=0       1.4717        2.8746       2.8746       2.8746        4.2775        4.2775        8.7436        11.292        12.695          15.5        18.306       21.112 
    coh751:k=55.1697,b=0       1.4737        2.8785       2.8785       2.8785        4.2832        4.2832        8.4974        11.307        12.712        15.521        18.331        21.14 
    coh752:k=55.2701,b=0       1.4757        2.8823       2.8823       2.8823        4.2889        4.2889        8.5088        11.322        12.729        15.542        18.355       21.168 
    coh753:k=55.3704,b=0       1.4777        2.8861       2.8861       2.8861        4.2946        4.2946        8.5201        11.337        12.746        15.563         18.38       20.392 
    coh754:k=55.4708,b=0       1.4796          2.89         2.89         2.89        4.3004        4.3004        8.5315        11.352        12.763        15.583        17.714       19.814 
    coh755:k=55.5711,b=0       1.4816        2.8938       2.8938       2.8938        4.3061        4.3061        8.5428        11.367         12.78        15.604        17.016       19.841 
    coh756:k=55.6715,b=0       1.4836        2.8977       2.8977       2.8977        4.3118        4.3118        8.5542        11.382        12.797        15.625        17.039       20.328 
    coh757:k=55.7719,b=0       1.4855        2.9015       2.9015       2.9015        4.3175        4.3175        8.5655        11.398        12.814        15.646        17.407        21.31 
    coh758:k=55.8722,b=0       1.4875        2.9054       2.9054       2.9054        4.3232        4.3232        8.5769        11.413         12.83        15.666        18.502       21.338 
    coh759:k=55.9726,b=0       1.4895        2.9092       2.9092       2.9092         4.329         4.329        8.5882        11.428        12.847        15.687        18.526       21.366 
    coh760:k=56.0729,b=0       1.4914        2.9131       2.9131       2.9131        4.3347        4.3347        8.5996        11.443        12.864        15.708        18.551       21.394 
    coh761:k=56.1733,b=0       1.4934        2.9169       2.9169       2.9169        4.3404        4.3404        8.6109        11.458        12.881        15.728        18.575       21.422 
    coh762:k=56.2737,b=0       1.4954        2.9207       2.9207       2.9207        4.3461        4.3461        8.6222        11.473        12.898        15.749          18.6       21.451 
    coh763:k=56.374,b=0        1.4957        2.9214       2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.456 
    coh764:k=56.4744,b=0       1.4957        2.9214       2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.456 
    coh765:k=56.5747,b=0       1.4957        2.9214       2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.753        18.604       21.057 
    coh766:k=56.6751,b=0       1.4957        2.9214       2.9214       2.9214        4.3471        4.3471        8.6243        11.476        12.901        15.481        18.283       21.085 
    coh767:k=56.7755,b=0       1.4957        2.9214       2.9214       2.9214        4.3471        4.3471          8.72        11.292        12.695        15.501        18.307       21.112 
    coh768:k=56.8758,b=0       1.4957        2.8784       2.8784       2.8784        4.2832        4.2832        8.4974        11.307        12.712        15.521        18.331        21.14 
    coh769:k=56.9762,b=0       1.4756        2.8822       2.8822       2.8822        4.2888        4.2888        8.5085        11.322        12.728        15.541        18.355       21.168 
    coh770:k=57.0765,b=0       1.4776         2.886        2.886        2.886        4.2944        4.2944        8.5196        11.336        12.745        15.562        18.378       20.453 
    coh771:k=57.1769,b=0       1.4795        2.8897       2.8897       2.8897           4.3           4.3        8.5307        11.351        12.761        15.582        17.803       19.813 
    coh772:k=57.2773,b=0       1.4814        2.8935       2.8935       2.8935        4.3056        4.3056        8.5418        11.366        12.778        15.602        17.014       19.838 

tb_pol_w: risky + safe investment choices (first stage choice, choose within risky vs safe)
                            z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                            __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    coh1:k=-20,b=0                 0             0             0            0            0             0             0             0             0             0             0             0 
    coh2:k=-19.8996,b=0       -19.92        -19.92        -19.92      -19.918      -19.918       -19.918       -19.916       -19.916       -19.916       -19.916       -19.916       -19.916 
    coh3:k=-19.7993,b=0      -19.885       -19.894       -19.898      -19.898      -19.898       -19.898       -19.898       -19.898       -19.898       -19.898       -19.898       -19.898 
    coh4:k=-19.6989,b=0      -19.797       -19.803       -19.803       -19.81      -19.822       -19.834       -19.871       -19.883       -19.895       -19.895       -19.895       -19.895 
    coh5:k=-19.5986,b=0      -19.738       -19.746       -19.754      -19.762      -19.779       -19.795       -19.803       -19.803       -19.803       -19.803        -19.82       -19.828 
    coh6:k=-19.4982,b=0      -19.672       -19.683       -19.693      -19.693      -19.703       -19.703       -19.744       -19.764       -19.775       -19.785       -19.795       -19.795 
    coh7:k=-19.3978,b=0      -19.595       -19.595       -19.607      -19.607      -19.619       -19.644       -19.693       -19.693       -19.705       -19.705       -19.705       -19.717 
    coh8:k=-19.2975,b=0      -19.513       -19.527       -19.541      -19.556       -19.57       -19.584       -19.599       -19.627       -19.642       -19.656        -19.67       -19.685 
    coh9:k=-19.1971,b=0      -19.443        -19.46       -19.476      -19.492      -19.492       -19.492       -19.558       -19.574        -19.59        -19.59       -19.607       -19.607 
    coh10:k=-19.0968,b=0     -19.374       -19.392       -19.392      -19.392       -19.41        -19.41       -19.484       -19.502       -19.502       -19.521       -19.539       -19.558 
    coh11:k=-18.9964,b=0     -19.284       -19.304       -19.304      -19.324      -19.345       -19.365       -19.406       -19.427       -19.447       -19.468       -19.488       -19.488 
    coh12:k=-18.896,b=0      -19.212       -19.212       -19.234      -19.257      -19.279       -19.279       -19.347       -19.369       -19.392       -19.392       -19.414       -19.414 
    coh13:k=-18.7957,b=0      -19.14        -19.14       -19.165      -19.189      -19.189       -19.189       -19.287       -19.287       -19.312       -19.312       -19.337       -19.361 
    coh14:k=-18.6953,b=0     -19.042       -19.069       -19.095      -19.095      -19.095       -19.122       -19.202       -19.202       -19.228       -19.255       -19.281       -19.281 
    coh15:k=-18.595,b=0      -18.968       -18.997       -18.997      -18.997      -19.026       -19.054       -19.111        -19.14       -19.169       -19.197       -19.197       -19.226 
    coh16:k=-18.4946,b=0     -18.895       -18.895       -18.925      -18.925      -18.956       -18.987       -19.048       -19.079       -19.109       -19.109        -19.14       -19.171 
    coh17:k=-18.3942,b=0     -18.821       -18.821       -18.854      -18.854      -18.886       -18.886       -18.985       -18.985       -19.017        -19.05       -19.083       -19.083 
    coh18:k=-18.2939,b=0     -18.713       -18.747       -18.747      -18.782      -18.782       -18.817       -18.886       -18.921       -18.956       -18.991       -18.991       -18.991 
    coh19:k=-18.1935,b=0     -18.637       -18.674       -18.674       -18.71       -18.71       -18.747       -18.821       -18.858       -18.894       -18.894       -18.894       -18.931 
    coh20:k=-18.0932,b=0     -18.561         -18.6         -18.6        -18.6      -18.639       -18.639       -18.755       -18.794       -18.794       -18.833       -18.833       -18.872 
    coh21:k=-17.9928,b=0     -18.485       -18.485       -18.526      -18.526      -18.567       -18.567        -18.69        -18.69       -18.731       -18.731       -18.772       -18.812 
    coh22:k=-17.8924,b=0      -18.41        -18.41        -18.41      -18.453      -18.496       -18.496       -18.581       -18.624       -18.624       -18.667        -18.71        -18.71 
    coh23:k=-17.7921,b=0     -18.334       -18.334       -18.334      -18.379      -18.379       -18.424       -18.514       -18.559       -18.559       -18.604       -18.604       -18.649 
    coh24:k=-17.6917,b=0     -18.211       -18.258       -18.258      -18.305      -18.305       -18.352       -18.446       -18.446       -18.493       -18.493        -18.54       -18.587 
    coh25:k=-17.5914,b=0     -18.133       -18.182       -18.182      -18.182      -18.232       -18.232       -18.379       -18.379       -18.428       -18.428       -18.477       -18.477 
    coh26:k=-17.491,b=0      -18.056       -18.107       -18.107      -18.107      -18.158       -18.158        -18.26       -18.311       -18.311       -18.362       -18.413       -18.413 
    coh27:k=-17.3906,b=0     -17.978       -17.978       -18.031      -18.031      -18.084       -18.084        -18.19       -18.244       -18.244       -18.297       -18.297        -18.35 
    coh28:k=-17.2903,b=0       -17.9         -17.9       -17.955      -17.955      -17.955        -18.01       -18.121       -18.121       -18.176       -18.231       -18.231       -18.286 
    coh29:k=-17.1899,b=0     -17.822       -17.822        -17.88       -17.88       -17.88       -17.937       -18.051       -18.051       -18.108       -18.108       -18.166       -18.166 
    coh30:k=-17.0896,b=0     -17.745       -17.745       -17.745      -17.804      -17.804       -17.863       -17.982       -17.982       -18.041       -18.041         -18.1         -18.1 
    coh31:k=-16.9892,b=0     -17.667       -17.667       -17.667      -17.728      -17.728       -17.789       -17.851       -17.912       -17.912       -17.973       -18.035       -18.035 
    coh32:k=-16.8888,b=0     -17.526       -17.589       -17.589      -17.589      -17.652       -17.652       -17.779       -17.842       -17.842       -17.906       -17.906       -17.969 
    coh33:k=-16.7885,b=0     -17.446       -17.511       -17.511      -17.511      -17.577       -17.577       -17.707       -17.773       -17.773       -17.838       -17.838       -17.904 
    coh34:k=-16.6881,b=0     -17.366       -17.433       -17.433      -17.433      -17.501       -17.501       -17.636       -17.636       -17.703       -17.703       -17.771       -17.838 
    coh35:k=-16.5878,b=0     -17.286       -17.286       -17.356      -17.356      -17.425       -17.425       -17.564       -17.564       -17.634       -17.634       -17.703       -17.703 
    coh36:k=-16.4874,b=0     -17.206       -17.206       -17.278      -17.278      -17.278       -17.349       -17.493       -17.493       -17.564       -17.564       -17.636       -17.636 
    coh37:k=-16.387,b=0      -17.127       -17.127         -17.2        -17.2        -17.2       -17.274       -17.421       -17.421       -17.494       -17.494       -17.494       -17.568 
    coh38:k=-16.2867,b=0     -17.047       -17.047       -17.122      -17.122      -17.122       -17.198       -17.274       -17.349       -17.349       -17.425       -17.425         -17.5 
    coh39:k=-16.1863,b=0     -16.967       -16.967       -16.967      -17.045      -17.045       -17.122         -17.2       -17.278       -17.278       -17.355       -17.355       -17.433 
    coh40:k=-16.086,b=0      -16.887       -16.887       -16.887      -16.967      -16.967       -16.967       -17.126       -17.206       -17.206       -17.286       -17.286       -17.286 
    coh41:k=-15.9856,b=0     -16.807       -16.807       -16.807      -16.889      -16.889       -16.889       -17.053       -17.053       -17.134       -17.134       -17.216       -17.216 
    coh42:k=-15.8852,b=0     -16.727       -16.727       -16.727      -16.811      -16.811       -16.811       -16.979       -16.979       -17.063       -17.063       -17.146       -17.146 
    coh43:k=-15.7849,b=0     -16.562       -16.648       -16.648      -16.648      -16.733       -16.733       -16.905       -16.905       -16.991       -16.991       -17.077       -17.077 
    coh44:k=-15.6845,b=0      -16.48       -16.568       -16.568      -16.568      -16.656       -16.656       -16.831       -16.831       -16.919       -16.919       -17.007       -17.007 
    coh45:k=-15.5842,b=0     -16.398       -16.488       -16.488      -16.488      -16.578       -16.578       -16.758       -16.758       -16.758       -16.848       -16.848       -16.938 
    coh46:k=-15.4838,b=0     -16.316       -16.408       -16.408      -16.408        -16.5         -16.5       -16.592       -16.684       -16.684       -16.776       -16.776       -16.868 
    coh47:k=-15.3834,b=0     -16.234       -16.234       -16.328      -16.328      -16.422       -16.422       -16.516        -16.61        -16.61       -16.704       -16.704       -16.798 
    coh48:k=-15.2831,b=0     -16.152       -16.152       -16.249      -16.249      -16.249       -16.345       -16.441       -16.537       -16.537       -16.633       -16.633       -16.633 
    coh49:k=-15.1827,b=0     -16.071       -16.071       -16.169      -16.169      -16.169       -16.267       -16.365       -16.463       -16.463       -16.463       -16.561       -16.561 
    coh50:k=-15.0824,b=0     -15.989       -15.989       -16.089      -16.089      -16.089       -16.189       -16.289       -16.389       -16.389       -16.389        -16.49        -16.49 
    coh723:k=52.3596,b=0      46.392        46.392        46.392       46.392       46.392        46.392        46.392        46.392        46.392        46.392        46.392        46.392 
    coh724:k=52.46,b=0        46.484        46.484        46.484       46.484       46.484        46.484        46.484        46.484        46.484        46.484        46.484        46.484 
    coh725:k=52.5603,b=0      46.576        46.576        46.576       46.576       46.576        46.576        46.576        46.576        46.576        46.576        46.576        46.576 
    coh726:k=52.6607,b=0      46.668        46.668        46.668       46.668       46.668        46.668        46.668        46.668        46.668        46.668        46.668        46.668 
    coh727:k=52.7611,b=0       46.76         46.76         46.76        46.76        46.76         46.76         46.76         46.76         46.76         46.76         46.76         46.76 
    coh728:k=52.8614,b=0      46.853        46.853        46.853       46.853       46.853        46.853        46.853        46.853        46.853        46.853        46.853        46.853 
    coh729:k=52.9618,b=0      46.945        46.945        46.945       46.945       46.945        46.945        46.945        46.945        46.945        46.945        46.945        46.945 
    coh730:k=53.0621,b=0      47.037        47.037        47.037       47.037       47.037        47.037        47.037        47.037        47.037        47.037        47.037        47.037 
    coh731:k=53.1625,b=0      47.129        47.129        47.129       47.129       47.129        47.129        47.129        47.129        47.129        47.129        47.129        47.129 
    coh732:k=53.2629,b=0      47.221        47.221        47.221       47.221       47.221        47.221        47.221        47.221        47.221        47.221        47.221        47.221 
    coh733:k=53.3632,b=0      47.313        47.313        47.313       47.313       47.313        47.313        47.313        47.313        47.313        47.313        47.313        47.313 
    coh734:k=53.4636,b=0      47.405        47.405        47.405       47.405       47.405        47.405        47.405        47.405        47.405        47.405        47.405        47.405 
    coh735:k=53.5639,b=0      47.497        47.497        47.497       47.497       47.497        47.497        47.497        47.497        47.497        47.497        47.497        47.497 
    coh736:k=53.6643,b=0      47.589        47.589        47.589       47.589       47.589        47.589        47.589        47.589        47.589        47.589        47.589        47.589 
    coh737:k=53.7647,b=0      47.681        47.681        47.681       47.681       47.681        47.681        47.681        47.681        47.681        47.681        47.681        47.681 
    coh738:k=53.865,b=0       49.278        47.773        47.773       47.773       47.773        47.773        47.773        47.773        47.773        47.773        47.773        47.773 
    coh739:k=53.9654,b=0      49.372        47.865        47.865       47.865       47.865        47.865        47.865        47.865        47.865        47.865        47.865        47.865 
    coh740:k=54.0657,b=0      49.466        47.958        47.958       47.958       47.958        47.958        47.958        47.958        47.958        47.958        47.958        47.958 
    coh741:k=54.1661,b=0       49.56         48.05         48.05        48.05        48.05         48.05         48.05         48.05         48.05         48.05         48.05         48.05 
    coh742:k=54.2665,b=0      49.654        48.142        48.142       48.142       48.142        48.142        48.142        48.142        48.142        48.142        48.142        48.142 
    coh743:k=54.3668,b=0      49.748        48.234        48.234       48.234       48.234        48.234        48.234        48.234        48.234        48.234        48.234        48.234 
    coh744:k=54.4672,b=0      49.843        48.326        48.326       48.326       48.326        48.326        48.326        48.326        48.326        48.326        48.326        48.326 
    coh745:k=54.5675,b=0      49.937        48.418        48.418       48.418       48.418        48.418        48.418        48.418        48.418        48.418        48.418        48.418 
    coh746:k=54.6679,b=0       48.51         48.51         48.51        48.51        48.51         48.51         48.51         48.51         48.51         48.51         48.51         48.51 
    coh747:k=54.7683,b=0      48.602        48.602        48.602       48.602       48.602        48.602        48.602        48.602        48.602        48.602        48.602        48.602 
    coh748:k=54.8686,b=0      48.694        48.694        48.694       48.694       48.694        48.694        48.694        48.694        48.694        48.694        48.694        48.694 
    coh749:k=54.969,b=0       48.786        48.786        48.786       48.786       48.786        48.786        48.786        48.786        48.786        48.786        48.786        48.786 
    coh750:k=55.0693,b=0      48.878        48.878        48.878       48.878       48.878        48.878        48.878        48.878        48.878        48.878        48.878        48.878 
    coh751:k=55.1697,b=0       48.97         48.97         48.97        48.97        48.97         48.97         48.97         48.97         48.97         48.97         48.97         48.97 
    coh752:k=55.2701,b=0      49.063        49.063        49.063       49.063       49.063        49.063        49.063        49.063        49.063        49.063        49.063        49.063 
    coh753:k=55.3704,b=0      49.155        49.155        49.155       49.155       49.155        49.155        49.155        49.155        49.155        49.155        49.155        49.155 
    coh754:k=55.4708,b=0      49.247        49.247        49.247       49.247       49.247        49.247        49.247        49.247        49.247        49.247        49.247        49.247 
    coh755:k=55.5711,b=0      49.339        49.339        49.339       49.339       49.339        49.339        49.339        49.339        49.339        49.339        49.339        49.339 
    coh756:k=55.6715,b=0      49.431        49.431        49.431       49.431       49.431        49.431        49.431        49.431        49.431        49.431        49.431        49.431 
    coh757:k=55.7719,b=0      49.523        49.523        49.523       49.523       49.523        49.523        49.523        49.523        49.523        49.523        49.523        49.523 
    coh758:k=55.8722,b=0      49.615        49.615        49.615       49.615       49.615        49.615        49.615        49.615        49.615        49.615        49.615        49.615 
    coh759:k=55.9726,b=0      49.707        49.707        49.707       49.707       49.707        49.707        49.707        49.707        49.707        49.707        49.707        49.707 
    coh760:k=56.0729,b=0      49.799        49.799        49.799       49.799       49.799        49.799        49.799        49.799        49.799        49.799        49.799        49.799 
    coh761:k=56.1733,b=0      49.891        49.891        49.891       49.891       49.891        49.891        49.891        49.891        49.891        49.891        49.891        49.891 
    coh762:k=56.2737,b=0      49.983        49.983        49.983       49.983       49.983        49.983        49.983        49.983        49.983        49.983        49.983        49.983 
    coh763:k=56.374,b=0       50.076        50.076        50.076       50.076       50.076        50.076        50.076        50.076        50.076        50.076        50.076        50.076 
    coh764:k=56.4744,b=0      50.168        50.168        50.168       50.168       50.168        50.168        50.168        50.168        50.168        50.168        50.168        50.168 
    coh765:k=56.5747,b=0       50.26         50.26         50.26        50.26        50.26         50.26         50.26         50.26         50.26         50.26         50.26          48.7 
    coh766:k=56.6751,b=0      50.352        50.352        50.352       50.352       50.352        50.352        50.352        50.352        50.352         48.79         48.79         48.79 
    coh767:k=56.7755,b=0      50.444        50.444        50.444       50.444       50.444        50.444         48.88         48.88         48.88         48.88         48.88         48.88 
    coh768:k=56.8758,b=0      50.536         48.97         48.97        48.97        48.97         48.97         48.97         48.97         48.97         48.97         48.97         48.97 
    coh769:k=56.9762,b=0       49.06         49.06         49.06        49.06        49.06         49.06         49.06         49.06         49.06         49.06         49.06         49.06 
    coh770:k=57.0765,b=0       49.15         49.15         49.15        49.15        49.15         49.15         49.15         49.15         49.15         49.15         49.15         49.15 
    coh771:k=57.1769,b=0       49.24         49.24         49.24        49.24        49.24         49.24         49.24         49.24         49.24         49.24         49.24         49.24 
    coh772:k=57.2773,b=0       49.33         49.33         49.33        49.33        49.33         49.33         49.33         49.33         49.33         49.33         49.33         49.33 

</pre><img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_01.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_02.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_03.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_04.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_05.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_06.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_07.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_08.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_09.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_10.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_11.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_12.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_13.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_14.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_15.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_16.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_17.png" alt=""> <img vspace="5" hspace="5" src="ff_ipwkbz_vf_vecsv_18.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 15
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Risky + Safe Asset (Save + Borr) Interpolated-Percentage (Optimized-Vectorized)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function result_map = ff_ipwkbz_vf_vecsv(varargin)
%% FF_IPWKBZ_VF_VECSV solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic savings and risky
% capital asset problem with some ar1 shock. This is the two step solution
% with interpolation and with percentage asset grids version of
% <https://fanwangecon.github.io/CodeDynaAsset/m_akz/solve/html/ff_iwkz_vf_vecsv.html
% ff_iwkz_vf_vecsv>. See that file for more descriptions.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables.
%
% keys included in result_map:
%
% * mt_val matrix states_n by shock_n matrix of converged value function grid
% * mt_pol_a matrix states_n by shock_n matrix of converged policy function grid
% * ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function
% difference between iteration
% * ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy
% function difference between iterations
% * mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the
% proportion of grid points at which policy function changed between
% current and last iteration for each element of shock
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ff_ipwkbz_evf.m ff_ipwkbz_evf>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_set_default_param.m ffs_ipwkbz_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_ipwkbz/paramfunc/ffs_ipwkbz_get_funcgrid.m ffs_ipwkbz_get_funcgrid>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_akz/solvepost/ff_akz_vf_post.m ff_akz_vf_post>
%


%% Default
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_ipwkbz_set_default_param(it_param_set);

% parameters can be set inside ffs_ipwkbz_set_default_param or updated here
% param_map('it_w_perc_n') = 50;
% param_map('it_ak_perc_n') = param_map('it_w_perc_n');
% param_map('it_z_n') = 15;
% param_map('fl_coh_interp_grid_gap') = 0.025;
% param_map('it_c_interp_grid_gap') = 0.001;
% param_map('fl_w_interp_grid_gap') = 0.25;
% param_map('it_w_perc_n') = 100;
% param_map('it_ak_perc_n') = param_map('it_w_perc_n');
% param_map('it_z_n') = 11;
% param_map('fl_coh_interp_grid_gap') = 0.1;
% param_map('it_c_interp_grid_gap') = 10^-4;
% param_map('fl_w_interp_grid_gap') = 0.1;
%
% get armt and func map
[armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_ipwkbz_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

% append function name
st_func_name = 'ff_ipwkbz_vf_vecsv';
support_map('st_profile_name_main') = [st_func_name support_map('st_profile_name_main')];
support_map('st_mat_name_main') = [st_func_name support_map('st_mat_name_main')];
support_map('st_img_name_main') = [st_func_name support_map('st_img_name_main')];

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_w_perc', 'ar_w_level', 'ar_z'});
[ar_w_perc, ar_w_level, ar_z] = params_group{:};
params_group = values(armt_map, {'ar_interp_c_grid', 'ar_interp_coh_grid', ...
    'ar_a_meshk', 'ar_k_mesha', ...
    'mt_interp_coh_grid_mesh_z', 'mt_z_mesh_coh_interp_grid',...
    'mt_interp_coh_grid_mesh_w_perc',...
    'mt_w_by_interp_coh_interp_grid'});
[ar_interp_c_grid, ar_interp_coh_grid, ar_a_meshk, ar_k_mesha, ...
    mt_interp_coh_grid_mesh_z, mt_z_mesh_coh_interp_grid, ...
    mt_interp_coh_grid_mesh_w_perc,...
    mt_w_by_interp_coh_interp_grid] = params_group{:};
params_group = values(armt_map, {'mt_coh_wkb', 'mt_z_mesh_coh_wkb'});
[mt_coh_wkb, mt_z_mesh_coh_wkb] = params_group{:};

% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_cons'});
[f_util_log, f_util_crra, f_cons] = params_group{:};

% param_map
params_group = values(param_map, {'it_z_n', 'fl_crra', 'fl_beta', ...
    'fl_nan_replace', 'fl_c_min', 'bl_default', 'fl_default_wprime'});
[it_z_n, fl_crra, fl_beta, fl_nan_replace, fl_c_min, bl_default, fl_default_wprime] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_time', 'bl_graph_evf', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_time, bl_graph_evf, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes

mt_val_cur = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_k = zeros(length(ar_interp_coh_grid),length(ar_z));
mt_pol_k_cur = mt_pol_k - 1;
mt_pol_idx = zeros(length(ar_interp_coh_grid),length(ar_z));

% We did not need these in ff_oz_vf or ff_oz_vf_vec
% see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why store using cells.
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
cl_w_kstar_interp_z = cell([it_z_n, 1]);
for it_z_i = 1:length(ar_z)
    cl_w_kstar_interp_z{it_z_i} = zeros([length(ar_w_perc), length(ar_interp_coh_grid)]) - 1;
end

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Pre-calculate u(c)
% Interpolation, see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why interpolate over u(c)

% Evaluate
if (fl_crra == 1)
    ar_interp_u_of_c_grid = f_util_log(ar_interp_c_grid);
    fl_u_cmin = f_util_log(fl_c_min);
else
    ar_interp_u_of_c_grid = f_util_crra(ar_interp_c_grid);
    fl_u_cmin = f_util_crra(fl_c_min);
end
ar_interp_u_of_c_grid(ar_interp_c_grid <= fl_c_min) = fl_u_cmin;

% Get Interpolant
f_grid_interpolant_spln = griddedInterpolant(ar_interp_c_grid, ar_interp_u_of_c_grid, 'spline', 'nearest');

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;

    %% Interpolate (1) reacahble v(coh(k(w,z),b(w,z),z),z) given v(coh, z)
    % v(coh,z) solved on ar_interp_coh_grid, ar_z grids, see
    % ffs_ipwkbz_get_funcgrid.m. Generate interpolant based on that, Then
    % interpolate for the coh reachable levels given the k(w,z) percentage
    % choice grids in the second stage of the problem

    % Generate Interpolant for v(coh,z)
    f_grid_interpolant_value = griddedInterpolant(...
        mt_z_mesh_coh_interp_grid', mt_interp_coh_grid_mesh_z', mt_val_cur', 'linear', 'nearest');

    % Interpolate for v(coh(k(w,z),b(w,z),z),z)
    mt_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb, mt_coh_wkb);
%     ar_val_wkb_interpolated = f_grid_interpolant_value(mt_z_mesh_coh_wkb(:), mt_coh_wkb(:));
%     mt_val_wkb_interpolated = reshape(ar_val_wkb_interpolated, size(mt_z_mesh_coh_wkb));
    
    %% Solve Second Stage Problem k*(w,z)
    % This is the key difference between this function and
    % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html
    % ffs_akz_set_functions> which solves the two stages jointly
    % Interpolation first, because solution coh grid is not the same as all
    % points reachable by k and b choices given w.
    support_map('bl_graph_evf') = false;
    if (it_iter == (it_maxiter_val + 1))
        support_map('bl_graph_evf') = bl_graph_evf;
    end
    bl_input_override = true;
    [mt_ev_condi_z_max, ~, mt_ev_condi_z_max_kp, ~] = ...
        ff_ipwkbz_evf(mt_val_wkb_interpolated, param_map, support_map, armt_map, bl_input_override);

    %% Solve First Stage Problem w*(z) given k*(w,z)

    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)

        %% A. Interpolate FULL to get k*(w_perc, z), b*(k,w) based on k*(w_level, z)
        % Generate interpolant for (2) k*(ar_w_perc) from k*(ar_w_level,z)
        % There are two w=k'+b' arrays. ar_w_level is the level even grid based
        % on which we solve the 2nd stage problem in ff_ipwkbz_evf.m. Here for
        % each coh level, we have a different vector of w levels, but the same
        % vector of percentage ws. So we need to interpolate to get the optimal
        % k* and b* choices at each percentage level of w.
        f_interpolante_w_level_kstar_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max_kp(:, it_z_i)', 'linear', 'nearest');

        % Interpolate (2), shift from w_level to w_perc
        mt_w_kstar_interp_z = f_interpolante_w_level_kstar_z(mt_w_by_interp_coh_interp_grid);
        mt_w_astar_interp_z = mt_w_by_interp_coh_interp_grid - mt_w_kstar_interp_z;

        % changes in w_perc kstar choices
        mt_w_kstar_diff_idx = (cl_w_kstar_interp_z{it_z_i} ~= mt_w_kstar_interp_z);

        %% B. Calculate UPDATE u(c): u(c(coh_level, w_perc)) given k*_interp, b*_interp
        % Note that compared to
        % <https://fanwangecon.github.io/CodeDynaAsset/m_akz/paramfunc/html/ffs_akz_set_functions.html
        % ffs_akz_set_functions> the mt_c here is much smaller the same
        % number of columns (states) as in the ffs_akz_set_functions file,
        % but the number of rows equal to ar_w length.
        ar_c = f_cons(mt_interp_coh_grid_mesh_w_perc(mt_w_kstar_diff_idx), ...
                      mt_w_astar_interp_z(mt_w_kstar_diff_idx), ...
                      mt_w_kstar_interp_z(mt_w_kstar_diff_idx));

        ar_it_c_valid_idx = (ar_c <= fl_c_min);
        % EVAL current utility: N by N, f_util defined earlier
        ar_utility_update = f_grid_interpolant_spln(ar_c);

        % Update Storage
        if (it_iter == 1)
            cl_u_c_store{it_z_i} = reshape(ar_utility_update, [length(ar_w_perc), length(ar_interp_coh_grid)]);
            cl_c_valid_idx{it_z_i} = reshape(ar_it_c_valid_idx, [length(ar_w_perc), length(ar_interp_coh_grid)]);
        else
            cl_u_c_store{it_z_i}(mt_w_kstar_diff_idx) = ar_utility_update;
            cl_c_valid_idx{it_z_i}(mt_w_kstar_diff_idx) = ar_it_c_valid_idx;
        end
        cl_w_kstar_interp_z{it_z_i} = mt_w_kstar_interp_z;

        %% C. Interpolate FULL EV(k*(coh_level, w_perc, z), w - b*|z) based on EV(k*(w_level, z))
        % Generate Interpolant for (3) EV(k*(ar_w_perc),Z)
        f_interpolante_ev_condi_z_max_z = griddedInterpolant(ar_w_level, mt_ev_condi_z_max(:, it_z_i)', 'linear', 'nearest');
        % Interpolate (3), EVAL add on future utility, N by N + N by N
        mt_ev_condi_z_max_interp_z = f_interpolante_ev_condi_z_max_z(mt_w_by_interp_coh_interp_grid);
        
        %% D. Compute FULL U(coh_level, w_perc, z) over all w_perc
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_ev_condi_z_max_interp_z;

        % Index update
        % using the method below is much faster than index replace
        % see <https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        % Default or Not Utility Handling
        if (bl_default)
            % if default: only today u(cmin), transition out next period, debt wiped out
            fl_v_default = fl_u_cmin + fl_beta*f_interpolante_ev_condi_z_max_z(fl_default_wprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        else
            % if default is not allowed: v = u(cmin)
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        end

        % percentage algorithm does not have invalid (check to make sure
        % min percent is not 0 in ffs_ipwkbz_get_funcgrid.m)
        % mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_u_neg_c*(mt_it_c_valid_idx);

        %% E. Optimize Over Choices: max_{w_perc} U(coh_level, w_perc, z)        
        % Optimization: remember matlab is column major, rows must be
        % choices, columns must be states
        % <https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR>
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);

        % Generate Linear Opti Index
        [it_choies_n, it_states_n] = size(mt_utility);
        ar_add_grid = linspace(0, it_choies_n*(it_states_n-1), it_states_n);
        ar_opti_linear_idx_z = ar_opti_idx_z + ar_add_grid;

        ar_opti_aprime_z = mt_w_astar_interp_z(ar_opti_linear_idx_z);
        ar_opti_kprime_z = mt_w_kstar_interp_z(ar_opti_linear_idx_z);
        ar_opti_c_z = f_cons(ar_interp_coh_grid, ar_opti_aprime_z, ar_opti_kprime_z);

        % Handle Default is optimal or not
        if (bl_default)
            % if defaulting is optimal choice, at these states, not required
            % to default, non-default possible, but default could be optimal
            fl_default_opti_kprime = f_interpolante_w_level_kstar_z(fl_default_wprime);
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = fl_default_wprime - fl_default_opti_kprime;
            ar_opti_kprime_z(ar_opti_c_z <= fl_c_min) = fl_default_opti_kprime;
        else
            % if default is not allowed, then next period same state as now
            % this is absorbing state, this is the limiting case, single
            % state space point, lowest a and lowest shock has this.
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = min(ar_a_meshk);
            ar_opti_kprime_z(ar_opti_c_z <= fl_c_min) = min(ar_k_mesha);
        end

        %% F. Store Results        
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;
        mt_pol_k(:,it_z_i) = ar_opti_kprime_z;
        if (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_linear_idx_z;
        end

    end

    %% Check Tolerance and Continuation

    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur) + norm(mt_pol_k - mt_pol_k_cur);
    ar_pol_a_perc_change = sum((mt_pol_a ~= mt_pol_a_cur))/(length(ar_interp_coh_grid));
    ar_pol_k_perc_change = sum((mt_pol_k ~= mt_pol_k_cur))/(length(ar_interp_coh_grid));
    mt_pol_perc_change(it_iter, :) = mean([ar_pol_a_perc_change;ar_pol_k_perc_change]);

    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    mt_pol_k_cur = mt_pol_k;

    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1);...
                                      mean(mt_pol_a_cur,1); ...
                                      mean(mt_pol_k_cur,1); ...
                                      mt_val_cur(length(ar_interp_coh_grid),:); ...
                                      mt_pol_a_cur(length(ar_interp_coh_grid),:); ...
                                      mt_pol_k_cur(length(ar_interp_coh_grid),:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'mak', 'Hval', 'Hap', 'Hak'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('mkp  = mean(mt_pol_k_cur,1), average choice over k')
        disp('Hval = mt_val_cur(it_ameshk_n,:), highest a state val')
        disp('Hap = mt_pol_a_cur(it_ameshk_n,:), highest a state choice')
        disp('mak = mt_pol_k_cur(it_ameshk_n,:), highest k state choice')
        disp(tb_valpol_iter);
    end

    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    end

end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_idx') = mt_pol_idx;

result_map('cl_mt_pol_coh') = {mt_interp_coh_grid_mesh_z, zeros(1)};
result_map('cl_mt_pol_a') = {mt_pol_a, zeros(1)};
result_map('cl_mt_pol_k') = {mt_pol_k, zeros(1)};
result_map('cl_mt_pol_c') = {f_cons(mt_interp_coh_grid_mesh_z, mt_pol_a, mt_pol_k), zeros(1)};
result_map('ar_st_pol_names') = ["cl_mt_pol_coh", "cl_mt_pol_a", "cl_mt_pol_k", "cl_mt_pol_c"];


if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);

    % graphing based on coh_wkb, but that does not match optimal choice
    % matrixes for graphs.
    armt_map('mt_coh_wkb') = mt_interp_coh_grid_mesh_z;
    armt_map('it_ameshk_n') = length(ar_interp_coh_grid);
    armt_map('ar_a_meshk') = mt_interp_coh_grid_mesh_z(:,1);
    armt_map('ar_k_mesha') = zeros(size(mt_interp_coh_grid_mesh_z(:,1)) + 0);

    result_map = ff_akz_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end

##### SOURCE END #####
--></body></html>