
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Generate States, Choices and Shocks Grids and Get Functions (Borr + Save)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-08-06"><meta name="DC.source" content="ffs_abz_get_funcgrid.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Generate States, Choices and Shocks Grids and Get Functions (Borr + Save)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FFS_ABZ_GET_FUNCGRID get funcs, params, states choices shocks grids</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Parse Parameters 3</a></li><li><a href="#7">Get Shock: Income Shock (ar1)</a></li><li><a href="#8">Get Shock: Interest Rate Shock (iid)</a></li><li><a href="#9">Get Shock: Mesh Shocks Together</a></li><li><a href="#10">Get Equations</a></li><li><a href="#11">Get Asset and Choice Grid</a></li><li><a href="#12">Store</a></li><li><a href="#13">Graph: A, Shocks, COH, and Defaults</a></li><li><a href="#14">Display</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> [armt_map, func_map] = ffs_abz_get_funcgrid(varargin)
</pre><h2 id="2">FFS_ABZ_GET_FUNCGRID get funcs, params, states choices shocks grids</h2><p>centralized gateway for retrieving parameters, and solution grids and functions. Generate asset grid, and shock grid that accomandates two shocks jointly: one ar1 wage shock, one iid interest rate shock.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param bl_input_override boolean if true varargin contained param_map and support_map fully overrides local default. Local default is not invoked. This could be important for speed if this function is getting invoked within certain loops. Default is 0.</p><p>@return armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@return func_map container container with function handles for consumption cash-on-hand etc.</p><p>@example</p><pre>  it_param_set = 2;
  bl_input_override = true;
  [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
  [armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override);</pre><p>@include</p><div><ul><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_functions.html">ffs_abz_set_functions</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_gen_borrsave_grid.html">ffs_abz_gen_borrsave_grid</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/tools/html/fft_gen_discrete_var.html">fft_gen_discrete_var</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/ffto_gen_tauchen_jhl.m">ffto_gen_tauchen_jhl</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/fft_gen_grid_loglin.m">fft_gen_grid_loglin</a></li></ul></div><p>@seealso</p><div><ul><li>initialize parameters: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_default_param.html">ffs_abz_set_default_param</a></li><li>initialize functions: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_functions.html">ffs_abz_set_functions</a></li><li>set asset grid: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_gen_borrsave_grid.html">ffs_abz_gen_borrsave_grid</a></li><li>set shock borrow rate: <a href="https://fanwangecon.github.io/CodeDynaAsset/tools/html/fft_gen_discrete_var.html">fft_gen_discrete_var</a></li><li>set shock wage: <a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/ffto_gen_tauchen_jhl.m">ffto_gen_tauchen_jhl</a></li><li>gateway function processing grid, paramters, functions: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_get_funcgrid.html">ffs_abz_get_funcgrid</a></li></ul></div><h2 id="3">Default</h2><pre class="codeinput"><span class="keyword">if</span> (~isempty(varargin))

    <span class="comment">% override when called from outside</span>
    [param_map, support_map] = varargin{:};

<span class="keyword">else</span>
    close <span class="string">all</span>
    <span class="comment">% default internal run</span>
    it_param_set = 4;
    [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
    support_map(<span class="string">'bl_graph_funcgrids'</span>) = true;
    support_map(<span class="string">'bl_display_funcgrids'</span>) = true;
    default_maps = {param_map, support_map};

    <span class="comment">% numvarargs is the number of varagin inputted</span>
    [default_maps{1:length(varargin)}] = varargin{:};
    param_map = [param_map; default_maps{1}];
    support_map = [support_map; default_maps{2}];
<span class="keyword">end</span>
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% param_map asset grid</span>
params_group = values(param_map, {<span class="string">'fl_b_bd'</span>, <span class="string">'bl_default'</span>, <span class="string">'fl_a_min'</span>, <span class="string">'fl_a_max'</span>, <span class="string">'bl_loglin'</span>, <span class="string">'fl_loglin_threshold'</span>, <span class="string">'it_a_n'</span>});
[fl_b_bd, bl_default, fl_a_min, fl_a_max, bl_loglin, fl_loglin_threshold, it_a_n] = params_group{:};

<span class="comment">% param_map preference</span>
params_group = values(param_map, {<span class="string">'fl_crra'</span>, <span class="string">'fl_c_min'</span>});
[fl_crra, fl_c_min] = params_group{:};

<span class="comment">% param_map borrowing and price</span>
params_group = values(param_map, {<span class="string">'bl_b_is_principle'</span>, <span class="string">'fl_r_save'</span>, <span class="string">'fl_w'</span>});
[bl_b_is_principle, fl_r_save, fl_w] = params_group{:};
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% param_map shock income</span>
params_group = values(param_map, {<span class="string">'it_z_wage_n'</span>, <span class="string">'fl_z_wage_mu'</span>, <span class="string">'fl_z_wage_rho'</span>, <span class="string">'fl_z_wage_sig'</span>});
[it_z_wage_n, fl_z_wage_mu, fl_z_wage_rho, fl_z_wage_sig] = params_group{:};

<span class="comment">% param_map shock borrowing interest</span>
params_group = values(param_map, {<span class="string">'st_z_r_borr_drv_ele_type'</span>, <span class="string">'st_z_r_borr_drv_prb_type'</span>, <span class="string">'fl_z_r_borr_poiss_mean'</span>, <span class="keyword">...</span>
    <span class="string">'fl_z_r_borr_max'</span>, <span class="string">'fl_z_r_borr_min'</span>, <span class="string">'fl_z_r_borr_n'</span>});
[st_z_r_borr_drv_ele_type, st_z_r_borr_drv_prb_type, fl_z_r_borr_poiss_mean, <span class="keyword">...</span>
    fl_z_r_borr_max, fl_z_r_borr_min, fl_z_r_borr_n] = params_group{:};
</pre><h2 id="6">Parse Parameters 3</h2><pre class="codeinput"><span class="comment">% support_map controls</span>
params_group = values(support_map, {<span class="string">'bl_graph_funcgrids'</span>, <span class="string">'bl_display_funcgrids'</span>});
[bl_graph_funcgrids, bl_display_funcgrids] = params_group{:};
params_group = values(support_map, {<span class="string">'it_display_summmat_rowmax'</span>, <span class="string">'it_display_summmat_colmax'</span>});
[it_display_summmat_rowmax, it_display_summmat_colmax] = params_group{:};
</pre><h2 id="7">Get Shock: Income Shock (ar1)</h2><pre class="codeinput">[~, mt_z_wage_trans, ~, ar_z_wage] = ffto_gen_tauchen_jhl(fl_z_wage_mu,fl_z_wage_rho,fl_z_wage_sig,it_z_wage_n);
</pre><h2 id="8">Get Shock: Interest Rate Shock (iid)</h2><pre class="codeinput"><span class="comment">% get borrowing grid and probabilities</span>
param_dsv_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
param_dsv_map(<span class="string">'st_drv_ele_type'</span>) = st_z_r_borr_drv_ele_type;
param_dsv_map(<span class="string">'st_drv_prb_type'</span>) = st_z_r_borr_drv_prb_type;
param_dsv_map(<span class="string">'fl_poiss_mean'</span>) = fl_z_r_borr_poiss_mean;
param_dsv_map(<span class="string">'fl_max'</span>) = fl_z_r_borr_max;
param_dsv_map(<span class="string">'fl_min'</span>) = fl_z_r_borr_min;
param_dsv_map(<span class="string">'fl_n'</span>) = fl_z_r_borr_n;
[ar_z_r_borr, ar_z_r_borr_prob] = fft_gen_discrete_var(param_dsv_map, true);

<span class="comment">% iid transition matrix</span>
mt_z_r_borr_prob_trans = repmat(ar_z_r_borr_prob, [length(ar_z_r_borr_prob), 1]);
</pre><h2 id="9">Get Shock: Mesh Shocks Together</h2><pre class="codeinput"><span class="comment">% Kronecker product to get full transition matrix for the two shocks</span>
mt_z_trans = kron(mt_z_r_borr_prob_trans, mt_z_wage_trans);

<span class="comment">% mesh the shock vectors</span>
[mt_z_wage_mesh_r_borr, mt_z_r_borr_mesh_wage] = ndgrid(ar_z_wage, ar_z_r_borr);
ar_z_r_borr_mesh_wage = mt_z_r_borr_mesh_wage(:)';
ar_z_wage_mesh_r_borr = mt_z_wage_mesh_r_borr(:)';

<span class="keyword">if</span> (bl_display_funcgrids)

    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Borrow R Shock: ar_z_r_borr_mesh_wage'</span>);
    disp(<span class="string">'Prod/Wage Shock: mt_z_wage_mesh_r_borr'</span>);
    disp(<span class="string">'show which shock is inner and which is outter'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);

    tb_two_shocks = array2table([ar_z_r_borr_mesh_wage;<span class="keyword">...</span>
        ar_z_wage_mesh_r_borr]');
    cl_col_names = [<span class="string">"Borrow R Shock (Meshed)"</span>, <span class="string">"Wage R Shock (Meshed)"</span>];
    cl_row_names = strcat(<span class="string">'zi='</span>, string((1:length(ar_z_r_borr_mesh_wage))));
    tb_two_shocks.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_two_shocks.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

    it_row_display = it_z_wage_n*2;

    disp(size(tb_two_shocks));
    disp(head(tb_two_shocks, it_row_display));
    disp(tail(tb_two_shocks, it_row_display));


    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Borrow Rate Transition Matrix: mt_z_r_borr_prob_trans'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    it_col_n_keep = 15;
    it_row_n_keep = 15;
    [it_row_n, it_col_n] = size(mt_z_r_borr_prob_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);
    cl_st_full_rowscols = cellstr([num2str(ar_z_r_borr', <span class="string">'r%3.2f'</span>)]);
    tb_z_r_borr_prob_trans = array2table(round(mt_z_r_borr_prob_trans(ar_it_rows, ar_it_cols), 6));
    cl_col_names = strcat(<span class="string">'zi='</span>, num2str(ar_it_cols'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat(<span class="string">'zi='</span>, num2str(ar_it_rows'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    tb_z_r_borr_prob_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_z_r_borr_prob_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

    disp(size(tb_z_r_borr_prob_trans));
    disp(tb_z_r_borr_prob_trans);


    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Wage Prod Shock Transition Matrix: mt_z_r_borr_prob_trans'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    it_col_n_keep = 15;
    it_row_n_keep = 15;
    [it_row_n, it_col_n] = size(mt_z_wage_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);
    cl_st_full_rowscols = cellstr([num2str(ar_z_wage', <span class="string">'w%3.2f'</span>)]);
    tb_z_wage_trans = array2table(round(mt_z_wage_trans(ar_it_rows, ar_it_cols),6));
    cl_col_names = strcat(<span class="string">'zi='</span>, num2str(ar_it_cols'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat(<span class="string">'zi='</span>, num2str(ar_it_rows'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    tb_z_wage_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_z_wage_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

    disp(size(tb_z_wage_trans));
    disp(tb_z_wage_trans);


    disp(<span class="string">'----------------------------------------'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    disp(<span class="string">'Full Transition Matrix: mt_z_trans'</span>);
    disp(<span class="string">'xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx'</span>);
    it_col_n_keep = it_z_wage_n*3;
    it_row_n_keep = it_z_wage_n*3;
    [it_row_n, it_col_n] = size(mt_z_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);
    cl_st_full_rowscols = cellstr([num2str(ar_z_r_borr_mesh_wage', <span class="string">'r%3.2f;'</span>), <span class="keyword">...</span>
                                   num2str(ar_z_wage_mesh_r_borr', <span class="string">'w%3.2f'</span>)]);
    tb_mt_z_trans = array2table(round(mt_z_trans(ar_it_rows, ar_it_cols),6));
    cl_col_names = strcat(<span class="string">'i'</span>, num2str(ar_it_cols'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat(<span class="string">'i'</span>, num2str(ar_it_rows'), <span class="string">':'</span>, cl_st_full_rowscols(ar_it_cols));
    tb_mt_z_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_mt_z_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);

    disp(size(tb_mt_z_trans));
    disp(tb_mt_z_trans);

<span class="keyword">end</span>
</pre><pre class="codeoutput">----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Borrow R Shock: ar_z_r_borr_mesh_wage
Prod/Wage Shock: mt_z_wage_mesh_r_borr
show which shock is inner and which is outter
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    55     2

             BorrowRShock_Meshed_    WageRShock_Meshed_
             ____________________    __________________

    zi_1             0.025                0.34664      
    zi_2             0.025                0.42338      
    zi_3             0.025                0.51712      
    zi_4             0.025                0.63162      
    zi_5             0.025                0.77146      
    zi_6             0.025                0.94226      
    zi_7             0.025                 1.1509      
    zi_8             0.025                 1.4057      
    zi_9             0.025                 1.7169      
    zi_10            0.025                  2.097      
    zi_11            0.025                 2.5613      
    zi_12           0.0425                0.34664      
    zi_13           0.0425                0.42338      
    zi_14           0.0425                0.51712      
    zi_15           0.0425                0.63162      
    zi_16           0.0425                0.77146      
    zi_17           0.0425                0.94226      
    zi_18           0.0425                 1.1509      
    zi_19           0.0425                 1.4057      
    zi_20           0.0425                 1.7169      
    zi_21           0.0425                  2.097      
    zi_22           0.0425                 2.5613      

             BorrowRShock_Meshed_    WageRShock_Meshed_
             ____________________    __________________

    zi_34           0.0775                0.34664      
    zi_35           0.0775                0.42338      
    zi_36           0.0775                0.51712      
    zi_37           0.0775                0.63162      
    zi_38           0.0775                0.77146      
    zi_39           0.0775                0.94226      
    zi_40           0.0775                 1.1509      
    zi_41           0.0775                 1.4057      
    zi_42           0.0775                 1.7169      
    zi_43           0.0775                  2.097      
    zi_44           0.0775                 2.5613      
    zi_45            0.095                0.34664      
    zi_46            0.095                0.42338      
    zi_47            0.095                0.51712      
    zi_48            0.095                0.63162      
    zi_49            0.095                0.77146      
    zi_50            0.095                0.94226      
    zi_51            0.095                 1.1509      
    zi_52            0.095                 1.4057      
    zi_53            0.095                 1.7169      
    zi_54            0.095                  2.097      
    zi_55            0.095                 2.5613      

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Borrow Rate Transition Matrix: mt_z_r_borr_prob_trans
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
     5     5

                  zi_1_r0_03    zi_2_r0_04    zi_3_r0_06    zi_4_r0_08    zi_5_r0_10
                  __________    __________    __________    __________    __________

    zi_1_r0_03     0.001552      0.01552        0.0776       0.25866       0.64666  
    zi_2_r0_04     0.001552      0.01552        0.0776       0.25866       0.64666  
    zi_3_r0_06     0.001552      0.01552        0.0776       0.25866       0.64666  
    zi_4_r0_08     0.001552      0.01552        0.0776       0.25866       0.64666  
    zi_5_r0_10     0.001552      0.01552        0.0776       0.25866       0.64666  

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Wage Prod Shock Transition Matrix: mt_z_r_borr_prob_trans
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    11    11

                   zi_1_w0_35    zi_2_w0_42    zi_3_w0_52    zi_4_w0_63    zi_5_w0_77    zi_6_w0_94    zi_7_w1_15    zi_8_w1_41    zi_9_w1_72    zi_10_w2_10    zi_11_w2_56
                   __________    __________    __________    __________    __________    __________    __________    __________    __________    ___________    ___________

    zi_1_w0_35       0.30854       0.38293       0.24173      0.060598      0.005977      0.000229         3e-06             0             0             0              0  
    zi_2_w0_42        0.0968       0.28529       0.37595        0.1974      0.041098      0.003359      0.000106         1e-06             0             0              0  
    zi_3_w0_52      0.017864        0.1178       0.32451       0.35577       0.15534      0.026851      0.001818       4.8e-05             0             0              0  
    zi_4_w0_63      0.001866      0.026851       0.15534       0.35577       0.32451        0.1178      0.016897      0.000947         2e-05             0              0  
    zi_5_w0_77      0.000108      0.003359      0.041098        0.1974       0.37595       0.28529      0.086076      0.010241      0.000475         8e-06              0  
    zi_6_w0_94         3e-06      0.000229      0.005977      0.060598       0.24173       0.38293       0.24173      0.060598      0.005977      0.000229          3e-06  
    zi_7_w1_15             0         8e-06      0.000475      0.010241      0.086076       0.28529       0.37595        0.1974      0.041098      0.003359       0.000108  
    zi_8_w1_41             0             0         2e-05      0.000947      0.016897        0.1178       0.32451       0.35577       0.15534      0.026851       0.001866  
    zi_9_w1_72             0             0             0       4.8e-05      0.001818      0.026851       0.15534       0.35577       0.32451        0.1178       0.017864  
    zi_10_w2_10            0             0             0         1e-06      0.000106      0.003359      0.041098        0.1974       0.37595       0.28529         0.0968  
    zi_11_w2_56            0             0             0             0         3e-06      0.000229      0.005977      0.060598       0.24173       0.38293        0.30854  

----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Full Transition Matrix: mt_z_trans
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
    33    33

                       i1_r0_03_w0_35    i2_r0_03_w0_42    i3_r0_03_w0_52    i4_r0_03_w0_63    i5_r0_03_w0_77    i6_r0_03_w0_94    i7_r0_03_w1_15    i8_r0_03_w1_41    i9_r0_03_w1_72    i10_r0_03_w2_10    i11_r0_03_w2_56    i12_r0_04_w0_35    i13_r0_04_w0_42    i14_r0_04_w0_52    i15_r0_04_w0_63    i16_r0_04_w0_77    i28_r0_06_w0_94    i40_r0_08_w1_15    i41_r0_08_w1_41    i42_r0_08_w1_72    i43_r0_08_w2_10    i44_r0_08_w2_56    i45_r0_10_w0_35    i46_r0_10_w0_42    i47_r0_10_w0_52    i48_r0_10_w0_63    i49_r0_10_w0_77    i50_r0_10_w0_94    i51_r0_10_w1_15    i52_r0_10_w1_41    i53_r0_10_w1_72    i54_r0_10_w2_10    i55_r0_10_w2_56
                       ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    ______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________    _______________

    i1_r0_03_w0_35        0.000479          0.000594          0.000375           9.4e-05             9e-06                 0                 0                 0                 0                 0                  0           0.004788           0.005943           0.003752            0.00094            9.3e-05            1.8e-05              1e-06                  0                  0                  0                  0            0.19952            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06                  0                  0                  0                  0    
    i2_r0_03_w0_42         0.00015          0.000443          0.000583          0.000306           6.4e-05             5e-06                 0                 0                 0                 0                  0           0.001502           0.004428           0.005835           0.003064           0.000638           0.000261            2.8e-05                  0                  0                  0                  0           0.062597            0.18449            0.24311            0.12765           0.026577           0.002172            6.9e-05              1e-06                  0                  0                  0    
    i3_r0_03_w0_52         2.8e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05             3e-06                 0                 0                 0                  0           0.000277           0.001828           0.005036           0.005521           0.002411           0.002084            0.00047            1.2e-05                  0                  0                  0           0.011552           0.076178            0.20985            0.23006            0.10046           0.017363           0.001175            3.1e-05                  0                  0                  0    
    i4_r0_03_w0_63           3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183           2.6e-05             1e-06                 0                 0                  0            2.9e-05           0.000417           0.002411           0.005521           0.005036           0.009141           0.004371           0.000245              5e-06                  0                  0           0.001207           0.017363            0.10046            0.23006            0.20985           0.076178           0.010927           0.000612            1.3e-05                  0                  0    
    i5_r0_03_w0_77               0             5e-06           6.4e-05          0.000306          0.000583          0.000443          0.000134           1.6e-05             1e-06                 0                  0              2e-06            5.2e-05           0.000638           0.003064           0.005835           0.022138           0.022265           0.002649           0.000123              2e-06                  0              7e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.055662           0.006622           0.000307              5e-06                  0    
    i6_r0_03_w0_94               0                 0             9e-06           9.4e-05          0.000375          0.000594          0.000375           9.4e-05             9e-06                 0                  0                  0              4e-06            9.3e-05            0.00094           0.003752           0.029715           0.062527           0.015674           0.001546            5.9e-05              1e-06              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06    
    i7_r0_03_w1_15               0                 0             1e-06           1.6e-05          0.000134          0.000443          0.000583          0.000306           6.4e-05             5e-06                  0                  0                  0              7e-06           0.000159           0.001336           0.022138           0.097245            0.05106           0.010631           0.000869            2.8e-05                  0              5e-06           0.000307           0.006622           0.055662            0.18449            0.24311            0.12765           0.026577           0.002172              7e-05    
    i8_r0_03_w1_41               0                 0                 0             1e-06           2.6e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05              3e-06                  0                  0                  0            1.5e-05           0.000262           0.009141           0.083938           0.092025           0.040182           0.006945           0.000483                  0                  0            1.3e-05           0.000612           0.010927           0.076178            0.20985            0.23006            0.10046           0.017363           0.001207    
    i9_r0_03_w1_72               0                 0                 0                 0             3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183            2.8e-05                  0                  0                  0              1e-06            2.8e-05           0.002084           0.040182           0.092025           0.083938           0.030471           0.004621                  0                  0                  0            3.1e-05           0.001175           0.017363            0.10046            0.23006            0.20985           0.076178           0.011552    
    i10_r0_03_w2_10              0                 0                 0                 0                 0             5e-06           6.4e-05          0.000306          0.000583          0.000443            0.00015                  0                  0                  0                  0              2e-06           0.000261           0.010631            0.05106           0.097245           0.073794           0.025039                  0                  0                  0              1e-06            6.9e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.062597    
    i11_r0_03_w2_56              0                 0                 0                 0                 0                 0             9e-06           9.4e-05          0.000375          0.000594           0.000479                  0                  0                  0                  0                  0            1.8e-05           0.001546           0.015674           0.062527           0.099049           0.079808                  0                  0                  0                  0              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.19952    
    i12_r0_04_w0_35       0.000479          0.000594          0.000375           9.4e-05             9e-06                 0                 0                 0                 0                 0                  0           0.004788           0.005943           0.003752            0.00094            9.3e-05            1.8e-05              1e-06                  0                  0                  0                  0            0.19952            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06                  0                  0                  0                  0    
    i13_r0_04_w0_42        0.00015          0.000443          0.000583          0.000306           6.4e-05             5e-06                 0                 0                 0                 0                  0           0.001502           0.004428           0.005835           0.003064           0.000638           0.000261            2.8e-05                  0                  0                  0                  0           0.062597            0.18449            0.24311            0.12765           0.026577           0.002172            6.9e-05              1e-06                  0                  0                  0    
    i14_r0_04_w0_52        2.8e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05             3e-06                 0                 0                 0                  0           0.000277           0.001828           0.005036           0.005521           0.002411           0.002084            0.00047            1.2e-05                  0                  0                  0           0.011552           0.076178            0.20985            0.23006            0.10046           0.017363           0.001175            3.1e-05                  0                  0                  0    
    i15_r0_04_w0_63          3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183           2.6e-05             1e-06                 0                 0                  0            2.9e-05           0.000417           0.002411           0.005521           0.005036           0.009141           0.004371           0.000245              5e-06                  0                  0           0.001207           0.017363            0.10046            0.23006            0.20985           0.076178           0.010927           0.000612            1.3e-05                  0                  0    
    i16_r0_04_w0_77              0             5e-06           6.4e-05          0.000306          0.000583          0.000443          0.000134           1.6e-05             1e-06                 0                  0              2e-06            5.2e-05           0.000638           0.003064           0.005835           0.022138           0.022265           0.002649           0.000123              2e-06                  0              7e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.055662           0.006622           0.000307              5e-06                  0    
    i28_r0_06_w0_94              0                 0             9e-06           9.4e-05          0.000375          0.000594          0.000375           9.4e-05             9e-06                 0                  0                  0              4e-06            9.3e-05            0.00094           0.003752           0.029715           0.062527           0.015674           0.001546            5.9e-05              1e-06              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06    
    i40_r0_08_w1_15              0                 0             1e-06           1.6e-05          0.000134          0.000443          0.000583          0.000306           6.4e-05             5e-06                  0                  0                  0              7e-06           0.000159           0.001336           0.022138           0.097245            0.05106           0.010631           0.000869            2.8e-05                  0              5e-06           0.000307           0.006622           0.055662            0.18449            0.24311            0.12765           0.026577           0.002172              7e-05    
    i41_r0_08_w1_41              0                 0                 0             1e-06           2.6e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05              3e-06                  0                  0                  0            1.5e-05           0.000262           0.009141           0.083938           0.092025           0.040182           0.006945           0.000483                  0                  0            1.3e-05           0.000612           0.010927           0.076178            0.20985            0.23006            0.10046           0.017363           0.001207    
    i42_r0_08_w1_72              0                 0                 0                 0             3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183            2.8e-05                  0                  0                  0              1e-06            2.8e-05           0.002084           0.040182           0.092025           0.083938           0.030471           0.004621                  0                  0                  0            3.1e-05           0.001175           0.017363            0.10046            0.23006            0.20985           0.076178           0.011552    
    i43_r0_08_w2_10              0                 0                 0                 0                 0             5e-06           6.4e-05          0.000306          0.000583          0.000443            0.00015                  0                  0                  0                  0              2e-06           0.000261           0.010631            0.05106           0.097245           0.073794           0.025039                  0                  0                  0              1e-06            6.9e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.062597    
    i44_r0_08_w2_56              0                 0                 0                 0                 0                 0             9e-06           9.4e-05          0.000375          0.000594           0.000479                  0                  0                  0                  0                  0            1.8e-05           0.001546           0.015674           0.062527           0.099049           0.079808                  0                  0                  0                  0              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.19952    
    i45_r0_10_w0_35       0.000479          0.000594          0.000375           9.4e-05             9e-06                 0                 0                 0                 0                 0                  0           0.004788           0.005943           0.003752            0.00094            9.3e-05            1.8e-05              1e-06                  0                  0                  0                  0            0.19952            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06                  0                  0                  0                  0    
    i46_r0_10_w0_42        0.00015          0.000443          0.000583          0.000306           6.4e-05             5e-06                 0                 0                 0                 0                  0           0.001502           0.004428           0.005835           0.003064           0.000638           0.000261            2.8e-05                  0                  0                  0                  0           0.062597            0.18449            0.24311            0.12765           0.026577           0.002172            6.9e-05              1e-06                  0                  0                  0    
    i47_r0_10_w0_52        2.8e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05             3e-06                 0                 0                 0                  0           0.000277           0.001828           0.005036           0.005521           0.002411           0.002084            0.00047            1.2e-05                  0                  0                  0           0.011552           0.076178            0.20985            0.23006            0.10046           0.017363           0.001175            3.1e-05                  0                  0                  0    
    i48_r0_10_w0_63          3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183           2.6e-05             1e-06                 0                 0                  0            2.9e-05           0.000417           0.002411           0.005521           0.005036           0.009141           0.004371           0.000245              5e-06                  0                  0           0.001207           0.017363            0.10046            0.23006            0.20985           0.076178           0.010927           0.000612            1.3e-05                  0                  0    
    i49_r0_10_w0_77              0             5e-06           6.4e-05          0.000306          0.000583          0.000443          0.000134           1.6e-05             1e-06                 0                  0              2e-06            5.2e-05           0.000638           0.003064           0.005835           0.022138           0.022265           0.002649           0.000123              2e-06                  0              7e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.055662           0.006622           0.000307              5e-06                  0    
    i50_r0_10_w0_94              0                 0             9e-06           9.4e-05          0.000375          0.000594          0.000375           9.4e-05             9e-06                 0                  0                  0              4e-06            9.3e-05            0.00094           0.003752           0.029715           0.062527           0.015674           0.001546            5.9e-05              1e-06              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.15632           0.039186           0.003865           0.000148              2e-06    
    i51_r0_10_w1_15              0                 0             1e-06           1.6e-05          0.000134          0.000443          0.000583          0.000306           6.4e-05             5e-06                  0                  0                  0              7e-06           0.000159           0.001336           0.022138           0.097245            0.05106           0.010631           0.000869            2.8e-05                  0              5e-06           0.000307           0.006622           0.055662            0.18449            0.24311            0.12765           0.026577           0.002172              7e-05    
    i52_r0_10_w1_41              0                 0                 0             1e-06           2.6e-05          0.000183          0.000504          0.000552          0.000241           4.2e-05              3e-06                  0                  0                  0            1.5e-05           0.000262           0.009141           0.083938           0.092025           0.040182           0.006945           0.000483                  0                  0            1.3e-05           0.000612           0.010927           0.076178            0.20985            0.23006            0.10046           0.017363           0.001207    
    i53_r0_10_w1_72              0                 0                 0                 0             3e-06           4.2e-05          0.000241          0.000552          0.000504          0.000183            2.8e-05                  0                  0                  0              1e-06            2.8e-05           0.002084           0.040182           0.092025           0.083938           0.030471           0.004621                  0                  0                  0            3.1e-05           0.001175           0.017363            0.10046            0.23006            0.20985           0.076178           0.011552    
    i54_r0_10_w2_10              0                 0                 0                 0                 0             5e-06           6.4e-05          0.000306          0.000583          0.000443            0.00015                  0                  0                  0                  0              2e-06           0.000261           0.010631            0.05106           0.097245           0.073794           0.025039                  0                  0                  0              1e-06            6.9e-05           0.002172           0.026577            0.12765            0.24311            0.18449           0.062597    
    i55_r0_10_w2_56              0                 0                 0                 0                 0                 0             9e-06           9.4e-05          0.000375          0.000594           0.000479                  0                  0                  0                  0                  0            1.8e-05           0.001546           0.015674           0.062527           0.099049           0.079808                  0                  0                  0                  0              2e-06           0.000148           0.003865           0.039186            0.15632            0.24762            0.19952    

</pre><h2 id="10">Get Equations</h2><pre class="codeinput">[f_util_log, f_util_crra, f_util_standin, f_coh, f_cons_coh, f_cons_checkcmin] = <span class="keyword">...</span>
    ffs_abz_set_functions(fl_crra, fl_c_min, fl_r_save, fl_w);
</pre><h2 id="11">Get Asset and Choice Grid</h2><p>note this requires ar_z</p><pre class="codeinput"><span class="keyword">if</span> (bl_loglin)
    <span class="comment">% C:\Users\fan\M4Econ\asset\grid\ff_grid_loglin.m</span>
    ar_a = fft_gen_grid_loglin(it_a_n, fl_a_max, fl_a_min, fl_loglin_threshold);
<span class="keyword">else</span>
    fl_r_borr_max = max(ar_z_r_borr);
    [ar_a, fl_borr_yminbd, fl_borr_ymaxbd] = ffs_abz_gen_borrsave_grid(<span class="keyword">...</span>
        fl_b_bd, bl_default, ar_z_wage, fl_w, <span class="keyword">...</span>
        bl_b_is_principle, fl_r_borr_max, fl_a_min, fl_a_max, it_a_n);
<span class="keyword">end</span>
</pre><h2 id="12">Store</h2><pre class="codeinput">armt_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
armt_map(<span class="string">'ar_a'</span>) = ar_a;
armt_map(<span class="string">'mt_z_trans'</span>) = mt_z_trans;
armt_map(<span class="string">'ar_z_r_borr_mesh_wage'</span>) = ar_z_r_borr_mesh_wage;
armt_map(<span class="string">'ar_z_wage_mesh_r_borr'</span>) = ar_z_wage_mesh_r_borr;
armt_map(<span class="string">'ar_z_r_borr'</span>) = ar_z_r_borr;
armt_map(<span class="string">'ar_z_r_borr_prob'</span>) = ar_z_r_borr_prob; <span class="comment">% Exo. Prob</span>

func_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
func_map(<span class="string">'f_util_log'</span>) = f_util_log;
func_map(<span class="string">'f_util_crra'</span>) = f_util_crra;
func_map(<span class="string">'f_util_standin'</span>) = f_util_standin;
func_map(<span class="string">'f_coh'</span>) = f_coh;
func_map(<span class="string">'f_cons_coh'</span>) = f_cons_coh;
func_map(<span class="string">'f_cons_checkcmin'</span>) = f_cons_checkcmin;
</pre><h2 id="13">Graph: A, Shocks, COH, and Defaults</h2><div><ol><li>y-axis : coh(a,z)</li><li>x-axis : a</li><li>color: z</li><li>overlay: coh points points where there is default.</li></ol></div><pre class="codeinput"><span class="keyword">if</span> (bl_graph_funcgrids)

    <span class="comment">% mesh a and and z</span>
    [mt_a_mesh_z, mt_z_mesh_a] = ndgrid(ar_a, ar_z_wage);

    <span class="comment">% cash-on-hand given a and z</span>
    mt_coh = f_coh(mt_z_mesh_a, mt_a_mesh_z);

    <span class="comment">% loop over level vs log graphs</span>
    <span class="keyword">for</span> sub_j=1:1:1

        figure(<span class="string">'PaperPosition'</span>, [0 0 7 4]);

        <span class="keyword">if</span> (sub_j == 1)
            x_mat = mt_a_mesh_z;
            y_mat = mt_coh;
            st_title = <span class="string">'coh(a,z)'</span>;
            st_ylabel = <span class="string">'Cash-on-hand(a, z)'</span>;
            st_xlabel = <span class="string">'Asset States (Choices)'</span>;

            fl_b_bd_graph = fl_b_bd;
            fl_borr_yminbd_graph = fl_borr_yminbd;
            fl_borr_ymaxbd_graph = fl_borr_ymaxbd;
        <span class="keyword">else</span>
            x_mat = log(mt_a_mesh_z - min(min(mt_a_mesh_z)) + 1);
            y_mat = log(mt_coh - min(min(mt_coh)) + 1);
            st_title = <span class="string">'coh(a,z) log scale'</span>;
            st_ylabel = <span class="string">'log(Cash-on-hand(a, z) - min(coh) + 1)'</span>;
            st_xlabel = <span class="string">'log(a - min(a) + 1)'</span>;

            fl_b_bd_graph = log(fl_b_bd  - min(min(mt_a_mesh_z)) + 1);
            fl_borr_yminbd_graph = log(fl_borr_yminbd - min(min(mt_a_mesh_z)) + 1);
            fl_borr_ymaxbd_graph = log(fl_borr_ymaxbd - min(min(mt_a_mesh_z)) + 1);
        <span class="keyword">end</span>

        <span class="comment">% plot main x and y</span>
        chart = plot(x_mat, y_mat, <span class="string">'blue'</span>);

        <span class="comment">% add color based on z</span>
        clr = jet(numel(chart));
        <span class="keyword">for</span> m = 1:numel(chart)
            set(chart(m), <span class="string">'Color'</span>, clr(m,:))
        <span class="keyword">end</span>

        <span class="comment">%     if (length(ar_w_level_full) &lt;= 100)</span>
        <span class="comment">%         scatter(ar_a_meshk, ar_k_mesha, 3, 'filled', ...</span>
        <span class="comment">%             'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');</span>
        <span class="comment">%     end</span>
        <span class="comment">%     if (length(ar_w_level_full) &lt;= 100)</span>
        <span class="comment">%         gf_invalid_scatter = scatter(ar_a_meshk_full(ar_bl_wkb_invalid),...</span>
        <span class="comment">%                                      ar_k_mesha_full(ar_bl_wkb_invalid),...</span>
        <span class="comment">%                 20, 'O', 'MarkerEdgeColor', 'black', 'MarkerFaceColor', 'black');</span>
        <span class="comment">%     end</span>

        <span class="comment">% add various borrowing bound lines</span>

        <span class="comment">% add 0 lines</span>
        xline(0);
        yline(0);

        <span class="comment">% add 45 degrees line</span>
        hline = refline([1 0]);
        hline.Color = <span class="string">'k'</span>;
        hline.LineStyle = <span class="string">':'</span>;
        hline.HandleVisibility = <span class="string">'off'</span>;
        hline.LineWidth = 2.5;

        title(st_title)
        ylabel(st_ylabel)

        grid <span class="string">on</span>;
        grid <span class="string">minor</span>;

        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z_wage', <span class="string">'z=%3.2f'</span>));
        chart(length(chart)+1) = hline;
        legendCell{length(legendCell) + 1} = <span class="string">'if coh(a,z) &gt;= a'</span>;
        legend2plot = [legend2plot length(legendCell)];

        <span class="comment">% if borrow plot additional borrowing bound lines</span>
        <span class="keyword">if</span> (fl_b_bd &gt;= 0 )
            ar_legend_ele = [legend2plot];
            xlabel({st_xlabel})
        <span class="keyword">else</span>
            <span class="comment">% add fl_b_bd exo borrow line</span>
            <span class="keyword">if</span> (fl_b_bd &gt;= min(ar_a))
                xline_borrbound = xline(fl_b_bd_graph);
                xline_borrbound.HandleVisibility = <span class="string">'on'</span>;
                xline_borrbound.LineStyle = <span class="string">'-'</span>;
                xline_borrbound.Color = <span class="string">'black'</span>;
                xline_borrbound.LineWidth = 2.5;

                yline_borrbound = yline(fl_b_bd_graph);
                yline_borrbound.HandleVisibility = <span class="string">'off'</span>;
                yline_borrbound.LineStyle = <span class="string">'-'</span>;
                yline_borrbound.Color = <span class="string">'black'</span>;
                yline_borrbound.LineWidth = 1;
            <span class="keyword">end</span>

            xline_yminbd = xline(fl_borr_yminbd_graph);
            xline_yminbd.HandleVisibility = <span class="string">'on'</span>;
            xline_yminbd.LineStyle = <span class="string">'--'</span>;
            xline_yminbd.Color = <span class="string">'red'</span>;
            xline_yminbd.LineWidth = 2.5;

            yline_yminbd = yline(fl_borr_yminbd_graph);
            yline_yminbd.HandleVisibility = <span class="string">'off'</span>;
            yline_yminbd.LineStyle = <span class="string">'--'</span>;
            yline_yminbd.Color = <span class="string">'red'</span>;
            yline_yminbd.LineWidth = 1;

            <span class="keyword">if</span> (bl_default)
                xline_ymaxbd = xline(fl_borr_ymaxbd_graph);
                xline_ymaxbd.HandleVisibility = <span class="string">'on'</span>;
                xline_ymaxbd.LineStyle = <span class="string">'--'</span>;
                xline_ymaxbd.Color = <span class="string">'blue'</span>;
                xline_ymaxbd.LineWidth = 2.5;

                yline_ymaxbd = yline(fl_borr_ymaxbd_graph);
                yline_ymaxbd.HandleVisibility = <span class="string">'on'</span>;
                yline_ymaxbd.LineStyle = <span class="string">':'</span>;
                yline_ymaxbd.Color = <span class="string">'blue'</span>;
                yline_ymaxbd.LineWidth = 2.5;
            <span class="keyword">end</span>


            <span class="comment">% add bound line legends</span>
            it_addlines_cn = 0;
            <span class="keyword">if</span> (fl_b_bd &gt;= min(ar_a))
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = xline_borrbound;
                legendCell{length(legendCell) + 1} = <span class="string">'exo. borrow bound fbbd'</span>;
            <span class="keyword">end</span>
            it_addlines_cn = it_addlines_cn + 1;
            chart(length(chart)+1) = xline_yminbd;
            legendCell{length(legendCell) + 1} = <span class="string">'neg min inc: -zmin*w/r (no default)'</span>;
            <span class="keyword">if</span> (bl_default)
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = xline_ymaxbd;
                legendCell{length(legendCell) + 1} = <span class="string">'neg max inc: -zmax*w/r (default)'</span>;
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = yline_ymaxbd;
                legendCell{length(legendCell) + 1} = <span class="string">'must default if coh(a,z)&lt;dot-line'</span>;
            <span class="keyword">end</span>

            <span class="comment">% draw legend</span>
            ar_legend_ele = [legend2plot length(legendCell)-it_addlines_cn:1:length(legendCell)];
            xlabel({st_xlabel <span class="string">'if coh(a,z) &lt; a, then a''(a,z)&lt;a'</span>})
        <span class="keyword">end</span>

        <span class="comment">% draw legends</span>
        legend(chart(unique(ar_legend_ele)), legendCell(unique(ar_legend_ele)), <span class="string">'Location'</span>, <span class="string">'northwest'</span>);

    <span class="keyword">end</span>

<span class="keyword">end</span>
</pre><img vspace="5" hspace="5" src="ffs_abz_get_funcgrid_01.png" alt=""> <h2 id="14">Display</h2><pre class="codeinput"><span class="keyword">if</span> (bl_display_funcgrids)

    disp(<span class="string">'ar_z_wage'</span>);
    disp(size(ar_z_wage));
    disp(ar_z_wage);

    disp(<span class="string">'ar_z_r_borr'</span>);
    disp(size(ar_z_r_borr));
    disp(ar_z_r_borr);

    fft_container_map_display(armt_map, it_display_summmat_rowmax, it_display_summmat_colmax);
    fft_container_map_display(func_map, it_display_summmat_rowmax, it_display_summmat_colmax);
<span class="keyword">end</span>
</pre><pre class="codeoutput">ar_z_wage
     1    11

  Columns 1 through 7

    0.3466    0.4234    0.5171    0.6316    0.7715    0.9423    1.1509

  Columns 8 through 11

    1.4057    1.7169    2.0970    2.5613

ar_z_r_borr
     1     5

    0.0250    0.0425    0.0600    0.0775    0.0950

----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: ARMT_MAP
----------------------------------------
  Map with properties:

        Count: 6
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Matrix in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                             i    idx    rowN    colN      mean        std         min         max  
                             _    ___    ____    ____    ________    ________    ________    _______

    ar_a                     1     1       1     750           15      20.248         -20         50
    ar_z_r_borr              2     2       1       5         0.06     0.02767       0.025      0.095
    ar_z_r_borr_mesh_wage    3     3       1      55         0.06    0.024977       0.025      0.095
    ar_z_r_borr_prob         4     4       1       5          0.2     0.26988    0.001552    0.64666
    ar_z_wage_mesh_r_borr    5     5       1      55       1.1422     0.70079     0.34664     2.5613
    mt_z_trans               6     6      55      55     0.018182    0.046336           0    0.24762

----------------------------------------
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Begin: Show all key and value pairs from container
CONTAINER NAME: FUNC_MAP
----------------------------------------
  Map with properties:

        Count: 6
      KeyType: char
    ValueType: any

xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
----------------------------------------
----------------------------------------
pos = 1 ; key = f_coh ; val = @(z,b)(z*fl_w+b)
pos = 2 ; key = f_cons_checkcmin ; val = @(fl_r_borr,z,b,bprime)((f_coh_princ(fl_r_borr,z,b)-bprime).*((f_coh_princ(fl_r_borr,z,b)-bprime)&gt;=fl_c_min)+fl_c_min.*((f_coh_princ(fl_r_borr,z,b)-bprime)&lt;fl_c_min))
pos = 3 ; key = f_cons_coh ; val = @(coh,fl_r_borr,bprime)(coh-(bprime.*(1/(1+fl_r_save)).*(bprime&gt;0)+bprime.*(1/(1+fl_r_borr)).*(bprime&lt;=0)))
pos = 4 ; key = f_util_crra ; val = @(c)(((c).^(1-fl_crra)-1)./(1-fl_crra))
pos = 5 ; key = f_util_log ; val = @(c)log(c)
pos = 6 ; key = f_util_standin ; val = @(fl_r_borr,z,b)f_util_log(f_coh_princ(fl_r_borr,z,b).*(f_coh_princ(fl_r_borr,z,b)&gt;0)+fl_c_min.*(f_coh_princ(fl_r_borr,z,b)&lt;=0))
----------------------------------------
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
Scalars in Container and Sizes and Basic Statistics
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
                        i    idx    xFunction
                        _    ___    _________

    f_coh               1     1         1    
    f_cons_checkcmin    2     2         2    
    f_cons_coh          3     3         3    
    f_util_crra         4     4         4    
    f_util_log          5     5         5    
    f_util_standin      6     6         6    

</pre><pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 6
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Generate States, Choices and Shocks Grids and Get Functions (Borr + Save)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function [armt_map, func_map] = ffs_abz_get_funcgrid(varargin)
%% FFS_ABZ_GET_FUNCGRID get funcs, params, states choices shocks grids
% centralized gateway for retrieving parameters, and solution grids and
% functions. Generate asset grid, and shock grid that accomandates two
% shocks jointly: one ar1 wage shock, one iid interest rate shock.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param bl_input_override boolean if true varargin contained param_map and
% support_map fully overrides local default. Local default is not invoked.
% This could be important for speed if this function is getting invoked
% within certain loops. Default is 0.
%
% @return armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @return func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @example
%
%    it_param_set = 2;
%    bl_input_override = true;
%    [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
%    [armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override);
%
% @include
%
% * <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_functions.html ffs_abz_set_functions>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_gen_borrsave_grid.html ffs_abz_gen_borrsave_grid>
% * <https://fanwangecon.github.io/CodeDynaAsset/tools/html/fft_gen_discrete_var.html fft_gen_discrete_var>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/ffto_gen_tauchen_jhl.m ffto_gen_tauchen_jhl>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/fft_gen_grid_loglin.m fft_gen_grid_loglin>
%
% @seealso
%
% * initialize parameters: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_default_param.html ffs_abz_set_default_param>
% * initialize functions: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_functions.html ffs_abz_set_functions>
% * set asset grid: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_gen_borrsave_grid.html ffs_abz_gen_borrsave_grid>
% * set shock borrow rate: <https://fanwangecon.github.io/CodeDynaAsset/tools/html/fft_gen_discrete_var.html fft_gen_discrete_var>
% * set shock wage: <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/tools/ffto_gen_tauchen_jhl.m ffto_gen_tauchen_jhl>
% * gateway function processing grid, paramters, functions: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_get_funcgrid.html ffs_abz_get_funcgrid>
%

%% Default
if (~isempty(varargin))
    
    % override when called from outside
    [param_map, support_map] = varargin{:};
    
else
    close all
    % default internal run
    it_param_set = 4;
    [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
    support_map('bl_graph_funcgrids') = true;
    support_map('bl_display_funcgrids') = true;
    default_maps = {param_map, support_map};
    
    % numvarargs is the number of varagin inputted
    [default_maps{1:length(varargin)}] = varargin{:};
    param_map = [param_map; default_maps{1}];
    support_map = [support_map; default_maps{2}];
end

%% Parse Parameters 1

% param_map asset grid
params_group = values(param_map, {'fl_b_bd', 'bl_default', 'fl_a_min', 'fl_a_max', 'bl_loglin', 'fl_loglin_threshold', 'it_a_n'});
[fl_b_bd, bl_default, fl_a_min, fl_a_max, bl_loglin, fl_loglin_threshold, it_a_n] = params_group{:};

% param_map preference
params_group = values(param_map, {'fl_crra', 'fl_c_min'});
[fl_crra, fl_c_min] = params_group{:};

% param_map borrowing and price
params_group = values(param_map, {'bl_b_is_principle', 'fl_r_save', 'fl_w'});
[bl_b_is_principle, fl_r_save, fl_w] = params_group{:};

%% Parse Parameters 2

% param_map shock income
params_group = values(param_map, {'it_z_wage_n', 'fl_z_wage_mu', 'fl_z_wage_rho', 'fl_z_wage_sig'});
[it_z_wage_n, fl_z_wage_mu, fl_z_wage_rho, fl_z_wage_sig] = params_group{:};

% param_map shock borrowing interest
params_group = values(param_map, {'st_z_r_borr_drv_ele_type', 'st_z_r_borr_drv_prb_type', 'fl_z_r_borr_poiss_mean', ...
    'fl_z_r_borr_max', 'fl_z_r_borr_min', 'fl_z_r_borr_n'});
[st_z_r_borr_drv_ele_type, st_z_r_borr_drv_prb_type, fl_z_r_borr_poiss_mean, ...
    fl_z_r_borr_max, fl_z_r_borr_min, fl_z_r_borr_n] = params_group{:};

%% Parse Parameters 3

% support_map controls
params_group = values(support_map, {'bl_graph_funcgrids', 'bl_display_funcgrids'});
[bl_graph_funcgrids, bl_display_funcgrids] = params_group{:};
params_group = values(support_map, {'it_display_summmat_rowmax', 'it_display_summmat_colmax'});
[it_display_summmat_rowmax, it_display_summmat_colmax] = params_group{:};

%% Get Shock: Income Shock (ar1)

[~, mt_z_wage_trans, ~, ar_z_wage] = ffto_gen_tauchen_jhl(fl_z_wage_mu,fl_z_wage_rho,fl_z_wage_sig,it_z_wage_n);

%% Get Shock: Interest Rate Shock (iid)

% get borrowing grid and probabilities
param_dsv_map = containers.Map('KeyType','char', 'ValueType','any');
param_dsv_map('st_drv_ele_type') = st_z_r_borr_drv_ele_type;
param_dsv_map('st_drv_prb_type') = st_z_r_borr_drv_prb_type;
param_dsv_map('fl_poiss_mean') = fl_z_r_borr_poiss_mean;
param_dsv_map('fl_max') = fl_z_r_borr_max;
param_dsv_map('fl_min') = fl_z_r_borr_min;
param_dsv_map('fl_n') = fl_z_r_borr_n;
[ar_z_r_borr, ar_z_r_borr_prob] = fft_gen_discrete_var(param_dsv_map, true);

% iid transition matrix
mt_z_r_borr_prob_trans = repmat(ar_z_r_borr_prob, [length(ar_z_r_borr_prob), 1]);

%% Get Shock: Mesh Shocks Together

% Kronecker product to get full transition matrix for the two shocks
mt_z_trans = kron(mt_z_r_borr_prob_trans, mt_z_wage_trans);

% mesh the shock vectors
[mt_z_wage_mesh_r_borr, mt_z_r_borr_mesh_wage] = ndgrid(ar_z_wage, ar_z_r_borr);
ar_z_r_borr_mesh_wage = mt_z_r_borr_mesh_wage(:)';
ar_z_wage_mesh_r_borr = mt_z_wage_mesh_r_borr(:)';

if (bl_display_funcgrids)
    
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Borrow R Shock: ar_z_r_borr_mesh_wage');
    disp('Prod/Wage Shock: mt_z_wage_mesh_r_borr');
    disp('show which shock is inner and which is outter');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    
    tb_two_shocks = array2table([ar_z_r_borr_mesh_wage;...
        ar_z_wage_mesh_r_borr]');
    cl_col_names = ["Borrow R Shock (Meshed)", "Wage R Shock (Meshed)"];
    cl_row_names = strcat('zi=', string((1:length(ar_z_r_borr_mesh_wage))));
    tb_two_shocks.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_two_shocks.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);
    
    it_row_display = it_z_wage_n*2;
    
    disp(size(tb_two_shocks));
    disp(head(tb_two_shocks, it_row_display));
    disp(tail(tb_two_shocks, it_row_display));
    
    
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Borrow Rate Transition Matrix: mt_z_r_borr_prob_trans');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    it_col_n_keep = 15;
    it_row_n_keep = 15;    
    [it_row_n, it_col_n] = size(mt_z_r_borr_prob_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);    
    cl_st_full_rowscols = cellstr([num2str(ar_z_r_borr', 'r%3.2f')]);
    tb_z_r_borr_prob_trans = array2table(round(mt_z_r_borr_prob_trans(ar_it_rows, ar_it_cols), 6));
    cl_col_names = strcat('zi=', num2str(ar_it_cols'), ':', cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat('zi=', num2str(ar_it_rows'), ':', cl_st_full_rowscols(ar_it_cols));
    tb_z_r_borr_prob_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_z_r_borr_prob_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);
       
    disp(size(tb_z_r_borr_prob_trans));
    disp(tb_z_r_borr_prob_trans);
    
    
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Wage Prod Shock Transition Matrix: mt_z_r_borr_prob_trans');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    it_col_n_keep = 15;
    it_row_n_keep = 15;    
    [it_row_n, it_col_n] = size(mt_z_wage_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);    
    cl_st_full_rowscols = cellstr([num2str(ar_z_wage', 'w%3.2f')]);
    tb_z_wage_trans = array2table(round(mt_z_wage_trans(ar_it_rows, ar_it_cols),6));    
    cl_col_names = strcat('zi=', num2str(ar_it_cols'), ':', cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat('zi=', num2str(ar_it_rows'), ':', cl_st_full_rowscols(ar_it_cols));
    tb_z_wage_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_z_wage_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);
       
    disp(size(tb_z_wage_trans));
    disp(tb_z_wage_trans);
    
    
    disp('REPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASHREPLACE_WITH_DASH_DASH');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    disp('Full Transition Matrix: mt_z_trans');
    disp('xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx');
    it_col_n_keep = it_z_wage_n*3;
    it_row_n_keep = it_z_wage_n*3;
    [it_row_n, it_col_n] = size(mt_z_trans);
    [ar_it_cols, ar_it_rows] = fft_row_col_subset(it_col_n, it_col_n_keep, it_row_n, it_row_n_keep);    
    cl_st_full_rowscols = cellstr([num2str(ar_z_r_borr_mesh_wage', 'r%3.2f;'), ...
                                   num2str(ar_z_wage_mesh_r_borr', 'w%3.2f')]);
    tb_mt_z_trans = array2table(round(mt_z_trans(ar_it_rows, ar_it_cols),6));
    cl_col_names = strcat('i', num2str(ar_it_cols'), ':', cl_st_full_rowscols(ar_it_cols));
    cl_row_names = strcat('i', num2str(ar_it_rows'), ':', cl_st_full_rowscols(ar_it_cols));
    tb_mt_z_trans.Properties.VariableNames = matlab.lang.makeValidName(cl_col_names);
    tb_mt_z_trans.Properties.RowNames = matlab.lang.makeValidName(cl_row_names);
       
    disp(size(tb_mt_z_trans));
    disp(tb_mt_z_trans);
    
end

%% Get Equations

[f_util_log, f_util_crra, f_util_standin, f_coh, f_cons_coh, f_cons_checkcmin] = ...
    ffs_abz_set_functions(fl_crra, fl_c_min, fl_r_save, fl_w);

%% Get Asset and Choice Grid
% note this requires ar_z

if (bl_loglin)
    % C:\Users\fan\M4Econ\asset\grid\ff_grid_loglin.m
    ar_a = fft_gen_grid_loglin(it_a_n, fl_a_max, fl_a_min, fl_loglin_threshold);
else
    fl_r_borr_max = max(ar_z_r_borr);
    [ar_a, fl_borr_yminbd, fl_borr_ymaxbd] = ffs_abz_gen_borrsave_grid(...
        fl_b_bd, bl_default, ar_z_wage, fl_w, ...
        bl_b_is_principle, fl_r_borr_max, fl_a_min, fl_a_max, it_a_n);
end

%% Store

armt_map = containers.Map('KeyType','char', 'ValueType','any');
armt_map('ar_a') = ar_a;
armt_map('mt_z_trans') = mt_z_trans;
armt_map('ar_z_r_borr_mesh_wage') = ar_z_r_borr_mesh_wage;
armt_map('ar_z_wage_mesh_r_borr') = ar_z_wage_mesh_r_borr;
armt_map('ar_z_r_borr') = ar_z_r_borr;
armt_map('ar_z_r_borr_prob') = ar_z_r_borr_prob; % Exo. Prob

func_map = containers.Map('KeyType','char', 'ValueType','any');
func_map('f_util_log') = f_util_log;
func_map('f_util_crra') = f_util_crra;
func_map('f_util_standin') = f_util_standin;
func_map('f_coh') = f_coh;
func_map('f_cons_coh') = f_cons_coh;
func_map('f_cons_checkcmin') = f_cons_checkcmin;

%% Graph: A, Shocks, COH, and Defaults
% # y-axis : coh(a,z)
% # x-axis : a
% # color: z
% # overlay: coh points points where there is default.

if (bl_graph_funcgrids)
    
    % mesh a and and z
    [mt_a_mesh_z, mt_z_mesh_a] = ndgrid(ar_a, ar_z_wage);
    
    % cash-on-hand given a and z
    mt_coh = f_coh(mt_z_mesh_a, mt_a_mesh_z);
    
    % loop over level vs log graphs
    for sub_j=1:1:1
        
        figure('PaperPosition', [0 0 7 4]);
        
        if (sub_j == 1)
            x_mat = mt_a_mesh_z;
            y_mat = mt_coh;
            st_title = 'coh(a,z)';
            st_ylabel = 'Cash-on-hand(a, z)';
            st_xlabel = 'Asset States (Choices)';
            
            fl_b_bd_graph = fl_b_bd;
            fl_borr_yminbd_graph = fl_borr_yminbd;
            fl_borr_ymaxbd_graph = fl_borr_ymaxbd;
        else
            x_mat = log(mt_a_mesh_z - min(min(mt_a_mesh_z)) + 1);
            y_mat = log(mt_coh - min(min(mt_coh)) + 1);
            st_title = 'coh(a,z) log scale';
            st_ylabel = 'log(Cash-on-hand(a, z) - min(coh) + 1)';
            st_xlabel = 'log(a - min(a) + 1)';
            
            fl_b_bd_graph = log(fl_b_bd  - min(min(mt_a_mesh_z)) + 1);
            fl_borr_yminbd_graph = log(fl_borr_yminbd - min(min(mt_a_mesh_z)) + 1);
            fl_borr_ymaxbd_graph = log(fl_borr_ymaxbd - min(min(mt_a_mesh_z)) + 1);
        end
        
        % plot main x and y
        chart = plot(x_mat, y_mat, 'blue');
        
        % add color based on z
        clr = jet(numel(chart));
        for m = 1:numel(chart)
            set(chart(m), 'Color', clr(m,:))
        end
        
        %     if (length(ar_w_level_full) <= 100)
        %         scatter(ar_a_meshk, ar_k_mesha, 3, 'filled', ...
        %             'MarkerEdgeColor', 'b', 'MarkerFaceColor', 'b');
        %     end
        %     if (length(ar_w_level_full) <= 100)
        %         gf_invalid_scatter = scatter(ar_a_meshk_full(ar_bl_wkb_invalid),...
        %                                      ar_k_mesha_full(ar_bl_wkb_invalid),...
        %                 20, 'O', 'MarkerEdgeColor', 'black', 'MarkerFaceColor', 'black');
        %     end
        
        % add various borrowing bound lines
        
        % add 0 lines
        xline(0);
        yline(0);
        
        % add 45 degrees line
        hline = refline([1 0]);
        hline.Color = 'k';
        hline.LineStyle = ':';
        hline.HandleVisibility = 'off';
        hline.LineWidth = 2.5;
        
        title(st_title)
        ylabel(st_ylabel)
        
        grid on;
        grid minor;
        
        legend2plot = fliplr([1 round(numel(chart)/3) round((2*numel(chart))/4)  numel(chart)]);
        legendCell = cellstr(num2str(ar_z_wage', 'z=%3.2f'));
        chart(length(chart)+1) = hline;
        legendCell{length(legendCell) + 1} = 'if coh(a,z) >= a';
        legend2plot = [legend2plot length(legendCell)];
        
        % if borrow plot additional borrowing bound lines
        if (fl_b_bd >= 0 )
            ar_legend_ele = [legend2plot];
            xlabel({st_xlabel})
        else
            % add fl_b_bd exo borrow line
            if (fl_b_bd >= min(ar_a))
                xline_borrbound = xline(fl_b_bd_graph);
                xline_borrbound.HandleVisibility = 'on';
                xline_borrbound.LineStyle = '-';
                xline_borrbound.Color = 'black';
                xline_borrbound.LineWidth = 2.5;
                
                yline_borrbound = yline(fl_b_bd_graph);
                yline_borrbound.HandleVisibility = 'off';
                yline_borrbound.LineStyle = '-';
                yline_borrbound.Color = 'black';
                yline_borrbound.LineWidth = 1;
            end
            
            xline_yminbd = xline(fl_borr_yminbd_graph);
            xline_yminbd.HandleVisibility = 'on';
            xline_yminbd.LineStyle = 'REPLACE_WITH_DASH_DASH';
            xline_yminbd.Color = 'red';
            xline_yminbd.LineWidth = 2.5;
            
            yline_yminbd = yline(fl_borr_yminbd_graph);
            yline_yminbd.HandleVisibility = 'off';
            yline_yminbd.LineStyle = 'REPLACE_WITH_DASH_DASH';
            yline_yminbd.Color = 'red';
            yline_yminbd.LineWidth = 1;
            
            if (bl_default)
                xline_ymaxbd = xline(fl_borr_ymaxbd_graph);
                xline_ymaxbd.HandleVisibility = 'on';
                xline_ymaxbd.LineStyle = 'REPLACE_WITH_DASH_DASH';
                xline_ymaxbd.Color = 'blue';
                xline_ymaxbd.LineWidth = 2.5;
                
                yline_ymaxbd = yline(fl_borr_ymaxbd_graph);
                yline_ymaxbd.HandleVisibility = 'on';
                yline_ymaxbd.LineStyle = ':';
                yline_ymaxbd.Color = 'blue';
                yline_ymaxbd.LineWidth = 2.5;
            end
            
            
            % add bound line legends
            it_addlines_cn = 0;
            if (fl_b_bd >= min(ar_a))
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = xline_borrbound;
                legendCell{length(legendCell) + 1} = 'exo. borrow bound fbbd';
            end
            it_addlines_cn = it_addlines_cn + 1;
            chart(length(chart)+1) = xline_yminbd;
            legendCell{length(legendCell) + 1} = 'neg min inc: -zmin*w/r (no default)';
            if (bl_default)
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = xline_ymaxbd;
                legendCell{length(legendCell) + 1} = 'neg max inc: -zmax*w/r (default)';
                it_addlines_cn = it_addlines_cn + 1;
                chart(length(chart)+1) = yline_ymaxbd;
                legendCell{length(legendCell) + 1} = 'must default if coh(a,z)<dot-line';
            end
            
            % draw legend
            ar_legend_ele = [legend2plot length(legendCell)-it_addlines_cn:1:length(legendCell)];
            xlabel({st_xlabel 'if coh(a,z) < a, then a''(a,z)<a'})
        end
        
        % draw legends
        legend(chart(unique(ar_legend_ele)), legendCell(unique(ar_legend_ele)), 'Location', 'northwest');
        
    end
    
end

%% Display

if (bl_display_funcgrids)
    
    disp('ar_z_wage');
    disp(size(ar_z_wage));
    disp(ar_z_wage);

    disp('ar_z_r_borr');
    disp(size(ar_z_r_borr));
    disp(ar_z_r_borr);
    
    fft_container_map_display(armt_map, it_display_summmat_rowmax, it_display_summmat_colmax);
    fft_container_map_display(func_map, it_display_summmat_rowmax, it_display_summmat_colmax);
end

end

##### SOURCE END #####
--></body></html>