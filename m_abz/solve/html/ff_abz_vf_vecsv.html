
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>Solve Save + Borr Dynamic Programming Problem (Optimized-Vectorized)</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-06-16"><meta name="DC.source" content="ff_abz_vf_vecsv.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h1>Solve Save + Borr Dynamic Programming Problem (Optimized-Vectorized)</h1><!--introduction--><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><!--/introduction--><h2>Contents</h2><div><ul><li><a href="#2">FF_ABZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Iterate Value Function</a></li><li><a href="#10">Solve Optimization Problem Current Iteration</a></li><li><a href="#11">Check Tolerance and Continuation</a></li><li><a href="#13">Process Optimal Choices</a></li></ul></div><pre class="codeinput"><span class="keyword">function</span> result_map = ff_abz_vf_vecsv(varargin)
</pre><h2 id="2">FF_ABZ_VF_VECSV solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic single asset and single shock problem with vectorized codes. <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf.html">ff_abz_vf</a> shows looped codes. <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vec.html">ff_abz_vf_vec</a> shows vectorized codes. This file shows vectorized codes that is faster but is more memory intensive.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>keys included in result_map:</p><div><ul><li>mt_val matrix states_n by shock_n matrix of converged value function grid</li><li>mt_pol_a matrix states_n by shock_n matrix of converged policy function grid</li><li>ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function difference between iteration</li><li>ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy function difference between iterations</li><li>mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the proportion of grid points at which policy function changed between current and last iteration for each element of shock</li></ul></div><p>@example</p><pre>  % Get Default Parameters
  it_param_set = 4;
  [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
  % Chnage param_map keys for borrowing
  param_map('fl_b_bd') = -20; % borrow bound
  param_map('bl_default') = false; % true if allow for default
  param_map('fl_c_min') = 0.0001; % u(c_min) when default
  % Change Keys in param_map
  param_map('it_a_n') = 500;
  param_map('it_z_n') = 11;
  param_map('fl_a_max') = 100;
  param_map('fl_w') = 1.3;
  % Change Keys support_map
  support_map('bl_display') = false;
  support_map('bl_post') = true;
  support_map('bl_display_final') = false;
  % Call Program with external parameters that override defaults.
  ff_abz_vf_vecsv(param_map, support_map);</pre><p>@include</p><div><ul><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_default_param.html">ffs_abz_set_default_param</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_get_funcgrid.html">ffs_abz_get_funcgrid</a></li><li><a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html">ff_az_vf_post</a></li></ul></div><p>@seealso</p><div><ul><li>save loop: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf.html">ff_az_vf</a></li><li>save vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vec.html">ff_az_vf_vec</a></li><li>save optimized-vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vecsv.html">ff_az_vf_vecsv</a></li><li>save + borr loop: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf.html">ff_abz_vf</a></li><li>save + borr vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vec.html">ff_abz_vf_vec</a></li><li>save + borr optimized-vectorized: <a href="https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vecsv.html">ff_abz_vf_vecsv</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><p>go to <a href="https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_abz_set_default_param.html">ffs_abz_set_default_param</a> to change parameters in param_map container. The parameters can also be updated here directly after obtaining them from ffs_abz_set_default_param as we possibly change it_a_n and it_z_n here.</p><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_abz_set_default_param(it_param_set);

<span class="comment">% Note: param_map and support_map can be adjusted here or outside to override defaults</span>
<span class="comment">% param_map('it_a_n') = 750;</span>
<span class="comment">% param_map('it_z_n') = 15;</span>

[armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_abz_vf_vecsv'</span>;
support_map(<span class="string">'st_profile_name_main'</span>) = [st_func_name support_map(<span class="string">'st_profile_name_main'</span>)];
support_map(<span class="string">'st_mat_name_main'</span>) = [st_func_name support_map(<span class="string">'st_mat_name_main'</span>)];
support_map(<span class="string">'st_img_name_main'</span>) = [st_func_name support_map(<span class="string">'st_img_name_main'</span>)];
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_a'</span>, <span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>});
[ar_a, mt_z_trans, ar_z] = params_group{:};

<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_cons'</span>, <span class="string">'f_coh'</span>, <span class="string">'f_cons_coh'</span>});
[f_util_log, f_util_crra, f_cons, f_coh, f_cons_coh] = params_group{:};

<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'it_a_n'</span>, <span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="string">'fl_c_min'</span>,<span class="keyword">...</span>
    <span class="string">'fl_nan_replace'</span>, <span class="string">'bl_default'</span>, <span class="string">'fl_default_aprime'</span>});
[it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min, <span class="keyword">...</span>
    fl_nan_replace, bl_default, fl_default_aprime] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><p>include mt_pol_idx which we did not have in looped code</p><pre class="codeinput">mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_idx = zeros(length(ar_a),length(ar_z));

<span class="comment">% We did not need these in ff_abz_vf or ff_abz_vf_vec</span>
<span class="comment">% see</span>
<span class="comment">% &lt;https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html</span>
<span class="comment">% fs_u_c_partrepeat_main&gt; for why store using cells.</span>
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="10">Solve Optimization Problem Current Iteration</h2><p>Only this segment of code differs between ff_abz_vf and ff_abz_vf_vec Store in cells results and retrieve, this is more memory intensive than ff_abz_vf_vec.</p><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)

        <span class="comment">% Current Shock</span>
        fl_z = ar_z(it_z_i);

        <span class="comment">% cash-on-hand</span>
        ar_coh = f_coh(fl_z, ar_a);

        <span class="comment">% Consumption and u(c) only need to be evaluated once</span>
        <span class="keyword">if</span> (it_iter == 1)

            <span class="comment">% Consumption: fl_z = 1 by 1, ar_a = 1 by N, ar_a' = N by 1</span>
            <span class="comment">% mt_c is N by N: matrix broadcasting, expand to matrix from arrays</span>
            mt_c = f_cons_coh(ar_coh, ar_a');

            <span class="comment">% EVAL current utility: N by N, f_util defined earlier</span>
            <span class="comment">% slightly faster to explicitly write function</span>
            <span class="keyword">if</span> (fl_crra == 1)
                mt_utility = log(mt_c);
                fl_u_cmin = f_util_log(fl_c_min);
            <span class="keyword">else</span>
                <span class="comment">% slightly faster if write function here directly, but</span>
                <span class="comment">% speed gain is very small, more important to have single</span>
                <span class="comment">% location control of functions.</span>
                mt_utility = f_util_crra(mt_c);
                fl_u_cmin = f_util_crra(fl_c_min);
            <span class="keyword">end</span>

            <span class="comment">% Eliminate Complex Numbers</span>
            mt_it_c_valid_idx = (mt_c &lt;= fl_c_min);
            mt_utility(mt_it_c_valid_idx) = fl_u_cmin;

            <span class="comment">% Store in cells</span>
            cl_u_c_store{it_z_i} = mt_utility;
            cl_c_valid_idx{it_z_i} = mt_it_c_valid_idx;

        <span class="keyword">end</span>

        <span class="comment">% f(z'|z)</span>
        ar_z_trans_condi = mt_z_trans(it_z_i,:);

        <span class="comment">% EVAL EV((A',K'),Z'|Z) = V((A',K'),Z') x p(z'|z)', (N by Z) x (Z by 1) = N by 1</span>
        <span class="comment">% Note: transpose ar_z_trans_condi from 1 by Z to Z by 1</span>
        <span class="comment">% Note: matrix multiply not dot multiply</span>
        mt_evzp_condi_z = mt_val_cur * ar_z_trans_condi';

        <span class="comment">% EVAL add on future utility, N by N + N by 1</span>
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_evzp_condi_z;

        <span class="comment">% Index update</span>
        <span class="comment">% using the method below is much faster than index replace</span>
        <span class="comment">% see &lt;https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript&gt;</span>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        <span class="comment">% Default or Not Utility Handling</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if default: only today u(cmin), transition out next period, debt wiped out</span>
            fl_v_default = fl_u_cmin + fl_beta*mt_evzp_condi_z(ar_a == fl_default_aprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed: v = u(cmin)</span>
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        <span class="keyword">end</span>

        <span class="comment">% Optimization: remember matlab is column major, rows must be</span>
        <span class="comment">% choices, columns must be states</span>
        <span class="comment">% &lt;https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR&gt;</span>
        <span class="comment">% mt_utility is N by N, rows are choices, cols are states.</span>
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);
        ar_opti_aprime_z = ar_a(ar_opti_idx_z);
        ar_opti_c_z = f_cons_coh(ar_coh, ar_opti_aprime_z);

        <span class="comment">% Handle Default is optimal or not</span>
        <span class="keyword">if</span> (bl_default)
            <span class="comment">% if defaulting is optimal choice, at these states, not required</span>
            <span class="comment">% to default, non-default possible, but default could be optimal</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = fl_default_aprime;
        <span class="keyword">else</span>
            <span class="comment">% if default is not allowed, then next period same state as now</span>
            <span class="comment">% this is absorbing state, this is the limiting case, single</span>
            <span class="comment">% state space point, lowest a and lowest shock has this.</span>
            ar_opti_aprime_z(ar_opti_c_z &lt;= fl_c_min) = ar_a(ar_opti_c_z &lt;= fl_c_min);
        <span class="keyword">end</span>

        <span class="comment">% store optimal values</span>
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;

        <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_idx_z;
        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2 id="11">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); <span class="keyword">...</span>
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'Hval'</span>, <span class="string">'Hap'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_a_n,:), highest a state val'</span>)
        disp(<span class="string">'Hap = mt_pol_a_cur(it_a_n,:), highest a state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><h2 id="13">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_a'</span>) = mt_pol_a;
result_map(<span class="string">'mt_pol_idx'</span>) = mt_pol_idx;

<span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">valgap = norm(mt_val - mt_val_cur)
polgap = norm(mt_pol_a - mt_pol_a_cur)
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n)
                 valgap       polgap        z1           z2           z3           z4           z5           z6           z7           z8           z9           z10          z11          z12          z13          z14          z15   
                _________    ________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________    _________

    iter=1         206.22      2013.9            1            1            1            1            1            1            1            1            1            1            1            1            1            1            1
    iter=2         147.51      2147.6        0.996        0.996        0.996      0.99733      0.99867            1            1            1            1            1            1            1            1            1            1
    iter=3         116.24      717.48        0.992      0.99467        0.992      0.99467        0.996      0.99733            1            1            1            1            1            1            1            1            1
    iter=4         96.652      358.74      0.98667        0.988        0.988      0.98933      0.99067      0.99333        0.996      0.99733      0.99867      0.99867            1            1            1            1            1
    iter=5         82.421      214.56      0.98267      0.98267        0.984      0.98267      0.98667        0.988      0.98933      0.99467        0.996      0.99867      0.99867            1            1            1            1
    iter=6         71.221      142.88        0.972      0.97467      0.97467      0.97733      0.98133      0.98133      0.98533        0.988      0.99067      0.99467        0.996      0.99733      0.99867            1            1
    iter=7         62.016      102.05        0.968      0.96133      0.96533      0.96933      0.97067        0.976        0.976      0.97733        0.984      0.98533        0.992      0.99467      0.99733      0.99867            1
    iter=8         54.369      75.966        0.948      0.94933      0.95333        0.956      0.95467         0.96      0.96533        0.968        0.972         0.98        0.984      0.98933      0.99467      0.99467      0.99867
    iter=9         47.916      58.869      0.93467      0.93733      0.93867         0.94        0.948      0.94933      0.95067         0.96      0.96267      0.96667        0.976      0.98267      0.98667        0.992        0.996
    iter=10        42.409      46.919      0.91333      0.91867        0.924      0.92533      0.93067      0.93067      0.94133      0.94267      0.95467      0.95333      0.96533      0.97067      0.97733      0.98267      0.99067
    iter=11        37.678      38.111      0.90267          0.9        0.904      0.91333        0.912      0.92133        0.924      0.92933      0.93333      0.94533        0.948         0.96      0.96533      0.97333      0.97867
    iter=12        33.595      31.477         0.88      0.88133      0.88667      0.89067      0.89467      0.89733      0.89867      0.90533         0.92        0.928      0.93733      0.94267        0.956      0.96133        0.968
    iter=13        30.053      26.501        0.856        0.864        0.864        0.872      0.87467      0.88267        0.888      0.89733      0.90133      0.90933      0.91733      0.92933         0.94        0.948      0.95733
    iter=14        26.969      22.517      0.83733      0.83733      0.84133      0.85067      0.85067        0.852        0.864        0.868      0.88267        0.888      0.89867      0.90667      0.91333      0.93067      0.94133
    iter=15         24.28      19.285        0.808      0.81867         0.82      0.82267      0.83333      0.83867      0.84267        0.852      0.85867        0.872        0.872        0.888      0.90267      0.90933        0.924
    iter=16        21.928      16.704      0.78533        0.788      0.79467      0.80133      0.80133        0.808         0.82      0.82533      0.83333         0.84        0.852      0.86533        0.872        0.888      0.90133
    iter=17        19.865      14.592      0.75733        0.764      0.76533      0.76933      0.77733      0.78667      0.79333      0.79733        0.804         0.82        0.828      0.84133      0.84933      0.86267         0.88
    iter=18        18.054       12.82      0.72533      0.72933      0.73733      0.74133        0.744        0.752         0.76        0.776      0.77733      0.79333      0.80133      0.81067        0.828      0.83867        0.852
    iter=19        16.461      11.302      0.68933      0.69467      0.70133      0.70933        0.712      0.71867      0.73067      0.73333      0.75067      0.75467      0.77067        0.784        0.792      0.80667         0.82
    iter=20        15.056      10.078      0.66267      0.65867      0.67333      0.66933      0.68667      0.69333      0.69867        0.704      0.71733      0.72133      0.73067      0.74667      0.76533      0.77867        0.788
    iter=21        13.817      8.9798      0.61333      0.63067      0.62267        0.636        0.644      0.65333      0.65467        0.676      0.67467      0.69333      0.70133      0.71867        0.724        0.744      0.75733
    iter=22         12.72      8.0476      0.58267      0.58267      0.59467      0.59467      0.60267      0.61333      0.62133        0.624         0.64      0.65067      0.66133      0.66667        0.692      0.70267         0.72
    iter=23        11.748      7.2636      0.53467      0.54667      0.54667      0.56267         0.56        0.564         0.58      0.59333      0.59867        0.612        0.624      0.64133      0.65067      0.66667      0.67733
    iter=24        10.884      6.5836      0.49867      0.49733      0.50933        0.508        0.524      0.53067      0.53867        0.544      0.56267      0.56933         0.58      0.58933      0.60267        0.616        0.636
    iter=25        10.114      6.0011      0.45333      0.45733         0.46         0.46        0.468      0.48267        0.488      0.49333      0.50533      0.52533        0.536        0.544      0.55733      0.57867      0.58933
    iter=26        9.4268      5.5198          0.4      0.40667      0.41067        0.428      0.43067      0.43333        0.436        0.452      0.45867        0.468        0.488          0.5      0.51733        0.528      0.54133
    iter=27        8.8106       5.102        0.364      0.37333      0.37733      0.38533        0.388      0.39333      0.40667        0.408      0.41867        0.428        0.432        0.452         0.46      0.47733      0.49733
    iter=28        8.2564      4.7163      0.33467      0.33067        0.344        0.344        0.352      0.36133      0.36667      0.36933      0.38267      0.38533      0.40533        0.408         0.42      0.43467        0.448
    iter=29         7.756      4.3741        0.308      0.30933      0.31333      0.31067         0.32      0.32667      0.33467        0.344        0.352      0.36133      0.36133      0.37333      0.38533      0.39867      0.40933
    iter=30        7.3024      4.0264      0.27333         0.28         0.28      0.28933        0.292      0.29467      0.30133      0.31067      0.31067      0.32533      0.33733      0.34933      0.36267      0.36267      0.38267
    iter=31        6.8895      3.6577      0.25467      0.25733      0.25733      0.26533        0.264        0.272      0.27333      0.28533      0.29333        0.292          0.3        0.308      0.31867      0.33467      0.34267
    iter=32        6.5123      3.3732      0.22667      0.23867         0.24      0.24267      0.25467        0.248      0.26133      0.26133        0.256      0.27467      0.28533      0.28133      0.29067      0.30133        0.312
    iter=33         6.166      3.0506      0.21467      0.21067      0.21067        0.216      0.21333        0.232      0.22933      0.23067      0.25067         0.24      0.24667      0.27067      0.26933      0.28133      0.29467
    iter=34        5.8467      2.8084      0.19067      0.19733      0.20133      0.20667        0.212        0.208      0.21467        0.224      0.21867      0.23467         0.24      0.23733      0.25067      0.25467      0.25867
    iter=35        5.5512      2.5457         0.18      0.17867         0.18      0.18267      0.18533      0.18933      0.19067      0.19067      0.20533      0.20667      0.20667      0.22533        0.228      0.23867        0.248
    iter=36        5.2766      2.3734      0.16133      0.16533      0.17067      0.16667      0.17467        0.176      0.17867      0.18533        0.188      0.19467      0.20533          0.2        0.216        0.216         0.22
    iter=37        5.0204      2.2258        0.152      0.15467      0.15733      0.15867      0.16667      0.16267      0.17067      0.16933      0.16667        0.176      0.17467        0.188      0.18667      0.19467      0.21067
    iter=38        4.7806      2.1302      0.13867        0.132      0.14267      0.14267      0.13867      0.15067      0.14933        0.156        0.168      0.16267      0.17067      0.17467      0.18267      0.18933      0.18933
    iter=39        4.5554      1.9349      0.12533      0.12667        0.124        0.136      0.13467        0.132        0.136      0.14667      0.14267        0.152      0.15867        0.156      0.16667      0.16667      0.17467
    iter=40        4.3433      1.8188      0.11333      0.12267      0.12267         0.12      0.12533        0.132      0.13067      0.12933        0.136        0.136      0.13867      0.14533      0.14933        0.156      0.15733
    iter=41        4.1429      1.7224      0.10933        0.108      0.11067        0.116        0.112      0.11467        0.124      0.12133      0.12133      0.13067        0.132        0.136      0.14133      0.14533        0.152
    iter=42        3.9531      1.5995      0.10267     0.098667      0.10267          0.1      0.10533      0.10533      0.10533      0.11067        0.116      0.11467      0.11867      0.12267      0.12533        0.132      0.13867
    iter=43         3.773       1.519     0.086667     0.094667     0.090667        0.096     0.093333          0.1      0.10267      0.10667      0.10533      0.11067        0.116        0.112      0.11467      0.12267        0.124
    iter=44        3.6018       1.499     0.089333        0.088        0.092     0.093333     0.098667     0.089333     0.094667     0.098667     0.097333          0.1     0.098667      0.11067        0.116      0.11733      0.11867
    iter=45        3.4388      1.4198     0.077333         0.08     0.077333     0.078667         0.08        0.088     0.089333        0.088     0.093333     0.089333        0.092      0.10267      0.10133      0.10667        0.108
    iter=46        3.2833      1.2973     0.073333        0.068     0.073333     0.070667     0.078667     0.077333     0.077333     0.078667     0.085333     0.090667     0.090667     0.086667     0.098667        0.092        0.104
    iter=47        3.1348        1.24     0.069333        0.072        0.072     0.073333     0.066667     0.074667        0.072     0.074667     0.074667        0.076        0.084     0.082667         0.08     0.093333        0.092
    iter=48        2.9929      1.1449        0.056     0.061333     0.062667        0.064     0.065333     0.062667        0.068     0.073333        0.068     0.074667        0.076     0.077333     0.082667     0.081333        0.084
    iter=49        2.8572      1.0892        0.056        0.056     0.049333        0.064        0.064     0.062667     0.058667     0.065333        0.068        0.064        0.068        0.072        0.072     0.077333     0.082667
    iter=50        2.7274      1.0246     0.049333     0.053333     0.053333        0.056        0.056        0.056     0.061333     0.058667         0.06        0.064        0.064     0.069333     0.069333        0.076     0.074667
    iter=104      0.15135    0.093458            0            0            0            0            0            0            0    0.0013333            0            0    0.0013333            0            0    0.0013333            0
    iter=105       0.1426    0.093458            0            0            0    0.0013333    0.0013333            0            0    0.0013333    0.0013333            0            0    0.0013333            0            0            0
    iter=106      0.13434     0.13217            0            0            0            0            0    0.0026667            0    0.0013333            0            0            0            0            0            0            0
    iter=107      0.12654    0.093458    0.0013333            0    0.0013333            0            0    0.0013333            0            0    0.0013333            0    0.0013333    0.0013333            0            0            0
    iter=108      0.11918    0.093458            0    0.0013333            0            0            0    0.0013333            0            0    0.0013333    0.0013333    0.0013333            0            0            0            0
    iter=109      0.11224    0.093458            0            0            0    0.0013333            0            0            0            0            0            0            0            0            0            0            0
    iter=110      0.10569    0.093458            0            0            0            0    0.0013333            0            0            0            0            0            0            0            0    0.0013333    0.0013333
    iter=111     0.099512    0.093458            0            0            0            0            0            0    0.0013333            0            0            0            0            0            0            0            0
    iter=112     0.093688    0.093458            0            0            0            0            0            0            0            0            0            0            0            0            0            0    0.0013333
    iter=113     0.088196    0.093458    0.0013333            0            0            0            0            0    0.0013333            0            0            0            0            0            0            0    0.0013333
    iter=114      0.08302           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=115     0.078141    0.093458            0    0.0013333            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=116     0.073543    0.093458    0.0013333            0            0            0            0            0            0            0            0            0            0            0    0.0013333            0            0
    iter=117      0.06921    0.093458            0            0            0            0            0            0            0    0.0013333            0            0    0.0013333            0            0            0            0
    iter=118     0.065129           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=119     0.061284           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=120     0.057662    0.093458            0            0            0            0            0            0            0            0    0.0013333            0            0            0            0            0            0
    iter=121     0.054251           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=122      0.05104           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=123     0.048015    0.093458            0            0            0            0    0.0013333    0.0013333            0            0            0            0            0            0            0            0            0
    iter=124     0.045168    0.093458            0            0            0    0.0013333            0            0            0            0            0            0            0            0            0            0            0
    iter=125     0.042488           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=126     0.039965    0.093458            0            0            0            0            0            0            0            0            0            0            0    0.0013333            0            0            0
    iter=127      0.03759    0.093458            0            0            0    0.0013333            0            0            0            0            0            0            0            0    0.0013333            0            0
    iter=128     0.035355           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=129     0.033251           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=130     0.031272           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=131     0.029409           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=132     0.027657           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=133     0.026008           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=134     0.024457           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=135     0.022998           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=136     0.021625           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=137     0.020334           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=138     0.019119           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=139     0.017977           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=140     0.016903           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=141     0.015892           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=142     0.014942           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=143     0.014048           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=144     0.013208           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=145     0.012417           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=146     0.011674           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=147     0.010975           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=148     0.010318           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=149    0.0097003           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=150    0.0091194           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=151    0.0085731           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=152    0.0080595           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0
    iter=153    0.0075767           0            0            0            0            0            0            0            0            0            0            0            0            0            0            0            0

tb_val
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20           -58.347        -58.18       -57.992       -57.79      -39.104       -30.352       -13.959       -11.598       -9.5136       -7.6397       -5.9517       -4.4497 
    a2=-19.9065      -58.347        -58.18       -57.992      -45.904      -35.975         -28.8       -13.665       -11.363       -9.3274       -7.4865       -5.8232       -4.3403 
    a3=-19.8131      -58.347        -58.18       -51.539      -41.908      -33.955       -27.453        -13.38       -11.136       -9.1436       -7.3359       -5.6963       -4.2321 
    a4=-19.7196      -58.347       -55.162       -47.467      -39.261      -32.034       -26.327       -13.101       -10.915       -8.9642        -7.188       -5.5714       -4.1252 
    a5=-19.6262      -56.825       -51.961       -44.399      -37.117       -30.49       -25.374       -12.828       -10.699       -8.7885       -7.0426       -5.4482       -4.0197 
    a6=-19.5327      -54.915       -48.998       -41.927      -35.108      -29.211       -24.527       -12.565        -10.49       -8.6165       -6.8992       -5.3267       -3.9154 
    a7=-19.4393      -52.622       -46.425       -39.825      -33.447      -28.083       -23.768        -12.31       -10.286        -8.448       -6.7583       -5.2067       -3.8123 
    a8=-19.3458      -50.339       -44.086       -37.962      -31.986      -27.093       -23.069       -12.063       -10.087       -8.2827       -6.6194       -5.0884       -3.7104 
    a9=-19.2523      -47.973       -41.975       -36.178       -30.72      -26.198       -22.402       -11.824       -9.8924         -8.12       -6.4827       -4.9717       -3.6096 
    a10=-19.1589      -45.75       -40.094       -34.616      -29.585      -25.374       -21.763       -11.592       -9.7025       -7.9605       -6.3479       -4.8565       -3.5094 
    a11=-19.0654      -43.68       -38.387       -33.214      -28.545      -24.612       -21.164       -11.367       -9.5163       -7.8034       -6.2153       -4.7428       -3.4103 
    a12=-18.972      -41.767       -36.793       -31.923      -27.598      -23.875       -20.604       -11.148        -9.334       -7.6491       -6.0847       -4.6307       -3.3122 
    a13=-18.8785     -39.943       -35.355       -30.759      -26.727      -23.182       -20.073       -10.934       -9.1548       -7.4973       -5.9554       -4.5198       -3.2151 
    a14=-18.785       -38.29       -34.039       -29.694      -25.911      -22.531       -19.573       -10.726        -8.979       -7.3482       -5.8276       -4.4103       -3.1191 
    a15=-18.6916     -36.776       -32.762       -28.703      -25.155      -21.921         -19.1       -10.521       -8.8064       -7.2016       -5.7016       -4.3022       -3.0241 
    a16=-18.5981     -35.371       -31.576        -27.79      -24.425      -21.347       -18.653        -10.32       -8.6368       -7.0576       -5.5774       -4.1949       -2.9301 
    a17=-18.5047     -34.072       -30.486       -26.943      -23.731      -20.808       -18.227       -10.124       -8.4688        -6.916       -5.4549       -4.0885       -2.8371 
    a18=-18.4112     -32.881       -29.482       -26.147       -23.08      -20.296        -17.82       -9.9315       -8.3041       -6.7766       -5.3342       -3.9834        -2.745 
    a19=-18.3178     -31.764       -28.538       -25.399      -22.465       -19.81       -17.432       -9.7413       -8.1425       -6.6394       -5.2151       -3.8795       -2.6539 
    a20=-18.2243     -30.722       -27.655       -24.696      -21.885      -19.349       -17.059       -9.5546        -7.984       -6.5039       -5.0975       -3.7768       -2.5635 
    a21=-18.1308     -29.754       -26.832       -24.037      -21.337      -18.909        -16.69       -9.3719       -7.8283       -6.3697       -4.9814       -3.6752        -2.474 
    a22=-18.0374     -28.856       -26.064       -23.393      -20.817      -18.488       -16.336        -9.193       -7.6752       -6.2375       -4.8667       -3.5747       -2.3853 
    a23=-17.9439     -27.987       -25.339        -22.78      -20.323      -18.083       -15.992       -9.0176       -7.5249       -6.1073       -4.7534       -3.4754       -2.2976 
    a24=-17.8505     -27.159       -24.657       -22.201      -19.852      -17.689       -15.659       -8.8455       -7.3773       -5.9789       -4.6415        -3.377       -2.2106 
    a25=-17.757      -26.383       -24.016       -21.654        -19.4      -17.304       -15.338       -8.6769       -7.2321       -5.8523        -4.531       -3.2795       -2.1246 
    a26=-17.6636     -25.656       -23.405        -21.13      -18.967      -16.934       -15.027       -8.5117       -7.0893       -5.7274       -4.4218       -3.1831       -2.0392 
    a27=-17.5701     -24.969       -22.823       -20.631      -18.551      -16.577       -14.725       -8.3497       -6.9487       -5.6041       -4.3137       -3.0878       -1.9546 
    a28=-17.4766     -24.312       -22.269       -20.153      -18.151      -16.231       -14.432       -8.1907       -6.8103       -5.4824       -4.2067       -2.9934       -1.8708 
    a29=-17.3832     -23.689       -21.736       -19.697      -17.765      -15.898       -14.149       -8.0345       -6.6738       -5.3623        -4.101       -2.9001       -1.7877 
    a30=-17.2897       -23.1       -21.217       -19.259      -17.384      -15.575       -13.874       -7.8811       -6.5392       -5.2435       -3.9965       -2.8077       -1.7054 
    a31=-17.1963      -22.54       -20.722       -18.839      -17.018      -15.263       -13.606       -7.7301       -6.4064       -5.1261       -3.8932       -2.7161       -1.6239 
    a32=-17.1028     -22.007       -20.249       -18.436      -16.665      -14.962       -13.347       -7.5814       -6.2753       -5.0101       -3.7911       -2.6254        -1.543 
    a33=-17.0093     -21.496       -19.796       -18.047      -16.324      -14.668       -13.095       -7.4348       -6.1458       -4.8955       -3.6902       -2.5356       -1.4629 
    a34=-16.9159     -21.007        -19.36        -17.67      -15.993      -14.384       -12.849       -7.2902       -6.0179       -4.7825       -3.5902       -2.4467       -1.3835 
    a35=-16.8224     -20.536       -18.939       -17.307      -15.673      -14.108       -12.611       -7.1475       -5.8918       -4.6708       -3.4913       -2.3587       -1.3047 
    a36=-16.729      -20.086       -18.535       -16.955      -15.364      -13.841       -12.375       -7.0067       -5.7674       -4.5605       -3.3936       -2.2715       -1.2266 
    a37=-16.6355     -19.654       -18.146       -16.609      -15.064       -13.58       -12.145        -6.868       -5.6439       -4.4515       -3.2963       -2.1852       -1.1491 
    a38=-16.5421     -19.233       -17.772       -16.275      -14.773      -13.327        -11.92        -6.731        -5.522       -4.3437       -3.2001       -2.0996        -1.072 
    a39=-16.4486     -18.823        -17.41       -15.951      -14.491       -13.08       -11.699       -6.5952       -5.4016       -4.2372       -3.1048       -2.0149      -0.99547 
    a40=-16.3551     -18.428        -17.06       -15.637      -14.217      -12.835       -11.484       -6.4615       -5.2828       -4.1319       -3.0106       -1.9309      -0.91963 
    a41=-16.2617     -18.046       -16.722       -15.334       -13.95      -12.596       -11.273       -6.3296       -5.1655       -4.0279       -2.9174       -1.8476      -0.84437 
    a42=-16.1682     -17.679       -16.394       -15.038       -13.69      -12.363       -11.066       -6.1997       -5.0497       -3.9251        -2.825       -1.7651      -0.76974 
    a43=-16.0748     -17.323       -16.076       -14.751      -13.436      -12.135       -10.863       -6.0715       -4.9353       -3.8234       -2.7337        -1.683      -0.69571 
    a44=-15.9813     -16.978       -15.767       -14.472      -13.188      -11.912       -10.664       -5.9451       -4.8223       -3.7223       -2.6432       -1.6015      -0.62228 
    a45=-15.8879     -16.643       -15.464       -14.201      -12.946      -11.693       -10.469       -5.8203       -4.7108       -3.6223       -2.5535       -1.5208      -0.54944 
    a46=-15.7944     -16.319       -15.167       -13.936      -12.707       -11.48       -10.278       -5.6972       -4.6007       -3.5234       -2.4647       -1.4407      -0.47719 
    a47=-15.7009     -16.004       -14.879       -13.678      -12.473      -11.271       -10.091       -5.5758       -4.4919       -3.4255       -2.3768       -1.3613      -0.40548 
    a48=-15.6075     -15.699       -14.599       -13.427      -12.245      -11.066       -9.9074        -5.456       -4.3845       -3.3286       -2.2896       -1.2826      -0.33433 
    a49=-15.514      -15.403       -14.326       -13.182      -12.022      -10.865       -9.7271       -5.3379       -4.2782       -3.2327       -2.2032       -1.2046      -0.26374 
    a50=-15.4206     -15.115       -14.061       -12.942      -11.803      -10.668         -9.55       -5.2213       -4.1732       -3.1378       -2.1176       -1.1273      -0.19363 
    a701=45.4206       13.46        13.511        13.569       13.632         13.7        13.772        14.118         14.22        14.329        14.445        14.566        14.688 
    a702=45.514       13.471        13.522         13.58       13.643        13.71        13.783        14.128         14.23        14.339        14.454        14.575        14.697 
    a703=45.6075      13.483        13.533        13.591       13.653       13.721        13.793        14.138        14.239        14.348        14.464        14.584        14.706 
    a704=45.7009      13.494        13.544        13.602       13.664       13.732        13.804        14.147        14.249        14.358        14.473        14.594        14.715 
    a705=45.7944      13.505        13.555        13.612       13.675       13.742        13.814        14.157        14.259        14.367        14.483        14.603        14.724 
    a706=45.8879      13.516        13.566        13.623       13.686       13.753        13.825        14.167        14.269        14.377        14.492        14.612        14.733 
    a707=45.9813      13.527        13.577        13.634       13.696       13.763        13.835        14.177        14.278        14.386        14.501        14.621        14.742 
    a708=46.0748      13.537        13.588        13.645       13.707       13.774        13.846        14.187        14.288        14.396        14.511         14.63        14.751 
    a709=46.1682      13.548        13.599        13.655       13.718       13.784        13.856        14.197        14.298        14.405         14.52        14.639         14.76 
    a710=46.2617      13.559        13.609        13.666       13.728       13.795        13.866        14.207        14.307        14.415        14.529        14.649        14.769 
    a711=46.3551       13.57         13.62        13.677       13.739       13.805        13.877        14.217        14.317        14.424        14.539        14.658        14.778 
    a712=46.4486      13.581        13.631        13.688       13.749       13.816        13.887        14.226        14.327        14.434        14.548        14.667        14.787 
    a713=46.5421      13.592        13.642        13.698        13.76       13.826        13.898        14.236        14.336        14.443        14.557        14.676        14.795 
    a714=46.6355      13.603        13.653        13.709       13.771       13.837        13.908        14.246        14.346        14.453        14.566        14.685        14.804 
    a715=46.729       13.614        13.663         13.72       13.781       13.847        13.918        14.256        14.355        14.462        14.576        14.694        14.813 
    a716=46.8224      13.624        13.674         13.73       13.792       13.858        13.928        14.265        14.365        14.472        14.585        14.703        14.822 
    a717=46.9159      13.635        13.685        13.741       13.802       13.868        13.939        14.275        14.375        14.481        14.594        14.712        14.831 
    a718=47.0093      13.646        13.695        13.751       13.813       13.878        13.949        14.285        14.384         14.49        14.603        14.721         14.84 
    a719=47.1028      13.657        13.706        13.762       13.823       13.889        13.959        14.294        14.394          14.5        14.613         14.73        14.849 
    a720=47.1963      13.668        13.717        13.773       13.834       13.899        13.969        14.304        14.403        14.509        14.622        14.739        14.858 
    a721=47.2897      13.678        13.727        13.783       13.844       13.909         13.98        14.314        14.413        14.519        14.631        14.748        14.866 
    a722=47.3832      13.689        13.738        13.794       13.854        13.92         13.99        14.323        14.422        14.528         14.64        14.757        14.875 
    a723=47.4766        13.7        13.749        13.804       13.865        13.93            14        14.333        14.432        14.537        14.649        14.766        14.884 
    a724=47.5701       13.71        13.759        13.815       13.875        13.94         14.01        14.343        14.441        14.546        14.658        14.775        14.893 
    a725=47.6636      13.721         13.77        13.825       13.885       13.951         14.02        14.352        14.451        14.556        14.667        14.784        14.901 
    a726=47.757       13.732         13.78        13.835       13.896       13.961         14.03        14.362         14.46        14.565        14.676        14.793         14.91 
    a727=47.8505      13.742        13.791        13.846       13.906       13.971         14.04        14.371        14.469        14.574        14.686        14.802        14.919 
    a728=47.9439      13.753        13.801        13.856       13.916       13.981        14.051        14.381        14.479        14.583        14.695        14.811        14.928 
    a729=48.0374      13.763        13.812        13.867       13.927       13.991        14.061        14.391        14.488        14.593        14.704         14.82        14.936 
    a730=48.1308      13.774        13.822        13.877       13.937       14.002        14.071          14.4        14.498        14.602        14.713        14.828        14.945 
    a731=48.2243      13.784        13.833        13.887       13.947       14.012        14.081         14.41        14.507        14.611        14.722        14.837        14.954 
    a732=48.3178      13.795        13.843        13.898       13.958       14.022        14.091        14.419        14.516         14.62        14.731        14.846        14.962 
    a733=48.4112      13.805        13.853        13.908       13.968       14.032        14.101        14.429        14.526        14.629         14.74        14.855        14.971 
    a734=48.5047      13.816        13.864        13.918       13.978       14.042        14.111        14.438        14.535        14.639        14.749        14.864         14.98 
    a735=48.5981      13.826        13.874        13.929       13.988       14.052        14.121        14.447        14.544        14.648        14.758        14.873        14.988 
    a736=48.6916      13.837        13.885        13.939       13.998       14.062        14.131        14.457        14.554        14.657        14.767        14.881        14.997 
    a737=48.785       13.847        13.895        13.949       14.008       14.072        14.141        14.466        14.563        14.666        14.776         14.89        15.005 
    a738=48.8785      13.858        13.905        13.959       14.019       14.082        14.151        14.476        14.572        14.675        14.784        14.899        15.014 
    a739=48.972       13.868        13.916         13.97       14.029       14.092         14.16        14.485        14.581        14.684        14.793        14.908        15.023 
    a740=49.0654      13.878        13.926         13.98       14.039       14.102         14.17        14.494         14.59        14.693        14.802        14.916        15.031 
    a741=49.1589      13.889        13.936         13.99       14.049       14.112         14.18        14.504          14.6        14.702        14.811        14.925         15.04 
    a742=49.2523      13.899        13.946            14       14.059       14.122         14.19        14.513        14.609        14.711         14.82        14.934        15.048 
    a743=49.3458      13.909        13.957         14.01       14.069       14.132          14.2        14.522        14.618         14.72        14.829        14.942        15.057 
    a744=49.4393       13.92        13.967         14.02       14.079       14.142         14.21        14.532        14.627        14.729        14.838        14.951        15.065 
    a745=49.5327       13.93        13.977        14.031       14.089       14.152         14.22        14.541        14.636        14.738        14.847         14.96        15.074 
    a746=49.6262       13.94        13.987        14.041       14.099       14.162        14.229         14.55        14.646        14.747        14.855        14.968        15.082 
    a747=49.7196       13.95        13.997        14.051       14.109       14.172        14.239         14.56        14.655        14.756        14.864        14.977        15.091 
    a748=49.8131      13.961        14.008        14.061       14.119       14.182        14.249        14.569        14.664        14.765        14.873        14.986        15.099 
    a749=49.9065      13.971        14.018        14.071       14.129       14.192        14.259        14.578        14.673        14.774        14.882        14.994        15.108 
    a750=50           13.981        14.028        14.081       14.139       14.201        14.268        14.587        14.682        14.783        14.891        15.003        15.116 

tb_pol_a
                    z1_0_34741    z2_0_40076    z3_0_4623    z4_0_5333    z5_0_61519    z6_0_70966    z10_1_2567    z11_1_4496    z12_1_6723    z13_1_9291    z14_2_2253    z15_2_567
                    __________    __________    _________    _________    __________    __________    __________    __________    __________    __________    __________    _________

    a1=-20                 0             0             0            0          -20       -19.907       -19.533       -19.439       -19.159       -18.972       -18.692       -18.318 
    a2=-19.9065            0             0             0          -20      -19.907       -19.907       -19.439       -19.346       -19.159       -18.879       -18.598       -18.224 
    a3=-19.8131            0             0           -20      -19.907      -19.907       -19.813       -19.346       -19.252       -19.065       -18.785       -18.505       -18.131 
    a4=-19.7196            0           -20       -19.907      -19.813      -19.813        -19.72       -19.346       -19.159       -18.972       -18.692       -18.411       -18.037 
    a5=-19.6262          -20       -19.907       -19.813      -19.813       -19.72       -19.626       -19.252       -19.065       -18.879       -18.598       -18.318       -17.944 
    a6=-19.5327      -19.907       -19.813        -19.72       -19.72      -19.626       -19.533       -19.159       -18.972       -18.785       -18.505       -18.224        -17.85 
    a7=-19.4393      -19.813        -19.72       -19.626      -19.626      -19.533       -19.439       -19.065       -18.879       -18.692       -18.411       -18.131       -17.757 
    a8=-19.3458       -19.72       -19.626       -19.533      -19.533      -19.439       -19.346       -18.972       -18.785       -18.598       -18.318       -18.037       -17.664 
    a9=-19.2523      -19.626       -19.533       -19.533      -19.439      -19.346       -19.346       -18.879       -18.692       -18.505       -18.224       -17.944        -17.57 
    a10=-19.1589     -19.533       -19.439       -19.439      -19.346      -19.252       -19.252       -18.785       -18.598       -18.411       -18.131        -17.85        -17.57 
    a11=-19.0654     -19.439       -19.346       -19.346      -19.252      -19.159       -19.159       -18.692       -18.505       -18.318       -18.037       -17.757       -17.477 
    a12=-18.972      -19.346       -19.252       -19.252      -19.159      -19.159       -19.065       -18.598       -18.411       -18.224       -17.944       -17.664       -17.383 
    a13=-18.8785     -19.252       -19.159       -19.159      -19.065      -19.065       -18.972       -18.505       -18.318       -18.131       -17.944        -17.57        -17.29 
    a14=-18.785      -19.159       -19.159       -19.065      -18.972      -18.972       -18.879       -18.411       -18.224       -18.037        -17.85       -17.477       -17.196 
    a15=-18.6916     -19.065       -19.065       -18.972      -18.879      -18.879       -18.785       -18.318       -18.131       -17.944       -17.757       -17.383       -17.103 
    a16=-18.5981     -18.972       -18.972       -18.879      -18.879      -18.785       -18.692       -18.224       -18.131        -17.85       -17.664       -17.383       -17.009 
    a17=-18.5047     -18.879       -18.879       -18.785      -18.785      -18.692       -18.598       -18.131       -18.037       -17.757        -17.57        -17.29       -16.916 
    a18=-18.4112     -18.785       -18.785       -18.692      -18.692      -18.598       -18.505       -18.037       -17.944       -17.664       -17.477       -17.196       -16.822 
    a19=-18.3178     -18.692       -18.692       -18.598      -18.598      -18.505       -18.411       -18.037        -17.85        -17.57       -17.383       -17.103       -16.729 
    a20=-18.2243     -18.598       -18.598       -18.505      -18.505      -18.411       -18.318       -17.944       -17.757        -17.57        -17.29       -17.009       -16.636 
    a21=-18.1308     -18.505       -18.505       -18.411      -18.411      -18.318       -18.318        -17.85       -17.664       -17.477       -17.196       -16.916       -16.542 
    a22=-18.0374     -18.411       -18.411       -18.411      -18.318      -18.224       -18.224       -17.757        -17.57       -17.383       -17.103       -16.822       -16.449 
    a23=-17.9439     -18.411       -18.318       -18.318      -18.224      -18.131       -18.131       -17.664       -17.477        -17.29       -17.009       -16.729       -16.355 
    a24=-17.8505     -18.318       -18.224       -18.224      -18.131      -18.131       -18.037        -17.57       -17.383       -17.196       -16.916       -16.636       -16.262 
    a25=-17.757      -18.224       -18.131       -18.131      -18.037      -18.037       -17.944       -17.477        -17.29       -17.103       -16.822       -16.542       -16.168 
    a26=-17.6636     -18.131       -18.037       -18.037      -17.944      -17.944        -17.85       -17.383       -17.196       -17.009       -16.729       -16.449       -16.075 
    a27=-17.5701     -18.037       -17.944       -17.944       -17.85       -17.85       -17.757        -17.29       -17.103       -16.916       -16.636       -16.355       -15.981 
    a28=-17.4766     -17.944        -17.85        -17.85      -17.757      -17.757       -17.664       -17.196       -17.009       -16.822       -16.542       -16.262       -15.888 
    a29=-17.3832      -17.85        -17.85       -17.757      -17.757      -17.664        -17.57       -17.103       -16.916       -16.729       -16.449       -16.168       -15.794 
    a30=-17.2897     -17.757       -17.757       -17.664      -17.664       -17.57       -17.477       -17.009       -16.822       -16.636       -16.355       -16.075       -15.701 
    a31=-17.1963     -17.664       -17.664        -17.57       -17.57      -17.477       -17.383       -16.916       -16.729       -16.542       -16.262       -15.981       -15.607 
    a32=-17.1028      -17.57        -17.57       -17.477      -17.477      -17.383        -17.29       -16.822       -16.636       -16.449       -16.168       -15.888       -15.514 
    a33=-17.0093     -17.477       -17.477       -17.383      -17.383       -17.29       -17.196       -16.729       -16.542       -16.355       -16.075       -15.794       -15.421 
    a34=-16.9159     -17.383       -17.383        -17.29       -17.29      -17.196       -17.103       -16.636       -16.449       -16.262       -15.981       -15.701       -15.327 
    a35=-16.8224      -17.29        -17.29       -17.196      -17.196      -17.103       -17.009       -16.542       -16.355       -16.168       -15.888       -15.607       -15.234 
    a36=-16.729      -17.196       -17.196       -17.196      -17.103      -17.009       -17.009       -16.449       -16.262       -16.075       -15.794       -15.514        -15.14 
    a37=-16.6355     -17.103       -17.103       -17.103      -17.009      -16.916       -16.916       -16.355       -16.262       -15.981       -15.794       -15.421        -15.14 
    a38=-16.5421     -17.103       -17.009       -17.009      -16.916      -16.822       -16.822       -16.355       -16.168       -15.888       -15.701       -15.327       -15.047 
    a39=-16.4486     -17.009       -16.916       -16.916      -16.822      -16.729       -16.729       -16.262       -16.075       -15.794       -15.607       -15.234       -14.953 
    a40=-16.3551     -16.916       -16.822       -16.822      -16.729      -16.729       -16.636       -16.168       -15.981       -15.701       -15.514        -15.14        -14.86 
    a41=-16.2617     -16.822       -16.729       -16.729      -16.636      -16.636       -16.542       -16.075       -15.888       -15.607       -15.421       -15.047       -14.766 
    a42=-16.1682     -16.729       -16.636       -16.636      -16.542      -16.542       -16.449       -15.981       -15.794       -15.514       -15.327       -14.953       -14.673 
    a43=-16.0748     -16.636       -16.542       -16.542      -16.449      -16.449       -16.355       -15.888       -15.701       -15.421       -15.234       -14.953       -14.579 
    a44=-15.9813     -16.542       -16.449       -16.449      -16.355      -16.355       -16.262       -15.794       -15.607       -15.421        -15.14        -14.86       -14.486 
    a45=-15.8879     -16.449       -16.449       -16.355      -16.262      -16.262       -16.168       -15.701       -15.514       -15.327       -15.047       -14.766       -14.393 
    a46=-15.7944     -16.355       -16.355       -16.262      -16.262      -16.168       -16.075       -15.607       -15.421       -15.234       -14.953       -14.673       -14.299 
    a47=-15.7009     -16.262       -16.262       -16.168      -16.168      -16.075       -15.981       -15.514       -15.327        -15.14        -14.86       -14.579       -14.206 
    a48=-15.6075     -16.168       -16.168       -16.075      -16.075      -15.981       -15.888       -15.421       -15.234       -15.047       -14.766       -14.486       -14.112 
    a49=-15.514      -16.075       -16.075       -15.981      -15.981      -15.888       -15.794       -15.327        -15.14       -14.953       -14.673       -14.393       -14.019 
    a50=-15.4206     -15.981       -15.981       -15.888      -15.888      -15.794       -15.701       -15.234       -15.047        -14.86       -14.579       -14.299       -13.925 
    a701=45.4206      42.804        42.804        42.897       42.991       42.991        43.084        43.645        43.832        44.112        44.299        44.673        45.047 
    a702=45.514       42.897        42.897        42.991       43.084       43.084        43.178        43.738        43.925        44.206        44.393        44.766         45.14 
    a703=45.6075      42.991        42.991        43.084       43.178       43.178        43.271        43.832        44.019        44.299        44.486         44.86        45.234 
    a704=45.7009      43.084        43.084        43.178       43.178       43.271        43.364        43.925        44.112        44.299        44.579        44.953        45.327 
    a705=45.7944      43.178        43.178        43.271       43.271       43.364        43.458        44.019        44.206        44.393        44.673        45.047        45.421 
    a706=45.8879      43.271        43.271        43.364       43.364       43.458        43.551        44.112        44.299        44.486        44.766         45.14        45.514 
    a707=45.9813      43.364        43.364        43.458       43.458       43.551        43.645        44.206        44.393        44.579         44.86        45.234        45.607 
    a708=46.0748      43.458        43.458        43.551       43.551       43.645        43.738        44.299        44.486        44.673        44.953        45.327        45.701 
    a709=46.1682      43.551        43.551        43.645       43.645       43.738        43.832        44.393        44.579        44.766        45.047        45.421        45.794 
    a710=46.2617      43.645        43.645        43.738       43.738       43.832        43.925        44.486        44.673         44.86         45.14        45.514        45.888 
    a711=46.3551      43.738        43.738        43.832       43.832       43.925        44.019        44.579        44.766        44.953        45.234        45.607        45.981 
    a712=46.4486      43.832        43.832        43.925       43.925       44.019        44.112        44.673         44.86        45.047        45.327        45.701        45.981 
    a713=46.5421      43.925        43.925        44.019       44.019       44.112        44.206        44.766        44.953         45.14        45.421        45.701        46.075 
    a714=46.6355      43.925        44.019        44.112       44.112       44.206        44.299         44.86        45.047        45.234        45.514        45.794        46.168 
    a715=46.729       44.019        44.112        44.206       44.206       44.299        44.393        44.953         45.14        45.327        45.607        45.888        46.262 
    a716=46.8224      44.112        44.206        44.206       44.299       44.393        44.486        45.047        45.234        45.421        45.701        45.981        46.355 
    a717=46.9159      44.206        44.299        44.299       44.393       44.486        44.579         45.14        45.327        45.514        45.794        46.075        46.449 
    a718=47.0093      44.299        44.393        44.393       44.486       44.579        44.673        45.234        45.421        45.607        45.888        46.168        46.542 
    a719=47.1028      44.393        44.486        44.486       44.579       44.673        44.766        45.234        45.514        45.701        45.981        46.262        46.636 
    a720=47.1963      44.486        44.579        44.579       44.673       44.766         44.86        45.327        45.607        45.794        46.075        46.355        46.729 
    a721=47.2897      44.579        44.673        44.673       44.766        44.86        44.953        45.421        45.701        45.888        46.168        46.449        46.822 
    a722=47.3832      44.673        44.766        44.766        44.86       44.953        45.047        45.514        45.794        45.981        46.262        46.542        46.916 
    a723=47.4766      44.766         44.86         44.86       44.953       45.047         45.14        45.607        45.794        46.075        46.355        46.636        47.009 
    a724=47.5701       44.86        44.953        44.953       45.047        45.14        45.234        45.701        45.888        46.168        46.449        46.729        47.103 
    a725=47.6636      44.953        45.047        45.047        45.14       45.234        45.327        45.794        45.981        46.262        46.542        46.822        47.196 
    a726=47.757       45.047         45.14         45.14       45.234       45.327        45.421        45.888        46.075        46.355        46.636        46.916         47.29 
    a727=47.8505       45.14        45.234        45.234       45.327       45.421        45.514        45.981        46.168        46.449        46.729        47.009        47.383 
    a728=47.9439      45.234        45.327        45.327       45.421       45.514        45.607        46.075        46.262        46.542        46.822        47.103        47.477 
    a729=48.0374      45.327        45.421        45.421       45.514       45.607        45.701        46.168        46.355        46.636        46.916        47.196         47.57 
    a730=48.1308      45.421        45.514        45.514       45.607       45.701        45.701        46.262        46.449        46.729        47.009         47.29        47.664 
    a731=48.2243      45.514        45.514        45.607       45.701       45.794        45.794        46.355        46.542        46.822        47.103        47.383        47.757 
    a732=48.3178      45.607        45.607        45.701       45.794       45.794        45.888        46.449        46.636        46.916        47.196        47.477         47.85 
    a733=48.4112      45.701        45.701        45.794       45.888       45.888        45.981        46.542        46.729        47.009         47.29         47.57        47.944 
    a734=48.5047      45.794        45.794        45.888       45.981       45.981        46.075        46.636        46.822        47.103        47.383        47.664        48.037 
    a735=48.5981      45.888        45.888        45.981       46.075       46.075        46.168        46.729        46.916        47.196        47.477        47.757        48.131 
    a736=48.6916      45.981        45.981        46.075       46.168       46.168        46.262        46.822        47.009         47.29        47.477         47.85        48.224 
    a737=48.785       46.075        46.075        46.168       46.262       46.262        46.355        46.916        47.103        47.383         47.57        47.944        48.318 
    a738=48.8785      46.168        46.168        46.262       46.355       46.355        46.449        47.009        47.196        47.477        47.664        48.037        48.411 
    a739=48.972       46.262        46.262        46.355       46.355       46.449        46.542        47.103         47.29         47.57        47.757        48.131        48.505 
    a740=49.0654      46.355        46.355        46.449       46.449       46.542        46.636        47.196        47.383         47.57         47.85        48.224        48.598 
    a741=49.1589      46.449        46.449        46.542       46.542       46.636        46.729         47.29        47.477        47.664        47.944        48.318        48.692 
    a742=49.2523      46.542        46.542        46.636       46.636       46.729        46.822        47.383         47.57        47.757        48.037        48.411        48.785 
    a743=49.3458      46.636        46.636        46.729       46.729       46.822        46.916        47.477        47.664         47.85        48.131        48.505        48.879 
    a744=49.4393      46.729        46.729        46.822       46.822       46.916        47.009         47.57        47.757        47.944        48.224        48.598        48.972 
    a745=49.5327      46.822        46.822        46.916       46.916       47.009        47.103        47.664         47.85        48.037        48.318        48.692        49.065 
    a746=49.6262      46.916        46.916        47.009       47.009       47.103        47.196        47.757        47.944        48.131        48.411        48.785        49.159 
    a747=49.7196      47.009        47.009        47.103       47.103       47.196         47.29         47.85        48.037        48.224        48.505        48.879        49.252 
    a748=49.8131      47.103        47.103        47.196       47.196        47.29        47.383        47.944        48.131        48.318        48.598        48.972        49.346 
    a749=49.9065      47.103        47.196         47.29        47.29       47.383        47.477        48.037        48.224        48.411        48.692        48.972        49.346 
    a750=50           47.196         47.29        47.383       47.383       47.477         47.57        48.131        48.318        48.505        48.785        49.065        49.439 

</pre><img vspace="5" hspace="5" src="ff_abz_vf_vecsv_01.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_02.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_03.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_04.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_05.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_06.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_07.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_08.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_09.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_10.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_11.png" alt=""> <img vspace="5" hspace="5" src="ff_abz_vf_vecsv_12.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 11
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% Solve Save + Borr Dynamic Programming Problem (Optimized-Vectorized)
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository>
% Table of Content.*

%%
function result_map = ff_abz_vf_vecsv(varargin)
%% FF_ABZ_VF_VECSV solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic single asset and single
% shock problem with vectorized codes.
% <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf.html
% ff_abz_vf> shows looped codes.
% <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vec.html
% ff_abz_vf_vec> shows vectorized codes. This file shows vectorized codes
% that is faster but is more memory intensive.
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables.
%
% keys included in result_map:
%
% * mt_val matrix states_n by shock_n matrix of converged value function grid
% * mt_pol_a matrix states_n by shock_n matrix of converged policy function grid
% * ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function
% difference between iteration
% * ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy
% function difference between iterations
% * mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the
% proportion of grid points at which policy function changed between
% current and last iteration for each element of shock
%
% @example
%
%    % Get Default Parameters
%    it_param_set = 4;
%    [param_map, support_map] = ffs_abz_set_default_param(it_param_set);
%    % Chnage param_map keys for borrowing
%    param_map('fl_b_bd') = -20; % borrow bound
%    param_map('bl_default') = false; % true if allow for default
%    param_map('fl_c_min') = 0.0001; % u(c_min) when default
%    % Change Keys in param_map
%    param_map('it_a_n') = 500;
%    param_map('it_z_n') = 11;
%    param_map('fl_a_max') = 100;
%    param_map('fl_w') = 1.3;
%    % Change Keys support_map
%    support_map('bl_display') = false;
%    support_map('bl_post') = true;
%    support_map('bl_display_final') = false;
%    % Call Program with external parameters that override defaults.
%    ff_abz_vf_vecsv(param_map, support_map);
%
% @include
%
% * <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_set_default_param.html ffs_abz_set_default_param>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_abz/paramfunc/html/ffs_abz_get_funcgrid.html ffs_abz_get_funcgrid>
% * <https://fanwangecon.github.io/CodeDynaAsset/m_az/solvepost/html/ff_az_vf_post.html ff_az_vf_post>
%
% @seealso
%
% * save loop: <https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf.html ff_az_vf>
% * save vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vec.html ff_az_vf_vec>
% * save optimized-vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_az/solve/html/ff_az_vf_vecsv.html ff_az_vf_vecsv>
% * save + borr loop: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf.html ff_abz_vf>
% * save + borr vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vec.html ff_abz_vf_vec>
% * save + borr optimized-vectorized: <https://fanwangecon.github.io/CodeDynaAsset/m_abz/solve/html/ff_abz_vf_vecsv.html ff_abz_vf_vecsv>
%

%% Default
%
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button
%
% go to
% <https://fanwangecon.github.io/CodeDynaAsset/m_az/paramfunc/html/ffs_abz_set_default_param.html
% ffs_abz_set_default_param> to change parameters in param_map container.
% The parameters can also be updated here directly after obtaining them
% from ffs_abz_set_default_param as we possibly change it_a_n and it_z_n
% here.

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_abz_set_default_param(it_param_set);

% Note: param_map and support_map can be adjusted here or outside to override defaults
% param_map('it_a_n') = 750;
% param_map('it_z_n') = 15;

[armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_abz_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

% append function name
st_func_name = 'ff_abz_vf_vecsv';
support_map('st_profile_name_main') = [st_func_name support_map('st_profile_name_main')];
support_map('st_mat_name_main') = [st_func_name support_map('st_mat_name_main')];
support_map('st_img_name_main') = [st_func_name support_map('st_img_name_main')];

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_a', 'mt_z_trans', 'ar_z'});
[ar_a, mt_z_trans, ar_z] = params_group{:};

% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_cons', 'f_coh', 'f_cons_coh'});
[f_util_log, f_util_crra, f_cons, f_coh, f_cons_coh] = params_group{:};

% param_map
params_group = values(param_map, {'it_a_n', 'it_z_n', 'fl_crra', 'fl_beta', 'fl_c_min',...
    'fl_nan_replace', 'bl_default', 'fl_default_aprime'});
[it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min, ...
    fl_nan_replace, bl_default, fl_default_aprime] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};

% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_time', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes
% include mt_pol_idx which we did not have in looped code

mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
mt_pol_idx = zeros(length(ar_a),length(ar_z));

% We did not need these in ff_abz_vf or ff_abz_vf_vec
% see
% <https://fanwangecon.github.io/M4Econ/support/speed/partupdate/fs_u_c_partrepeat_main.html
% fs_u_c_partrepeat_main> for why store using cells.
cl_u_c_store = cell([it_z_n, 1]);
cl_c_valid_idx = cell([it_z_n, 1]);

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;

    %% Solve Optimization Problem Current Iteration
    % Only this segment of code differs between ff_abz_vf and ff_abz_vf_vec
    % Store in cells results and retrieve, this is more memory intensive
    % than ff_abz_vf_vec.

    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)

        % Current Shock
        fl_z = ar_z(it_z_i);

        % cash-on-hand
        ar_coh = f_coh(fl_z, ar_a);

        % Consumption and u(c) only need to be evaluated once
        if (it_iter == 1)

            % Consumption: fl_z = 1 by 1, ar_a = 1 by N, ar_a' = N by 1
            % mt_c is N by N: matrix broadcasting, expand to matrix from arrays
            mt_c = f_cons_coh(ar_coh, ar_a');

            % EVAL current utility: N by N, f_util defined earlier
            % slightly faster to explicitly write function
            if (fl_crra == 1)
                mt_utility = log(mt_c);
                fl_u_cmin = f_util_log(fl_c_min);
            else
                % slightly faster if write function here directly, but
                % speed gain is very small, more important to have single
                % location control of functions.
                mt_utility = f_util_crra(mt_c);
                fl_u_cmin = f_util_crra(fl_c_min);
            end

            % Eliminate Complex Numbers
            mt_it_c_valid_idx = (mt_c <= fl_c_min);
            mt_utility(mt_it_c_valid_idx) = fl_u_cmin;

            % Store in cells
            cl_u_c_store{it_z_i} = mt_utility;
            cl_c_valid_idx{it_z_i} = mt_it_c_valid_idx;

        end

        % f(z'|z)
        ar_z_trans_condi = mt_z_trans(it_z_i,:);

        % EVAL EV((A',K'),Z'|Z) = V((A',K'),Z') x p(z'|z)', (N by Z) x (Z by 1) = N by 1
        % Note: transpose ar_z_trans_condi from 1 by Z to Z by 1
        % Note: matrix multiply not dot multiply        
        mt_evzp_condi_z = mt_val_cur * ar_z_trans_condi';

        % EVAL add on future utility, N by N + N by 1
        mt_utility = cl_u_c_store{it_z_i} + fl_beta*mt_evzp_condi_z;

        % Index update
        % using the method below is much faster than index replace
        % see <https://fanwangecon.github.io/M4Econ/support/speed/index/fs_subscript.html fs_subscript>
        mt_it_c_valid_idx = cl_c_valid_idx{it_z_i};
        % Default or Not Utility Handling
        if (bl_default)
            % if default: only today u(cmin), transition out next period, debt wiped out
            fl_v_default = fl_u_cmin + fl_beta*mt_evzp_condi_z(ar_a == fl_default_aprime);
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_v_default*(mt_it_c_valid_idx);
        else
            % if default is not allowed: v = u(cmin)
            mt_utility = mt_utility.*(~mt_it_c_valid_idx) + fl_nan_replace*(mt_it_c_valid_idx);
        end

        % Optimization: remember matlab is column major, rows must be
        % choices, columns must be states
        % <https://en.wikipedia.org/wiki/Row-_and_column-major_order COLUMN-MAJOR>
        % mt_utility is N by N, rows are choices, cols are states.                 
        [ar_opti_val_z, ar_opti_idx_z] = max(mt_utility);
        ar_opti_aprime_z = ar_a(ar_opti_idx_z);
        ar_opti_c_z = f_cons_coh(ar_coh, ar_opti_aprime_z);

        % Handle Default is optimal or not
        if (bl_default)
            % if defaulting is optimal choice, at these states, not required
            % to default, non-default possible, but default could be optimal
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = fl_default_aprime;
        else
            % if default is not allowed, then next period same state as now
            % this is absorbing state, this is the limiting case, single
            % state space point, lowest a and lowest shock has this.
            ar_opti_aprime_z(ar_opti_c_z <= fl_c_min) = ar_a(ar_opti_c_z <= fl_c_min);
        end

        % store optimal values
        mt_val(:,it_z_i) = ar_opti_val_z;
        mt_pol_a(:,it_z_i) = ar_opti_aprime_z;

        if (it_iter == (it_maxiter_val + 1))
            mt_pol_idx(:,it_z_i) = ar_opti_idx_z;
        end
    end

    %% Check Tolerance and Continuation

    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);

    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;

    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); ...
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'Hval', 'Hap'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('Hval = mt_val_cur(it_a_n,:), highest a state val')
        disp('Hap = mt_pol_a_cur(it_a_n,:), highest a state choice')
        disp(tb_valpol_iter);
    end

    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    end

end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_a') = mt_pol_a;
result_map('mt_pol_idx') = mt_pol_idx;

if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end

##### SOURCE END #####
--></body></html>