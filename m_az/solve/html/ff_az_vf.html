
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ff_az_vf</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-05-28"><meta name="DC.source" content="ff_az_vf.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FF_AZ_VF solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Iterate Value Function</a></li><li><a href="#10">Solve Optimization Problem Current Iteration</a></li><li><a href="#11">Check Tolerance and Continuation</a></li><li><a href="#13">Process Optimal Choices</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> result_map = ff_az_vf(varargin)
</pre><h2 id="2">FF_AZ_VF solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic single asset and single shock problem with loops. It is useful to have a version of code that is looped for easy debugging. This is the standard dynamic exogenous incomplete borrowing and savings problem.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>keys included in result_map:</p><div><ul><li>mt_val matrix states_n by shock_n matrix of converged value function grid</li><li>mt_pol_a matrix states_n by shock_n matrix of converged policy function grid</li><li>ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function difference between iteration</li><li>ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy function difference between iterations</li><li>mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the proportion of grid points at which policy function changed between current and last iteration for each element of shock</li></ul></div><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m">ffs_az_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_get_funcgrid.m">ffs_az_get_funcgrid</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post.m">ff_az_vf_post</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_az_set_default_param(it_param_set);
[armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_a'</span>, <span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>});
[ar_a, mt_z_trans, ar_z] = params_group{:};
<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_cons'</span>});
[f_util_log, f_util_crra, f_cons] = params_group{:};
<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'fl_r_save'</span>, <span class="string">'fl_r_borr'</span>, <span class="string">'fl_w'</span>,<span class="keyword">...</span>
    <span class="string">'it_a_n'</span>, <span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="string">'fl_c_min'</span>});
[fl_r_save, fl_r_borr, fl_wage, it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};
<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><pre class="codeinput">mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="10">Solve Optimization Problem Current Iteration</h2><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)
        fl_z = ar_z(it_z_i);

        <span class="comment">% loop 2: over endogenous states</span>
        <span class="keyword">for</span> it_a_j = 1:length(ar_a)
            fl_a = ar_a(it_a_j);
            ar_val_cur = zeros(size(ar_a));

            <span class="comment">% loop 3: over choices</span>
            <span class="keyword">for</span> it_ap_k = 1:length(ar_a)
                fl_ap = ar_a(it_ap_k);
                fl_c = f_cons(fl_z, fl_a, fl_ap);
<span class="comment">%                 fl_c = fl_z*fl_wage + fl_a.*((1+fl_r_save).*(b&gt;0) + (1+fl_r_borr).*(b&lt;=0)) - fl_ap;</span>

                <span class="comment">% current utility</span>
                <span class="keyword">if</span> (fl_crra == 1)
                    ar_val_cur(it_ap_k) = f_util_log(fl_c);
                    fl_u_neg_c = f_util_log(fl_c_min);
                <span class="keyword">else</span>
                    ar_val_cur(it_ap_k) = f_util_crra(fl_c);
                    fl_u_neg_c = f_util_crra(fl_c_min);
                <span class="keyword">end</span>

                <span class="comment">% loop 4: add future utility, integration--loop over future shocks</span>
                <span class="keyword">for</span> y = 1:length(ar_z)
                    ar_val_cur(it_ap_k) = ar_val_cur(it_ap_k) + fl_beta*mt_z_trans(it_z_i,y)*mt_val_cur(it_ap_k,y);
                <span class="keyword">end</span>

                <span class="comment">% Replace if negative consumption</span>
                <span class="keyword">if</span> fl_c &lt;= 0
                    ar_val_cur(it_ap_k) = fl_u_neg_c;
                <span class="keyword">end</span>

            <span class="keyword">end</span>

            <span class="comment">% maximization over loop 3 choices for loop 1+2 states</span>
            it_max_lin_idx = find(ar_val_cur == max(ar_val_cur));
            mt_val(it_a_j,it_z_i) = ar_val_cur(it_max_lin_idx(1));
            mt_pol_a(it_a_j,it_z_i) = ar_a(it_max_lin_idx(1));

        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2 id="11">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); <span class="keyword">...</span>
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'Hval'</span>, <span class="string">'Hpol'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_a_n,:), highest a state val'</span>)
        disp(<span class="string">'mval = mt_pol_a_cur(it_a_n,:), highest a state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeoutput">VAL it_iter:5, fl_diff:1.090726e+01, fl_diff_pol:9.959979e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval     1.658    1.8668     2.094    2.3297    2.5709    2.8165    3.0658    3.3178     3.571     3.822    4.0615
    map     3.7727     3.798    3.8273    3.8505    3.8909    3.9535    4.0384    4.1505     4.304     4.498    4.7798
    Hval    3.5679    3.6431    3.7299    3.8257    3.9304    4.0437    4.1659    4.2967    4.4357    4.5809    4.7259
    Hpol    7.7778    7.7778    7.7778    7.8788    7.8788    7.8788    7.9798    8.0808    8.2828    8.4848    8.7879

</pre><pre class="codeoutput">VAL it_iter:10, fl_diff:5.066986e+00, fl_diff_pol:2.120390e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    1.8518    2.1829    2.5445      2.92    3.3045    3.6968    4.0964    4.5026     4.914     5.325    5.7189
    map     4.1081    4.1394    4.1747    4.2263     4.301     4.398    4.5313     4.704    4.9293    5.2212    5.6051
    Hval    4.3763    4.5447    4.7352    4.9412    5.1604    5.3928    5.6383    5.8965    6.1666    6.4451     6.719
    Hpol    8.5859    8.5859    8.5859    8.6869    8.7879    8.8889    8.9899    9.1919    9.3939     9.697        10

</pre><pre class="codeoutput">VAL it_iter:15, fl_diff:2.928222e+00, fl_diff_pol:7.820985e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.1183    2.4863    2.8897    3.3102    3.7429     4.187    4.6428    5.1104     5.589    6.0727    6.5407
    map     4.1596     4.199    4.2444    4.3051    4.3909    4.5081    4.6616    4.8657    5.1202    5.4515    5.8626
    Hval    4.7865     4.997    5.2352    5.4923    5.7658    6.0559    6.3628    6.6865    7.0259    7.3758    7.7086
    Hpol    8.6869    8.7879    8.7879    8.8889    8.9899    9.0909    9.2929    9.4949     9.697        10        10

</pre><pre class="codeoutput">VAL it_iter:20, fl_diff:1.917806e+00, fl_diff_pol:3.809851e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.3721    2.7504     3.166       3.6    4.0479    4.5091    4.9846     5.475    5.9801    6.4942    6.9943
    map     4.1707    4.2131    4.2596    4.3263    4.4182    4.5414     4.703    4.9202    5.1909    5.5333    5.9545
    Hval    5.0747    5.2993    5.5547    5.8307    6.1256    6.4394    6.7728    7.1262    7.4981    7.8778    8.2344
    Hpol    8.7879    8.7879    8.8889    8.9899    9.0909    9.1919    9.3939     9.596     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:25, fl_diff:1.333970e+00, fl_diff_pol:2.437184e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.5764    2.9577     3.377    3.8153     4.268     4.735    5.2173    5.7161    6.2312    6.7571    7.2701
    map     4.1737    4.2172    4.2657    4.3323    4.4273    4.5556    4.7212    4.9414    5.2162    5.5646    5.9899
    Hval    5.2897    5.5187    5.7798    6.0623    6.3647    6.6871    7.0309     7.396    7.7811    8.1723    8.5385
    Hpol    8.7879    8.7879    8.8889    8.9899    9.0909    9.2929    9.3939     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:30, fl_diff:9.535987e-01, fl_diff_pol:1.428499e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11 
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    _____

    mval    2.7314    3.1138    3.5343     3.974    4.4284    4.8974    5.3821    5.8839    6.4028    6.9331    7.451
    map     4.1747    4.2192    4.2677    4.3333    4.4303    4.5576    4.7263    4.9475    5.2283    5.5758        6
    Hval    5.4487    5.6793    5.9423    6.2271     6.532    6.8578    7.2053    7.5751    7.9649    8.3604     8.73
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.3939     9.697     9.899        10       10

</pre><pre class="codeoutput">VAL it_iter:35, fl_diff:6.905919e-01, fl_diff_pol:1.010101e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.8468    3.2295    3.6504    4.0906    4.5456    5.0153     5.501    6.0039    6.5242    7.0562    7.5759
    map     4.1758    4.2212    4.2687    4.3354    4.4313    4.5596    4.7293    4.9495    5.2313    5.5798    6.0051
    Hval    5.5655    5.7967    6.0603     6.346    6.6519    6.9789    7.3277    7.6994    8.0909     8.488     8.859
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.3939     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:40, fl_diff:5.033498e-01, fl_diff_pol:1.010101e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.9319    3.3148    3.7358    4.1762    4.6314    5.1014    5.5874    6.0907    6.6115    7.1442    7.6646
    map     4.1758    4.2212    4.2687    4.3384    4.4313    4.5596    4.7303    4.9505    5.2323    5.5838    6.0081
    Hval    5.6512    5.8826    6.1465    6.4325    6.7388    7.0662    7.4156    7.7879      8.18    8.5777    8.9492
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:45, fl_diff:3.680840e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    2.9945    3.3774    3.7986     4.239    4.6943    5.1644    5.6505     6.154     6.675    7.2079    7.7286
    map     4.1758    4.2212    4.2687    4.3384    4.4313    4.5596    4.7303    4.9515    5.2333    5.5838    6.0081
    Hval     5.714    5.9456    6.2095    6.4956    6.8021    7.1296    7.4793    7.8518    8.2442    8.6421    9.0138
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:50, fl_diff:2.696295e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.0406    3.4235    3.8446    4.2851    4.7404    5.2106    5.6967    6.2003    6.7214    7.2544    7.7751
    map     4.1758    4.2212    4.2687    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval    5.7601    5.9917    6.2557    6.5418    6.8483     7.176    7.5257    7.8983    8.2908    8.6888    9.0606
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:55, fl_diff:1.976860e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.0744    3.4573    3.8784    4.3189    4.7743    5.2444    5.7306    6.2341    6.7553    7.2883    7.8091
    map     4.1758    4.2212    4.2697    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval     5.794    6.0255    6.2896    6.5757    6.8822    7.2099    7.5596    7.9323    8.3249    8.7229    9.0946
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:60, fl_diff:1.450067e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.0992    3.4821    3.9033    4.3438    4.7991    5.2692    5.7554     6.259    6.7801    7.3132     7.834
    map     4.1758    4.2212    4.2697    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval    5.8188    6.0504    6.3144    6.6005    6.9071    7.2348    7.5845    7.9572    8.3498    8.7478    9.1196
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:65, fl_diff:1.063917e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.1174    3.5003    3.9215     4.362    4.8173    5.2875    5.7736    6.2772    6.7984    7.3314    7.8522
    map     4.1758    4.2212    4.2697    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval     5.837    6.0686    6.3326    6.6188    6.9253     7.253    7.6027    7.9754     8.368     8.766    9.1378
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:70, fl_diff:7.806993e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.1308    3.5137    3.9348    4.3753    4.8307    5.3008     5.787    6.2906    6.8117    7.3448    7.8656
    map     4.1758    4.2212    4.2697    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval    5.8504     6.082     6.346    6.6321    6.9387    7.2664    7.6161    7.9888    8.3814    8.7794    9.1512
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeoutput">VAL it_iter:75, fl_diff:5.729144e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    3.1406    3.5235    3.9447    4.3852    4.8405    5.3106    5.7968    6.3004    6.8216    7.3546    7.8754
    map     4.1758    4.2212    4.2697    4.3384    4.4313    4.5596    4.7313    4.9515    5.2333    5.5838    6.0081
    Hval    5.8602    6.0918    6.3558     6.642    6.9485    7.2762    7.6259    7.9986    8.3912    8.7892     9.161
    Hpol    8.7879    8.8889    8.8889    8.9899    9.0909    9.2929    9.4949     9.697     9.899        10        10

</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><pre class="codeoutput">Elapsed time is 16.745496 seconds.
</pre><h2 id="13">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_a'</span>) = mt_pol_a;

<span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">Warning: Directory already exists. 
valgap = norm(mt_val - mt_val_cur)
polgap = norm(mt_pol_a - mt_pol_a_cur)
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n)
                valgap     polgap      z1      z2      z3      z4      z5      z6      z7      z8      z9     z10     z11 
               ________    _______    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____

    iter=1       38.262     33.166       1       1       1       1       1       1       1       1       1       1       1
    iter=2       23.077     96.766    0.97    0.98    0.98    0.98    0.98    0.99    0.99       1       1       1       1
    iter=3       16.941     32.652    0.94    0.94    0.94    0.94    0.96    0.96    0.97    0.99       1       1       1
    iter=4       13.342      16.53    0.89    0.89    0.88    0.89     0.9    0.92    0.97    0.98       1       1       1
    iter=5       10.907       9.96    0.83    0.82     0.8    0.85    0.84    0.89    0.92    0.95    0.97       1       1
    iter=6       9.1206      6.609    0.75    0.74    0.71    0.76     0.8    0.81    0.87    0.91    0.95    0.98       1
    iter=7       7.7457     4.7118    0.63    0.63    0.62    0.68    0.71    0.74    0.78    0.84    0.88    0.95    0.99
    iter=8       6.6578     3.5186    0.52    0.51    0.52    0.57    0.61    0.67    0.71    0.77    0.86    0.91    0.96
    iter=9       5.7817     2.6606     0.4    0.38    0.44    0.47     0.5    0.54    0.61    0.68    0.74    0.82    0.91
    iter=10       5.067     2.1204    0.26    0.27     0.3    0.34    0.39    0.45    0.51    0.59    0.67    0.76    0.84
    iter=11      4.4778     1.7076    0.17     0.2    0.21    0.25    0.28    0.33     0.4    0.48    0.55    0.65    0.72
    iter=12      3.9875     1.3855    0.14    0.13    0.19     0.2    0.21    0.25    0.29    0.37    0.45    0.53    0.63
    iter=13      3.5757     1.1843    0.09    0.14    0.13    0.17    0.17    0.21    0.23    0.31    0.38    0.47    0.46
    iter=14      3.2267    0.88987    0.07    0.07    0.08    0.07    0.14    0.16    0.23    0.25    0.28    0.31    0.39
    iter=15      2.9282     0.7821    0.04    0.05    0.08    0.09    0.09    0.14    0.14    0.19    0.23    0.31    0.32
    iter=16      2.6705    0.65508    0.07    0.04    0.06    0.07    0.09    0.11    0.13    0.14    0.21    0.23    0.26
    iter=17      2.4461    0.60221    0.01    0.05    0.03    0.06    0.07    0.05     0.1    0.16    0.16    0.18    0.22
    iter=18      2.2488    0.47092    0.01    0.01    0.03    0.03    0.05    0.06    0.08    0.09    0.14    0.15    0.18
    iter=19      2.0739     0.4182    0.01    0.02    0.02    0.03    0.04    0.06    0.06    0.07    0.12    0.15    0.13
    iter=20      1.9178    0.38099    0.01    0.02    0.01    0.02    0.02    0.05    0.04    0.08    0.07     0.1    0.12
    iter=21      1.7775     0.4122       0    0.01    0.02    0.01    0.03    0.02    0.05    0.05    0.07    0.08     0.1
    iter=22      1.6507    0.34639    0.01    0.01    0.01    0.02    0.03    0.04    0.04    0.05    0.07    0.09    0.07
    iter=23      1.5355    0.28285    0.02       0    0.01    0.01    0.01    0.04    0.04    0.05    0.04    0.05    0.07
    iter=24      1.4303    0.26837       0    0.02    0.02       0       0    0.02    0.02    0.03    0.04    0.05    0.06
    iter=25       1.334    0.24372       0       0       0    0.02    0.02    0.02    0.03    0.03    0.03    0.04    0.05
    iter=26      1.2454    0.20202       0       0       0       0    0.01       0       0       0    0.04    0.04    0.03
    iter=27      1.1638    0.17495    0.01    0.01       0       0       0       0    0.02    0.02    0.02    0.02    0.03
    iter=28      1.0883    0.16344       0       0    0.02    0.01    0.01    0.02    0.02       0    0.01    0.02    0.02
    iter=29      1.0184    0.20202       0    0.01       0       0    0.01       0    0.01    0.03    0.04    0.01    0.02
    iter=30      0.9536    0.14285       0       0       0       0       0       0       0    0.01    0.01    0.02       0
    iter=31     0.89332    0.17495       0    0.01    0.01       0       0       0    0.02    0.01    0.01    0.01    0.03
    iter=32     0.83722    0.10101    0.01    0.01       0       0    0.01       0    0.01    0.01       0    0.01    0.01
    iter=33     0.78493    0.10101       0       0       0       0       0    0.01       0       0       0    0.01       0
    iter=34     0.73615    0.10101       0       0       0    0.01       0    0.01       0       0    0.01    0.01    0.01
    iter=35     0.69059    0.10101       0       0       0    0.01       0       0       0       0    0.01       0       0
    iter=36     0.64802    0.14285       0       0       0       0       0       0    0.01       0    0.01    0.02    0.01
    iter=37      0.6082    0.10101       0       0       0    0.01       0       0       0       0       0    0.01    0.01
    iter=38     0.57093    0.10101       0       0       0    0.01       0       0       0    0.01       0       0    0.01
    iter=39     0.53604          0       0       0       0       0       0       0       0       0       0       0       0
    iter=40     0.50335    0.10101       0       0       0    0.01       0       0       0       0       0    0.01       0
    iter=41     0.47272          0       0       0       0       0       0       0       0       0       0       0       0
    iter=42     0.44399          0       0       0       0       0       0       0       0       0       0       0       0
    iter=43     0.41706    0.10101       0       0       0       0       0       0       0    0.01       0       0       0
    iter=44     0.39179    0.10101       0       0       0       0       0       0       0       0    0.01       0       0
    iter=45     0.36808          0       0       0       0       0       0       0       0       0       0       0       0
    iter=46     0.34583          0       0       0       0       0       0       0       0       0       0       0       0
    iter=47     0.32495    0.10101       0       0       0       0       0       0    0.01       0       0       0       0
    iter=48     0.30534          0       0       0       0       0       0       0       0       0       0       0       0
    iter=49     0.28692          0       0       0       0       0       0       0       0       0       0       0       0
    iter=50     0.26963          0       0       0       0       0       0       0       0       0       0       0       0
    iter=51     0.25339          0       0       0       0       0       0       0       0       0       0       0       0
    iter=52     0.23813    0.10101       0       0    0.01       0       0       0       0       0       0       0       0
    iter=53      0.2238          0       0       0       0       0       0       0       0       0       0       0       0
    iter=54     0.21034          0       0       0       0       0       0       0       0       0       0       0       0
    iter=55     0.19769          0       0       0       0       0       0       0       0       0       0       0       0
    iter=56      0.1858          0       0       0       0       0       0       0       0       0       0       0       0
    iter=57     0.17463          0       0       0       0       0       0       0       0       0       0       0       0
    iter=58     0.16414          0       0       0       0       0       0       0       0       0       0       0       0
    iter=59     0.15427          0       0       0       0       0       0       0       0       0       0       0       0
    iter=60     0.14501          0       0       0       0       0       0       0       0       0       0       0       0
    iter=61      0.1363          0       0       0       0       0       0       0       0       0       0       0       0
    iter=62     0.12811          0       0       0       0       0       0       0       0       0       0       0       0
    iter=63     0.12042          0       0       0       0       0       0       0       0       0       0       0       0
    iter=64     0.11319          0       0       0       0       0       0       0       0       0       0       0       0
    iter=65     0.10639          0       0       0       0       0       0       0       0       0       0       0       0
    iter=66         0.1          0       0       0       0       0       0       0       0       0       0       0       0
    iter=67    0.094001          0       0       0       0       0       0       0       0       0       0       0       0
    iter=68    0.088359          0       0       0       0       0       0       0       0       0       0       0       0
    iter=69    0.083055          0       0       0       0       0       0       0       0       0       0       0       0
    iter=70     0.07807          0       0       0       0       0       0       0       0       0       0       0       0
    iter=71    0.073384          0       0       0       0       0       0       0       0       0       0       0       0
    iter=72     0.06898          0       0       0       0       0       0       0       0       0       0       0       0
    iter=73     0.06484          0       0       0       0       0       0       0       0       0       0       0       0
    iter=74    0.060949          0       0       0       0       0       0       0       0       0       0       0       0
    iter=75    0.057291          0       0       0       0       0       0       0       0       0       0       0       0
    iter=76    0.053853          0       0       0       0       0       0       0       0       0       0       0       0
    iter=77    0.050622          0       0       0       0       0       0       0       0       0       0       0       0
    iter=78    0.047584          0       0       0       0       0       0       0       0       0       0       0       0

tb_val
                   z1_0_34664    z2_0_42338    z3_0_51712    z4_0_63162    z5_0_77146    z6_0_94226    z7_1_1509    z8_1_4057    z9_1_7169    z10_2_097    z11_2_5613
                   __________    __________    __________    __________    __________    __________    _________    _________    _________    _________    __________

    a1=0             -1.5677      -0.66367       0.2422        1.1096        1.9315        2.7114       3.4622        4.195       4.9182       5.6325        6.3136  
    a2=0.10101       -1.2687      -0.43626      0.41449        1.2397        2.0294        2.7911       3.5282       4.2509        4.967       5.6749        6.3514  
    a3=0.20202       -1.0444      -0.25416      0.56092        1.3573         2.125         2.868       3.5923       4.3059       5.0153        5.717         6.389  
    a4=0.30303      -0.82389     -0.076682      0.70077        1.4665        2.2154        2.9416       3.6552       4.3604        5.063       5.7588        6.4263  
    a5=0.40404      -0.64797      0.073946      0.82781        1.5733        2.3012        3.0145       3.7172       4.4142       5.1101       5.8005        6.4633  
    a6=0.50505      -0.47344       0.21886      0.94859        1.6744        2.3853        3.0861       3.7782       4.4675       5.1567       5.8419        6.5001  
    a7=0.60606      -0.30329       0.36169       1.0646        1.7705        2.4678        3.1563       3.8384       4.5204       5.2028       5.8829        6.5367  
    a8=0.70707      -0.15881       0.48953       1.1758        1.8632         2.548        3.2251       3.8985       4.5725       5.2485       5.9237         6.573  
    a9=0.80808     -0.018038       0.61233       1.2822        1.9553        2.6261        3.2925       3.9575       4.6239       5.2938       5.9641        6.6091  
    a10=0.90909      0.12155       0.73148       1.3849        2.0443         2.702        3.3586       4.0154       4.6746       5.3388       6.0042         6.645  
    a11=1.0101       0.25772       0.84914       1.4827        2.1302        2.7765        3.4233       4.0723       4.7249       5.3832        6.044        6.6806  
    a12=1.1111       0.37974       0.95903         1.58        2.2142        2.8492         3.487       4.1283       4.7746       5.4274       6.0835        6.7161  
    a13=1.2121       0.49771        1.0653       1.6746        2.2958        2.9215        3.5502       4.1839       4.8238       5.4713       6.1227        6.7514  
    a14=1.3131       0.61342        1.1685       1.7663        2.3753         2.992        3.6122       4.2386       4.8724        5.515       6.1616        6.7865  
    a15=1.4141       0.72823        1.2687        1.855        2.4541        3.0612        3.6737       4.2927       4.9206       5.5584       6.2002        6.8214  
    a16=1.5152       0.84022        1.3674       1.9415        2.5314        3.1295        3.7341       4.3461       4.9685       5.6013       6.2386        6.8561  
    a17=1.6162       0.94504        1.4632       2.0258        2.6071        3.1962        3.7937       4.3991       5.0159       5.6439       6.2767        6.8906  
    a18=1.7172        1.0466        1.5562       2.1089         2.681        3.2621        3.8524       4.4518        5.063       5.6861       6.3145        6.9249  
    a19=1.8182        1.1457        1.6468       2.1907        2.7537        3.3268        3.9103        4.504       5.1098       5.7279        6.352         6.959  
    a20=1.9192        1.2426        1.7351       2.2708         2.825        3.3904        3.9674       4.5556       5.1561       5.7694       6.3894        6.9929  
    a21=2.0202        1.3392        1.8217       2.3493        2.8949        3.4537        4.0238       4.6065       5.2019       5.8106       6.4266        7.0266  
    a22=2.1212        1.4339        1.9059       2.4259        2.9636        3.5161        4.0796       4.6569       5.2474       5.8514       6.4636        7.0601  
    a23=2.2222        1.5248        1.9896       2.5011        3.0321        3.5776         4.135       4.7068       5.2924       5.8919       6.5004        7.0934  
    a24=2.3232        1.6134        2.0716       2.5749        3.0994        3.6381        4.1898       4.7562        5.337       5.9321        6.537        7.1265  
    a25=2.4242        1.6999        2.1518       2.6473        3.1655        3.6978         4.244       4.8051       5.3812       5.9721       6.5733        7.1594  
    a26=2.5253        1.7846        2.2304       2.7189        3.2306        3.7568        4.2977       4.8535        5.425       6.0118       6.6094        7.1921  
    a27=2.6263        1.8682        2.3077       2.7898        3.2947        3.8152        4.3507       4.9014       5.4684       6.0512       6.6453        7.2246  
    a28=2.7273        1.9504        2.3832       2.8593        3.3581        3.8728        4.4031       4.9488       5.5115       6.0904       6.6809         7.257  
    a29=2.8283        2.0317        2.4576        2.928        3.4205        3.9296         4.455       4.9958       5.5543       6.1295       6.7163        7.2892  
    a30=2.9293        2.1114        2.5306       2.9955         3.482        3.9857        4.5063       5.0426       5.5967       6.1684       6.7515        7.3212  
    a31=3.0303        2.1894        2.6027       3.0619        3.5426        4.0412         4.557        5.089       5.6389       6.2069       6.7864        7.3532  
    a32=3.1313        2.2658        2.6741       3.1273        3.6026        4.0965        4.6071        5.135       5.6809       6.2452       6.8211        7.3849  
    a33=3.2323        2.3408        2.7444       3.1919        3.6623        4.1512        4.6568       5.1806       5.7226       6.2832       6.8557        7.4166  
    a34=3.3333        2.4148        2.8137       3.2555        3.7212        4.2052         4.706       5.2259       5.7641       6.3209         6.89         7.448  
    a35=3.4343        2.4874        2.8818       3.3182        3.7794        4.2585         4.755       5.2708       5.8052       6.3584       6.9241        7.4793  
    a36=3.5354        2.5591         2.949       3.3804        3.8367        4.3112        4.8036       5.3153        5.846       6.3956        6.958        7.5104  
    a37=3.6364        2.6298        3.0151       3.4419        3.8934        4.3635        4.8518       5.3594       5.8865       6.4326       6.9917        7.5414  
    a38=3.7374           2.7        3.0802       3.5027        3.9494        4.4153        4.8995       5.4033       5.9267       6.4693       7.0252        7.5722  
    a39=3.8384         2.769        3.1444       3.5627        4.0051        4.4665        4.9469       5.4467       5.9666       6.5057       7.0587        7.6029  
    a40=3.9394        2.8371        3.2079       3.6222          4.06        4.5173        4.9938       5.4898       6.0062       6.5419        7.092        7.6334  
    a41=4.0404        2.9042        3.2705       3.6808        4.1142        4.5675        5.0403       5.5326       6.0455       6.5779       7.1251        7.6637  
    a42=4.1414        2.9703        3.3329       3.7387        4.1678        4.6172        5.0864       5.5749       6.0844       6.6137       7.1581        7.6939  
    a43=4.2424        3.0353        3.3944       3.7959        4.2209        4.6665         5.132        5.617       6.1231       6.6493       7.1909        7.7239  
    a44=4.3434        3.0996        3.4552       3.8524        4.2735        4.7153        5.1773       5.6587       6.1615       6.6847       7.2235        7.7538  
    a45=4.4444         3.163        3.5152       3.9083        4.3259         4.764        5.2222       5.7003       6.1998       6.7199       7.2559        7.7835  
    a46=4.5455        3.2257        3.5745       3.9637        4.3778        4.8122        5.2666       5.7416       6.2377        6.755       7.2881         7.813  
    a47=4.6465        3.2875        3.6331       4.0184        4.4292          4.86        5.3107       5.7825       6.2754       6.7899       7.3202        7.8424  
    a48=4.7475        3.3488        3.6911       4.0728          4.48        4.9072        5.3544       5.8233        6.313       6.8247        7.352        7.8717  
    a49=4.8485        3.4097        3.7483       4.1267        4.5303        4.9541         5.398       5.8637       6.3504       6.8592       7.3837        7.9008  
    a50=4.9495        3.4698        3.8049       4.1801          4.58        5.0005        5.4414       5.9037       6.3876       6.8935       7.4152        7.9298  
    a51=5.0505        3.5293        3.8608       4.2329        4.6293        5.0467        5.4844       5.9436       6.4246       6.9277       7.4465        7.9587  
    a52=5.1515        3.5881        3.9162       4.2851        4.6784        5.0925         5.527       5.9832       6.4614       6.9616       7.4777        7.9875  
    a53=5.2525        3.6461        3.9709        4.337        4.7269        5.1378        5.5693       6.0225       6.4979       6.9953       7.5087        8.0162  
    a54=5.3535        3.7035        4.0255       4.3883         4.775        5.1827        5.6113       6.0616       6.5342       7.0288       7.5395        8.0447  
    a55=5.4545        3.7602        4.0796       4.4391        4.8226        5.2273        5.6531       6.1004       6.5703       7.0621       7.5702        8.0731  
    a56=5.5556        3.8162        4.1331       4.4894        4.8698        5.2716        5.6945        6.139       6.6061       7.0952       7.6007        8.1013  
    a57=5.6566        3.8718         4.186       4.5393        4.9166        5.3155        5.7357       6.1773       6.6417       7.1281       7.6311        8.1294  
    a58=5.7576        3.9268        4.2385       4.5887         4.963        5.3591        5.7765       6.2153       6.6771       7.1608       7.6613        8.1574  
    a59=5.8586        3.9812        4.2904       4.6376        5.0093        5.4024         5.817       6.2531       6.7122       7.1933       7.6915        8.1853  
    a60=5.9596        4.0351        4.3418       4.6861        5.0553        5.4455        5.8572       6.2906       6.7471       7.2257       7.7215         8.213  
    a61=6.0606        4.0886        4.3927       4.7342        5.1008        5.4883        5.8972       6.3278       6.7818       7.2578       7.7514        8.2405  
    a62=6.1616        4.1417        4.4432        4.782         5.146        5.5307        5.9368        6.365       6.8163       7.2899       7.7812        8.2679  
    a63=6.2626        4.1943        4.4932       4.8296        5.1907        5.5728        5.9762        6.402       6.8506       7.3217       7.8108        8.2952  
    a64=6.3636        4.2465        4.5428       4.8767        5.2351        5.6146        6.0153       6.4386       6.8847       7.3534       7.8403        8.3224  
    a65=6.4646        4.2981        4.5918       4.9234        5.2791        5.6561        6.0542       6.4751       6.9186        7.385       7.8696        8.3494  
    a66=6.5657        4.3493        4.6404       4.9697        5.3228        5.6973         6.093       6.5114       6.9523       7.4166       7.8988        8.3762  
    a67=6.6667        4.3999        4.6886       5.0155        5.3662        5.7383        6.1315       6.5474        6.986       7.4479       7.9278        8.4029  
    a68=6.7677        4.4501        4.7367       5.0611        5.4093        5.7789        6.1697       6.5832       7.0195       7.4792       7.9566        8.4295  
    a69=6.8687        4.4998        4.7843       5.1063        5.4521        5.8193        6.2077       6.6188       7.0528       7.5102       7.9853        8.4559  
    a70=6.9697         4.549        4.8316       5.1512        5.4946        5.8594        6.2455       6.6542        7.086       7.5411       8.0139        8.4822  
    a71=7.0707        4.5978        4.8784       5.1957        5.5367        5.8991         6.283       6.6894        7.119       7.5718       8.0423        8.5085  
    a72=7.1717        4.6463         4.925       5.2399        5.5785        5.9386        6.3203       6.7244       7.1518       7.6024       8.0705        8.5345  
    a73=7.2727        4.6944        4.9711       5.2837          5.62        5.9779        6.3574       6.7592       7.1844       7.6328       8.0987        8.5605  
    a74=7.3737         4.742        5.0169       5.3272        5.6612        6.0169        6.3943       6.7938       7.2168        7.663       8.1266        8.5863  
    a75=7.4747        4.7892        5.0623       5.3703        5.7023        6.0557        6.4309       6.8282       7.2491        7.693       8.1545         8.612  
    a76=7.5758        4.8363        5.1072       5.4131        5.7431        6.0942        6.4673       6.8624       7.2812       7.7229       8.1821        8.6375  
    a77=7.6768         4.883        5.1518       5.4556        5.7837        6.1326        6.5034       6.8964       7.3131       7.7527       8.2097        8.6628  
    a78=7.7778        4.9292        5.1962        5.498         5.824        6.1708        6.5393       6.9302       7.3448       7.7822       8.2371        8.6879  
    a79=7.8788        4.9752        5.2402       5.5401         5.864        6.2087        6.5751       6.9639       7.3764       7.8117       8.2645        8.7129  
    a80=7.9798        5.0208        5.2838       5.5819        5.9036        6.2463        6.6106       6.9973       7.4078        7.841       8.2917        8.7377  
    a81=8.0808         5.066        5.3271       5.6234        5.9431        6.2837        6.6459       7.0306        7.439       7.8701       8.3188        8.7622  
    a82=8.1818        5.1109        5.3701       5.6646        5.9822        6.3209         6.681       7.0638         7.47       7.8991       8.3457        8.7866  
    a83=8.2828        5.1554        5.4128       5.7055        6.0211        6.3578        6.7159       7.0968       7.5009       7.9279       8.3725        8.8109  
    a84=8.3838        5.1996        5.4553        5.746        6.0597        6.3946        6.7506       7.1296       7.5316       7.9566       8.3992         8.835  
    a85=8.4848        5.2434        5.4975       5.7863        6.0982        6.4311        6.7852       7.1622       7.5622       7.9852       8.4257        8.8588  
    a86=8.5859        5.2869        5.5395       5.8264        6.1364        6.4674        6.8196       7.1946       7.5926       8.0138        8.452        8.8823  
    a87=8.6869        5.3301        5.5811       5.8662        6.1743        6.5035        6.8539       7.2269        7.623       8.0422       8.4781        8.9056  
    a88=8.7879        5.3729        5.6225       5.9058        6.2121        6.5393        6.8879        7.259       7.6532       8.0705       8.5041        8.9285  
    a89=8.8889        5.4155        5.6636       5.9451        6.2495         6.575        6.9217        7.291       7.6833       8.0986       8.5299        8.9512  
    a90=8.9899        5.4578        5.7044       5.9842        6.2868        6.6104        6.9554       7.3228       7.7132       8.1266       8.5555        8.9735  
    a91=9.0909        5.4998         5.745        6.023        6.3237        6.6456        6.9888       7.3544        7.743       8.1544       8.5809        8.9955  
    a92=9.1919        5.5415        5.7852       6.0615        6.3605        6.6806        7.0221       7.3858       7.7727       8.1821       8.6062         9.017  
    a93=9.2929        5.5831        5.8252       6.0997        6.3971        6.7155        7.0553       7.4172       7.8022       8.2096       8.6312        9.0382  
    a94=9.3939        5.6243        5.8648       6.1377        6.4336        6.7501        7.0882       7.4483       7.8316        8.237       8.6559        9.0587  
    a95=9.4949        5.6653        5.9043       6.1755        6.4699        6.7846         7.121       7.4793       7.8608       8.2642       8.6805        9.0791  
    a96=9.596          5.706        5.9435       6.2132        6.5059         6.819        7.1535       7.5101       7.8899       8.2912       8.7045        9.0984  
    a97=9.697         5.7465        5.9824       6.2507        6.5417        6.8531        7.1859       7.5408       7.9188        8.318       8.7282        9.1168  
    a98=9.798         5.7866        6.0211       6.2879        6.5773        6.8871        7.2182       7.5713       7.9475       8.3446       8.7517        9.1343  
    a99=9.899         5.8265        6.0595        6.325        6.6127        6.9209        7.2502       7.6017       7.9761       8.3709        8.774         9.151  
    a100=10           5.8661        6.0977       6.3617        6.6479        6.9544        7.2821       7.6319       8.0045       8.3971       8.7952         9.167  

tb_pol_a
                   z1_0_34664    z2_0_42338    z3_0_51712    z4_0_63162    z5_0_77146    z6_0_94226    z7_1_1509    z8_1_4057    z9_1_7169    z10_2_097    z11_2_5613
                   __________    __________    __________    __________    __________    __________    _________    _________    _________    _________    __________

    a1=0                  0             0             0             0             0             0       0.10101      0.30303      0.50505      0.90909       1.3131  
    a2=0.10101            0             0             0             0             0       0.10101       0.20202      0.40404      0.60606       1.0101       1.4141  
    a3=0.20202            0       0.10101       0.10101       0.10101       0.10101       0.20202       0.30303      0.50505      0.70707       1.1111       1.5152  
    a4=0.30303      0.10101       0.10101       0.10101       0.10101       0.20202       0.30303       0.40404      0.60606      0.80808       1.2121       1.6162  
    a5=0.40404      0.20202       0.20202       0.20202       0.20202       0.30303       0.30303       0.50505      0.70707      0.90909       1.2121       1.7172  
    a6=0.50505      0.20202       0.30303       0.30303       0.30303       0.30303       0.40404       0.60606      0.70707       1.0101       1.3131       1.8182  
    a7=0.60606      0.30303       0.30303       0.30303       0.40404       0.40404       0.50505       0.70707      0.80808       1.1111       1.4141       1.9192  
    a8=0.70707      0.40404       0.40404       0.40404       0.40404       0.50505       0.60606       0.70707      0.90909       1.2121       1.5152       2.0202  
    a9=0.80808      0.40404       0.50505       0.50505       0.50505       0.60606       0.70707       0.80808       1.0101       1.3131       1.6162       2.1212  
    a10=0.90909     0.50505       0.60606       0.60606       0.60606       0.70707       0.80808       0.90909       1.1111       1.4141       1.7172       2.2222  
    a11=1.0101      0.60606       0.60606       0.60606       0.70707       0.80808       0.90909        1.0101       1.2121       1.5152       1.8182       2.3232  
    a12=1.1111      0.70707       0.70707       0.70707       0.80808       0.80808       0.90909        1.1111       1.3131       1.6162       1.9192       2.3232  
    a13=1.2121      0.80808       0.80808       0.80808       0.90909       0.90909        1.0101        1.2121       1.4141       1.6162       2.0202       2.4242  
    a14=1.3131      0.80808       0.90909       0.90909       0.90909        1.0101        1.1111        1.3131       1.5152       1.7172       2.1212       2.5253  
    a15=1.4141      0.90909        1.0101        1.0101        1.0101        1.1111        1.2121        1.4141       1.6162       1.8182       2.2222       2.6263  
    a16=1.5152       1.0101        1.0101        1.1111        1.1111        1.2121        1.3131        1.5152       1.7172       1.9192       2.3232       2.7273  
    a17=1.6162       1.1111        1.1111        1.2121        1.2121        1.3131        1.4141        1.5152       1.8182       2.0202       2.4242       2.8283  
    a18=1.7172       1.2121        1.2121        1.2121        1.3131        1.4141        1.5152        1.6162       1.8182       2.1212       2.5253       2.9293  
    a19=1.8182       1.3131        1.3131        1.3131        1.4141        1.5152        1.6162        1.7172       1.9192       2.2222       2.6263       3.0303  
    a20=1.9192       1.3131        1.4141        1.4141        1.5152        1.6162        1.7172        1.8182       2.0202       2.3232       2.6263       3.1313  
    a21=2.0202       1.4141        1.5152        1.5152        1.6162        1.6162        1.8182        1.9192       2.1212       2.4242       2.7273       3.2323  
    a22=2.1212       1.5152        1.5152        1.6162        1.6162        1.7172        1.8182        2.0202       2.2222       2.5253       2.8283       3.3333  
    a23=2.2222       1.6162        1.6162        1.7172        1.7172        1.8182        1.9192        2.1212       2.3232       2.6263       2.9293       3.4343  
    a24=2.3232       1.7172        1.7172        1.8182        1.8182        1.9192        2.0202        2.2222       2.4242       2.7273       3.0303       3.5354  
    a25=2.4242       1.8182        1.8182        1.9192        1.9192        2.0202        2.1212        2.3232       2.5253       2.8283       3.1313       3.6364  
    a26=2.5253       1.9192        1.9192        1.9192        2.0202        2.1212        2.2222        2.4242       2.6263       2.9293       3.2323       3.7374  
    a27=2.6263       2.0202        2.0202        2.0202        2.1212        2.2222        2.3232        2.5253       2.7273       3.0303       3.3333       3.8384  
    a28=2.7273       2.0202        2.1212        2.1212        2.2222        2.3232        2.4242        2.6263       2.8283       3.0303       3.4343       3.9394  
    a29=2.8283       2.1212        2.2222        2.2222        2.3232        2.4242        2.5253        2.6263       2.9293       3.1313       3.5354       4.0404  
    a30=2.9293       2.2222        2.3232        2.3232        2.4242        2.5253        2.6263        2.7273       3.0303       3.2323       3.6364       4.1414  
    a31=3.0303       2.3232        2.3232        2.4242        2.5253        2.5253        2.7273        2.8283       3.1313       3.3333       3.7374       4.1414  
    a32=3.1313       2.4242        2.4242        2.5253        2.6263        2.6263        2.8283        2.9293       3.1313       3.4343       3.8384       4.2424  
    a33=3.2323       2.5253        2.5253        2.6263        2.6263        2.7273        2.9293        3.0303       3.2323       3.5354       3.9394       4.3434  
    a34=3.3333       2.6263        2.6263        2.7273        2.7273        2.8283        2.9293        3.1313       3.3333       3.6364       4.0404       4.4444  
    a35=3.4343       2.7273        2.7273        2.8283        2.8283        2.9293        3.0303        3.2323       3.4343       3.7374       4.1414       4.5455  
    a36=3.5354       2.8283        2.8283        2.8283        2.9293        3.0303        3.1313        3.3333       3.5354       3.8384       4.2424       4.6465  
    a37=3.6364       2.8283        2.9293        2.9293        3.0303        3.1313        3.2323        3.4343       3.6364       3.9394       4.3434       4.7475  
    a38=3.7374       2.9293        3.0303        3.0303        3.1313        3.2323        3.3333        3.5354       3.7374       4.0404       4.3434       4.8485  
    a39=3.8384       3.0303        3.1313        3.1313        3.2323        3.3333        3.4343        3.6364       3.8384       4.1414       4.4444       4.9495  
    a40=3.9394       3.1313        3.2323        3.2323        3.3333        3.4343        3.5354        3.7374       3.9394       4.2424       4.5455       5.0505  
    a41=4.0404       3.2323        3.2323        3.3333        3.4343        3.5354        3.6364        3.8384       4.0404       4.3434       4.6465       5.1515  
    a42=4.1414       3.3333        3.3333        3.4343        3.5354        3.6364        3.7374        3.9394       4.1414       4.4444       4.7475       5.2525  
    a43=4.2424       3.4343        3.4343        3.5354        3.6364        3.7374        3.8384        4.0404       4.2424       4.5455       4.8485       5.3535  
    a44=4.3434       3.5354        3.5354        3.6364        3.7374        3.7374        3.9394        4.0404       4.3434       4.6465       4.9495       5.4545  
    a45=4.4444       3.6364        3.6364        3.7374        3.7374        3.8384        4.0404        4.1414       4.4444       4.7475       5.0505       5.5556  
    a46=4.5455       3.7374        3.7374        3.8384        3.8384        3.9394        4.1414        4.2424       4.5455       4.7475       5.1515       5.6566  
    a47=4.6465       3.8384        3.8384        3.9394        3.9394        4.0404        4.2424        4.3434       4.6465       4.8485       5.2525       5.7576  
    a48=4.7475       3.8384        3.9394        3.9394        4.0404        4.1414        4.3434        4.4444       4.6465       4.9495       5.3535       5.8586  
    a49=4.8485       3.9394        4.0404        4.0404        4.1414        4.2424        4.3434        4.5455       4.7475       5.0505       5.4545       5.9596  
    a50=4.9495       4.0404        4.1414        4.1414        4.2424        4.3434        4.4444        4.6465       4.8485       5.1515       5.5556       6.0606  
    a51=5.0505       4.1414        4.2424        4.2424        4.3434        4.4444        4.5455        4.7475       4.9495       5.2525       5.6566       6.0606  
    a52=5.1515       4.2424        4.3434        4.3434        4.4444        4.5455        4.6465        4.8485       5.0505       5.3535       5.7576       6.1616  
    a53=5.2525       4.3434        4.4444        4.4444        4.5455        4.6465        4.7475        4.9495       5.1515       5.4545       5.8586       6.2626  
    a54=5.3535       4.4444        4.4444        4.5455        4.6465        4.7475        4.8485        5.0505       5.2525       5.5556       5.9596       6.3636  
    a55=5.4545       4.5455        4.5455        4.6465        4.7475        4.8485        4.9495        5.1515       5.3535       5.6566       6.0606       6.4646  
    a56=5.5556       4.6465        4.6465        4.7475        4.8485        4.9495        5.0505        5.2525       5.4545       5.7576       6.1616       6.5657  
    a57=5.6566       4.7475        4.7475        4.8485        4.9495        5.0505        5.1515        5.3535       5.5556       5.8586       6.2626       6.6667  
    a58=5.7576       4.8485        4.8485        4.9495        5.0505        5.1515        5.2525        5.4545       5.6566       5.9596       6.2626       6.7677  
    a59=5.8586       4.9495        4.9495        5.0505        5.0505        5.1515        5.3535        5.5556       5.7576       6.0606       6.3636       6.8687  
    a60=5.9596       5.0505        5.0505        5.1515        5.1515        5.2525        5.4545        5.6566       5.8586       6.1616       6.4646       6.9697  
    a61=6.0606       5.0505        5.1515        5.2525        5.2525        5.3535        5.5556        5.6566       5.9596       6.2626       6.5657       7.0707  
    a62=6.1616       5.1515        5.2525        5.2525        5.3535        5.4545        5.6566        5.7576       6.0606       6.3636       6.6667       7.1717  
    a63=6.2626       5.2525        5.3535        5.3535        5.4545        5.5556        5.7576        5.8586       6.1616       6.4646       6.7677       7.2727  
    a64=6.3636       5.3535        5.4545        5.4545        5.5556        5.6566        5.8586        5.9596       6.2626       6.5657       6.8687       7.3737  
    a65=6.4646       5.4545        5.5556        5.5556        5.6566        5.7576        5.8586        6.0606       6.3636       6.5657       6.9697       7.4747  
    a66=6.5657       5.5556        5.6566        5.6566        5.7576        5.8586        5.9596        6.1616       6.4646       6.6667       7.0707       7.5758  
    a67=6.6667       5.6566        5.7576        5.7576        5.8586        5.9596        6.0606        6.2626       6.4646       6.7677       7.1717       7.6768  
    a68=6.7677       5.7576        5.7576        5.8586        5.9596        6.0606        6.1616        6.3636       6.5657       6.8687       7.2727       7.7778  
    a69=6.8687       5.8586        5.8586        5.9596        6.0606        6.1616        6.2626        6.4646       6.6667       6.9697       7.3737       7.8788  
    a70=6.9697       5.9596        5.9596        6.0606        6.1616        6.2626        6.3636        6.5657       6.7677       7.0707       7.4747       7.8788  
    a71=7.0707       6.0606        6.0606        6.1616        6.2626        6.3636        6.4646        6.6667       6.8687       7.1717       7.5758       7.9798  
    a72=7.1717       6.1616        6.1616        6.2626        6.3636        6.4646        6.5657        6.7677       6.9697       7.2727       7.6768       8.0808  
    a73=7.2727       6.2626        6.2626        6.3636        6.4646        6.5657        6.6667        6.8687       7.0707       7.3737       7.7778       8.1818  
    a74=7.3737       6.3636        6.3636        6.4646        6.5657        6.6667        6.7677        6.9697       7.1717       7.4747       7.8788       8.2828  
    a75=7.4747       6.4646        6.4646        6.5657        6.5657        6.7677        6.8687        7.0707       7.2727       7.5758       7.9798       8.3838  
    a76=7.5758       6.4646        6.5657        6.6667        6.6667        6.7677        6.9697        7.1717       7.3737       7.6768       8.0808       8.4848  
    a77=7.6768       6.5657        6.6667        6.7677        6.7677        6.8687        7.0707        7.2727       7.4747       7.7778       8.1818       8.5859  
    a78=7.7778       6.6667        6.7677        6.7677        6.8687        6.9697        7.1717        7.3737       7.5758       7.8788       8.1818       8.6869  
    a79=7.8788       6.7677        6.8687        6.8687        6.9697        7.0707        7.2727        7.4747       7.6768       7.9798       8.2828       8.7879  
    a80=7.9798       6.8687        6.9697        6.9697        7.0707        7.1717        7.3737        7.5758       7.7778       8.0808       8.3838       8.8889  
    a81=8.0808       6.9697        7.0707        7.0707        7.1717        7.2727        7.4747        7.5758       7.8788       8.1818       8.4848       8.9899  
    a82=8.1818       7.0707        7.1717        7.1717        7.2727        7.3737        7.5758        7.6768       7.9798       8.2828       8.5859       8.9899  
    a83=8.2828       7.1717        7.2727        7.2727        7.3737        7.4747        7.6768        7.7778       8.0808       8.3838       8.6869       9.0909  
    a84=8.3838       7.2727        7.2727        7.3737        7.4747        7.5758        7.6768        7.8788       8.1818       8.4848       8.7879       9.1919  
    a85=8.4848       7.3737        7.3737        7.4747        7.5758        7.6768        7.7778        7.9798       8.2828       8.4848       8.8889       9.2929  
    a86=8.5859       7.4747        7.4747        7.5758        7.6768        7.7778        7.8788        8.0808       8.3838       8.5859       8.9899       9.3939  
    a87=8.6869       7.5758        7.5758        7.6768        7.7778        7.8788        7.9798        8.1818       8.3838       8.6869       9.0909       9.4949  
    a88=8.7879       7.6768        7.6768        7.7778        7.8788        7.9798        8.0808        8.2828       8.4848       8.7879       9.1919       9.4949  
    a89=8.8889       7.7778        7.7778        7.8788        7.9798        8.0808        8.1818        8.3838       8.5859       8.8889       9.2929        9.596  
    a90=8.9899       7.8788        7.8788        7.9798        8.0808        8.1818        8.2828        8.4848       8.6869       8.9899       9.3939        9.697  
    a91=9.0909       7.9798        7.9798        8.0808        8.1818        8.2828        8.3838        8.5859       8.7879       9.0909       9.4949        9.798  
    a92=9.1919       7.9798        8.0808        8.1818        8.2828        8.3838        8.4848        8.6869       8.8889       9.1919       9.4949        9.798  
    a93=9.2929       8.0808        8.1818        8.2828        8.2828        8.4848        8.5859        8.7879       8.9899       9.2929        9.596        9.899  
    a94=9.3939       8.1818        8.2828        8.3838        8.3838        8.5859        8.6869        8.8889       9.0909       9.3939        9.697           10  
    a95=9.4949       8.2828        8.3838        8.4848        8.4848        8.5859        8.7879        8.9899       9.1919       9.4949        9.798           10  
    a96=9.596        8.3838        8.4848        8.4848        8.5859        8.6869        8.8889        9.0909       9.2929        9.596        9.899           10  
    a97=9.697        8.4848        8.5859        8.5859        8.6869        8.7879        8.9899        9.1919       9.3939        9.697        9.899           10  
    a98=9.798        8.5859        8.6869        8.6869        8.7879        8.8889        9.0909        9.2929       9.4949        9.798           10           10  
    a99=9.899        8.6869        8.7879        8.7879        8.8889        8.9899        9.1919        9.3939        9.596        9.899           10           10  
    a100=10          8.7879        8.8889        8.8889        8.9899        9.0909        9.2929        9.4949        9.697        9.899           10           10  

</pre><img vspace="5" hspace="5" src="ff_az_vf_01.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_02.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_03.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_04.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_05.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_06.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_07.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 11
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository> 
% Table of Content.*

function result_map = ff_az_vf(varargin)
%% FF_AZ_VF solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic single asset and single
% shock problem with loops. It is useful to have a version of code that is
% looped for easy debugging. This is the standard dynamic exogenous
% incomplete borrowing and savings problem. 
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables. 
%
% keys included in result_map:
%
% * mt_val matrix states_n by shock_n matrix of converged value function grid
% * mt_pol_a matrix states_n by shock_n matrix of converged policy function grid
% * ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function
% difference between iteration
% * ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy
% function difference between iterations
% * mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the
% proportion of grid points at which policy function changed between
% current and last iteration for each element of shock
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m ffs_az_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_get_funcgrid.m ffs_az_get_funcgrid>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post.m ff_az_vf_post>
%


%% Default
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_az_set_default_param(it_param_set);
[armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_a', 'mt_z_trans', 'ar_z'});
[ar_a, mt_z_trans, ar_z] = params_group{:};
% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_cons'});
[f_util_log, f_util_crra, f_cons] = params_group{:};
% param_map
params_group = values(param_map, {'fl_r_save', 'fl_r_borr', 'fl_w',...
    'it_a_n', 'it_z_n', 'fl_crra', 'fl_beta', 'fl_c_min'});
[fl_r_save, fl_r_borr, fl_wage, it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};
% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_time', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes

mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;
    
    %% Solve Optimization Problem Current Iteration
    
    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)
        fl_z = ar_z(it_z_i);
        
        % loop 2: over endogenous states
        for it_a_j = 1:length(ar_a)
            fl_a = ar_a(it_a_j);
            ar_val_cur = zeros(size(ar_a));
            
            % loop 3: over choices
            for it_ap_k = 1:length(ar_a)
                fl_ap = ar_a(it_ap_k);
                fl_c = f_cons(fl_z, fl_a, fl_ap);
%                 fl_c = fl_z*fl_wage + fl_a.*((1+fl_r_save).*(b>0) + (1+fl_r_borr).*(b<=0)) - fl_ap;
                
                % current utility
                if (fl_crra == 1)
                    ar_val_cur(it_ap_k) = f_util_log(fl_c);
                    fl_u_neg_c = f_util_log(fl_c_min);
                else
                    ar_val_cur(it_ap_k) = f_util_crra(fl_c);
                    fl_u_neg_c = f_util_crra(fl_c_min);
                end
                
                % loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
                for y = 1:length(ar_z)
                    ar_val_cur(it_ap_k) = ar_val_cur(it_ap_k) + fl_beta*mt_z_trans(it_z_i,y)*mt_val_cur(it_ap_k,y);
                end
                
                % Replace if negative consumption
                if fl_c <= 0
                    ar_val_cur(it_ap_k) = fl_u_neg_c;
                end
                
            end
            
            % maximization over loop 3 choices for loop 1+2 states
            it_max_lin_idx = find(ar_val_cur == max(ar_val_cur));
            mt_val(it_a_j,it_z_i) = ar_val_cur(it_max_lin_idx(1));
            mt_pol_a(it_a_j,it_z_i) = ar_a(it_max_lin_idx(1));
            
        end
    end
    
    %% Check Tolerance and Continuation
    
    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);
    
    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    
    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); ...
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'Hval', 'Hpol'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('Hval = mt_val_cur(it_a_n,:), highest a state val')
        disp('mval = mt_pol_a_cur(it_a_n,:), highest a state choice')
        disp(tb_valpol_iter);
    end
    
    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;        
    end
    
end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_a') = mt_pol_a;

if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end

##### SOURCE END #####
--></body></html>