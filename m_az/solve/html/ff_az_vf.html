
<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
   <!--
This HTML was auto-generated from MATLAB code.
To make changes, update the MATLAB code and republish this document.
      --><title>ff_az_vf</title><meta name="generator" content="MATLAB 9.6"><link rel="schema.DC" href="http://purl.org/dc/elements/1.1/"><meta name="DC.date" content="2019-05-28"><meta name="DC.source" content="ff_az_vf.m"><style type="text/css">
html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,font,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td{margin:0;padding:0;border:0;outline:0;font-size:100%;vertical-align:baseline;background:transparent}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}:focus{outine:0}ins{text-decoration:none}del{text-decoration:line-through}table{border-collapse:collapse;border-spacing:0}

html { min-height:100%; margin-bottom:1px; }
html body { height:100%; margin:0px; font-family:Arial, Helvetica, sans-serif; font-size:10px; color:#000; line-height:140%; background:#fff none; overflow-y:scroll; }
html body td { vertical-align:top; text-align:left; }

h1 { padding:0px; margin:0px 0px 25px; font-family:Arial, Helvetica, sans-serif; font-size:1.5em; color:#d55000; line-height:100%; font-weight:normal; }
h2 { padding:0px; margin:0px 0px 8px; font-family:Arial, Helvetica, sans-serif; font-size:1.2em; color:#000; font-weight:bold; line-height:140%; border-bottom:1px solid #d6d4d4; display:block; }
h3 { padding:0px; margin:0px 0px 5px; font-family:Arial, Helvetica, sans-serif; font-size:1.1em; color:#000; font-weight:bold; line-height:140%; }

a { color:#005fce; text-decoration:none; }
a:hover { color:#005fce; text-decoration:underline; }
a:visited { color:#004aa0; text-decoration:none; }

p { padding:0px; margin:0px 0px 20px; }
img { padding:0px; margin:0px 0px 20px; border:none; }
p img, pre img, tt img, li img, h1 img, h2 img { margin-bottom:0px; } 

ul { padding:0px; margin:0px 0px 20px 23px; list-style:square; }
ul li { padding:0px; margin:0px 0px 7px 0px; }
ul li ul { padding:5px 0px 0px; margin:0px 0px 7px 23px; }
ul li ol li { list-style:decimal; }
ol { padding:0px; margin:0px 0px 20px 0px; list-style:decimal; }
ol li { padding:0px; margin:0px 0px 7px 23px; list-style-type:decimal; }
ol li ol { padding:5px 0px 0px; margin:0px 0px 7px 0px; }
ol li ol li { list-style-type:lower-alpha; }
ol li ul { padding-top:7px; }
ol li ul li { list-style:square; }

.content { font-size:1.2em; line-height:140%; padding: 20px; }

pre, code { font-size:12px; }
tt { font-size: 1.2em; }
pre { margin:0px 0px 20px; }
pre.codeinput { padding:10px; border:1px solid #d3d3d3; background:#f7f7f7; }
pre.codeoutput { padding:10px 11px; margin:0px 0px 20px; color:#4c4c4c; }
pre.error { color:red; }

@media print { pre.codeinput, pre.codeoutput { word-wrap:break-word; width:100%; } }

span.keyword { color:#0000FF }
span.comment { color:#228B22 }
span.string { color:#A020F0 }
span.untermstring { color:#B20000 }
span.syscmd { color:#B28C00 }

.footer { width:auto; padding:10px 0px; margin:25px 0px 0px; border-top:1px dotted #878787; font-size:0.8em; line-height:140%; font-style:italic; color:#878787; text-align:left; float:none; }
.footer p { margin:0px; }
.footer a { color:#878787; }
.footer a:hover { color:#878787; text-decoration:underline; }
.footer a:visited { color:#878787; }

table th { padding:7px 5px; text-align:left; vertical-align:middle; border: 1px solid #d6d4d4; font-weight:bold; }
table td { padding:7px 5px; text-align:left; vertical-align:top; border:1px solid #d6d4d4; }





  </style></head><body><div class="content"><h2>Contents</h2><div><ul><li><a href="#2">FF_AZ_VF solve infinite horizon exo shock + endo asset problem</a></li><li><a href="#3">Default</a></li><li><a href="#4">Parse Parameters 1</a></li><li><a href="#5">Parse Parameters 2</a></li><li><a href="#6">Initialize Output Matrixes</a></li><li><a href="#7">Initialize Convergence Conditions</a></li><li><a href="#8">Iterate Value Function</a></li><li><a href="#10">Solve Optimization Problem Current Iteration</a></li><li><a href="#11">Check Tolerance and Continuation</a></li><li><a href="#13">Process Optimal Choices</a></li></ul></div><p><b>back to <a href="https://fanwangecon.github.io">Fan</a>'s <a href="https://fanwangecon.github.io/CodeDynaAsset/">Dynamic Assets Repository</a> Table of Content.</b></p><pre class="codeinput"><span class="keyword">function</span> result_map = ff_az_vf(varargin)
</pre><h2 id="2">FF_AZ_VF solve infinite horizon exo shock + endo asset problem</h2><p>This program solves the infinite horizon dynamic single asset and single shock problem with loops. It is useful to have a version of code that is looped for easy debugging. This is the standard dynamic exogenous incomplete borrowing and savings problem.</p><p>@param param_map container parameter container</p><p>@param support_map container support container</p><p>@param armt_map container container with states, choices and shocks grids that are inputs for grid based solution algorithm</p><p>@param func_map container container with function handles for consumption cash-on-hand etc.</p><p>@return result_map container contains policy function matrix, value function matrix, iteration results, and policy function, value function and iteration results tables.</p><p>keys included in result_map:</p><div><ul><li>mt_val matrix states_n by shock_n matrix of converged value function grid</li><li>mt_pol_a matrix states_n by shock_n matrix of converged policy function grid</li><li>ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function difference between iteration</li><li>ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy function difference between iterations</li><li>mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the proportion of grid points at which policy function changed between current and last iteration for each element of shock</li></ul></div><p>@example</p><p>@include</p><div><ul><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m">ffs_az_set_default_param</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_get_funcgrid.m">ffs_az_get_funcgrid</a></li><li><a href="https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post.m">ff_az_vf_post</a></li></ul></div><h2 id="3">Default</h2><div><ul><li>it_param_set = 1: quick test</li><li>it_param_set = 2: benchmark run</li><li>it_param_set = 3: benchmark profile</li><li>it_param_set = 4: press publish button</li></ul></div><pre class="codeinput">it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_az_set_default_param(it_param_set);
[armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override); <span class="comment">% 1 for override</span>
default_params = {param_map support_map armt_map func_map};
</pre><h2 id="4">Parse Parameters 1</h2><pre class="codeinput"><span class="comment">% if varargin only has param_map and support_map,</span>
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
<span class="keyword">if</span> params_len &gt;= 1 &amp;&amp; params_len &lt;= 2
    <span class="comment">% If override param_map, re-generate armt and func if they are not</span>
    <span class="comment">% provided</span>
    bl_input_override = true;
    [armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override);
<span class="keyword">else</span>
    <span class="comment">% Override all</span>
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
<span class="keyword">end</span>

<span class="comment">% append function name</span>
st_func_name = <span class="string">'ff_az_vf'</span>;
support_map(<span class="string">'st_profile_name_main'</span>) = [st_func_name support_map(<span class="string">'st_profile_name_main'</span>)];
support_map(<span class="string">'st_mat_name_main'</span>) = [st_func_name support_map(<span class="string">'st_mat_name_main'</span>)];
support_map(<span class="string">'st_img_name_main'</span>) = [st_func_name support_map(<span class="string">'st_img_name_main'</span>)];
</pre><h2 id="5">Parse Parameters 2</h2><pre class="codeinput"><span class="comment">% armt_map</span>
params_group = values(armt_map, {<span class="string">'ar_a'</span>, <span class="string">'mt_z_trans'</span>, <span class="string">'ar_z'</span>});
[ar_a, mt_z_trans, ar_z] = params_group{:};
<span class="comment">% func_map</span>
params_group = values(func_map, {<span class="string">'f_util_log'</span>, <span class="string">'f_util_crra'</span>, <span class="string">'f_cons'</span>});
[f_util_log, f_util_crra, f_cons] = params_group{:};
<span class="comment">% param_map</span>
params_group = values(param_map, {<span class="string">'fl_r_save'</span>, <span class="string">'fl_r_borr'</span>, <span class="string">'fl_w'</span>,<span class="keyword">...</span>
    <span class="string">'it_a_n'</span>, <span class="string">'it_z_n'</span>, <span class="string">'fl_crra'</span>, <span class="string">'fl_beta'</span>, <span class="string">'fl_c_min'</span>});
[fl_r_save, fl_r_borr, fl_wage, it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min] = params_group{:};
params_group = values(param_map, {<span class="string">'it_maxiter_val'</span>, <span class="string">'fl_tol_val'</span>, <span class="string">'fl_tol_pol'</span>, <span class="string">'it_tol_pol_nochange'</span>});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};
<span class="comment">% support_map</span>
params_group = values(support_map, {<span class="string">'bl_profile'</span>, <span class="string">'st_profile_path'</span>, <span class="keyword">...</span>
    <span class="string">'st_profile_prefix'</span>, <span class="string">'st_profile_name_main'</span>, <span class="string">'st_profile_suffix'</span>,<span class="keyword">...</span>
    <span class="string">'bl_time'</span>, <span class="string">'bl_display'</span>, <span class="string">'it_display_every'</span>, <span class="string">'bl_post'</span>});
[bl_profile, st_profile_path, <span class="keyword">...</span>
    st_profile_prefix, st_profile_name_main, st_profile_suffix, <span class="keyword">...</span>
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};
</pre><h2 id="6">Initialize Output Matrixes</h2><pre class="codeinput">mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;
</pre><h2 id="7">Initialize Convergence Conditions</h2><pre class="codeinput">bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);
</pre><h2 id="8">Iterate Value Function</h2><p>Loop solution with 4 nested loops</p><div><ol><li>loop 1: over exogenous states</li><li>loop 2: over endogenous states</li><li>loop 3: over choices</li><li>loop 4: add future utility, integration--loop over future shocks</li></ol></div><pre class="codeinput"><span class="comment">% Start Profile</span>
<span class="keyword">if</span> (bl_profile)
    close <span class="string">all</span>;
    profile <span class="string">off</span>;
    profile <span class="string">on</span>;
<span class="keyword">end</span>

<span class="comment">% Start Timer</span>
<span class="keyword">if</span> (bl_time)
    tic;
<span class="keyword">end</span>

<span class="comment">% Value Function Iteration</span>
<span class="keyword">while</span> bl_vfi_continue
</pre><pre class="codeinput">    it_iter = it_iter + 1;
</pre><h2 id="10">Solve Optimization Problem Current Iteration</h2><pre class="codeinput">    <span class="comment">% loop 1: over exogenous states</span>
    <span class="keyword">for</span> it_z_i = 1:length(ar_z)
        fl_z = ar_z(it_z_i);

        <span class="comment">% loop 2: over endogenous states</span>
        <span class="keyword">for</span> it_a_j = 1:length(ar_a)
            fl_a = ar_a(it_a_j);
            ar_val_cur = zeros(size(ar_a));

            <span class="comment">% loop 3: over choices</span>
            <span class="keyword">for</span> it_ap_k = 1:length(ar_a)
                fl_ap = ar_a(it_ap_k);
                fl_c = f_cons(fl_z, fl_a, fl_ap);
<span class="comment">%                 fl_c = fl_z*fl_wage + fl_a.*((1+fl_r_save).*(b&gt;0) + (1+fl_r_borr).*(b&lt;=0)) - fl_ap;</span>

                <span class="comment">% current utility</span>
                <span class="keyword">if</span> (fl_crra == 1)
                    ar_val_cur(it_ap_k) = f_util_log(fl_c);
                    fl_u_neg_c = f_util_log(fl_c_min);
                <span class="keyword">else</span>
                    ar_val_cur(it_ap_k) = f_util_crra(fl_c);
                    fl_u_neg_c = f_util_crra(fl_c_min);
                <span class="keyword">end</span>

                <span class="comment">% loop 4: add future utility, integration--loop over future shocks</span>
                <span class="keyword">for</span> it_ap_q = 1:length(ar_z)
                    ar_val_cur(it_ap_k) = ar_val_cur(it_ap_k) + fl_beta*mt_z_trans(it_z_i,it_ap_q)*mt_val_cur(it_ap_k,it_ap_q);
                <span class="keyword">end</span>

                <span class="comment">% Replace if negative consumption</span>
                <span class="keyword">if</span> fl_c &lt;= 0
                    ar_val_cur(it_ap_k) = fl_u_neg_c;
                <span class="keyword">end</span>

            <span class="keyword">end</span>

            <span class="comment">% maximization over loop 3 choices for loop 1+2 states</span>
            it_max_lin_idx = find(ar_val_cur == max(ar_val_cur));
            mt_val(it_a_j,it_z_i) = ar_val_cur(it_max_lin_idx(1));
            mt_pol_a(it_a_j,it_z_i) = ar_a(it_max_lin_idx(1));

        <span class="keyword">end</span>
    <span class="keyword">end</span>
</pre><h2 id="11">Check Tolerance and Continuation</h2><pre class="codeinput">    <span class="comment">% Difference across iterations</span>
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);

    <span class="comment">% Update</span>
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;

    <span class="comment">% Print Iteration Results</span>
    <span class="keyword">if</span> (bl_display &amp;&amp; (rem(it_iter, it_display_every)==0))
        fprintf(<span class="string">'VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n'</span>, <span class="keyword">...</span>
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); <span class="keyword">...</span>
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat(<span class="string">'z'</span>, string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {<span class="string">'mval'</span>, <span class="string">'map'</span>, <span class="string">'Hval'</span>, <span class="string">'Hpol'</span>};
        disp(<span class="string">'mval = mean(mt_val_cur,1), average value over a'</span>)
        disp(<span class="string">'map  = mean(mt_pol_a_cur,1), average choice over a'</span>)
        disp(<span class="string">'Hval = mt_val_cur(it_a_n,:), highest a state val'</span>)
        disp(<span class="string">'mval = mt_pol_a_cur(it_a_n,:), highest a state choice'</span>)
        disp(tb_valpol_iter);
    <span class="keyword">end</span>

    <span class="comment">% Continuation Conditions:</span>
    <span class="comment">% 1. if value function convergence criteria reached</span>
    <span class="comment">% 2. if policy function variation over iterations is less than</span>
    <span class="comment">% threshold</span>
    <span class="keyword">if</span> (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    <span class="keyword">elseif</span> ((it_iter == it_maxiter_val) || <span class="keyword">...</span>
            (ar_val_diff_norm(it_iter) &lt; fl_tol_val) || <span class="keyword">...</span>
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) &lt; fl_tol_pol))
        <span class="comment">% Fix to max, run again to save results if needed</span>
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;
    <span class="keyword">end</span>
</pre><pre class="codeoutput">VAL it_iter:5, fl_diff:2.301261e+01, fl_diff_pol:4.838439e+01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    4.5847    4.6504    4.7231       4.8    4.8806    4.9651    5.0543     5.148    5.2449    5.3452    5.4441
    map     19.778    19.798    19.798    19.798    19.798    19.818    19.975    20.182    20.212     20.46    20.732
    Hval    6.2453    6.2547     6.266    6.2789    6.2936    6.3103    6.3292    6.3506    6.3749    6.4019    6.4303
    Hpol    39.899    39.899    39.899    39.899    39.899    39.899    39.899    39.899    40.404    40.404    40.909

</pre><pre class="codeoutput">VAL it_iter:10, fl_diff:1.186821e+01, fl_diff_pol:1.052713e+01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    6.4119    6.5355    6.6731    6.8192    6.9725    7.1332     7.302    7.4791    7.6636    7.8542    8.0423
    map      22.01     22.04    22.071    22.126    22.212    22.293    22.444    22.641    22.848    23.136     23.53
    Hval    9.3734    9.4018    9.4349     9.472     9.513    9.5586    9.6092    9.6648    9.7259    9.7922    9.8608
    Hpol    44.444    44.444    44.444    44.444    44.444    44.949    44.949    44.949    45.455    45.455     45.96

</pre><pre class="codeoutput">VAL it_iter:15, fl_diff:6.677448e+00, fl_diff_pol:4.467680e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    7.4064    7.5584    7.7284    7.9095    8.1003    8.3015    8.5138    8.7373    8.9723    9.2163    9.4586
    map     22.672    22.712    22.768    22.838    22.929    23.061    23.217    23.419    23.697    24.025    24.465
    Hval    11.142    11.185    11.236    11.292    11.354    11.422    11.497    11.579    11.669    11.766    11.866
    Hpol     45.96     45.96     45.96     45.96     45.96    46.465    46.465    46.465     46.97    47.475    47.475

</pre><pre class="codeoutput">VAL it_iter:20, fl_diff:3.910097e+00, fl_diff_pol:2.890385e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    7.9945    8.1599    8.3454    8.5436    8.7532    8.9749      9.21    9.4585    9.7213    9.9955    10.269
    map      22.96    23.005    23.071    23.146    23.247    23.384    23.571    23.773    24.081    24.429    24.884
    Hval    12.182    12.236    12.298    12.367    12.444    12.527    12.618    12.719    12.828    12.948     13.07
    Hpol    46.465    46.465    46.465     46.97     46.97     46.97     46.97    47.475    47.475     47.98    48.485

</pre><pre class="codeoutput">VAL it_iter:25, fl_diff:2.348021e+00, fl_diff_pol:1.580730e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.3548    8.5268    8.7199    8.9268     9.146    9.3785    9.6256    9.8876    10.166    10.457    10.749
    map     23.096    23.152    23.217    23.303    23.414    23.551    23.737    23.965    24.268    24.636    25.106
    Hval    12.804    12.865    12.935    13.012    13.097    13.192    13.294    13.407    13.531    13.665    13.802
    Hpol     46.97     46.97     46.97     46.97    47.475    47.475    47.475     47.98     47.98    48.485     48.99

</pre><pre class="codeoutput">VAL it_iter:30, fl_diff:1.442168e+00, fl_diff_pol:1.148375e+00
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.5815    8.7568    8.9538    9.1651    9.3892    9.6274    9.8809     10.15    10.437    10.737    11.039
    map     23.172    23.227    23.303    23.384    23.485    23.646    23.838    24.056    24.374    24.758    25.237
    Hval    13.178    13.243    13.318    13.402    13.493    13.593    13.703    13.825    13.957      14.1    14.248
    Hpol     46.97     46.97    47.475    47.475    47.475    47.475     47.98     47.98    48.485    48.485     48.99

</pre><pre class="codeoutput">VAL it_iter:35, fl_diff:9.088178e-01, fl_diff_pol:9.332116e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval     8.728     8.905    9.1039    9.3174    9.5441    9.7852    10.042    10.315    10.606    10.912    11.219
    map     23.217    23.268    23.333    23.424    23.535    23.707    23.884    24.116    24.429    24.808    25.298
    Hval    13.404    13.472     13.55    13.637    13.732    13.836    13.952    14.078    14.217    14.367    14.522
    Hpol    47.475    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:40, fl_diff:5.914508e-01, fl_diff_pol:7.142493e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.8255    9.0032    9.2031    9.4177    9.6456    9.8882    10.147    10.422    10.715    11.023    11.333
    map     23.232    23.288    23.348    23.444    23.566    23.717    23.904    24.152     24.46    24.843    25.333
    Hval    13.542    13.611    13.691     13.78    13.877    13.985    14.103    14.232    14.375     14.53    14.689
    Hpol    47.475    47.475    47.475    47.475    47.475     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:45, fl_diff:3.989941e-01, fl_diff_pol:5.050505e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.8923    9.0704    9.2708    9.4858    9.7144    9.9576    10.217    10.493    10.787    11.096    11.408
    map     23.237    23.293    23.359    23.455    23.581    23.722    23.919    24.157    24.485    24.864    25.343
    Hval    13.627    13.697    13.778    13.868    13.966    14.076    14.196    14.327    14.472    14.629    14.791
    Hpol    47.475    47.475    47.475    47.475    47.475     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:50, fl_diff:2.777599e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.9393    9.1175    9.3181    9.5334    9.7621    10.006    10.265    10.542    10.836    11.146    11.459
    map     23.237    23.293    23.364     23.46    23.586    23.732    23.924    24.162     24.49    24.869    25.354
    Hval    13.682    13.752    13.834    13.924    14.023    14.134    14.254    14.387    14.532    14.691    14.854
    Hpol    47.475    47.475    47.475    47.475    47.475     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:55, fl_diff:1.976124e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.9729    9.1512    9.3518    9.5672    9.7961     10.04    10.299    10.576    10.871    11.181    11.494
    map     23.237    23.293    23.369     23.46    23.591    23.732    23.929    24.162    24.495    24.874    25.359
    Hval    13.719    13.789    13.871    13.961    14.061    14.172    14.293    14.426    14.572    14.731    14.895
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:60, fl_diff:1.424389e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    8.9972    9.1756    9.3762    9.5916    9.8206    10.064    10.324    10.601    10.896    11.206    11.519
    map     23.237    23.293    23.369     23.46    23.591    23.732    23.929    24.162    24.495    24.874    25.359
    Hval    13.744    13.815    13.897    13.987    14.087    14.198    14.319    14.452    14.598    14.758    14.922
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:65, fl_diff:1.034512e-01, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0149    9.1932    9.3939    9.6093    9.8383    10.082    10.342    10.619    10.914    11.224    11.537
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.929    24.162    24.495    24.874    25.359
    Hval    13.763    13.833    13.915    14.006    14.105    14.217    14.338    14.471    14.617    14.777    14.941
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:70, fl_diff:7.546552e-02, fl_diff_pol:5.050505e-01
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0278    9.2062    9.4068    9.6223    9.8512    10.095    10.355    10.631    10.927    11.237     11.55
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.776    13.846    13.928    14.019    14.119     14.23    14.351    14.484    14.631     14.79    14.954
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:75, fl_diff:5.519085e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0373    9.2156    9.4163    9.6317    9.8607    10.104    10.364    10.641    10.936    11.246    11.559
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.785    13.856    13.938    14.028    14.128    14.239    14.361    14.494     14.64      14.8    14.964
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:80, fl_diff:4.042284e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0442    9.2225    9.4232    9.6386    9.8676    10.111    10.371    10.648    10.943    11.253    11.566
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.792    13.863    13.945    14.035    14.135    14.246    14.367    14.501    14.647    14.807    14.971
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:85, fl_diff:2.963175e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0493    9.2276    9.4283    9.6437    9.8727    10.116    10.376    10.653    10.948    11.259    11.571
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.797    13.868     13.95    14.041     14.14    14.251    14.373    14.506    14.652    14.812    14.976
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:90, fl_diff:2.173212e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval     9.053    9.2313     9.432    9.6474    9.8764     10.12     10.38    10.657    10.952    11.262    11.575
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.801    13.872    13.954    14.044    14.144    14.255    14.376     14.51    14.656    14.815     14.98
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeoutput">VAL it_iter:95, fl_diff:1.594305e-02, fl_diff_pol:0
mval = mean(mt_val_cur,1), average value over a
map  = mean(mt_pol_a_cur,1), average choice over a
Hval = mt_val_cur(it_a_n,:), highest a state val
mval = mt_pol_a_cur(it_a_n,:), highest a state choice
              z1        z2        z3        z4        z5        z6        z7        z8        z9       z10       z11  
            ______    ______    ______    ______    ______    ______    ______    ______    ______    ______    ______

    mval    9.0557    9.2341    9.4347    9.6502    9.8791    10.123    10.383    10.659    10.955    11.265    11.578
    map     23.242    23.298    23.369     23.46    23.591    23.732    23.934    24.162      24.5    24.874    25.359
    Hval    13.804    13.874    13.956    14.047    14.147    14.258    14.379    14.513    14.659    14.818    14.983
    Hpol    47.475    47.475    47.475    47.475     47.98     47.98     47.98    48.485    48.485     48.99    49.495

</pre><pre class="codeinput"><span class="keyword">end</span>

<span class="comment">% End Timer</span>
<span class="keyword">if</span> (bl_time)
    toc;
<span class="keyword">end</span>

<span class="comment">% End Profile</span>
<span class="keyword">if</span> (bl_profile)
    profile <span class="string">off</span>
    profile <span class="string">viewer</span>
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile(<span class="string">'info'</span>), strcat(st_profile_path, st_file_name));
<span class="keyword">end</span>
</pre><pre class="codeoutput">Elapsed time is 23.432028 seconds.
</pre><h2 id="13">Process Optimal Choices</h2><pre class="codeinput">result_map = containers.Map(<span class="string">'KeyType'</span>,<span class="string">'char'</span>, <span class="string">'ValueType'</span>,<span class="string">'any'</span>);
result_map(<span class="string">'mt_val'</span>) = mt_val;
result_map(<span class="string">'mt_pol_a'</span>) = mt_pol_a;

<span class="keyword">if</span> (bl_post)
    bl_input_override = true;
    result_map(<span class="string">'ar_val_diff_norm'</span>) = ar_val_diff_norm(1:it_iter_last);
    result_map(<span class="string">'ar_pol_diff_norm'</span>) = ar_pol_diff_norm(1:it_iter_last);
    result_map(<span class="string">'mt_pol_perc_change'</span>) = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
<span class="keyword">end</span>
</pre><pre class="codeoutput">Warning: Directory already exists. 
valgap = norm(mt_val - mt_val_cur)
polgap = norm(mt_pol_a - mt_pol_a_cur)
z1 = z1 perc change: sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n)
                valgap     polgap      z1      z2      z3      z4      z5      z6      z7      z8      z9     z10     z11 
               ________    _______    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____    ____

    iter=1       51.122     33.166       1       1       1       1       1       1       1       1       1       1       1
    iter=2       38.823      479.5    0.98    0.98    0.98    0.98    0.98    0.99    0.99    0.99    0.99    0.99       1
    iter=3       31.868     160.34    0.96    0.96    0.96    0.96    0.96    0.96    0.97    0.97    0.97    0.99    0.98
    iter=4       26.872     80.459    0.93    0.93    0.93    0.93    0.93    0.94    0.93    0.94    0.94    0.96    0.97
    iter=5       23.013     48.384    0.89    0.89    0.89    0.89    0.89    0.91    0.89     0.9    0.92    0.92    0.94
    iter=6       19.913     31.826     0.8    0.83    0.84    0.84    0.84    0.84    0.85    0.85     0.9    0.87    0.89
    iter=7       17.363     22.766    0.73    0.73    0.74    0.78    0.78    0.78    0.79    0.79    0.82    0.82    0.84
    iter=8       15.228     16.854    0.66    0.66    0.67    0.67    0.71    0.72     0.7    0.71    0.76    0.75    0.77
    iter=9       13.418     13.148    0.58    0.58    0.57    0.58     0.6    0.63    0.64    0.62    0.65    0.66     0.7
    iter=10      11.868     10.527    0.49    0.49    0.49    0.48     0.5    0.53    0.52    0.52    0.58    0.58    0.59
    iter=11       10.53     8.5855    0.38    0.39    0.39    0.39    0.39    0.44    0.42    0.43    0.49    0.49    0.51
    iter=12      9.3676     7.3154    0.32    0.33    0.34    0.34    0.33    0.34    0.38    0.37    0.36    0.39    0.42
    iter=13      8.3523     5.9399    0.23    0.24    0.25    0.27    0.27    0.29     0.3    0.29    0.32    0.35    0.34
    iter=14      7.4619     5.0563    0.22    0.22    0.23    0.22    0.23    0.24    0.25    0.24    0.29    0.26    0.29
    iter=15      6.6774     4.4677    0.16    0.15    0.17    0.19     0.2    0.21    0.18    0.21    0.22    0.27    0.29
    iter=16       5.985      3.871    0.15    0.16    0.15    0.16    0.15    0.16    0.18    0.18    0.19    0.19    0.21
    iter=17      5.3715     3.6463    0.15    0.13    0.14    0.13    0.15    0.16    0.16    0.16    0.18     0.2    0.17
    iter=18      4.8266     3.0761    0.09    0.11    0.11    0.11    0.13    0.14    0.13    0.15    0.14    0.15    0.19
    iter=19      4.3421     2.8503    0.09    0.09     0.1    0.12    0.12    0.09    0.12    0.11    0.12    0.14    0.13
    iter=20      3.9101     2.8904    0.09    0.09     0.1    0.09    0.08    0.09    0.11     0.1    0.13    0.12    0.13
    iter=21      3.5249      2.535    0.08    0.09    0.07    0.07    0.09     0.1     0.1    0.09     0.1    0.12    0.11
    iter=22      3.1803     2.3416    0.07    0.06    0.06    0.06    0.06    0.08    0.06    0.09    0.08     0.1    0.12
    iter=23       2.872     1.8127    0.05    0.05    0.05    0.08    0.06    0.07    0.06    0.07    0.06    0.07    0.07
    iter=24      2.5957     1.7707    0.03    0.04    0.05    0.05    0.08    0.05    0.06    0.08    0.07    0.06    0.09
    iter=25       2.348     1.5807    0.04    0.05    0.06    0.05    0.04    0.03    0.05    0.05    0.06    0.06    0.05
    iter=26      2.1261     1.4792    0.03    0.03    0.04    0.06    0.04    0.05    0.05    0.04    0.07    0.05    0.06
    iter=27      1.9269     1.5708    0.05    0.03    0.03    0.04    0.03    0.05    0.06    0.04    0.06    0.05    0.06
    iter=28      1.7479     1.5287    0.02    0.04    0.04    0.02    0.02    0.03    0.05    0.04    0.04    0.06    0.05
    iter=29      1.5869     1.4007    0.02    0.03    0.03    0.02    0.04    0.03    0.02    0.03    0.02    0.04    0.05
    iter=30      1.4422     1.1484    0.03    0.02    0.03    0.02    0.01    0.03    0.02    0.03    0.02    0.04    0.04
    iter=31       1.312     1.2937    0.03    0.03    0.01    0.01    0.02    0.03    0.02    0.03    0.03    0.04    0.05
    iter=32      1.1949     1.0787    0.02    0.03    0.02    0.02    0.03    0.03    0.03    0.02    0.03    0.02    0.02
    iter=33      1.0894     1.0101    0.01       0       0    0.02    0.01    0.01    0.01    0.04    0.02    0.02    0.02
    iter=34     0.99438     1.0101    0.02    0.01    0.01    0.01    0.02    0.02    0.02    0.02    0.01    0.01    0.01
    iter=35     0.90882    0.93321    0.01    0.01    0.02    0.02    0.02    0.03    0.01    0.01    0.02    0.01    0.02
    iter=36     0.83168    0.81719    0.01    0.02    0.01    0.01    0.02       0       0    0.02    0.01    0.02    0.01
    iter=37     0.76211    0.71425    0.01    0.01       0    0.01    0.01    0.01    0.02    0.02    0.02       0    0.02
    iter=38     0.69935    0.81719    0.01       0    0.01       0       0       0    0.01    0.02    0.01    0.02    0.01
    iter=39     0.64267    0.71425       0       0    0.01    0.02    0.02    0.01    0.01    0.01    0.01    0.01    0.01
    iter=40     0.59145    0.71425       0    0.01       0       0    0.01       0       0       0    0.01    0.02    0.02
    iter=41     0.54511    0.71425       0       0    0.01    0.01       0    0.01    0.02       0    0.01       0       0
    iter=42     0.50314    0.71425    0.01       0       0       0    0.01       0       0    0.01    0.02    0.01    0.01
    iter=43     0.46507    0.50505       0       0       0       0       0       0       0       0       0    0.01       0
    iter=44     0.43047    0.71425       0    0.01    0.01    0.01    0.02       0    0.01       0    0.01    0.01    0.01
    iter=45     0.39899    0.50505       0       0       0       0       0       0       0       0    0.01    0.01       0
    iter=46     0.37029    0.71425       0       0    0.01       0       0    0.02       0       0       0       0    0.01
    iter=47     0.34406    0.50505       0       0       0       0    0.01       0    0.01    0.01    0.01       0    0.01
    iter=48     0.32004    0.50505       0       0       0    0.01       0       0       0       0       0    0.01       0
    iter=49     0.29801          0       0       0       0       0       0       0       0       0       0       0       0
    iter=50     0.27776          0       0       0       0       0       0       0       0       0       0       0       0
    iter=51     0.25911    0.50505       0       0       0       0       0       0       0       0    0.01       0    0.01
    iter=52      0.2419    0.50505       0       0       0       0    0.01       0       0       0       0       0       0
    iter=53     0.22599    0.50505       0       0    0.01       0       0       0       0       0       0       0       0
    iter=54     0.21127    0.50505       0       0       0       0       0       0    0.01       0       0    0.01       0
    iter=55     0.19761          0       0       0       0       0       0       0       0       0       0       0       0
    iter=56     0.18494          0       0       0       0       0       0       0       0       0       0       0       0
    iter=57     0.17315          0       0       0       0       0       0       0       0       0       0       0       0
    iter=58     0.16218          0       0       0       0       0       0       0       0       0       0       0       0
    iter=59     0.15197          0       0       0       0       0       0       0       0       0       0       0       0
    iter=60     0.14244          0       0       0       0       0       0       0       0       0       0       0       0
    iter=61     0.13355    0.50505    0.01       0       0       0       0       0       0       0       0       0       0
    iter=62     0.12525          0       0       0       0       0       0       0       0       0       0       0       0
    iter=63     0.11749    0.50505       0    0.01       0       0       0       0       0       0       0       0       0
    iter=64     0.11024          0       0       0       0       0       0       0       0       0       0       0       0
    iter=65     0.10345          0       0       0       0       0       0       0       0       0       0       0       0
    iter=66      0.0971          0       0       0       0       0       0       0       0       0       0       0       0
    iter=67    0.091152          0       0       0       0       0       0       0       0       0       0       0       0
    iter=68    0.085581    0.50505       0       0       0       0       0       0       0       0    0.01       0       0
    iter=69     0.08036          0       0       0       0       0       0       0       0       0       0       0       0
    iter=70    0.075466    0.50505       0       0       0       0       0       0    0.01       0       0       0       0
    iter=71    0.070877          0       0       0       0       0       0       0       0       0       0       0       0
    iter=72    0.066573          0       0       0       0       0       0       0       0       0       0       0       0
    iter=73    0.062535          0       0       0       0       0       0       0       0       0       0       0       0
    iter=74    0.058746          0       0       0       0       0       0       0       0       0       0       0       0
    iter=75    0.055191          0       0       0       0       0       0       0       0       0       0       0       0
    iter=76    0.051854          0       0       0       0       0       0       0       0       0       0       0       0
    iter=77    0.048721          0       0       0       0       0       0       0       0       0       0       0       0
    iter=78    0.045779          0       0       0       0       0       0       0       0       0       0       0       0
    iter=79    0.043017          0       0       0       0       0       0       0       0       0       0       0       0
    iter=80    0.040423          0       0       0       0       0       0       0       0       0       0       0       0
    iter=81    0.037987          0       0       0       0       0       0       0       0       0       0       0       0
    iter=82    0.035698          0       0       0       0       0       0       0       0       0       0       0       0
    iter=83    0.033548          0       0       0       0       0       0       0       0       0       0       0       0
    iter=84    0.031529          0       0       0       0       0       0       0       0       0       0       0       0
    iter=85    0.029632          0       0       0       0       0       0       0       0       0       0       0       0
    iter=86    0.027849          0       0       0       0       0       0       0       0       0       0       0       0
    iter=87    0.026174          0       0       0       0       0       0       0       0       0       0       0       0
    iter=88    0.024601          0       0       0       0       0       0       0       0       0       0       0       0
    iter=89    0.023122          0       0       0       0       0       0       0       0       0       0       0       0
    iter=90    0.021732          0       0       0       0       0       0       0       0       0       0       0       0
    iter=91    0.020426          0       0       0       0       0       0       0       0       0       0       0       0
    iter=92    0.019199          0       0       0       0       0       0       0       0       0       0       0       0
    iter=93    0.018046          0       0       0       0       0       0       0       0       0       0       0       0
    iter=94    0.016962          0       0       0       0       0       0       0       0       0       0       0       0
    iter=95    0.015943          0       0       0       0       0       0       0       0       0       0       0       0
    iter=96    0.014986          0       0       0       0       0       0       0       0       0       0       0       0

tb_val
                   z1_0_34664    z2_0_42338    z3_0_51712    z4_0_63162    z5_0_77146    z6_0_94226    z7_1_1509    z8_1_4057    z9_1_7169    z10_2_097    z11_2_5613
                   __________    __________    __________    __________    __________    __________    _________    _________    _________    _________    __________

    a1=0              -1.599      -0.69733      0.20538        1.0685        1.8843         2.655       3.3869       4.0896       4.8254       5.5395        6.2231  
    a2=0.505051     -0.63623      0.076534      0.82217        1.5561        2.2667        2.9858       3.6828       4.3583       5.0626       5.7485        6.4104  
    a3=1.0101        0.10495       0.70743       1.3497        1.9969        2.6409        3.3035       3.9679        4.617       5.2896       5.9504        6.5932  
    a4=1.51515       0.70717         1.239       1.8131        2.4007        2.9949        3.6036       4.2383       4.8634        5.508       6.1467        6.7717  
    a5=2.0202         1.2163        1.7008       2.2277        2.7716         3.326          3.89        4.496       5.0992       5.7197       6.3359        6.9468  
    a6=2.52525          1.66        2.1109       2.6033        3.1136         3.636        4.1704       4.7455       5.3278       5.9234       6.5232        7.1166  
    a7=3.0303         2.0552        2.4811       2.9471        3.4315         3.929        4.4397       4.9846       5.5473       6.1192       6.7042        7.2819  
    a8=3.53535        2.4206        2.8195       3.2649        3.7289        4.2061        4.6966       5.2131       5.7577       6.3082       6.8797        7.4434  
    a9=4.0404         2.7729        3.1409       3.5612        4.0083        4.4684         4.941       5.4313       5.9594       6.4918       7.0509         7.601  
    a10=4.54545        3.098        3.4498       3.8406        4.2719        4.7169        5.1735       5.6425       6.1546       6.6714       7.2183        7.7546  
    a11=5.05051        3.407        3.7414        4.116        4.5217         4.953        5.3956       5.8502       6.3451       6.8475       7.3817        7.9037  
    a12=5.55556       3.6987        4.0176       4.3768        4.7607        5.1788        5.6091       6.0515       6.5301       7.0211         7.54        8.0485  
    a13=6.06061       3.9778        4.2832       4.6275        4.9953        5.3953        5.8147       6.2463       6.7091       7.1891       7.6936        8.1895  
    a14=6.56566       4.2422        4.5354       4.8662        5.2212        5.6046        6.0131       6.4344       6.8823       7.3518       7.8427        8.3268  
    a15=7.07071       4.4963        4.7787       5.0974        5.4401        5.8066        6.2048       6.6162       7.0499       7.5094       7.9877        8.4611  
    a16=7.57576       4.7382         5.011       5.3191        5.6507        6.0021        6.3901        6.792       7.2123       7.6624       8.1289        8.5927  
    a17=8.08081       4.9716        5.2355       5.5336        5.8545        6.1955        6.5694       6.9623         7.37       7.8111        8.267        8.7219  
    a18=8.58586       5.1947        5.4508       5.7399        6.0511        6.3824        6.7441       7.1276       7.5236       7.9561       8.4029        8.8485  
    a19=9.09091       5.4106        5.6593       5.9402        6.2427        6.5649        6.9137       7.2884       7.6759       8.0988        8.536        8.9725  
    a20=9.59596       5.6177        5.8598       6.1332        6.4278        6.7416         7.079       7.4454       7.8252       8.2386       8.6664        9.0941  
    a21=10.101        5.8185        6.0545        6.321        6.6081        6.9139        7.2399       7.5987       7.9714       8.3754        8.794        9.2133  
    a22=10.6061       6.0118        6.2422       6.5025        6.7827         7.081        7.3975       7.7484       8.1142       8.5093        8.919        9.3303  
    a23=11.1111          6.2        6.4249       6.6792        6.9528         7.244        7.5531       7.8947       8.2539       8.6403       9.0416        9.4453  
    a24=11.6162        6.386        6.6014       6.8502        7.1179        7.4025        7.7049       8.0381       8.3906       8.7687       9.1619        9.5583  
    a25=12.1212       6.5655        6.7733       7.0169         7.279        7.5577        7.8538       8.1784       8.5246       8.8945         9.28        9.6696  
    a26=12.6263       6.7403        6.9433       7.1787        7.4356        7.7089        7.9992       8.3159       8.6558       9.0179        9.396        9.7793  
    a27=13.1313       6.9107        7.1087       7.3366        7.5887        7.8568        8.1415       8.4503       8.7844       9.1389       9.5102        9.8879  
    a28=13.6364       7.0762        7.2698       7.4905        7.7378         8.001        8.2806        8.582       8.9103       9.2578       9.6233        9.9951  
    a29=14.1414       7.2383        7.4273        7.643        7.8836        8.1422        8.4168       8.7109       9.0338       9.3743       9.7347          10.1  
    a30=14.6465       7.3963        7.5809       7.7921        8.0258          8.28        8.5498       8.8372       9.1548       9.4886       9.8439        10.204  
    a31=15.1515       7.5501        7.7306       7.9374        8.1653        8.4151        8.6802       8.9612       9.2733       9.6007       9.9511        10.305  
    a32=15.6566       7.7011        7.8777       8.0802        8.3016         8.547        8.8076       9.0839       9.3896        9.711       10.057        10.405  
    a33=16.1616       7.8485        8.0214       8.2196        8.4359        8.6762        8.9326       9.2043        9.504       9.8195        10.16        10.504  
    a34=16.6667       7.9922        8.1616        8.356        8.5683        8.8028        9.0551       9.3226       9.6165        9.927       10.263        10.602  
    a35=17.1717       8.1333        8.2993       8.4897        8.6979         8.927        9.1754       9.4388       9.7272       10.033       10.364        10.698  
    a36=17.6768       8.2713        8.4341       8.6208        8.8251        9.0489        9.2934        9.553        9.836       10.138       10.464        10.793  
    a37=18.1818       8.4061         8.566       8.7493          8.95        9.1685        9.4093       9.6651       9.9431       10.241       10.562        10.886  
    a38=18.6869       8.5384        8.6954       8.8754        9.0724         9.286        9.5232       9.7753       10.048       10.343       10.658        10.978  
    a39=19.1919        8.668        8.8223       8.9991        9.1926        9.4018         9.635       9.8837       10.152       10.442       10.753        11.068  
    a40=19.697         8.795        8.9466       9.1204        9.3106        9.5163        9.7448       9.9901       10.254       10.541       10.847        11.157  
    a41=20.202        8.9195        9.0686       9.2395        9.4264        9.6288        9.8529       10.095       10.354       10.637       10.939        11.245  
    a42=20.7071       9.0416        9.1883       9.3564        9.5403        9.7394        9.9593       10.198       10.453       10.732       11.029        11.331  
    a43=21.2121       9.1614        9.3059       9.4713        9.6523        9.8484        10.064       10.299        10.55       10.826       11.118        11.416  
    a44=21.7172       9.2789        9.4212       9.5841        9.7624        9.9554        10.167       10.399       10.645       10.918       11.206          11.5  
    a45=22.2222       9.3943        9.5345        9.695        9.8706        10.061        10.268       10.497        10.74       11.008       11.293        11.583  
    a46=22.7273       9.5076        9.6458        9.804        9.9771        10.164        10.368       10.593       10.833       11.098       11.378        11.664  
    a47=23.2323       9.6196        9.7551       9.9112        10.082        10.266        10.466       10.688       10.926       11.186       11.463        11.745  
    a48=23.7374         9.73        9.8626       10.017        10.185        10.367        10.563       10.782       11.016       11.273       11.546        11.825  
    a49=24.2424       9.8386        9.9683        10.12        10.286        10.466        10.659       10.875       11.106       11.359       11.628        11.903  
    a50=24.7475       9.9454        10.072       10.222        10.386        10.563        10.754       10.966       11.194       11.444        11.71        11.981  
    a51=25.2525        10.05        10.176       10.322        10.484        10.659        10.847       11.056       11.282       11.528        11.79        12.057  
    a52=25.7576       10.154        10.277       10.421        10.581        10.753        10.939       11.144       11.368        11.61       11.869        12.133  
    a53=26.2626       10.256        10.377       10.518        10.676        10.846         11.03       11.232       11.453       11.692       11.947        12.208  
    a54=26.7677       10.356        10.476       10.614         10.77        10.938        11.119       11.318       11.536       11.772       12.024        12.281  
    a55=27.2727       10.455        10.573       10.709        10.862        11.028        11.207       11.403       11.619       11.852         12.1        12.354  
    a56=27.7778       10.552        10.668       10.803        10.953        11.117        11.294       11.487         11.7        11.93       12.175        12.427  
    a57=28.2828       10.648        10.763       10.895        11.043        11.205         11.38        11.57       11.781       12.007        12.25        12.499  
    a58=28.7879       10.742        10.855       10.986        11.131        11.292        11.465       11.652        11.86       12.084       12.324         12.57  
    a59=29.2929       10.835        10.947       11.076        11.219        11.377        11.548       11.733       11.939       12.159       12.397        12.641  
    a60=29.798        10.927        11.037       11.165        11.305        11.461        11.631       11.813       12.016       12.234       12.469         12.71  
    a61=30.303        11.017        11.126       11.252         11.39        11.545        11.712       11.892       12.092       12.307        12.54        12.779  
    a62=30.8081       11.107        11.214       11.338        11.475        11.627        11.792        11.97       12.168        12.38       12.611        12.847  
    a63=31.3131       11.195        11.301       11.423        11.558        11.708        11.871       12.047       12.242       12.452       12.681        12.914  
    a64=31.8182       11.282        11.386       11.507         11.64        11.787        11.949       12.124       12.316       12.524       12.749        12.981  
    a65=32.3232       11.367         11.47        11.59        11.721        11.866        12.026       12.199       12.389       12.594       12.818        13.046  
    a66=32.8283       11.452        11.554       11.672        11.802        11.944        12.103       12.274       12.461       12.664       12.885        13.112  
    a67=33.3333       11.535        11.636       11.752        11.881        12.021        12.178       12.347       12.532       12.734       12.952        13.176  
    a68=33.8384       11.617        11.717       11.832        11.959        12.098        12.252        12.42       12.603       12.802       13.018         13.24  
    a69=34.3434       11.698        11.797       11.911        12.036        12.173        12.326       12.492       12.672        12.87       13.084        13.303  
    a70=34.8485       11.778        11.876       11.988        12.112        12.248        12.399       12.563       12.741       12.937       13.149        13.366  
    a71=35.3535       11.858        11.954       12.065        12.188        12.322         12.47       12.633       12.809       13.003       13.213        13.428  
    a72=35.8586       11.936        12.031       12.141        12.262        12.395        12.541       12.702       12.877       13.069       13.276        13.489  
    a73=36.3636       12.013        12.107       12.216        12.336        12.467        12.612       12.771       12.943       13.134       13.339        13.549  
    a74=36.8687       12.089        12.182        12.29        12.409        12.538        12.681       12.839       13.009       13.198       13.401        13.609  
    a75=37.3737       12.164        12.257       12.363        12.481        12.609         12.75       12.906       13.074       13.261       13.462        13.668  
    a76=37.8788       12.238         12.33       12.435        12.552        12.679        12.818       12.972       13.139       13.324       13.522        13.727  
    a77=38.3838       12.312        12.402       12.507        12.622        12.747        12.885       13.038       13.203       13.386       13.582        13.785  
    a78=38.8889       12.385        12.474       12.577        12.691        12.816        12.951       13.103       13.266       13.447       13.642        13.842  
    a79=39.3939       12.458        12.545       12.647         12.76        12.883        13.017       13.167       13.329       13.508       13.701        13.899  
    a80=39.899        12.529        12.615       12.716        12.828         12.95        13.082        13.23       13.391       13.568       13.759        13.955  
    a81=40.404        12.599        12.684       12.784        12.895        13.016        13.147       13.293       13.453       13.628       13.817        14.011  
    a82=40.9091       12.669        12.753       12.852        12.961        13.081        13.211       13.356       13.513       13.687       13.874        14.067  
    a83=41.4141       12.738        12.821       12.919        13.027        13.145        13.274       13.417       13.574       13.746        13.93        14.121  
    a84=41.9192       12.806        12.889       12.984        13.092        13.209        13.337       13.478       13.633       13.803       13.986        14.175  
    a85=42.4242       12.873        12.955        13.05        13.156        13.273        13.399       13.539       13.692       13.861       14.042        14.229  
    a86=42.9293        12.94        13.021       13.115         13.22        13.335         13.46       13.598       13.751       13.918       14.097        14.282  
    a87=43.4343       13.006        13.086       13.179        13.283        13.397        13.521       13.658       13.809       13.974       14.151        14.335  
    a88=43.9394       13.072        13.151       13.242        13.345        13.458        13.581       13.716       13.866       14.029       14.205        14.387  
    a89=44.4444       13.136        13.214       13.305        13.407        13.519        13.641       13.774       13.923       14.085       14.259        14.439  
    a90=44.9495         13.2        13.278       13.368        13.468        13.579          13.7       13.832       13.979       14.139       14.312        14.491  
    a91=45.4545       13.263         13.34       13.429        13.528        13.638        13.758       13.889       14.035       14.193       14.365        14.542  
    a92=45.9596       13.326        13.402        13.49        13.588        13.697        13.816       13.945        14.09       14.247       14.417        14.593  
    a93=46.4646       13.388        13.463       13.551        13.647        13.755        13.873       14.001       14.145         14.3       14.469        14.643  
    a94=46.9697       13.449        13.524        13.61        13.706        13.813         13.93       14.057       14.199       14.353        14.52        14.693  
    a95=47.4747        13.51        13.584        13.67        13.765         13.87        13.986       14.112       14.252       14.405       14.571        14.742  
    a96=47.9798        13.57        13.643       13.728        13.822        13.927        14.042       14.167       14.306       14.456       14.622        14.792  
    a97=48.4848        13.63        13.702       13.786        13.879        13.983        14.097       14.221       14.358       14.508       14.672         14.84  
    a98=48.9899       13.689         13.76       13.844        13.936        14.038        14.151       14.274        14.41       14.559       14.721        14.888  
    a99=49.4949       13.747        13.818       13.901        13.992        14.093        14.205       14.327       14.462       14.609        14.77        14.936  
    a100=50           13.805        13.875       13.957        14.048        14.148        14.259        14.38       14.514        14.66       14.819        14.984  

tb_pol_a
                   z1_0_34664    z2_0_42338    z3_0_51712    z4_0_63162    z5_0_77146    z6_0_94226    z7_1_1509    z8_1_4057    z9_1_7169    z10_2_097    z11_2_5613
                   __________    __________    __________    __________    __________    __________    _________    _________    _________    _________    __________

    a1=0                  0             0             0             0             0             0             0            0      0.50505      1.0101        1.5152  
    a2=0.505051           0             0             0             0             0       0.50505       0.50505      0.50505       1.0101      1.5152        2.0202  
    a3=1.0101       0.50505       0.50505       0.50505       0.50505       0.50505        1.0101        1.0101       1.0101       1.5152      2.0202        2.5253  
    a4=1.51515       1.0101        1.0101        1.0101        1.0101        1.0101        1.5152        1.5152       1.5152       2.0202      2.5253        2.5253  
    a5=2.0202        1.5152        1.5152        1.5152        1.5152        1.5152        1.5152        2.0202       2.0202       2.5253      3.0303        3.0303  
    a6=2.52525       2.0202        2.0202        2.0202        2.0202        2.0202        2.0202        2.5253       2.5253       3.0303      3.0303        3.5354  
    a7=3.0303        2.5253        2.5253        2.5253        2.5253        2.5253        2.5253        3.0303       3.0303       3.5354      3.5354        4.0404  
    a8=3.53535       2.5253        3.0303        3.0303        3.0303        3.0303        3.0303        3.5354       3.5354       4.0404      4.0404        4.5455  
    a9=4.0404        3.0303        3.0303        3.5354        3.5354        3.5354        3.5354        4.0404       4.0404       4.5455      4.5455        5.0505  
    a10=4.54545      3.5354        3.5354        3.5354        4.0404        4.0404        4.0404        4.0404       4.5455       5.0505      5.0505        5.5556  
    a11=5.05051      4.0404        4.0404        4.0404        4.5455        4.5455        4.5455        4.5455       5.0505       5.0505      5.5556        6.0606  
    a12=5.55556      4.5455        4.5455        4.5455        5.0505        5.0505        5.0505        5.0505       5.5556       5.5556      6.0606        6.5657  
    a13=6.06061      5.0505        5.0505        5.0505        5.0505        5.5556        5.5556        5.5556       6.0606       6.0606      6.5657        7.0707  
    a14=6.56566      5.5556        5.5556        5.5556        5.5556        6.0606        6.0606        6.0606       6.5657       6.5657      7.0707        7.5758  
    a15=7.07071      6.0606        6.0606        6.0606        6.0606        6.5657        6.5657        6.5657       7.0707       7.0707      7.5758        8.0808  
    a16=7.57576      6.5657        6.5657        6.5657        6.5657        6.5657        7.0707        7.0707       7.5758       7.5758      8.0808        8.5859  
    a17=8.08081      7.0707        7.0707        7.0707        7.0707        7.0707        7.5758        7.5758       8.0808       8.0808      8.5859        9.0909  
    a18=8.58586      7.5758        7.5758        7.5758        7.5758        7.5758        8.0808        8.0808       8.0808       8.5859      9.0909         9.596  
    a19=9.09091      8.0808        8.0808        8.0808        8.0808        8.0808        8.5859        8.5859       8.5859       9.0909       9.596        10.101  
    a20=9.59596      8.5859        8.5859        8.5859        8.5859        8.5859        9.0909        9.0909       9.0909        9.596      10.101        10.606  
    a21=10.101       9.0909        9.0909        9.0909        9.0909        9.0909         9.596         9.596        9.596       10.101      10.606        11.111  
    a22=10.6061       9.596         9.596         9.596         9.596         9.596         9.596        10.101       10.101       10.606      11.111        11.616  
    a23=11.1111       9.596        10.101        10.101        10.101        10.101        10.101        10.606       10.606       11.111      11.616        12.121  
    a24=11.6162      10.101        10.606        10.606        10.606        10.606        10.606        11.111       11.111       11.616      12.121        12.626  
    a25=12.1212      10.606        11.111        11.111        11.111        11.111        11.111        11.616       11.616       12.121      12.626        13.131  
    a26=12.6263      11.111        11.111        11.616        11.616        11.616        11.616        12.121       12.121       12.626      13.131        13.636  
    a27=13.1313      11.616        11.616        12.121        12.121        12.121        12.121        12.626       12.626       13.131      13.636        13.636  
    a28=13.6364      12.121        12.121        12.626        12.626        12.626        12.626        13.131       13.131       13.636      13.636        14.141  
    a29=14.1414      12.626        12.626        12.626        13.131        13.131        13.131        13.636       13.636       14.141      14.141        14.646  
    a30=14.6465      13.131        13.131        13.131        13.636        13.636        13.636        14.141       14.141       14.646      14.646        15.152  
    a31=15.1515      13.636        13.636        13.636        14.141        14.141        14.141        14.141       14.646       15.152      15.152        15.657  
    a32=15.6566      14.141        14.141        14.141        14.646        14.646        14.646        14.646       15.152       15.657      15.657        16.162  
    a33=16.1616      14.646        14.646        14.646        14.646        15.152        15.152        15.152       15.657       16.162      16.162        16.667  
    a34=16.6667      15.152        15.152        15.152        15.152        15.657        15.657        15.657       16.162       16.162      16.667        17.172  
    a35=17.1717      15.657        15.657        15.657        15.657        16.162        16.162        16.162       16.667       16.667      17.172        17.677  
    a36=17.6768      16.162        16.162        16.162        16.162        16.667        16.667        16.667       17.172       17.172      17.677        18.182  
    a37=18.1818      16.667        16.667        16.667        16.667        17.172        17.172        17.172       17.677       17.677      18.182        18.687  
    a38=18.6869      17.172        17.172        17.172        17.172        17.677        17.677        17.677       18.182       18.182      18.687        19.192  
    a39=19.1919      17.677        17.677        17.677        17.677        17.677        18.182        18.182       18.687       18.687      19.192        19.697  
    a40=19.697       18.182        18.182        18.182        18.182        18.182        18.687        18.687       19.192       19.192      19.697        20.202  
    a41=20.202       18.687        18.687        18.687        18.687        18.687        19.192        19.192       19.697       19.697      20.202        20.707  
    a42=20.7071      19.192        19.192        19.192        19.192        19.192        19.697        19.697       20.202       20.202      20.707        21.212  
    a43=21.2121      19.697        19.697        19.697        19.697        19.697        20.202        20.202       20.707       20.707      21.212        21.717  
    a44=21.7172      20.202        20.202        20.202        20.202        20.202        20.707        20.707       20.707       21.212      21.717        22.222  
    a45=22.2222      20.707        20.707        20.707        20.707        20.707        21.212        21.212       21.212       21.717      22.222        22.727  
    a46=22.7273      21.212        21.212        21.212        21.212        21.212        21.717        21.717       21.717       22.222      22.727        23.232  
    a47=23.2323      21.212        21.717        21.717        21.717        21.717        22.222        22.222       22.222       22.727      23.232        23.737  
    a48=23.7374      21.717        22.222        22.222        22.222        22.222        22.222        22.727       22.727       23.232      23.737        24.242  
    a49=24.2424      22.222        22.727        22.727        22.727        22.727        22.727        23.232       23.232       23.737      24.242        24.747  
    a50=24.7475      22.727        22.727        23.232        23.232        23.232        23.232        23.737       23.737       24.242      24.747        25.253  
    a51=25.2525      23.232        23.232        23.737        23.737        23.737        23.737        24.242       24.242       24.747      25.253        25.758  
    a52=25.7576      23.737        23.737        24.242        24.242        24.242        24.242        24.747       24.747       25.253      25.758        26.263  
    a53=26.2626      24.242        24.242        24.747        24.747        24.747        24.747        25.253       25.253       25.758      26.263        26.768  
    a54=26.7677      24.747        24.747        25.253        25.253        25.253        25.253        25.758       25.758       26.263      26.768        27.273  
    a55=27.2727      25.253        25.253        25.253        25.758        25.758        25.758        26.263       26.263       26.768      27.273        27.778  
    a56=27.7778      25.758        25.758        25.758        26.263        26.263        26.263        26.768       26.768       27.273      27.273        27.778  
    a57=28.2828      26.263        26.263        26.263        26.768        26.768        26.768        27.273       27.273       27.778      27.778        28.283  
    a58=28.7879      26.768        26.768        26.768        27.273        27.273        27.273        27.778       27.778       28.283      28.283        28.788  
    a59=29.2929      27.273        27.273        27.273        27.778        27.778        27.778        28.283       28.283       28.788      28.788        29.293  
    a60=29.798       27.778        27.778        27.778        27.778        28.283        28.283        28.283       28.788       29.293      29.293        29.798  
    a61=30.303       28.283        28.283        28.283        28.283        28.788        28.788        28.788       29.293       29.798      29.798        30.303  
    a62=30.8081      28.788        28.788        28.788        28.788        29.293        29.293        29.293       29.798       30.303      30.303        30.808  
    a63=31.3131      29.293        29.293        29.293        29.293        29.798        29.798        29.798       30.303       30.303      30.808        31.313  
    a64=31.8182      29.798        29.798        29.798        29.798        30.303        30.303        30.303       30.808       30.808      31.313        31.818  
    a65=32.3232      30.303        30.303        30.303        30.303        30.808        30.808        30.808       31.313       31.313      31.818        32.323  
    a66=32.8283      30.808        30.808        30.808        30.808        31.313        31.313        31.313       31.818       31.818      32.323        32.828  
    a67=33.3333      31.313        31.313        31.313        31.313        31.818        31.818        31.818       32.323       32.323      32.828        33.333  
    a68=33.8384      31.818        31.818        31.818        31.818        31.818        32.323        32.323       32.828       32.828      33.333        33.838  
    a69=34.3434      32.323        32.323        32.323        32.323        32.323        32.828        32.828       33.333       33.333      33.838        34.343  
    a70=34.8485      32.828        32.828        32.828        32.828        32.828        33.333        33.333       33.838       33.838      34.343        34.848  
    a71=35.3535      33.333        33.333        33.333        33.333        33.333        33.838        33.838       34.343       34.343      34.848        35.354  
    a72=35.8586      33.838        33.838        33.838        33.838        33.838        34.343        34.343       34.848       34.848      35.354        35.859  
    a73=36.3636      34.343        34.343        34.343        34.343        34.343        34.848        34.848       35.354       35.354      35.859        36.364  
    a74=36.8687      34.848        34.848        34.848        34.848        34.848        35.354        35.354       35.859       35.859      36.364        36.869  
    a75=37.3737      35.354        35.354        35.354        35.354        35.354        35.859        35.859       35.859       36.364      36.869        37.374  
    a76=37.8788      35.859        35.859        35.859        35.859        35.859        36.364        36.364       36.364       36.869      37.374        37.879  
    a77=38.3838      35.859        36.364        36.364        36.364        36.364        36.869        36.869       36.869       37.374      37.879        38.384  
    a78=38.8889      36.364        36.869        36.869        36.869        36.869        36.869        37.374       37.374       37.879      38.384        38.889  
    a79=39.3939      36.869        37.374        37.374        37.374        37.374        37.374        37.879       37.879       38.384      38.889        39.394  
    a80=39.899       37.374        37.879        37.879        37.879        37.879        37.879        38.384       38.384       38.889      39.394        39.899  
    a81=40.404       37.879        37.879        38.384        38.384        38.384        38.384        38.889       38.889       39.394      39.899        40.404  
    a82=40.9091      38.384        38.384        38.889        38.889        38.889        38.889        39.394       39.394       39.899      40.404        40.909  
    a83=41.4141      38.889        38.889        39.394        39.394        39.394        39.394        39.899       39.899       40.404      40.909        41.414  
    a84=41.9192      39.394        39.394        39.899        39.899        39.899        39.899        40.404       40.404       40.909      41.414        41.919  
    a85=42.4242      39.899        39.899        40.404        40.404        40.404        40.404        40.909       40.909       41.414      41.919        42.424  
    a86=42.9293      40.404        40.404        40.404        40.909        40.909        40.909        41.414       41.414       41.919      42.424        42.929  
    a87=43.4343      40.909        40.909        40.909        41.414        41.414        41.414        41.919       41.919       42.424      42.929        43.434  
    a88=43.9394      41.414        41.414        41.414        41.919        41.919        41.919        42.424       42.424       42.929      43.434        43.434  
    a89=44.4444      41.919        41.919        41.919        42.424        42.424        42.424        42.929       42.929       43.434      43.434        43.939  
    a90=44.9495      42.424        42.424        42.424        42.929        42.929        42.929        43.434       43.434       43.939      43.939        44.444  
    a91=45.4545      42.929        42.929        42.929        43.434        43.434        43.434        43.939       43.939       44.444      44.444        44.949  
    a92=45.9596      43.434        43.434        43.434        43.434        43.939        43.939        43.939       44.444       44.949      44.949        45.455  
    a93=46.4646      43.939        43.939        43.939        43.939        44.444        44.444        44.444       44.949       45.455      45.455         45.96  
    a94=46.9697      44.444        44.444        44.444        44.444        44.949        44.949        44.949       45.455        45.96       45.96        46.465  
    a95=47.4747      44.949        44.949        44.949        44.949        45.455        45.455        45.455        45.96       46.465      46.465         46.97  
    a96=47.9798      45.455        45.455        45.455        45.455         45.96         45.96         45.96       46.465        46.97       46.97        47.475  
    a97=48.4848       45.96         45.96         45.96         45.96        46.465        46.465        46.465        46.97        46.97      47.475         47.98  
    a98=48.9899      46.465        46.465        46.465        46.465         46.97         46.97         46.97       47.475       47.475       47.98        48.485  
    a99=49.4949       46.97         46.97         46.97         46.97        47.475        47.475        47.475        47.98        47.98      48.485         48.99  
    a100=50          47.475        47.475        47.475        47.475         47.98         47.98         47.98       48.485       48.485       48.99        49.495  

</pre><img vspace="5" hspace="5" src="ff_az_vf_01.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_02.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_03.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_04.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_05.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_06.png" alt=""> <img vspace="5" hspace="5" src="ff_az_vf_07.png" alt=""> <pre class="codeinput"><span class="keyword">end</span>
</pre><pre class="codeoutput">
ans = 

  Map with properties:

        Count: 11
      KeyType: char
    ValueType: any

</pre><p class="footer"><br><a href="https://www.mathworks.com/products/matlab/">Published with MATLAB&reg; R2019a</a><br></p></div><!--
##### SOURCE BEGIN #####
%% 
% *back to <https://fanwangecon.github.io Fan>'s
% <https://fanwangecon.github.io/CodeDynaAsset/ Dynamic Assets Repository> 
% Table of Content.*

function result_map = ff_az_vf(varargin)
%% FF_AZ_VF solve infinite horizon exo shock + endo asset problem
% This program solves the infinite horizon dynamic single asset and single
% shock problem with loops. It is useful to have a version of code that is
% looped for easy debugging. This is the standard dynamic exogenous
% incomplete borrowing and savings problem. 
%
% @param param_map container parameter container
%
% @param support_map container support container
%
% @param armt_map container container with states, choices and shocks
% grids that are inputs for grid based solution algorithm
%
% @param func_map container container with function handles for
% consumption cash-on-hand etc.
%
% @return result_map container contains policy function matrix, value
% function matrix, iteration results, and policy function, value function
% and iteration results tables. 
%
% keys included in result_map:
%
% * mt_val matrix states_n by shock_n matrix of converged value function grid
% * mt_pol_a matrix states_n by shock_n matrix of converged policy function grid
% * ar_val_diff_norm array if bl_post = true it_iter_last by 1 val function
% difference between iteration
% * ar_pol_diff_norm array if bl_post = true it_iter_last by 1 policy
% function difference between iterations
% * mt_pol_perc_change matrix if bl_post = true it_iter_last by shock_n the
% proportion of grid points at which policy function changed between
% current and last iteration for each element of shock
%
% @example
%
% @include
%
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_set_default_param.m ffs_az_set_default_param>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/paramfunc/ffs_az_get_funcgrid.m ffs_az_get_funcgrid>
% * <https://github.com/FanWangEcon/CodeDynaAsset/blob/master/m_az/solvepost/ff_az_vf_post.m ff_az_vf_post>
%


%% Default
% * it_param_set = 1: quick test
% * it_param_set = 2: benchmark run
% * it_param_set = 3: benchmark profile
% * it_param_set = 4: press publish button

it_param_set = 4;
bl_input_override = true;
[param_map, support_map] = ffs_az_set_default_param(it_param_set);
[armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override); % 1 for override
default_params = {param_map support_map armt_map func_map};

%% Parse Parameters 1

% if varargin only has param_map and support_map,
params_len = length(varargin);
[default_params{1:params_len}] = varargin{:};
param_map = [param_map; default_params{1}];
support_map = [support_map; default_params{2}];
if params_len >= 1 && params_len <= 2
    % If override param_map, re-generate armt and func if they are not
    % provided
    bl_input_override = true;
    [armt_map, func_map] = ffs_az_get_funcgrid(param_map, support_map, bl_input_override);
else
    % Override all
    armt_map = [armt_map; default_params{3}];
    func_map = [func_map; default_params{4}];
end

% append function name
st_func_name = 'ff_az_vf';
support_map('st_profile_name_main') = [st_func_name support_map('st_profile_name_main')];
support_map('st_mat_name_main') = [st_func_name support_map('st_mat_name_main')];
support_map('st_img_name_main') = [st_func_name support_map('st_img_name_main')];

%% Parse Parameters 2

% armt_map
params_group = values(armt_map, {'ar_a', 'mt_z_trans', 'ar_z'});
[ar_a, mt_z_trans, ar_z] = params_group{:};
% func_map
params_group = values(func_map, {'f_util_log', 'f_util_crra', 'f_cons'});
[f_util_log, f_util_crra, f_cons] = params_group{:};
% param_map
params_group = values(param_map, {'fl_r_save', 'fl_r_borr', 'fl_w',...
    'it_a_n', 'it_z_n', 'fl_crra', 'fl_beta', 'fl_c_min'});
[fl_r_save, fl_r_borr, fl_wage, it_a_n, it_z_n, fl_crra, fl_beta, fl_c_min] = params_group{:};
params_group = values(param_map, {'it_maxiter_val', 'fl_tol_val', 'fl_tol_pol', 'it_tol_pol_nochange'});
[it_maxiter_val, fl_tol_val, fl_tol_pol, it_tol_pol_nochange] = params_group{:};
% support_map
params_group = values(support_map, {'bl_profile', 'st_profile_path', ...
    'st_profile_prefix', 'st_profile_name_main', 'st_profile_suffix',...
    'bl_time', 'bl_display', 'it_display_every', 'bl_post'});
[bl_profile, st_profile_path, ...
    st_profile_prefix, st_profile_name_main, st_profile_suffix, ...
    bl_time, bl_display, it_display_every, bl_post] = params_group{:};

%% Initialize Output Matrixes

mt_val_cur = zeros(length(ar_a),length(ar_z));
mt_val = mt_val_cur - 1;
mt_pol_a = zeros(length(ar_a),length(ar_z));
mt_pol_a_cur = mt_pol_a - 1;

%% Initialize Convergence Conditions

bl_vfi_continue = true;
it_iter = 0;
ar_val_diff_norm = zeros([it_maxiter_val, 1]);
ar_pol_diff_norm = zeros([it_maxiter_val, 1]);
mt_pol_perc_change = zeros([it_maxiter_val, it_z_n]);

%% Iterate Value Function
% Loop solution with 4 nested loops
%
% # loop 1: over exogenous states
% # loop 2: over endogenous states
% # loop 3: over choices
% # loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
%

% Start Profile
if (bl_profile)
    close all;
    profile off;
    profile on;
end

% Start Timer
if (bl_time)
    tic;
end

% Value Function Iteration
while bl_vfi_continue
    it_iter = it_iter + 1;
    
    %% Solve Optimization Problem Current Iteration
    
    % loop 1: over exogenous states
    for it_z_i = 1:length(ar_z)
        fl_z = ar_z(it_z_i);
        
        % loop 2: over endogenous states
        for it_a_j = 1:length(ar_a)
            fl_a = ar_a(it_a_j);
            ar_val_cur = zeros(size(ar_a));
            
            % loop 3: over choices
            for it_ap_k = 1:length(ar_a)
                fl_ap = ar_a(it_ap_k);
                fl_c = f_cons(fl_z, fl_a, fl_ap);
%                 fl_c = fl_z*fl_wage + fl_a.*((1+fl_r_save).*(b>0) + (1+fl_r_borr).*(b<=0)) - fl_ap;
                
                % current utility
                if (fl_crra == 1)
                    ar_val_cur(it_ap_k) = f_util_log(fl_c);
                    fl_u_neg_c = f_util_log(fl_c_min);
                else
                    ar_val_cur(it_ap_k) = f_util_crra(fl_c);
                    fl_u_neg_c = f_util_crra(fl_c_min);
                end
                
                % loop 4: add future utility, integrationREPLACE_WITH_DASH_DASHloop over future shocks
                for it_ap_q = 1:length(ar_z)
                    ar_val_cur(it_ap_k) = ar_val_cur(it_ap_k) + fl_beta*mt_z_trans(it_z_i,it_ap_q)*mt_val_cur(it_ap_k,it_ap_q);
                end
                
                % Replace if negative consumption
                if fl_c <= 0
                    ar_val_cur(it_ap_k) = fl_u_neg_c;
                end
                
            end
            
            % maximization over loop 3 choices for loop 1+2 states
            it_max_lin_idx = find(ar_val_cur == max(ar_val_cur));
            mt_val(it_a_j,it_z_i) = ar_val_cur(it_max_lin_idx(1));
            mt_pol_a(it_a_j,it_z_i) = ar_a(it_max_lin_idx(1));
            
        end
    end
    
    %% Check Tolerance and Continuation
    
    % Difference across iterations
    ar_val_diff_norm(it_iter) = norm(mt_val - mt_val_cur);
    ar_pol_diff_norm(it_iter) = norm(mt_pol_a - mt_pol_a_cur);
    mt_pol_perc_change(it_iter, :) = sum((mt_pol_a ~= mt_pol_a_cur))/(it_a_n);
    
    % Update
    mt_val_cur = mt_val;
    mt_pol_a_cur = mt_pol_a;
    
    % Print Iteration Results
    if (bl_display && (rem(it_iter, it_display_every)==0))
        fprintf('VAL it_iter:%d, fl_diff:%d, fl_diff_pol:%d\n', ...
            it_iter, ar_val_diff_norm(it_iter), ar_pol_diff_norm(it_iter));
        tb_valpol_iter = array2table([mean(mt_val_cur,1); mean(mt_pol_a_cur,1); ...
            mt_val_cur(it_a_n,:); mt_pol_a_cur(it_a_n,:)]);
        tb_valpol_iter.Properties.VariableNames = strcat('z', string((1:size(mt_val_cur,2))));
        tb_valpol_iter.Properties.RowNames = {'mval', 'map', 'Hval', 'Hpol'};
        disp('mval = mean(mt_val_cur,1), average value over a')
        disp('map  = mean(mt_pol_a_cur,1), average choice over a')
        disp('Hval = mt_val_cur(it_a_n,:), highest a state val')
        disp('mval = mt_pol_a_cur(it_a_n,:), highest a state choice')
        disp(tb_valpol_iter);
    end
    
    % Continuation Conditions:
    % 1. if value function convergence criteria reached
    % 2. if policy function variation over iterations is less than
    % threshold
    if (it_iter == (it_maxiter_val + 1))
        bl_vfi_continue = false;
    elseif ((it_iter == it_maxiter_val) || ...
            (ar_val_diff_norm(it_iter) < fl_tol_val) || ...
            (sum(ar_pol_diff_norm(max(1, it_iter-it_tol_pol_nochange):it_iter)) < fl_tol_pol))
        % Fix to max, run again to save results if needed
        it_iter_last = it_iter;
        it_iter = it_maxiter_val;        
    end
    
end

% End Timer
if (bl_time)
    toc;
end

% End Profile
if (bl_profile)
    profile off
    profile viewer
    st_file_name = [st_profile_prefix st_profile_name_main st_profile_suffix];
    profsave(profile('info'), strcat(st_profile_path, st_file_name));
end

%% Process Optimal Choices

result_map = containers.Map('KeyType','char', 'ValueType','any');
result_map('mt_val') = mt_val;
result_map('mt_pol_a') = mt_pol_a;

if (bl_post)
    bl_input_override = true;
    result_map('ar_val_diff_norm') = ar_val_diff_norm(1:it_iter_last);
    result_map('ar_pol_diff_norm') = ar_pol_diff_norm(1:it_iter_last);
    result_map('mt_pol_perc_change') = mt_pol_perc_change(1:it_iter_last, :);
    result_map = ff_az_vf_post(param_map, support_map, armt_map, func_map, result_map, bl_input_override);
end

end

##### SOURCE END #####
--></body></html>